function _mergeNamespaces(K,C){for(var d=0;d<C.length;d++){const A=C[d];if(typeof A!="string"&&!Array.isArray(A)){for(const S in A)if(S!=="default"&&!(S in K)){const w=Object.getOwnPropertyDescriptor(A,S);w&&Object.defineProperty(K,S,w.get?w:{enumerable:!0,get:()=>A[S]})}}}return Object.freeze(Object.defineProperty(K,Symbol.toStringTag,{value:"Module"}))}function getDefaultExportFromCjs(K){return K&&K.__esModule&&Object.prototype.hasOwnProperty.call(K,"default")?K.default:K}var _3Dmol$3={exports:{}};/*!
 * 3dmol v2.5.3
 * JavaScript/TypeScript molecular visualization library
 * Author: David Koes and contributors
 */var _3Dmol$2=_3Dmol$3.exports,hasRequired_3Dmol;function require_3Dmol(){return hasRequired_3Dmol||(hasRequired_3Dmol=1,function(module,exports){(function(C,d){module.exports=d()})(_3Dmol$2,()=>(()=>{var __webpack_modules__={"./node_modules/iobuffer/lib-esm/IOBuffer.js":(K,C,d)=>{d.r(C),d.d(C,{IOBuffer:()=>p});var A=d("./node_modules/iobuffer/lib-esm/text.js");const S=1024*8,w=(()=>{const x=new Uint8Array(4),M=new Uint32Array(x.buffer);return!((M[0]=1)&x[0])})(),O={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class p{buffer;byteLength;byteOffset;length;offset;lastWrittenByte;littleEndian;_data;_mark;_marks;constructor(M=S,v={}){let b=!1;typeof M=="number"?M=new ArrayBuffer(M):(b=!0,this.lastWrittenByte=M.byteLength);const _=v.offset?v.offset>>>0:0,g=M.byteLength-_;let m=_;(ArrayBuffer.isView(M)||M instanceof p)&&(M.byteLength!==M.buffer.byteLength&&(m=M.byteOffset+_),M=M.buffer),b?this.lastWrittenByte=g:this.lastWrittenByte=0,this.buffer=M,this.length=g,this.byteLength=g,this.byteOffset=m,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,m,g),this._mark=0,this._marks=[]}available(M=1){return this.offset+M<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(M=1){return this.offset+=M,this}back(M=1){return this.offset-=M,this}seek(M){return this.offset=M,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const M=this._marks.pop();if(M===void 0)throw new Error("Mark stack empty");return this.seek(M),this}rewind(){return this.offset=0,this}ensureAvailable(M=1){if(!this.available(M)){const b=(this.offset+M)*2,_=new Uint8Array(b);_.set(new Uint8Array(this.buffer)),this.buffer=_.buffer,this.length=b,this.byteLength=b,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(M=1){return this.readArray(M,"uint8")}readArray(M,v){const b=O[v].BYTES_PER_ELEMENT*M,_=this.byteOffset+this.offset,g=this.buffer.slice(_,_+b);if(this.littleEndian===w&&v!=="uint8"&&v!=="int8"){const r=new Uint8Array(this.buffer.slice(_,_+b));r.reverse();const e=new O[v](r.buffer);return this.offset+=b,e.reverse(),e}const m=new O[v](g);return this.offset+=b,m}readInt16(){const M=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,M}readUint16(){const M=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,M}readInt32(){const M=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,M}readUint32(){const M=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,M}readFloat32(){const M=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,M}readFloat64(){const M=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,M}readBigInt64(){const M=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,M}readBigUint64(){const M=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,M}readChar(){return String.fromCharCode(this.readInt8())}readChars(M=1){let v="";for(let b=0;b<M;b++)v+=this.readChar();return v}readUtf8(M=1){return(0,A.decode)(this.readBytes(M))}decodeText(M=1,v="utf8"){return(0,A.decode)(this.readBytes(M),v)}writeBoolean(M){return this.writeUint8(M?255:0),this}writeInt8(M){return this.ensureAvailable(1),this._data.setInt8(this.offset++,M),this._updateLastWrittenByte(),this}writeUint8(M){return this.ensureAvailable(1),this._data.setUint8(this.offset++,M),this._updateLastWrittenByte(),this}writeByte(M){return this.writeUint8(M)}writeBytes(M){this.ensureAvailable(M.length);for(let v=0;v<M.length;v++)this._data.setUint8(this.offset++,M[v]);return this._updateLastWrittenByte(),this}writeInt16(M){return this.ensureAvailable(2),this._data.setInt16(this.offset,M,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(M){return this.ensureAvailable(2),this._data.setUint16(this.offset,M,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(M){return this.ensureAvailable(4),this._data.setInt32(this.offset,M,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(M){return this.ensureAvailable(4),this._data.setUint32(this.offset,M,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(M){return this.ensureAvailable(4),this._data.setFloat32(this.offset,M,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(M){return this.ensureAvailable(8),this._data.setFloat64(this.offset,M,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(M){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,M,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(M){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,M,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(M){return this.writeUint8(M.charCodeAt(0))}writeChars(M){for(let v=0;v<M.length;v++)this.writeUint8(M.charCodeAt(v));return this}writeUtf8(M){return this.writeBytes((0,A.encode)(M))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}},"./node_modules/iobuffer/lib-esm/text.js":(K,C,d)=>{d.r(C),d.d(C,{decode:()=>A,encode:()=>w});function A(O,p="utf8"){return new TextDecoder(p).decode(O)}const S=new TextEncoder;function w(O){return S.encode(O)}},"./node_modules/netcdfjs/lib-esm/data.js":(K,C,d)=>{d.r(C),d.d(C,{nonRecord:()=>S,record:()=>w});var A=d("./node_modules/netcdfjs/lib-esm/types.js");function S(O,p){const x=(0,A.str2num)(p.type),M=p.size/(0,A.num2bytes)(x),v=new Array(M);for(let b=0;b<M;b++)v[b]=(0,A.readType)(O,x,1);return v}function w(O,p,x){const M=(0,A.str2num)(p.type),v=p.size?p.size/(0,A.num2bytes)(M):1,b=x.length,_=new Array(b),g=x.recordStep;if(g)for(let m=0;m<b;m++){const r=O.offset;_[m]=(0,A.readType)(O,M,v),O.seek(r+g)}else throw new Error("recordDimension.recordStep is undefined");return _}},"./node_modules/netcdfjs/lib-esm/header.js":(K,C,d)=>{d.r(C),d.d(C,{header:()=>v});var A=d("./node_modules/netcdfjs/lib-esm/types.js"),S=d("./node_modules/netcdfjs/lib-esm/utils.js");const w=0,O=10,p=11,x=12,M=0;function v(m,r){const e={version:r},t={length:m.readUint32()},n=b(m);Array.isArray(n)||(t.id=n.recordId,t.name=n.recordName,e.dimensions=n.dimensions),e.globalAttributes=_(m);const o=g(m,t?.id,r);return Array.isArray(o)||(e.variables=o.variables,t.recordStep=o.recordStep),e.recordDimension=t,e}function b(m){const r={};let e,t;const n=m.readUint32();let o;if(n===w)return(0,S.notNetcdf)(m.readUint32()!==w,"wrong empty tag for list of dimensions"),[];{(0,S.notNetcdf)(n!==O,"wrong tag for list of dimensions");const h=m.readUint32();o=new Array(h);for(let f=0;f<h;f++){const i=(0,S.readName)(m),s=m.readUint32();s===M&&(e=f,t=i),o[f]={name:i,size:s}}}return e!==void 0&&(r.recordId=e),t!==void 0&&(r.recordName=t),r.dimensions=o,r}function _(m){const r=m.readUint32();let e;if(r===w)return(0,S.notNetcdf)(m.readUint32()!==w,"wrong empty tag for list of attributes"),[];{(0,S.notNetcdf)(r!==x,"wrong tag for list of attributes");const t=m.readUint32();e=new Array(t);for(let n=0;n<t;n++){const o=(0,S.readName)(m),h=m.readUint32();(0,S.notNetcdf)(h<1||h>6,`non valid type ${h}`);const f=m.readUint32(),i=(0,A.readType)(m,h,f);(0,S.padding)(m),e[n]={name:o,type:(0,A.num2str)(h),value:i}}}return e}function g(m,r,e){const t=m.readUint32();let n=0,o;if(t===w)return(0,S.notNetcdf)(m.readUint32()!==w,"wrong empty tag for list of variables"),[];{(0,S.notNetcdf)(t!==p,"wrong tag for list of variables");const h=m.readUint32();o=new Array(h);for(let f=0;f<h;f++){const i=(0,S.readName)(m),s=m.readUint32(),a=new Array(s);for(let P=0;P<s;P++)a[P]=m.readUint32();const c=_(m),u=m.readUint32();(0,S.notNetcdf)(u<1&&u>6,`non valid type ${u}`);const E=m.readUint32();let T=m.readUint32();e===2&&((0,S.notNetcdf)(T>0,"offsets larger than 4GB not supported"),T=m.readUint32());let L=!1;typeof r<"u"&&a[0]===r&&(n+=E,L=!0),o[f]={name:i,dimensions:a,attributes:c,type:(0,A.num2str)(u),size:E,offset:T,record:L}}}return{variables:o,recordStep:n}}},"./node_modules/netcdfjs/lib-esm/index.js":(K,C,d)=>{d.r(C),d.d(C,{NetCDFReader:()=>A.NetCDFReader});var A=d("./node_modules/netcdfjs/lib-esm/parser.js")},"./node_modules/netcdfjs/lib-esm/parser.js":(K,C,d)=>{d.r(C),d.d(C,{NetCDFReader:()=>x});var A=d("./node_modules/iobuffer/lib-esm/IOBuffer.js"),S=d("./node_modules/netcdfjs/lib-esm/data.js"),w=d("./node_modules/netcdfjs/lib-esm/header.js"),O=d("./node_modules/netcdfjs/lib-esm/toString.js"),p=d("./node_modules/netcdfjs/lib-esm/utils.js");class x{constructor(v){this.toString=O.toString;const b=new A.IOBuffer(v);b.setBigEndian(),(0,p.notNetcdf)(b.readChars(3)!=="CDF","should start with CDF");const _=b.readByte();(0,p.notNetcdf)(_>2,"unknown version"),this.header=(0,w.header)(b,_),this.buffer=b}get version(){return this.header.version===1?"classic format":"64-bit offset format"}get recordDimension(){return this.header.recordDimension}get dimensions(){return this.header.dimensions}get globalAttributes(){return this.header.globalAttributes}getAttribute(v){const b=this.globalAttributes.find(_=>_.name===v);return b?b.value:null}getDataVariableAsString(v){const b=this.getDataVariable(v);return b?b.join(""):null}get variables(){return this.header.variables}getDataVariable(v){let b;if(typeof v=="string"?b=this.header.variables.find(_=>_.name===v):b=v,b===void 0)throw new Error("Not a valid NetCDF v3.x file: variable not found");return this.buffer.seek(b.offset),b.record?(0,S.record)(this.buffer,b,this.header.recordDimension):(0,S.nonRecord)(this.buffer,b)}dataVariableExists(v){return this.header.variables.find(_=>_.name===v)!==void 0}attributeExists(v){return this.globalAttributes.find(_=>_.name===v)!==void 0}}},"./node_modules/netcdfjs/lib-esm/toString.js":(K,C,d)=>{d.r(C),d.d(C,{toString:()=>A});function A(){const S=[];S.push("DIMENSIONS");for(const O of this.dimensions)S.push(`  ${O.name.padEnd(30)} = size: ${O.size}`);S.push(""),S.push("GLOBAL ATTRIBUTES");for(const O of this.globalAttributes)S.push(`  ${O.name.padEnd(30)} = ${O.value}`);const w=JSON.parse(JSON.stringify(this.variables));S.push(""),S.push("VARIABLES:");for(const O of w){O.value=this.getDataVariable(O);let p=JSON.stringify(O.value);p.length>50&&(p=p.substring(0,50)),isNaN(O.value.length)||(p+=` (length: ${O.value.length})`),S.push(`  ${O.name.padEnd(30)} = ${p}`)}return S.join(`
`)}},"./node_modules/netcdfjs/lib-esm/types.js":(K,C,d)=>{d.r(C),d.d(C,{num2bytes:()=>w,num2str:()=>S,readType:()=>x,str2num:()=>O});const A={BYTE:1,CHAR:2,SHORT:3,INT:4,FLOAT:5,DOUBLE:6};function S(v){switch(Number(v)){case A.BYTE:return"byte";case A.CHAR:return"char";case A.SHORT:return"short";case A.INT:return"int";case A.FLOAT:return"float";case A.DOUBLE:return"double";default:return"undefined"}}function w(v){switch(Number(v)){case A.BYTE:return 1;case A.CHAR:return 1;case A.SHORT:return 2;case A.INT:return 4;case A.FLOAT:return 4;case A.DOUBLE:return 8;default:return-1}}function O(v){switch(String(v)){case"byte":return A.BYTE;case"char":return A.CHAR;case"short":return A.SHORT;case"int":return A.INT;case"float":return A.FLOAT;case"double":return A.DOUBLE;default:return-1}}function p(v,b){if(v!==1){const _=new Array(v);for(let g=0;g<v;g++)_[g]=b();return _}else return b()}function x(v,b,_){switch(b){case A.BYTE:return Array.from(v.readBytes(_));case A.CHAR:return M(v.readChars(_));case A.SHORT:return p(_,v.readInt16.bind(v));case A.INT:return p(_,v.readInt32.bind(v));case A.FLOAT:return p(_,v.readFloat32.bind(v));case A.DOUBLE:return p(_,v.readFloat64.bind(v));default:throw new Error(`non valid type ${b}`)}}function M(v){return v.charCodeAt(v.length-1)===0?v.substring(0,v.length-1):v}},"./node_modules/netcdfjs/lib-esm/utils.js":(K,C,d)=>{d.r(C),d.d(C,{notNetcdf:()=>A,padding:()=>S,readName:()=>w});function A(O,p){if(O)throw new TypeError(`Not a valid NetCDF v3.x file: ${p}`)}function S(O){O.offset%4!==0&&O.skip(4-O.offset%4)}function w(O){const p=O.readUint32(),x=O.readChars(p);return S(O),x}},"./node_modules/pako/dist/pako.esm.mjs":(K,C,d)=>{d.r(C),d.d(C,{Deflate:()=>Ur,Inflate:()=>Vr,constants:()=>Kr,default:()=>Gs,deflate:()=>Wr,deflateRaw:()=>Gr,gzip:()=>Nr,inflate:()=>jr,inflateRaw:()=>kr,ungzip:()=>Hr});/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const A=4,S=0,w=1,O=2;function p(l){let G=l.length;for(;--G>=0;)l[G]=0}const x=0,M=1,v=2,b=3,_=258,g=29,m=256,r=m+1+g,e=30,t=19,n=2*r+1,o=15,h=16,f=7,i=256,s=16,a=17,c=18,u=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),E=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),T=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),L=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),P=512,I=new Array((r+2)*2);p(I);const z=new Array(e*2);p(z);const B=new Array(P);p(B);const F=new Array(_-b+1);p(F);const W=new Array(g);p(W);const U=new Array(e);p(U);function R(l,G,y,X,J){this.static_tree=l,this.extra_bits=G,this.extra_base=y,this.elems=X,this.max_length=J,this.has_stree=l&&l.length}let V,q,ee;function se(l,G){this.dyn_tree=l,this.max_code=0,this.stat_desc=G}const ie=l=>l<256?B[l]:B[256+(l>>>7)],le=(l,G)=>{l.pending_buf[l.pending++]=G&255,l.pending_buf[l.pending++]=G>>>8&255},re=(l,G,y)=>{l.bi_valid>h-y?(l.bi_buf|=G<<l.bi_valid&65535,le(l,l.bi_buf),l.bi_buf=G>>h-l.bi_valid,l.bi_valid+=y-h):(l.bi_buf|=G<<l.bi_valid&65535,l.bi_valid+=y)},oe=(l,G,y)=>{re(l,y[G*2],y[G*2+1])},Ae=(l,G)=>{let y=0;do y|=l&1,l>>>=1,y<<=1;while(--G>0);return y>>>1},Me=l=>{l.bi_valid===16?(le(l,l.bi_buf),l.bi_buf=0,l.bi_valid=0):l.bi_valid>=8&&(l.pending_buf[l.pending++]=l.bi_buf&255,l.bi_buf>>=8,l.bi_valid-=8)},Oe=(l,G)=>{const y=G.dyn_tree,X=G.max_code,J=G.stat_desc.static_tree,$=G.stat_desc.has_stree,xe=G.stat_desc.extra_bits,ge=G.stat_desc.extra_base,Ze=G.stat_desc.max_length;let he,be,ot,Ke,Fe,Xe,xt=0;for(Ke=0;Ke<=o;Ke++)l.bl_count[Ke]=0;for(y[l.heap[l.heap_max]*2+1]=0,he=l.heap_max+1;he<n;he++)be=l.heap[he],Ke=y[y[be*2+1]*2+1]+1,Ke>Ze&&(Ke=Ze,xt++),y[be*2+1]=Ke,!(be>X)&&(l.bl_count[Ke]++,Fe=0,be>=ge&&(Fe=xe[be-ge]),Xe=y[be*2],l.opt_len+=Xe*(Ke+Fe),$&&(l.static_len+=Xe*(J[be*2+1]+Fe)));if(xt!==0){do{for(Ke=Ze-1;l.bl_count[Ke]===0;)Ke--;l.bl_count[Ke]--,l.bl_count[Ke+1]+=2,l.bl_count[Ze]--,xt-=2}while(xt>0);for(Ke=Ze;Ke!==0;Ke--)for(be=l.bl_count[Ke];be!==0;)ot=l.heap[--he],!(ot>X)&&(y[ot*2+1]!==Ke&&(l.opt_len+=(Ke-y[ot*2+1])*y[ot*2],y[ot*2+1]=Ke),be--)}},_e=(l,G,y)=>{const X=new Array(o+1);let J=0,$,xe;for($=1;$<=o;$++)J=J+y[$-1]<<1,X[$]=J;for(xe=0;xe<=G;xe++){let ge=l[xe*2+1];ge!==0&&(l[xe*2]=Ae(X[ge]++,ge))}},Q=()=>{let l,G,y,X,J;const $=new Array(o+1);for(y=0,X=0;X<g-1;X++)for(W[X]=y,l=0;l<1<<u[X];l++)F[y++]=X;for(F[y-1]=X,J=0,X=0;X<16;X++)for(U[X]=J,l=0;l<1<<E[X];l++)B[J++]=X;for(J>>=7;X<e;X++)for(U[X]=J<<7,l=0;l<1<<E[X]-7;l++)B[256+J++]=X;for(G=0;G<=o;G++)$[G]=0;for(l=0;l<=143;)I[l*2+1]=8,l++,$[8]++;for(;l<=255;)I[l*2+1]=9,l++,$[9]++;for(;l<=279;)I[l*2+1]=7,l++,$[7]++;for(;l<=287;)I[l*2+1]=8,l++,$[8]++;for(_e(I,r+1,$),l=0;l<e;l++)z[l*2+1]=5,z[l*2]=Ae(l,5);V=new R(I,u,m+1,r,o),q=new R(z,E,0,e,o),ee=new R(new Array(0),T,0,t,f)},me=l=>{let G;for(G=0;G<r;G++)l.dyn_ltree[G*2]=0;for(G=0;G<e;G++)l.dyn_dtree[G*2]=0;for(G=0;G<t;G++)l.bl_tree[G*2]=0;l.dyn_ltree[i*2]=1,l.opt_len=l.static_len=0,l.sym_next=l.matches=0},Ce=l=>{l.bi_valid>8?le(l,l.bi_buf):l.bi_valid>0&&(l.pending_buf[l.pending++]=l.bi_buf),l.bi_buf=0,l.bi_valid=0},Pe=(l,G,y,X)=>{const J=G*2,$=y*2;return l[J]<l[$]||l[J]===l[$]&&X[G]<=X[y]},We=(l,G,y)=>{const X=l.heap[y];let J=y<<1;for(;J<=l.heap_len&&(J<l.heap_len&&Pe(G,l.heap[J+1],l.heap[J],l.depth)&&J++,!Pe(G,X,l.heap[J],l.depth));)l.heap[y]=l.heap[J],y=J,J<<=1;l.heap[y]=X},Ue=(l,G,y)=>{let X,J,$=0,xe,ge;if(l.sym_next!==0)do X=l.pending_buf[l.sym_buf+$++]&255,X+=(l.pending_buf[l.sym_buf+$++]&255)<<8,J=l.pending_buf[l.sym_buf+$++],X===0?oe(l,J,G):(xe=F[J],oe(l,xe+m+1,G),ge=u[xe],ge!==0&&(J-=W[xe],re(l,J,ge)),X--,xe=ie(X),oe(l,xe,y),ge=E[xe],ge!==0&&(X-=U[xe],re(l,X,ge)));while($<l.sym_next);oe(l,i,G)},ze=(l,G)=>{const y=G.dyn_tree,X=G.stat_desc.static_tree,J=G.stat_desc.has_stree,$=G.stat_desc.elems;let xe,ge,Ze=-1,he;for(l.heap_len=0,l.heap_max=n,xe=0;xe<$;xe++)y[xe*2]!==0?(l.heap[++l.heap_len]=Ze=xe,l.depth[xe]=0):y[xe*2+1]=0;for(;l.heap_len<2;)he=l.heap[++l.heap_len]=Ze<2?++Ze:0,y[he*2]=1,l.depth[he]=0,l.opt_len--,J&&(l.static_len-=X[he*2+1]);for(G.max_code=Ze,xe=l.heap_len>>1;xe>=1;xe--)We(l,y,xe);he=$;do xe=l.heap[1],l.heap[1]=l.heap[l.heap_len--],We(l,y,1),ge=l.heap[1],l.heap[--l.heap_max]=xe,l.heap[--l.heap_max]=ge,y[he*2]=y[xe*2]+y[ge*2],l.depth[he]=(l.depth[xe]>=l.depth[ge]?l.depth[xe]:l.depth[ge])+1,y[xe*2+1]=y[ge*2+1]=he,l.heap[1]=he++,We(l,y,1);while(l.heap_len>=2);l.heap[--l.heap_max]=l.heap[1],Oe(l,G),_e(y,Ze,l.bl_count)},Be=(l,G,y)=>{let X,J=-1,$,xe=G[1],ge=0,Ze=7,he=4;for(xe===0&&(Ze=138,he=3),G[(y+1)*2+1]=65535,X=0;X<=y;X++)$=xe,xe=G[(X+1)*2+1],!(++ge<Ze&&$===xe)&&(ge<he?l.bl_tree[$*2]+=ge:$!==0?($!==J&&l.bl_tree[$*2]++,l.bl_tree[s*2]++):ge<=10?l.bl_tree[a*2]++:l.bl_tree[c*2]++,ge=0,J=$,xe===0?(Ze=138,he=3):$===xe?(Ze=6,he=3):(Ze=7,he=4))},Ie=(l,G,y)=>{let X,J=-1,$,xe=G[1],ge=0,Ze=7,he=4;for(xe===0&&(Ze=138,he=3),X=0;X<=y;X++)if($=xe,xe=G[(X+1)*2+1],!(++ge<Ze&&$===xe)){if(ge<he)do oe(l,$,l.bl_tree);while(--ge!==0);else $!==0?($!==J&&(oe(l,$,l.bl_tree),ge--),oe(l,s,l.bl_tree),re(l,ge-3,2)):ge<=10?(oe(l,a,l.bl_tree),re(l,ge-3,3)):(oe(l,c,l.bl_tree),re(l,ge-11,7));ge=0,J=$,xe===0?(Ze=138,he=3):$===xe?(Ze=6,he=3):(Ze=7,he=4)}},Se=l=>{let G;for(Be(l,l.dyn_ltree,l.l_desc.max_code),Be(l,l.dyn_dtree,l.d_desc.max_code),ze(l,l.bl_desc),G=t-1;G>=3&&l.bl_tree[L[G]*2+1]===0;G--);return l.opt_len+=3*(G+1)+5+5+4,G},Te=(l,G,y,X)=>{let J;for(re(l,G-257,5),re(l,y-1,5),re(l,X-4,4),J=0;J<X;J++)re(l,l.bl_tree[L[J]*2+1],3);Ie(l,l.dyn_ltree,G-1),Ie(l,l.dyn_dtree,y-1)},Ge=l=>{let G=4093624447,y;for(y=0;y<=31;y++,G>>>=1)if(G&1&&l.dyn_ltree[y*2]!==0)return S;if(l.dyn_ltree[18]!==0||l.dyn_ltree[20]!==0||l.dyn_ltree[26]!==0)return w;for(y=32;y<m;y++)if(l.dyn_ltree[y*2]!==0)return w;return S};let Ne=!1;const k=l=>{Ne||(Q(),Ne=!0),l.l_desc=new se(l.dyn_ltree,V),l.d_desc=new se(l.dyn_dtree,q),l.bl_desc=new se(l.bl_tree,ee),l.bi_buf=0,l.bi_valid=0,me(l)},Z=(l,G,y,X)=>{re(l,(x<<1)+(X?1:0),3),Ce(l),le(l,y),le(l,~y),y&&l.pending_buf.set(l.window.subarray(G,G+y),l.pending),l.pending+=y},Y=l=>{re(l,M<<1,3),oe(l,i,I),Me(l)},ue=(l,G,y,X)=>{let J,$,xe=0;l.level>0?(l.strm.data_type===O&&(l.strm.data_type=Ge(l)),ze(l,l.l_desc),ze(l,l.d_desc),xe=Se(l),J=l.opt_len+3+7>>>3,$=l.static_len+3+7>>>3,$<=J&&(J=$)):J=$=y+5,y+4<=J&&G!==-1?Z(l,G,y,X):l.strategy===A||$===J?(re(l,(M<<1)+(X?1:0),3),Ue(l,I,z)):(re(l,(v<<1)+(X?1:0),3),Te(l,l.l_desc.max_code+1,l.d_desc.max_code+1,xe+1),Ue(l,l.dyn_ltree,l.dyn_dtree)),me(l),X&&Ce(l)},fe=(l,G,y)=>(l.pending_buf[l.sym_buf+l.sym_next++]=G,l.pending_buf[l.sym_buf+l.sym_next++]=G>>8,l.pending_buf[l.sym_buf+l.sym_next++]=y,G===0?l.dyn_ltree[y*2]++:(l.matches++,G--,l.dyn_ltree[(F[y]+m+1)*2]++,l.dyn_dtree[ie(G)*2]++),l.sym_next===l.sym_end);var Ee=k,we=Z,N=ue,ae=fe,ve=Y,Le={_tr_init:Ee,_tr_stored_block:we,_tr_flush_block:N,_tr_tally:ae,_tr_align:ve},ye=(l,G,y,X)=>{let J=l&65535|0,$=l>>>16&65535|0,xe=0;for(;y!==0;){xe=y>2e3?2e3:y,y-=xe;do J=J+G[X++]|0,$=$+J|0;while(--xe);J%=65521,$%=65521}return J|$<<16|0};const j=()=>{let l,G=[];for(var y=0;y<256;y++){l=y;for(var X=0;X<8;X++)l=l&1?3988292384^l>>>1:l>>>1;G[y]=l}return G},De=new Uint32Array(j());var D=(l,G,y,X)=>{const J=De,$=X+y;l^=-1;for(let xe=X;xe<$;xe++)l=l>>>8^J[(l^G[xe])&255];return l^-1},ce={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},de={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:H,_tr_stored_block:te,_tr_flush_block:pe,_tr_tally:ke,_tr_align:je}=Le,{Z_NO_FLUSH:Ve,Z_PARTIAL_FLUSH:Qe,Z_FULL_FLUSH:_t,Z_FINISH:et,Z_BLOCK:$e,Z_OK:Je,Z_STREAM_END:gt,Z_STREAM_ERROR:ft,Z_DATA_ERROR:Ot,Z_BUF_ERROR:Dt,Z_DEFAULT_COMPRESSION:vt,Z_FILTERED:mt,Z_HUFFMAN_ONLY:ct,Z_RLE:At,Z_FIXED:yt,Z_DEFAULT_STRATEGY:Bt,Z_UNKNOWN:oi,Z_DEFLATED:Ft}=de,li=9,hi=15,fi=8,Ai=256+1+29,Xr=30,Yr=19,$r=2*Ai+1,Qr=15,rt=3,It=258,Lt=It+rt+1,Jr=32,kt=42,Mi=57,wi=69,Ci=73,Di=91,Li=103,Ut=113,$t=666,Et=1,Ht=2,Wt=3,Kt=4,qr=3,Gt=(l,G)=>(l.msg=ce[G],G),Ni=l=>l*2-(l>4?9:0),Rt=l=>{let G=l.length;for(;--G>=0;)l[G]=0},en=l=>{let G,y,X,J=l.w_size;G=l.hash_size,X=G;do y=l.head[--X],l.head[X]=y>=J?y-J:0;while(--G);G=J,X=G;do y=l.prev[--X],l.prev[X]=y>=J?y-J:0;while(--G)};let zt=(l,G,y)=>(G<<l.hash_shift^y)&l.hash_mask;const Mt=l=>{const G=l.state;let y=G.pending;y>l.avail_out&&(y=l.avail_out),y!==0&&(l.output.set(G.pending_buf.subarray(G.pending_out,G.pending_out+y),l.next_out),l.next_out+=y,G.pending_out+=y,l.total_out+=y,l.avail_out-=y,G.pending-=y,G.pending===0&&(G.pending_out=0))},wt=(l,G)=>{pe(l,l.block_start>=0?l.block_start:-1,l.strstart-l.block_start,G),l.block_start=l.strstart,Mt(l.strm)},lt=(l,G)=>{l.pending_buf[l.pending++]=G},Qt=(l,G)=>{l.pending_buf[l.pending++]=G>>>8&255,l.pending_buf[l.pending++]=G&255},Ti=(l,G,y,X)=>{let J=l.avail_in;return J>X&&(J=X),J===0?0:(l.avail_in-=J,G.set(l.input.subarray(l.next_in,l.next_in+J),y),l.state.wrap===1?l.adler=ye(l.adler,G,J,y):l.state.wrap===2&&(l.adler=D(l.adler,G,J,y)),l.next_in+=J,l.total_in+=J,J)},Vi=(l,G)=>{let y=l.max_chain_length,X=l.strstart,J,$,xe=l.prev_length,ge=l.nice_match;const Ze=l.strstart>l.w_size-Lt?l.strstart-(l.w_size-Lt):0,he=l.window,be=l.w_mask,ot=l.prev,Ke=l.strstart+It;let Fe=he[X+xe-1],Xe=he[X+xe];l.prev_length>=l.good_match&&(y>>=2),ge>l.lookahead&&(ge=l.lookahead);do if(J=G,!(he[J+xe]!==Xe||he[J+xe-1]!==Fe||he[J]!==he[X]||he[++J]!==he[X+1])){X+=2,J++;do;while(he[++X]===he[++J]&&he[++X]===he[++J]&&he[++X]===he[++J]&&he[++X]===he[++J]&&he[++X]===he[++J]&&he[++X]===he[++J]&&he[++X]===he[++J]&&he[++X]===he[++J]&&X<Ke);if($=It-(Ke-X),X=Ke-It,$>xe){if(l.match_start=G,xe=$,$>=ge)break;Fe=he[X+xe-1],Xe=he[X+xe]}}while((G=ot[G&be])>Ze&&--y!==0);return xe<=l.lookahead?xe:l.lookahead},Zt=l=>{const G=l.w_size;let y,X,J;do{if(X=l.window_size-l.lookahead-l.strstart,l.strstart>=G+(G-Lt)&&(l.window.set(l.window.subarray(G,G+G-X),0),l.match_start-=G,l.strstart-=G,l.block_start-=G,l.insert>l.strstart&&(l.insert=l.strstart),en(l),X+=G),l.strm.avail_in===0)break;if(y=Ti(l.strm,l.window,l.strstart+l.lookahead,X),l.lookahead+=y,l.lookahead+l.insert>=rt)for(J=l.strstart-l.insert,l.ins_h=l.window[J],l.ins_h=zt(l,l.ins_h,l.window[J+1]);l.insert&&(l.ins_h=zt(l,l.ins_h,l.window[J+rt-1]),l.prev[J&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=J,J++,l.insert--,!(l.lookahead+l.insert<rt)););}while(l.lookahead<Lt&&l.strm.avail_in!==0)},ji=(l,G)=>{let y=l.pending_buf_size-5>l.w_size?l.w_size:l.pending_buf_size-5,X,J,$,xe=0,ge=l.strm.avail_in;do{if(X=65535,$=l.bi_valid+42>>3,l.strm.avail_out<$||($=l.strm.avail_out-$,J=l.strstart-l.block_start,X>J+l.strm.avail_in&&(X=J+l.strm.avail_in),X>$&&(X=$),X<y&&(X===0&&G!==et||G===Ve||X!==J+l.strm.avail_in)))break;xe=G===et&&X===J+l.strm.avail_in?1:0,te(l,0,0,xe),l.pending_buf[l.pending-4]=X,l.pending_buf[l.pending-3]=X>>8,l.pending_buf[l.pending-2]=~X,l.pending_buf[l.pending-1]=~X>>8,Mt(l.strm),J&&(J>X&&(J=X),l.strm.output.set(l.window.subarray(l.block_start,l.block_start+J),l.strm.next_out),l.strm.next_out+=J,l.strm.avail_out-=J,l.strm.total_out+=J,l.block_start+=J,X-=J),X&&(Ti(l.strm,l.strm.output,l.strm.next_out,X),l.strm.next_out+=X,l.strm.avail_out-=X,l.strm.total_out+=X)}while(xe===0);return ge-=l.strm.avail_in,ge&&(ge>=l.w_size?(l.matches=2,l.window.set(l.strm.input.subarray(l.strm.next_in-l.w_size,l.strm.next_in),0),l.strstart=l.w_size,l.insert=l.strstart):(l.window_size-l.strstart<=ge&&(l.strstart-=l.w_size,l.window.set(l.window.subarray(l.w_size,l.w_size+l.strstart),0),l.matches<2&&l.matches++,l.insert>l.strstart&&(l.insert=l.strstart)),l.window.set(l.strm.input.subarray(l.strm.next_in-ge,l.strm.next_in),l.strstart),l.strstart+=ge,l.insert+=ge>l.w_size-l.insert?l.w_size-l.insert:ge),l.block_start=l.strstart),l.high_water<l.strstart&&(l.high_water=l.strstart),xe?Kt:G!==Ve&&G!==et&&l.strm.avail_in===0&&l.strstart===l.block_start?Ht:($=l.window_size-l.strstart,l.strm.avail_in>$&&l.block_start>=l.w_size&&(l.block_start-=l.w_size,l.strstart-=l.w_size,l.window.set(l.window.subarray(l.w_size,l.w_size+l.strstart),0),l.matches<2&&l.matches++,$+=l.w_size,l.insert>l.strstart&&(l.insert=l.strstart)),$>l.strm.avail_in&&($=l.strm.avail_in),$&&(Ti(l.strm,l.window,l.strstart,$),l.strstart+=$,l.insert+=$>l.w_size-l.insert?l.w_size-l.insert:$),l.high_water<l.strstart&&(l.high_water=l.strstart),$=l.bi_valid+42>>3,$=l.pending_buf_size-$>65535?65535:l.pending_buf_size-$,y=$>l.w_size?l.w_size:$,J=l.strstart-l.block_start,(J>=y||(J||G===et)&&G!==Ve&&l.strm.avail_in===0&&J<=$)&&(X=J>$?$:J,xe=G===et&&l.strm.avail_in===0&&X===J?1:0,te(l,l.block_start,X,xe),l.block_start+=X,Mt(l.strm)),xe?Wt:Et)},Oi=(l,G)=>{let y,X;for(;;){if(l.lookahead<Lt){if(Zt(l),l.lookahead<Lt&&G===Ve)return Et;if(l.lookahead===0)break}if(y=0,l.lookahead>=rt&&(l.ins_h=zt(l,l.ins_h,l.window[l.strstart+rt-1]),y=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart),y!==0&&l.strstart-y<=l.w_size-Lt&&(l.match_length=Vi(l,y)),l.match_length>=rt)if(X=ke(l,l.strstart-l.match_start,l.match_length-rt),l.lookahead-=l.match_length,l.match_length<=l.max_lazy_match&&l.lookahead>=rt){l.match_length--;do l.strstart++,l.ins_h=zt(l,l.ins_h,l.window[l.strstart+rt-1]),y=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart;while(--l.match_length!==0);l.strstart++}else l.strstart+=l.match_length,l.match_length=0,l.ins_h=l.window[l.strstart],l.ins_h=zt(l,l.ins_h,l.window[l.strstart+1]);else X=ke(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++;if(X&&(wt(l,!1),l.strm.avail_out===0))return Et}return l.insert=l.strstart<rt-1?l.strstart:rt-1,G===et?(wt(l,!0),l.strm.avail_out===0?Wt:Kt):l.sym_next&&(wt(l,!1),l.strm.avail_out===0)?Et:Ht},Xt=(l,G)=>{let y,X,J;for(;;){if(l.lookahead<Lt){if(Zt(l),l.lookahead<Lt&&G===Ve)return Et;if(l.lookahead===0)break}if(y=0,l.lookahead>=rt&&(l.ins_h=zt(l,l.ins_h,l.window[l.strstart+rt-1]),y=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart),l.prev_length=l.match_length,l.prev_match=l.match_start,l.match_length=rt-1,y!==0&&l.prev_length<l.max_lazy_match&&l.strstart-y<=l.w_size-Lt&&(l.match_length=Vi(l,y),l.match_length<=5&&(l.strategy===mt||l.match_length===rt&&l.strstart-l.match_start>4096)&&(l.match_length=rt-1)),l.prev_length>=rt&&l.match_length<=l.prev_length){J=l.strstart+l.lookahead-rt,X=ke(l,l.strstart-1-l.prev_match,l.prev_length-rt),l.lookahead-=l.prev_length-1,l.prev_length-=2;do++l.strstart<=J&&(l.ins_h=zt(l,l.ins_h,l.window[l.strstart+rt-1]),y=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart);while(--l.prev_length!==0);if(l.match_available=0,l.match_length=rt-1,l.strstart++,X&&(wt(l,!1),l.strm.avail_out===0))return Et}else if(l.match_available){if(X=ke(l,0,l.window[l.strstart-1]),X&&wt(l,!1),l.strstart++,l.lookahead--,l.strm.avail_out===0)return Et}else l.match_available=1,l.strstart++,l.lookahead--}return l.match_available&&(X=ke(l,0,l.window[l.strstart-1]),l.match_available=0),l.insert=l.strstart<rt-1?l.strstart:rt-1,G===et?(wt(l,!0),l.strm.avail_out===0?Wt:Kt):l.sym_next&&(wt(l,!1),l.strm.avail_out===0)?Et:Ht},tn=(l,G)=>{let y,X,J,$;const xe=l.window;for(;;){if(l.lookahead<=It){if(Zt(l),l.lookahead<=It&&G===Ve)return Et;if(l.lookahead===0)break}if(l.match_length=0,l.lookahead>=rt&&l.strstart>0&&(J=l.strstart-1,X=xe[J],X===xe[++J]&&X===xe[++J]&&X===xe[++J])){$=l.strstart+It;do;while(X===xe[++J]&&X===xe[++J]&&X===xe[++J]&&X===xe[++J]&&X===xe[++J]&&X===xe[++J]&&X===xe[++J]&&X===xe[++J]&&J<$);l.match_length=It-($-J),l.match_length>l.lookahead&&(l.match_length=l.lookahead)}if(l.match_length>=rt?(y=ke(l,1,l.match_length-rt),l.lookahead-=l.match_length,l.strstart+=l.match_length,l.match_length=0):(y=ke(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++),y&&(wt(l,!1),l.strm.avail_out===0))return Et}return l.insert=0,G===et?(wt(l,!0),l.strm.avail_out===0?Wt:Kt):l.sym_next&&(wt(l,!1),l.strm.avail_out===0)?Et:Ht},rn=(l,G)=>{let y;for(;;){if(l.lookahead===0&&(Zt(l),l.lookahead===0)){if(G===Ve)return Et;break}if(l.match_length=0,y=ke(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++,y&&(wt(l,!1),l.strm.avail_out===0))return Et}return l.insert=0,G===et?(wt(l,!0),l.strm.avail_out===0?Wt:Kt):l.sym_next&&(wt(l,!1),l.strm.avail_out===0)?Et:Ht};function Tt(l,G,y,X,J){this.good_length=l,this.max_lazy=G,this.nice_length=y,this.max_chain=X,this.func=J}const Jt=[new Tt(0,0,0,0,ji),new Tt(4,4,8,4,Oi),new Tt(4,5,16,8,Oi),new Tt(4,6,32,32,Oi),new Tt(4,4,16,16,Xt),new Tt(8,16,32,32,Xt),new Tt(8,16,128,128,Xt),new Tt(8,32,128,256,Xt),new Tt(32,128,258,1024,Xt),new Tt(32,258,258,4096,Xt)],nn=l=>{l.window_size=2*l.w_size,Rt(l.head),l.max_lazy_match=Jt[l.level].max_lazy,l.good_match=Jt[l.level].good_length,l.nice_match=Jt[l.level].nice_length,l.max_chain_length=Jt[l.level].max_chain,l.strstart=0,l.block_start=0,l.lookahead=0,l.insert=0,l.match_length=l.prev_length=rt-1,l.match_available=0,l.ins_h=0};function sn(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Ft,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array($r*2),this.dyn_dtree=new Uint16Array((2*Xr+1)*2),this.bl_tree=new Uint16Array((2*Yr+1)*2),Rt(this.dyn_ltree),Rt(this.dyn_dtree),Rt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Qr+1),this.heap=new Uint16Array(2*Ai+1),Rt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Ai+1),Rt(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const qt=l=>{if(!l)return 1;const G=l.state;return!G||G.strm!==l||G.status!==kt&&G.status!==Mi&&G.status!==wi&&G.status!==Ci&&G.status!==Di&&G.status!==Li&&G.status!==Ut&&G.status!==$t?1:0},ki=l=>{if(qt(l))return Gt(l,ft);l.total_in=l.total_out=0,l.data_type=oi;const G=l.state;return G.pending=0,G.pending_out=0,G.wrap<0&&(G.wrap=-G.wrap),G.status=G.wrap===2?Mi:G.wrap?kt:Ut,l.adler=G.wrap===2?0:1,G.last_flush=-2,H(G),Je},Hi=l=>{const G=ki(l);return G===Je&&nn(l.state),G},an=(l,G)=>qt(l)||l.state.wrap!==2?ft:(l.state.gzhead=G,Je),Ki=(l,G,y,X,J,$)=>{if(!l)return ft;let xe=1;if(G===vt&&(G=6),X<0?(xe=0,X=-X):X>15&&(xe=2,X-=16),J<1||J>li||y!==Ft||X<8||X>15||G<0||G>9||$<0||$>yt||X===8&&xe!==1)return Gt(l,ft);X===8&&(X=9);const ge=new sn;return l.state=ge,ge.strm=l,ge.status=kt,ge.wrap=xe,ge.gzhead=null,ge.w_bits=X,ge.w_size=1<<ge.w_bits,ge.w_mask=ge.w_size-1,ge.hash_bits=J+7,ge.hash_size=1<<ge.hash_bits,ge.hash_mask=ge.hash_size-1,ge.hash_shift=~~((ge.hash_bits+rt-1)/rt),ge.window=new Uint8Array(ge.w_size*2),ge.head=new Uint16Array(ge.hash_size),ge.prev=new Uint16Array(ge.w_size),ge.lit_bufsize=1<<J+6,ge.pending_buf_size=ge.lit_bufsize*4,ge.pending_buf=new Uint8Array(ge.pending_buf_size),ge.sym_buf=ge.lit_bufsize,ge.sym_end=(ge.lit_bufsize-1)*3,ge.level=G,ge.strategy=$,ge.method=y,Hi(l)},on=(l,G)=>Ki(l,G,Ft,hi,fi,Bt),ln=(l,G)=>{if(qt(l)||G>$e||G<0)return l?Gt(l,ft):ft;const y=l.state;if(!l.output||l.avail_in!==0&&!l.input||y.status===$t&&G!==et)return Gt(l,l.avail_out===0?Dt:ft);const X=y.last_flush;if(y.last_flush=G,y.pending!==0){if(Mt(l),l.avail_out===0)return y.last_flush=-1,Je}else if(l.avail_in===0&&Ni(G)<=Ni(X)&&G!==et)return Gt(l,Dt);if(y.status===$t&&l.avail_in!==0)return Gt(l,Dt);if(y.status===kt&&y.wrap===0&&(y.status=Ut),y.status===kt){let J=Ft+(y.w_bits-8<<4)<<8,$=-1;if(y.strategy>=ct||y.level<2?$=0:y.level<6?$=1:y.level===6?$=2:$=3,J|=$<<6,y.strstart!==0&&(J|=Jr),J+=31-J%31,Qt(y,J),y.strstart!==0&&(Qt(y,l.adler>>>16),Qt(y,l.adler&65535)),l.adler=1,y.status=Ut,Mt(l),y.pending!==0)return y.last_flush=-1,Je}if(y.status===Mi){if(l.adler=0,lt(y,31),lt(y,139),lt(y,8),y.gzhead)lt(y,(y.gzhead.text?1:0)+(y.gzhead.hcrc?2:0)+(y.gzhead.extra?4:0)+(y.gzhead.name?8:0)+(y.gzhead.comment?16:0)),lt(y,y.gzhead.time&255),lt(y,y.gzhead.time>>8&255),lt(y,y.gzhead.time>>16&255),lt(y,y.gzhead.time>>24&255),lt(y,y.level===9?2:y.strategy>=ct||y.level<2?4:0),lt(y,y.gzhead.os&255),y.gzhead.extra&&y.gzhead.extra.length&&(lt(y,y.gzhead.extra.length&255),lt(y,y.gzhead.extra.length>>8&255)),y.gzhead.hcrc&&(l.adler=D(l.adler,y.pending_buf,y.pending,0)),y.gzindex=0,y.status=wi;else if(lt(y,0),lt(y,0),lt(y,0),lt(y,0),lt(y,0),lt(y,y.level===9?2:y.strategy>=ct||y.level<2?4:0),lt(y,qr),y.status=Ut,Mt(l),y.pending!==0)return y.last_flush=-1,Je}if(y.status===wi){if(y.gzhead.extra){let J=y.pending,$=(y.gzhead.extra.length&65535)-y.gzindex;for(;y.pending+$>y.pending_buf_size;){let ge=y.pending_buf_size-y.pending;if(y.pending_buf.set(y.gzhead.extra.subarray(y.gzindex,y.gzindex+ge),y.pending),y.pending=y.pending_buf_size,y.gzhead.hcrc&&y.pending>J&&(l.adler=D(l.adler,y.pending_buf,y.pending-J,J)),y.gzindex+=ge,Mt(l),y.pending!==0)return y.last_flush=-1,Je;J=0,$-=ge}let xe=new Uint8Array(y.gzhead.extra);y.pending_buf.set(xe.subarray(y.gzindex,y.gzindex+$),y.pending),y.pending+=$,y.gzhead.hcrc&&y.pending>J&&(l.adler=D(l.adler,y.pending_buf,y.pending-J,J)),y.gzindex=0}y.status=Ci}if(y.status===Ci){if(y.gzhead.name){let J=y.pending,$;do{if(y.pending===y.pending_buf_size){if(y.gzhead.hcrc&&y.pending>J&&(l.adler=D(l.adler,y.pending_buf,y.pending-J,J)),Mt(l),y.pending!==0)return y.last_flush=-1,Je;J=0}y.gzindex<y.gzhead.name.length?$=y.gzhead.name.charCodeAt(y.gzindex++)&255:$=0,lt(y,$)}while($!==0);y.gzhead.hcrc&&y.pending>J&&(l.adler=D(l.adler,y.pending_buf,y.pending-J,J)),y.gzindex=0}y.status=Di}if(y.status===Di){if(y.gzhead.comment){let J=y.pending,$;do{if(y.pending===y.pending_buf_size){if(y.gzhead.hcrc&&y.pending>J&&(l.adler=D(l.adler,y.pending_buf,y.pending-J,J)),Mt(l),y.pending!==0)return y.last_flush=-1,Je;J=0}y.gzindex<y.gzhead.comment.length?$=y.gzhead.comment.charCodeAt(y.gzindex++)&255:$=0,lt(y,$)}while($!==0);y.gzhead.hcrc&&y.pending>J&&(l.adler=D(l.adler,y.pending_buf,y.pending-J,J))}y.status=Li}if(y.status===Li){if(y.gzhead.hcrc){if(y.pending+2>y.pending_buf_size&&(Mt(l),y.pending!==0))return y.last_flush=-1,Je;lt(y,l.adler&255),lt(y,l.adler>>8&255),l.adler=0}if(y.status=Ut,Mt(l),y.pending!==0)return y.last_flush=-1,Je}if(l.avail_in!==0||y.lookahead!==0||G!==Ve&&y.status!==$t){let J=y.level===0?ji(y,G):y.strategy===ct?rn(y,G):y.strategy===At?tn(y,G):Jt[y.level].func(y,G);if((J===Wt||J===Kt)&&(y.status=$t),J===Et||J===Wt)return l.avail_out===0&&(y.last_flush=-1),Je;if(J===Ht&&(G===Qe?je(y):G!==$e&&(te(y,0,0,!1),G===_t&&(Rt(y.head),y.lookahead===0&&(y.strstart=0,y.block_start=0,y.insert=0))),Mt(l),l.avail_out===0))return y.last_flush=-1,Je}return G!==et?Je:y.wrap<=0?gt:(y.wrap===2?(lt(y,l.adler&255),lt(y,l.adler>>8&255),lt(y,l.adler>>16&255),lt(y,l.adler>>24&255),lt(y,l.total_in&255),lt(y,l.total_in>>8&255),lt(y,l.total_in>>16&255),lt(y,l.total_in>>24&255)):(Qt(y,l.adler>>>16),Qt(y,l.adler&65535)),Mt(l),y.wrap>0&&(y.wrap=-y.wrap),y.pending!==0?Je:gt)},hn=l=>{if(qt(l))return ft;const G=l.state.status;return l.state=null,G===Ut?Gt(l,Ot):Je},fn=(l,G)=>{let y=G.length;if(qt(l))return ft;const X=l.state,J=X.wrap;if(J===2||J===1&&X.status!==kt||X.lookahead)return ft;if(J===1&&(l.adler=ye(l.adler,G,y,0)),X.wrap=0,y>=X.w_size){J===0&&(Rt(X.head),X.strstart=0,X.block_start=0,X.insert=0);let Ze=new Uint8Array(X.w_size);Ze.set(G.subarray(y-X.w_size,y),0),G=Ze,y=X.w_size}const $=l.avail_in,xe=l.next_in,ge=l.input;for(l.avail_in=y,l.next_in=0,l.input=G,Zt(X);X.lookahead>=rt;){let Ze=X.strstart,he=X.lookahead-(rt-1);do X.ins_h=zt(X,X.ins_h,X.window[Ze+rt-1]),X.prev[Ze&X.w_mask]=X.head[X.ins_h],X.head[X.ins_h]=Ze,Ze++;while(--he);X.strstart=Ze,X.lookahead=rt-1,Zt(X)}return X.strstart+=X.lookahead,X.block_start=X.strstart,X.insert=X.lookahead,X.lookahead=0,X.match_length=X.prev_length=rt-1,X.match_available=0,l.next_in=xe,l.input=ge,l.avail_in=$,X.wrap=J,Je};var dn=on,cn=Ki,un=Hi,gn=ki,vn=an,mn=ln,pn=hn,_n=fn,xn="pako deflate (from Nodeca project)",ei={deflateInit:dn,deflateInit2:cn,deflateReset:un,deflateResetKeep:gn,deflateSetHeader:vn,deflate:mn,deflateEnd:pn,deflateSetDictionary:_n,deflateInfo:xn};const bn=(l,G)=>Object.prototype.hasOwnProperty.call(l,G);var yn=function(l){const G=Array.prototype.slice.call(arguments,1);for(;G.length;){const y=G.shift();if(y){if(typeof y!="object")throw new TypeError(y+"must be non-object");for(const X in y)bn(y,X)&&(l[X]=y[X])}}return l},En=l=>{let G=0;for(let X=0,J=l.length;X<J;X++)G+=l[X].length;const y=new Uint8Array(G);for(let X=0,J=0,$=l.length;X<$;X++){let xe=l[X];y.set(xe,J),J+=xe.length}return y},ui={assign:yn,flattenChunks:En};let Zi=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Zi=!1}const ti=new Uint8Array(256);for(let l=0;l<256;l++)ti[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;ti[254]=ti[254]=1;var An=l=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(l);let G,y,X,J,$,xe=l.length,ge=0;for(J=0;J<xe;J++)y=l.charCodeAt(J),(y&64512)===55296&&J+1<xe&&(X=l.charCodeAt(J+1),(X&64512)===56320&&(y=65536+(y-55296<<10)+(X-56320),J++)),ge+=y<128?1:y<2048?2:y<65536?3:4;for(G=new Uint8Array(ge),$=0,J=0;$<ge;J++)y=l.charCodeAt(J),(y&64512)===55296&&J+1<xe&&(X=l.charCodeAt(J+1),(X&64512)===56320&&(y=65536+(y-55296<<10)+(X-56320),J++)),y<128?G[$++]=y:y<2048?(G[$++]=192|y>>>6,G[$++]=128|y&63):y<65536?(G[$++]=224|y>>>12,G[$++]=128|y>>>6&63,G[$++]=128|y&63):(G[$++]=240|y>>>18,G[$++]=128|y>>>12&63,G[$++]=128|y>>>6&63,G[$++]=128|y&63);return G};const Mn=(l,G)=>{if(G<65534&&l.subarray&&Zi)return String.fromCharCode.apply(null,l.length===G?l:l.subarray(0,G));let y="";for(let X=0;X<G;X++)y+=String.fromCharCode(l[X]);return y};var wn=(l,G)=>{const y=G||l.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(l.subarray(0,G));let X,J;const $=new Array(y*2);for(J=0,X=0;X<y;){let xe=l[X++];if(xe<128){$[J++]=xe;continue}let ge=ti[xe];if(ge>4){$[J++]=65533,X+=ge-1;continue}for(xe&=ge===2?31:ge===3?15:7;ge>1&&X<y;)xe=xe<<6|l[X++]&63,ge--;if(ge>1){$[J++]=65533;continue}xe<65536?$[J++]=xe:(xe-=65536,$[J++]=55296|xe>>10&1023,$[J++]=56320|xe&1023)}return Mn($,J)},Cn=(l,G)=>{G=G||l.length,G>l.length&&(G=l.length);let y=G-1;for(;y>=0&&(l[y]&192)===128;)y--;return y<0||y===0?G:y+ti[l[y]]>G?y:G},ii={string2buf:An,buf2string:wn,utf8border:Cn};function Dn(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Xi=Dn;const Yi=Object.prototype.toString,{Z_NO_FLUSH:Ln,Z_SYNC_FLUSH:Tn,Z_FULL_FLUSH:On,Z_FINISH:Sn,Z_OK:gi,Z_STREAM_END:Pn,Z_DEFAULT_COMPRESSION:In,Z_DEFAULT_STRATEGY:Rn,Z_DEFLATED:zn}=de;function ri(l){this.options=ui.assign({level:In,method:zn,chunkSize:16384,windowBits:15,memLevel:8,strategy:Rn},l||{});let G=this.options;G.raw&&G.windowBits>0?G.windowBits=-G.windowBits:G.gzip&&G.windowBits>0&&G.windowBits<16&&(G.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Xi,this.strm.avail_out=0;let y=ei.deflateInit2(this.strm,G.level,G.method,G.windowBits,G.memLevel,G.strategy);if(y!==gi)throw new Error(ce[y]);if(G.header&&ei.deflateSetHeader(this.strm,G.header),G.dictionary){let X;if(typeof G.dictionary=="string"?X=ii.string2buf(G.dictionary):Yi.call(G.dictionary)==="[object ArrayBuffer]"?X=new Uint8Array(G.dictionary):X=G.dictionary,y=ei.deflateSetDictionary(this.strm,X),y!==gi)throw new Error(ce[y]);this._dict_set=!0}}ri.prototype.push=function(l,G){const y=this.strm,X=this.options.chunkSize;let J,$;if(this.ended)return!1;for(G===~~G?$=G:$=G===!0?Sn:Ln,typeof l=="string"?y.input=ii.string2buf(l):Yi.call(l)==="[object ArrayBuffer]"?y.input=new Uint8Array(l):y.input=l,y.next_in=0,y.avail_in=y.input.length;;){if(y.avail_out===0&&(y.output=new Uint8Array(X),y.next_out=0,y.avail_out=X),($===Tn||$===On)&&y.avail_out<=6){this.onData(y.output.subarray(0,y.next_out)),y.avail_out=0;continue}if(J=ei.deflate(y,$),J===Pn)return y.next_out>0&&this.onData(y.output.subarray(0,y.next_out)),J=ei.deflateEnd(this.strm),this.onEnd(J),this.ended=!0,J===gi;if(y.avail_out===0){this.onData(y.output);continue}if($>0&&y.next_out>0){this.onData(y.output.subarray(0,y.next_out)),y.avail_out=0;continue}if(y.avail_in===0)break}return!0},ri.prototype.onData=function(l){this.chunks.push(l)},ri.prototype.onEnd=function(l){l===gi&&(this.result=ui.flattenChunks(this.chunks)),this.chunks=[],this.err=l,this.msg=this.strm.msg};function Si(l,G){const y=new ri(G);if(y.push(l,!0),y.err)throw y.msg||ce[y.err];return y.result}function Bn(l,G){return G=G||{},G.raw=!0,Si(l,G)}function Fn(l,G){return G=G||{},G.gzip=!0,Si(l,G)}var Un=ri,Wn=Si,Gn=Bn,Nn=Fn,Vn={Deflate:Un,deflate:Wn,deflateRaw:Gn,gzip:Nn};const vi=16209,jn=16191;var kn=function(G,y){let X,J,$,xe,ge,Ze,he,be,ot,Ke,Fe,Xe,xt,st,tt,dt,it,He,ht,bt,Ye,ut,at,qe;const nt=G.state;X=G.next_in,at=G.input,J=X+(G.avail_in-5),$=G.next_out,qe=G.output,xe=$-(y-G.avail_out),ge=$+(G.avail_out-257),Ze=nt.dmax,he=nt.wsize,be=nt.whave,ot=nt.wnext,Ke=nt.window,Fe=nt.hold,Xe=nt.bits,xt=nt.lencode,st=nt.distcode,tt=(1<<nt.lenbits)-1,dt=(1<<nt.distbits)-1;e:do{Xe<15&&(Fe+=at[X++]<<Xe,Xe+=8,Fe+=at[X++]<<Xe,Xe+=8),it=xt[Fe&tt];t:for(;;){if(He=it>>>24,Fe>>>=He,Xe-=He,He=it>>>16&255,He===0)qe[$++]=it&65535;else if(He&16){ht=it&65535,He&=15,He&&(Xe<He&&(Fe+=at[X++]<<Xe,Xe+=8),ht+=Fe&(1<<He)-1,Fe>>>=He,Xe-=He),Xe<15&&(Fe+=at[X++]<<Xe,Xe+=8,Fe+=at[X++]<<Xe,Xe+=8),it=st[Fe&dt];i:for(;;){if(He=it>>>24,Fe>>>=He,Xe-=He,He=it>>>16&255,He&16){if(bt=it&65535,He&=15,Xe<He&&(Fe+=at[X++]<<Xe,Xe+=8,Xe<He&&(Fe+=at[X++]<<Xe,Xe+=8)),bt+=Fe&(1<<He)-1,bt>Ze){G.msg="invalid distance too far back",nt.mode=vi;break e}if(Fe>>>=He,Xe-=He,He=$-xe,bt>He){if(He=bt-He,He>be&&nt.sane){G.msg="invalid distance too far back",nt.mode=vi;break e}if(Ye=0,ut=Ke,ot===0){if(Ye+=he-He,He<ht){ht-=He;do qe[$++]=Ke[Ye++];while(--He);Ye=$-bt,ut=qe}}else if(ot<He){if(Ye+=he+ot-He,He-=ot,He<ht){ht-=He;do qe[$++]=Ke[Ye++];while(--He);if(Ye=0,ot<ht){He=ot,ht-=He;do qe[$++]=Ke[Ye++];while(--He);Ye=$-bt,ut=qe}}}else if(Ye+=ot-He,He<ht){ht-=He;do qe[$++]=Ke[Ye++];while(--He);Ye=$-bt,ut=qe}for(;ht>2;)qe[$++]=ut[Ye++],qe[$++]=ut[Ye++],qe[$++]=ut[Ye++],ht-=3;ht&&(qe[$++]=ut[Ye++],ht>1&&(qe[$++]=ut[Ye++]))}else{Ye=$-bt;do qe[$++]=qe[Ye++],qe[$++]=qe[Ye++],qe[$++]=qe[Ye++],ht-=3;while(ht>2);ht&&(qe[$++]=qe[Ye++],ht>1&&(qe[$++]=qe[Ye++]))}}else if((He&64)===0){it=st[(it&65535)+(Fe&(1<<He)-1)];continue i}else{G.msg="invalid distance code",nt.mode=vi;break e}break}}else if((He&64)===0){it=xt[(it&65535)+(Fe&(1<<He)-1)];continue t}else if(He&32){nt.mode=jn;break e}else{G.msg="invalid literal/length code",nt.mode=vi;break e}break}}while(X<J&&$<ge);ht=Xe>>3,X-=ht,Xe-=ht<<3,Fe&=(1<<Xe)-1,G.next_in=X,G.next_out=$,G.avail_in=X<J?5+(J-X):5-(X-J),G.avail_out=$<ge?257+(ge-$):257-($-ge),nt.hold=Fe,nt.bits=Xe};const Yt=15,$i=852,Qi=592,Ji=0,Pi=1,qi=2,Hn=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Kn=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Zn=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Xn=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var ni=(l,G,y,X,J,$,xe,ge)=>{const Ze=ge.bits;let he=0,be=0,ot=0,Ke=0,Fe=0,Xe=0,xt=0,st=0,tt=0,dt=0,it,He,ht,bt,Ye,ut=null,at;const qe=new Uint16Array(Yt+1),nt=new Uint16Array(Yt+1);let jt=null,Zr,yi,Ei;for(he=0;he<=Yt;he++)qe[he]=0;for(be=0;be<X;be++)qe[G[y+be]]++;for(Fe=Ze,Ke=Yt;Ke>=1&&qe[Ke]===0;Ke--);if(Fe>Ke&&(Fe=Ke),Ke===0)return J[$++]=1<<24|64<<16|0,J[$++]=1<<24|64<<16|0,ge.bits=1,0;for(ot=1;ot<Ke&&qe[ot]===0;ot++);for(Fe<ot&&(Fe=ot),st=1,he=1;he<=Yt;he++)if(st<<=1,st-=qe[he],st<0)return-1;if(st>0&&(l===Ji||Ke!==1))return-1;for(nt[1]=0,he=1;he<Yt;he++)nt[he+1]=nt[he]+qe[he];for(be=0;be<X;be++)G[y+be]!==0&&(xe[nt[G[y+be]]++]=be);if(l===Ji?(ut=jt=xe,at=20):l===Pi?(ut=Hn,jt=Kn,at=257):(ut=Zn,jt=Xn,at=0),dt=0,be=0,he=ot,Ye=$,Xe=Fe,xt=0,ht=-1,tt=1<<Fe,bt=tt-1,l===Pi&&tt>$i||l===qi&&tt>Qi)return 1;for(;;){Zr=he-xt,xe[be]+1<at?(yi=0,Ei=xe[be]):xe[be]>=at?(yi=jt[xe[be]-at],Ei=ut[xe[be]-at]):(yi=96,Ei=0),it=1<<he-xt,He=1<<Xe,ot=He;do He-=it,J[Ye+(dt>>xt)+He]=Zr<<24|yi<<16|Ei|0;while(He!==0);for(it=1<<he-1;dt&it;)it>>=1;if(it!==0?(dt&=it-1,dt+=it):dt=0,be++,--qe[he]===0){if(he===Ke)break;he=G[y+xe[be]]}if(he>Fe&&(dt&bt)!==ht){for(xt===0&&(xt=Fe),Ye+=ot,Xe=he-xt,st=1<<Xe;Xe+xt<Ke&&(st-=qe[Xe+xt],!(st<=0));)Xe++,st<<=1;if(tt+=1<<Xe,l===Pi&&tt>$i||l===qi&&tt>Qi)return 1;ht=dt&bt,J[ht]=Fe<<24|Xe<<16|Ye-$|0}}return dt!==0&&(J[Ye+dt]=he-xt<<24|64<<16|0),ge.bits=Fe,0};const Yn=0,er=1,tr=2,{Z_FINISH:ir,Z_BLOCK:$n,Z_TREES:mi,Z_OK:Nt,Z_STREAM_END:Qn,Z_NEED_DICT:Jn,Z_STREAM_ERROR:Ct,Z_DATA_ERROR:rr,Z_MEM_ERROR:nr,Z_BUF_ERROR:qn,Z_DEFLATED:sr}=de,pi=16180,ar=16181,or=16182,lr=16183,hr=16184,fr=16185,dr=16186,cr=16187,ur=16188,gr=16189,_i=16190,St=16191,Ii=16192,vr=16193,Ri=16194,mr=16195,pr=16196,_r=16197,xr=16198,xi=16199,bi=16200,br=16201,yr=16202,Er=16203,Ar=16204,Mr=16205,zi=16206,wr=16207,Cr=16208,pt=16209,Dr=16210,Lr=16211,es=852,ts=592,is=15,Tr=l=>(l>>>24&255)+(l>>>8&65280)+((l&65280)<<8)+((l&255)<<24);function rs(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Vt=l=>{if(!l)return 1;const G=l.state;return!G||G.strm!==l||G.mode<pi||G.mode>Lr?1:0},Or=l=>{if(Vt(l))return Ct;const G=l.state;return l.total_in=l.total_out=G.total=0,l.msg="",G.wrap&&(l.adler=G.wrap&1),G.mode=pi,G.last=0,G.havedict=0,G.flags=-1,G.dmax=32768,G.head=null,G.hold=0,G.bits=0,G.lencode=G.lendyn=new Int32Array(es),G.distcode=G.distdyn=new Int32Array(ts),G.sane=1,G.back=-1,Nt},Sr=l=>{if(Vt(l))return Ct;const G=l.state;return G.wsize=0,G.whave=0,G.wnext=0,Or(l)},Pr=(l,G)=>{let y;if(Vt(l))return Ct;const X=l.state;return G<0?(y=0,G=-G):(y=(G>>4)+5,G<48&&(G&=15)),G&&(G<8||G>15)?Ct:(X.window!==null&&X.wbits!==G&&(X.window=null),X.wrap=y,X.wbits=G,Sr(l))},Ir=(l,G)=>{if(!l)return Ct;const y=new rs;l.state=y,y.strm=l,y.window=null,y.mode=pi;const X=Pr(l,G);return X!==Nt&&(l.state=null),X},ns=l=>Ir(l,is);let Rr=!0,Bi,Fi;const ss=l=>{if(Rr){Bi=new Int32Array(512),Fi=new Int32Array(32);let G=0;for(;G<144;)l.lens[G++]=8;for(;G<256;)l.lens[G++]=9;for(;G<280;)l.lens[G++]=7;for(;G<288;)l.lens[G++]=8;for(ni(er,l.lens,0,288,Bi,0,l.work,{bits:9}),G=0;G<32;)l.lens[G++]=5;ni(tr,l.lens,0,32,Fi,0,l.work,{bits:5}),Rr=!1}l.lencode=Bi,l.lenbits=9,l.distcode=Fi,l.distbits=5},zr=(l,G,y,X)=>{let J;const $=l.state;return $.window===null&&($.wsize=1<<$.wbits,$.wnext=0,$.whave=0,$.window=new Uint8Array($.wsize)),X>=$.wsize?($.window.set(G.subarray(y-$.wsize,y),0),$.wnext=0,$.whave=$.wsize):(J=$.wsize-$.wnext,J>X&&(J=X),$.window.set(G.subarray(y-X,y-X+J),$.wnext),X-=J,X?($.window.set(G.subarray(y-X,y),0),$.wnext=X,$.whave=$.wsize):($.wnext+=J,$.wnext===$.wsize&&($.wnext=0),$.whave<$.wsize&&($.whave+=J))),0},as=(l,G)=>{let y,X,J,$,xe,ge,Ze,he,be,ot,Ke,Fe,Xe,xt,st=0,tt,dt,it,He,ht,bt,Ye,ut;const at=new Uint8Array(4);let qe,nt;const jt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Vt(l)||!l.output||!l.input&&l.avail_in!==0)return Ct;y=l.state,y.mode===St&&(y.mode=Ii),xe=l.next_out,J=l.output,Ze=l.avail_out,$=l.next_in,X=l.input,ge=l.avail_in,he=y.hold,be=y.bits,ot=ge,Ke=Ze,ut=Nt;e:for(;;)switch(y.mode){case pi:if(y.wrap===0){y.mode=Ii;break}for(;be<16;){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}if(y.wrap&2&&he===35615){y.wbits===0&&(y.wbits=15),y.check=0,at[0]=he&255,at[1]=he>>>8&255,y.check=D(y.check,at,2,0),he=0,be=0,y.mode=ar;break}if(y.head&&(y.head.done=!1),!(y.wrap&1)||(((he&255)<<8)+(he>>8))%31){l.msg="incorrect header check",y.mode=pt;break}if((he&15)!==sr){l.msg="unknown compression method",y.mode=pt;break}if(he>>>=4,be-=4,Ye=(he&15)+8,y.wbits===0&&(y.wbits=Ye),Ye>15||Ye>y.wbits){l.msg="invalid window size",y.mode=pt;break}y.dmax=1<<y.wbits,y.flags=0,l.adler=y.check=1,y.mode=he&512?gr:St,he=0,be=0;break;case ar:for(;be<16;){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}if(y.flags=he,(y.flags&255)!==sr){l.msg="unknown compression method",y.mode=pt;break}if(y.flags&57344){l.msg="unknown header flags set",y.mode=pt;break}y.head&&(y.head.text=he>>8&1),y.flags&512&&y.wrap&4&&(at[0]=he&255,at[1]=he>>>8&255,y.check=D(y.check,at,2,0)),he=0,be=0,y.mode=or;case or:for(;be<32;){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}y.head&&(y.head.time=he),y.flags&512&&y.wrap&4&&(at[0]=he&255,at[1]=he>>>8&255,at[2]=he>>>16&255,at[3]=he>>>24&255,y.check=D(y.check,at,4,0)),he=0,be=0,y.mode=lr;case lr:for(;be<16;){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}y.head&&(y.head.xflags=he&255,y.head.os=he>>8),y.flags&512&&y.wrap&4&&(at[0]=he&255,at[1]=he>>>8&255,y.check=D(y.check,at,2,0)),he=0,be=0,y.mode=hr;case hr:if(y.flags&1024){for(;be<16;){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}y.length=he,y.head&&(y.head.extra_len=he),y.flags&512&&y.wrap&4&&(at[0]=he&255,at[1]=he>>>8&255,y.check=D(y.check,at,2,0)),he=0,be=0}else y.head&&(y.head.extra=null);y.mode=fr;case fr:if(y.flags&1024&&(Fe=y.length,Fe>ge&&(Fe=ge),Fe&&(y.head&&(Ye=y.head.extra_len-y.length,y.head.extra||(y.head.extra=new Uint8Array(y.head.extra_len)),y.head.extra.set(X.subarray($,$+Fe),Ye)),y.flags&512&&y.wrap&4&&(y.check=D(y.check,X,Fe,$)),ge-=Fe,$+=Fe,y.length-=Fe),y.length))break e;y.length=0,y.mode=dr;case dr:if(y.flags&2048){if(ge===0)break e;Fe=0;do Ye=X[$+Fe++],y.head&&Ye&&y.length<65536&&(y.head.name+=String.fromCharCode(Ye));while(Ye&&Fe<ge);if(y.flags&512&&y.wrap&4&&(y.check=D(y.check,X,Fe,$)),ge-=Fe,$+=Fe,Ye)break e}else y.head&&(y.head.name=null);y.length=0,y.mode=cr;case cr:if(y.flags&4096){if(ge===0)break e;Fe=0;do Ye=X[$+Fe++],y.head&&Ye&&y.length<65536&&(y.head.comment+=String.fromCharCode(Ye));while(Ye&&Fe<ge);if(y.flags&512&&y.wrap&4&&(y.check=D(y.check,X,Fe,$)),ge-=Fe,$+=Fe,Ye)break e}else y.head&&(y.head.comment=null);y.mode=ur;case ur:if(y.flags&512){for(;be<16;){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}if(y.wrap&4&&he!==(y.check&65535)){l.msg="header crc mismatch",y.mode=pt;break}he=0,be=0}y.head&&(y.head.hcrc=y.flags>>9&1,y.head.done=!0),l.adler=y.check=0,y.mode=St;break;case gr:for(;be<32;){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}l.adler=y.check=Tr(he),he=0,be=0,y.mode=_i;case _i:if(y.havedict===0)return l.next_out=xe,l.avail_out=Ze,l.next_in=$,l.avail_in=ge,y.hold=he,y.bits=be,Jn;l.adler=y.check=1,y.mode=St;case St:if(G===$n||G===mi)break e;case Ii:if(y.last){he>>>=be&7,be-=be&7,y.mode=zi;break}for(;be<3;){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}switch(y.last=he&1,he>>>=1,be-=1,he&3){case 0:y.mode=vr;break;case 1:if(ss(y),y.mode=xi,G===mi){he>>>=2,be-=2;break e}break;case 2:y.mode=pr;break;case 3:l.msg="invalid block type",y.mode=pt}he>>>=2,be-=2;break;case vr:for(he>>>=be&7,be-=be&7;be<32;){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}if((he&65535)!==(he>>>16^65535)){l.msg="invalid stored block lengths",y.mode=pt;break}if(y.length=he&65535,he=0,be=0,y.mode=Ri,G===mi)break e;case Ri:y.mode=mr;case mr:if(Fe=y.length,Fe){if(Fe>ge&&(Fe=ge),Fe>Ze&&(Fe=Ze),Fe===0)break e;J.set(X.subarray($,$+Fe),xe),ge-=Fe,$+=Fe,Ze-=Fe,xe+=Fe,y.length-=Fe;break}y.mode=St;break;case pr:for(;be<14;){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}if(y.nlen=(he&31)+257,he>>>=5,be-=5,y.ndist=(he&31)+1,he>>>=5,be-=5,y.ncode=(he&15)+4,he>>>=4,be-=4,y.nlen>286||y.ndist>30){l.msg="too many length or distance symbols",y.mode=pt;break}y.have=0,y.mode=_r;case _r:for(;y.have<y.ncode;){for(;be<3;){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}y.lens[jt[y.have++]]=he&7,he>>>=3,be-=3}for(;y.have<19;)y.lens[jt[y.have++]]=0;if(y.lencode=y.lendyn,y.lenbits=7,qe={bits:y.lenbits},ut=ni(Yn,y.lens,0,19,y.lencode,0,y.work,qe),y.lenbits=qe.bits,ut){l.msg="invalid code lengths set",y.mode=pt;break}y.have=0,y.mode=xr;case xr:for(;y.have<y.nlen+y.ndist;){for(;st=y.lencode[he&(1<<y.lenbits)-1],tt=st>>>24,dt=st>>>16&255,it=st&65535,!(tt<=be);){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}if(it<16)he>>>=tt,be-=tt,y.lens[y.have++]=it;else{if(it===16){for(nt=tt+2;be<nt;){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}if(he>>>=tt,be-=tt,y.have===0){l.msg="invalid bit length repeat",y.mode=pt;break}Ye=y.lens[y.have-1],Fe=3+(he&3),he>>>=2,be-=2}else if(it===17){for(nt=tt+3;be<nt;){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}he>>>=tt,be-=tt,Ye=0,Fe=3+(he&7),he>>>=3,be-=3}else{for(nt=tt+7;be<nt;){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}he>>>=tt,be-=tt,Ye=0,Fe=11+(he&127),he>>>=7,be-=7}if(y.have+Fe>y.nlen+y.ndist){l.msg="invalid bit length repeat",y.mode=pt;break}for(;Fe--;)y.lens[y.have++]=Ye}}if(y.mode===pt)break;if(y.lens[256]===0){l.msg="invalid code -- missing end-of-block",y.mode=pt;break}if(y.lenbits=9,qe={bits:y.lenbits},ut=ni(er,y.lens,0,y.nlen,y.lencode,0,y.work,qe),y.lenbits=qe.bits,ut){l.msg="invalid literal/lengths set",y.mode=pt;break}if(y.distbits=6,y.distcode=y.distdyn,qe={bits:y.distbits},ut=ni(tr,y.lens,y.nlen,y.ndist,y.distcode,0,y.work,qe),y.distbits=qe.bits,ut){l.msg="invalid distances set",y.mode=pt;break}if(y.mode=xi,G===mi)break e;case xi:y.mode=bi;case bi:if(ge>=6&&Ze>=258){l.next_out=xe,l.avail_out=Ze,l.next_in=$,l.avail_in=ge,y.hold=he,y.bits=be,kn(l,Ke),xe=l.next_out,J=l.output,Ze=l.avail_out,$=l.next_in,X=l.input,ge=l.avail_in,he=y.hold,be=y.bits,y.mode===St&&(y.back=-1);break}for(y.back=0;st=y.lencode[he&(1<<y.lenbits)-1],tt=st>>>24,dt=st>>>16&255,it=st&65535,!(tt<=be);){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}if(dt&&(dt&240)===0){for(He=tt,ht=dt,bt=it;st=y.lencode[bt+((he&(1<<He+ht)-1)>>He)],tt=st>>>24,dt=st>>>16&255,it=st&65535,!(He+tt<=be);){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}he>>>=He,be-=He,y.back+=He}if(he>>>=tt,be-=tt,y.back+=tt,y.length=it,dt===0){y.mode=Mr;break}if(dt&32){y.back=-1,y.mode=St;break}if(dt&64){l.msg="invalid literal/length code",y.mode=pt;break}y.extra=dt&15,y.mode=br;case br:if(y.extra){for(nt=y.extra;be<nt;){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}y.length+=he&(1<<y.extra)-1,he>>>=y.extra,be-=y.extra,y.back+=y.extra}y.was=y.length,y.mode=yr;case yr:for(;st=y.distcode[he&(1<<y.distbits)-1],tt=st>>>24,dt=st>>>16&255,it=st&65535,!(tt<=be);){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}if((dt&240)===0){for(He=tt,ht=dt,bt=it;st=y.distcode[bt+((he&(1<<He+ht)-1)>>He)],tt=st>>>24,dt=st>>>16&255,it=st&65535,!(He+tt<=be);){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}he>>>=He,be-=He,y.back+=He}if(he>>>=tt,be-=tt,y.back+=tt,dt&64){l.msg="invalid distance code",y.mode=pt;break}y.offset=it,y.extra=dt&15,y.mode=Er;case Er:if(y.extra){for(nt=y.extra;be<nt;){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}y.offset+=he&(1<<y.extra)-1,he>>>=y.extra,be-=y.extra,y.back+=y.extra}if(y.offset>y.dmax){l.msg="invalid distance too far back",y.mode=pt;break}y.mode=Ar;case Ar:if(Ze===0)break e;if(Fe=Ke-Ze,y.offset>Fe){if(Fe=y.offset-Fe,Fe>y.whave&&y.sane){l.msg="invalid distance too far back",y.mode=pt;break}Fe>y.wnext?(Fe-=y.wnext,Xe=y.wsize-Fe):Xe=y.wnext-Fe,Fe>y.length&&(Fe=y.length),xt=y.window}else xt=J,Xe=xe-y.offset,Fe=y.length;Fe>Ze&&(Fe=Ze),Ze-=Fe,y.length-=Fe;do J[xe++]=xt[Xe++];while(--Fe);y.length===0&&(y.mode=bi);break;case Mr:if(Ze===0)break e;J[xe++]=y.length,Ze--,y.mode=bi;break;case zi:if(y.wrap){for(;be<32;){if(ge===0)break e;ge--,he|=X[$++]<<be,be+=8}if(Ke-=Ze,l.total_out+=Ke,y.total+=Ke,y.wrap&4&&Ke&&(l.adler=y.check=y.flags?D(y.check,J,Ke,xe-Ke):ye(y.check,J,Ke,xe-Ke)),Ke=Ze,y.wrap&4&&(y.flags?he:Tr(he))!==y.check){l.msg="incorrect data check",y.mode=pt;break}he=0,be=0}y.mode=wr;case wr:if(y.wrap&&y.flags){for(;be<32;){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}if(y.wrap&4&&he!==(y.total&4294967295)){l.msg="incorrect length check",y.mode=pt;break}he=0,be=0}y.mode=Cr;case Cr:ut=Qn;break e;case pt:ut=rr;break e;case Dr:return nr;case Lr:default:return Ct}return l.next_out=xe,l.avail_out=Ze,l.next_in=$,l.avail_in=ge,y.hold=he,y.bits=be,(y.wsize||Ke!==l.avail_out&&y.mode<pt&&(y.mode<zi||G!==ir))&&zr(l,l.output,l.next_out,Ke-l.avail_out),ot-=l.avail_in,Ke-=l.avail_out,l.total_in+=ot,l.total_out+=Ke,y.total+=Ke,y.wrap&4&&Ke&&(l.adler=y.check=y.flags?D(y.check,J,Ke,l.next_out-Ke):ye(y.check,J,Ke,l.next_out-Ke)),l.data_type=y.bits+(y.last?64:0)+(y.mode===St?128:0)+(y.mode===xi||y.mode===Ri?256:0),(ot===0&&Ke===0||G===ir)&&ut===Nt&&(ut=qn),ut},os=l=>{if(Vt(l))return Ct;let G=l.state;return G.window&&(G.window=null),l.state=null,Nt},ls=(l,G)=>{if(Vt(l))return Ct;const y=l.state;return(y.wrap&2)===0?Ct:(y.head=G,G.done=!1,Nt)},hs=(l,G)=>{const y=G.length;let X,J,$;return Vt(l)||(X=l.state,X.wrap!==0&&X.mode!==_i)?Ct:X.mode===_i&&(J=1,J=ye(J,G,y,0),J!==X.check)?rr:($=zr(l,G,y,y),$?(X.mode=Dr,nr):(X.havedict=1,Nt))};var fs=Sr,ds=Pr,cs=Or,us=ns,gs=Ir,vs=as,ms=os,ps=ls,_s=hs,xs="pako inflate (from Nodeca project)",Pt={inflateReset:fs,inflateReset2:ds,inflateResetKeep:cs,inflateInit:us,inflateInit2:gs,inflate:vs,inflateEnd:ms,inflateGetHeader:ps,inflateSetDictionary:_s,inflateInfo:xs};function bs(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var ys=bs;const Br=Object.prototype.toString,{Z_NO_FLUSH:Es,Z_FINISH:As,Z_OK:si,Z_STREAM_END:Ui,Z_NEED_DICT:Wi,Z_STREAM_ERROR:Ms,Z_DATA_ERROR:Fr,Z_MEM_ERROR:ws}=de;function ai(l){this.options=ui.assign({chunkSize:65536,windowBits:15,to:""},l||{});const G=this.options;G.raw&&G.windowBits>=0&&G.windowBits<16&&(G.windowBits=-G.windowBits,G.windowBits===0&&(G.windowBits=-15)),G.windowBits>=0&&G.windowBits<16&&!(l&&l.windowBits)&&(G.windowBits+=32),G.windowBits>15&&G.windowBits<48&&(G.windowBits&15)===0&&(G.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Xi,this.strm.avail_out=0;let y=Pt.inflateInit2(this.strm,G.windowBits);if(y!==si)throw new Error(ce[y]);if(this.header=new ys,Pt.inflateGetHeader(this.strm,this.header),G.dictionary&&(typeof G.dictionary=="string"?G.dictionary=ii.string2buf(G.dictionary):Br.call(G.dictionary)==="[object ArrayBuffer]"&&(G.dictionary=new Uint8Array(G.dictionary)),G.raw&&(y=Pt.inflateSetDictionary(this.strm,G.dictionary),y!==si)))throw new Error(ce[y])}ai.prototype.push=function(l,G){const y=this.strm,X=this.options.chunkSize,J=this.options.dictionary;let $,xe,ge;if(this.ended)return!1;for(G===~~G?xe=G:xe=G===!0?As:Es,Br.call(l)==="[object ArrayBuffer]"?y.input=new Uint8Array(l):y.input=l,y.next_in=0,y.avail_in=y.input.length;;){for(y.avail_out===0&&(y.output=new Uint8Array(X),y.next_out=0,y.avail_out=X),$=Pt.inflate(y,xe),$===Wi&&J&&($=Pt.inflateSetDictionary(y,J),$===si?$=Pt.inflate(y,xe):$===Fr&&($=Wi));y.avail_in>0&&$===Ui&&y.state.wrap>0&&l[y.next_in]!==0;)Pt.inflateReset(y),$=Pt.inflate(y,xe);switch($){case Ms:case Fr:case Wi:case ws:return this.onEnd($),this.ended=!0,!1}if(ge=y.avail_out,y.next_out&&(y.avail_out===0||$===Ui))if(this.options.to==="string"){let Ze=ii.utf8border(y.output,y.next_out),he=y.next_out-Ze,be=ii.buf2string(y.output,Ze);y.next_out=he,y.avail_out=X-he,he&&y.output.set(y.output.subarray(Ze,Ze+he),0),this.onData(be)}else this.onData(y.output.length===y.next_out?y.output:y.output.subarray(0,y.next_out));if(!($===si&&ge===0)){if($===Ui)return $=Pt.inflateEnd(this.strm),this.onEnd($),this.ended=!0,!0;if(y.avail_in===0)break}}return!0},ai.prototype.onData=function(l){this.chunks.push(l)},ai.prototype.onEnd=function(l){l===si&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=ui.flattenChunks(this.chunks)),this.chunks=[],this.err=l,this.msg=this.strm.msg};function Gi(l,G){const y=new ai(G);if(y.push(l),y.err)throw y.msg||ce[y.err];return y.result}function Cs(l,G){return G=G||{},G.raw=!0,Gi(l,G)}var Ds=ai,Ls=Gi,Ts=Cs,Os=Gi,Ss={Inflate:Ds,inflate:Ls,inflateRaw:Ts,ungzip:Os};const{Deflate:Ps,deflate:Is,deflateRaw:Rs,gzip:zs}=Vn,{Inflate:Bs,inflate:Fs,inflateRaw:Us,ungzip:Ws}=Ss;var Ur=Ps,Wr=Is,Gr=Rs,Nr=zs,Vr=Bs,jr=Fs,kr=Us,Hr=Ws,Kr=de,Gs={Deflate:Ur,deflate:Wr,deflateRaw:Gr,gzip:Nr,Inflate:Vr,inflate:jr,inflateRaw:kr,ungzip:Hr,constants:Kr}},"./node_modules/upng-js/UPNG.js":(K,C,d)=>{(function(){var A={},S;K.exports=A,S=d("./node_modules/upng-js/node_modules/pako/index.js"),function(w,O){w.toRGBA8=function(p){var x=p.width,M=p.height;if(p.tabs.acTL==null)return[w.toRGBA8.decodeImage(p.data,x,M,p).buffer];var v=[];p.frames[0].data==null&&(p.frames[0].data=p.data);for(var b,_=new Uint8Array(x*M*4),g=0;g<p.frames.length;g++){var m=p.frames[g],r=m.rect.x,e=m.rect.y,t=m.rect.width,n=m.rect.height,o=w.toRGBA8.decodeImage(m.data,t,n,p);if(g==0?b=o:m.blend==0?w._copyTile(o,t,n,b,x,M,r,e,0):m.blend==1&&w._copyTile(o,t,n,b,x,M,r,e,1),v.push(b.buffer),b=b.slice(0),m.dispose!=0){if(m.dispose==1)w._copyTile(_,t,n,b,x,M,r,e,0);else if(m.dispose==2){for(var h=g-1;p.frames[h].dispose==2;)h--;b=new Uint8Array(v[h]).slice(0)}}}return v},w.toRGBA8.decodeImage=function(p,x,M,v){var b=x*M,_=w.decode._getBPP(v),g=Math.ceil(x*_/8),m=new Uint8Array(b*4),r=new Uint32Array(m.buffer),e=v.ctype,t=v.depth,n=w._bin.readUshort;if(e==6){var o=b<<2;if(t==8)for(var h=0;h<o;h++)m[h]=p[h];if(t==16)for(var h=0;h<o;h++)m[h]=p[h<<1]}else if(e==2){var f=v.tabs.tRNS,i=-1,s=-1,a=-1;if(f&&(i=f[0],s=f[1],a=f[2]),t==8)for(var h=0;h<b;h++){var c=h<<2,u=h*3;m[c]=p[u],m[c+1]=p[u+1],m[c+2]=p[u+2],m[c+3]=255,i!=-1&&p[u]==i&&p[u+1]==s&&p[u+2]==a&&(m[c+3]=0)}if(t==16)for(var h=0;h<b;h++){var c=h<<2,u=h*6;m[c]=p[u],m[c+1]=p[u+2],m[c+2]=p[u+4],m[c+3]=255,i!=-1&&n(p,u)==i&&n(p,u+2)==s&&n(p,u+4)==a&&(m[c+3]=0)}}else if(e==3){var E=v.tabs.PLTE,T=v.tabs.tRNS,L=T?T.length:0;if(t==1)for(var P=0;P<M;P++)for(var I=P*g,z=P*x,h=0;h<x;h++){var c=z+h<<2,B=p[I+(h>>3)]>>7-((h&7)<<0)&1,F=3*B;m[c]=E[F],m[c+1]=E[F+1],m[c+2]=E[F+2],m[c+3]=B<L?T[B]:255}if(t==2)for(var P=0;P<M;P++)for(var I=P*g,z=P*x,h=0;h<x;h++){var c=z+h<<2,B=p[I+(h>>2)]>>6-((h&3)<<1)&3,F=3*B;m[c]=E[F],m[c+1]=E[F+1],m[c+2]=E[F+2],m[c+3]=B<L?T[B]:255}if(t==4)for(var P=0;P<M;P++)for(var I=P*g,z=P*x,h=0;h<x;h++){var c=z+h<<2,B=p[I+(h>>1)]>>4-((h&1)<<2)&15,F=3*B;m[c]=E[F],m[c+1]=E[F+1],m[c+2]=E[F+2],m[c+3]=B<L?T[B]:255}if(t==8)for(var h=0;h<b;h++){var c=h<<2,B=p[h],F=3*B;m[c]=E[F],m[c+1]=E[F+1],m[c+2]=E[F+2],m[c+3]=B<L?T[B]:255}}else if(e==4){if(t==8)for(var h=0;h<b;h++){var c=h<<2,W=h<<1,U=p[W];m[c]=U,m[c+1]=U,m[c+2]=U,m[c+3]=p[W+1]}if(t==16)for(var h=0;h<b;h++){var c=h<<2,W=h<<2,U=p[W];m[c]=U,m[c+1]=U,m[c+2]=U,m[c+3]=p[W+2]}}else if(e==0){var i=v.tabs.tRNS?v.tabs.tRNS:-1;if(t==1)for(var h=0;h<b;h++){var U=255*(p[h>>3]>>7-(h&7)&1),R=U==i*255?0:255;r[h]=R<<24|U<<16|U<<8|U}if(t==2)for(var h=0;h<b;h++){var U=85*(p[h>>2]>>6-((h&3)<<1)&3),R=U==i*85?0:255;r[h]=R<<24|U<<16|U<<8|U}if(t==4)for(var h=0;h<b;h++){var U=17*(p[h>>1]>>4-((h&1)<<2)&15),R=U==i*17?0:255;r[h]=R<<24|U<<16|U<<8|U}if(t==8)for(var h=0;h<b;h++){var U=p[h],R=U==i?0:255;r[h]=R<<24|U<<16|U<<8|U}if(t==16)for(var h=0;h<b;h++){var U=p[h<<1],R=n(p,h<<1)==i?0:255;r[h]=R<<24|U<<16|U<<8|U}}return m},w.decode=function(p){for(var x=new Uint8Array(p),M=8,v=w._bin,b=v.readUshort,_=v.readUint,g={tabs:{},frames:[]},m=new Uint8Array(x.length),r=0,e,t=0,n=[137,80,78,71,13,10,26,10],o=0;o<8;o++)if(x[o]!=n[o])throw"The input is not a PNG file!";for(;M<x.length;){var h=v.readUint(x,M);M+=4;var f=v.readASCII(x,M,4);if(M+=4,f=="IHDR")w.decode._IHDR(x,M,g);else if(f=="IDAT"){for(var o=0;o<h;o++)m[r+o]=x[M+o];r+=h}else if(f=="acTL")g.tabs[f]={num_frames:_(x,M),num_plays:_(x,M+4)},e=new Uint8Array(x.length);else if(f=="fcTL"){if(t!=0){var i=g.frames[g.frames.length-1];i.data=w.decode._decompress(g,e.slice(0,t),i.rect.width,i.rect.height),t=0}var s={x:_(x,M+12),y:_(x,M+16),width:_(x,M+4),height:_(x,M+8)},a=b(x,M+22);a=b(x,M+20)/(a==0?100:a);var c={rect:s,delay:Math.round(a*1e3),dispose:x[M+24],blend:x[M+25]};g.frames.push(c)}else if(f=="fdAT"){for(var o=0;o<h-4;o++)e[t+o]=x[M+o+4];t+=h-4}else if(f=="pHYs")g.tabs[f]=[v.readUint(x,M),v.readUint(x,M+4),x[M+8]];else if(f=="cHRM"){g.tabs[f]=[];for(var o=0;o<8;o++)g.tabs[f].push(v.readUint(x,M+o*4))}else if(f=="tEXt"){g.tabs[f]==null&&(g.tabs[f]={});var u=v.nextZero(x,M),E=v.readASCII(x,M,u-M),T=v.readASCII(x,u+1,M+h-u-1);g.tabs[f][E]=T}else if(f=="iTXt"){g.tabs[f]==null&&(g.tabs[f]={});var u=0,L=M;u=v.nextZero(x,L);var E=v.readASCII(x,L,u-L);L=u+1,x[L],x[L+1],L+=2,u=v.nextZero(x,L),v.readASCII(x,L,u-L),L=u+1,u=v.nextZero(x,L),v.readUTF8(x,L,u-L),L=u+1;var T=v.readUTF8(x,L,h-(L-M));g.tabs[f][E]=T}else if(f=="PLTE")g.tabs[f]=v.readBytes(x,M,h);else if(f=="hIST"){var P=g.tabs.PLTE.length/3;g.tabs[f]=[];for(var o=0;o<P;o++)g.tabs[f].push(b(x,M+o*2))}else if(f=="tRNS")g.ctype==3?g.tabs[f]=v.readBytes(x,M,h):g.ctype==0?g.tabs[f]=b(x,M):g.ctype==2&&(g.tabs[f]=[b(x,M),b(x,M+2),b(x,M+4)]);else if(f=="gAMA")g.tabs[f]=v.readUint(x,M)/1e5;else if(f=="sRGB")g.tabs[f]=x[M];else if(f=="bKGD")g.ctype==0||g.ctype==4?g.tabs[f]=[b(x,M)]:g.ctype==2||g.ctype==6?g.tabs[f]=[b(x,M),b(x,M+2),b(x,M+4)]:g.ctype==3&&(g.tabs[f]=x[M]);else if(f=="IEND"){if(t!=0){var i=g.frames[g.frames.length-1];i.data=w.decode._decompress(g,e.slice(0,t),i.rect.width,i.rect.height),t=0}g.data=w.decode._decompress(g,m,g.width,g.height);break}M+=h,v.readUint(x,M),M+=4}return delete g.compress,delete g.interlace,delete g.filter,g},w.decode._decompress=function(p,x,M,v){return p.compress==0&&(x=w.decode._inflate(x)),p.interlace==0?x=w.decode._filterZero(x,p,0,M,v):p.interlace==1&&(x=w.decode._readInterlace(x,p)),x},w.decode._inflate=function(p){return O.inflate(p)},w.decode._readInterlace=function(p,x){for(var M=x.width,v=x.height,b=w.decode._getBPP(x),_=b>>3,g=Math.ceil(M*b/8),m=new Uint8Array(v*g),r=0,e=[0,0,4,0,2,0,1],t=[0,4,0,2,0,1,0],n=[8,8,8,4,4,2,2],o=[8,8,4,4,2,2,1],h=0;h<7;){for(var f=n[h],i=o[h],s=0,a=0,c=e[h];c<v;)c+=f,a++;for(var u=t[h];u<M;)u+=i,s++;var E=Math.ceil(s*b/8);w.decode._filterZero(p,x,r,s,a);for(var T=0,L=e[h];L<v;){for(var P=t[h],I=r+T*E<<3;P<M;){if(b==1){var z=p[I>>3];z=z>>7-(I&7)&1,m[L*g+(P>>3)]|=z<<7-((P&3)<<0)}if(b==2){var z=p[I>>3];z=z>>6-(I&7)&3,m[L*g+(P>>2)]|=z<<6-((P&3)<<1)}if(b==4){var z=p[I>>3];z=z>>4-(I&7)&15,m[L*g+(P>>1)]|=z<<4-((P&1)<<2)}if(b>=8)for(var B=L*g+P*_,F=0;F<_;F++)m[B+F]=p[(I>>3)+F];I+=b,P+=i}T++,L+=f}s*a!=0&&(r+=a*(1+E)),h=h+1}return m},w.decode._getBPP=function(p){var x=[1,null,3,1,2,null,4][p.ctype];return x*p.depth},w.decode._filterZero=function(p,x,M,v,b){var _=w.decode._getBPP(x),g=Math.ceil(v*_/8),m=w.decode._paeth;_=Math.ceil(_/8);for(var r=0;r<b;r++){var e=M+r*g,t=e+r+1,n=p[t-1];if(n==0)for(var o=0;o<g;o++)p[e+o]=p[t+o];else if(n==1){for(var o=0;o<_;o++)p[e+o]=p[t+o];for(var o=_;o<g;o++)p[e+o]=p[t+o]+p[e+o-_]&255}else if(r==0){for(var o=0;o<_;o++)p[e+o]=p[t+o];if(n==2)for(var o=_;o<g;o++)p[e+o]=p[t+o]&255;if(n==3)for(var o=_;o<g;o++)p[e+o]=p[t+o]+(p[e+o-_]>>1)&255;if(n==4)for(var o=_;o<g;o++)p[e+o]=p[t+o]+m(p[e+o-_],0,0)&255}else{if(n==2)for(var o=0;o<g;o++)p[e+o]=p[t+o]+p[e+o-g]&255;if(n==3){for(var o=0;o<_;o++)p[e+o]=p[t+o]+(p[e+o-g]>>1)&255;for(var o=_;o<g;o++)p[e+o]=p[t+o]+(p[e+o-g]+p[e+o-_]>>1)&255}if(n==4){for(var o=0;o<_;o++)p[e+o]=p[t+o]+m(0,p[e+o-g],0)&255;for(var o=_;o<g;o++)p[e+o]=p[t+o]+m(p[e+o-_],p[e+o-g],p[e+o-_-g])&255}}}return p},w.decode._paeth=function(p,x,M){var v=p+x-M,b=Math.abs(v-p),_=Math.abs(v-x),g=Math.abs(v-M);return b<=_&&b<=g?p:_<=g?x:M},w.decode._IHDR=function(p,x,M){var v=w._bin;M.width=v.readUint(p,x),x+=4,M.height=v.readUint(p,x),x+=4,M.depth=p[x],x++,M.ctype=p[x],x++,M.compress=p[x],x++,M.filter=p[x],x++,M.interlace=p[x],x++},w._bin={nextZero:function(p,x){for(;p[x]!=0;)x++;return x},readUshort:function(p,x){return p[x]<<8|p[x+1]},writeUshort:function(p,x,M){p[x]=M>>8&255,p[x+1]=M&255},readUint:function(p,x){return p[x]*16777216+(p[x+1]<<16|p[x+2]<<8|p[x+3])},writeUint:function(p,x,M){p[x]=M>>24&255,p[x+1]=M>>16&255,p[x+2]=M>>8&255,p[x+3]=M&255},readASCII:function(p,x,M){for(var v="",b=0;b<M;b++)v+=String.fromCharCode(p[x+b]);return v},writeASCII:function(p,x,M){for(var v=0;v<M.length;v++)p[x+v]=M.charCodeAt(v)},readBytes:function(p,x,M){for(var v=[],b=0;b<M;b++)v.push(p[x+b]);return v},pad:function(p){return p.length<2?"0"+p:p},readUTF8:function(p,x,M){for(var v="",b,_=0;_<M;_++)v+="%"+w._bin.pad(p[x+_].toString(16));try{b=decodeURIComponent(v)}catch{return w._bin.readASCII(p,x,M)}return b}},w._copyTile=function(p,x,M,v,b,_,g,m,r){for(var e=Math.min(x,b),t=Math.min(M,_),n=0,o=0,h=0;h<t;h++)for(var f=0;f<e;f++)if(g>=0&&m>=0?(n=h*x+f<<2,o=(m+h)*b+g+f<<2):(n=(-m+h)*x-g+f<<2,o=h*b+f<<2),r==0)v[o]=p[n],v[o+1]=p[n+1],v[o+2]=p[n+2],v[o+3]=p[n+3];else if(r==1){var i=p[n+3]*.00392156862745098,s=p[n]*i,a=p[n+1]*i,c=p[n+2]*i,u=v[o+3]*(1/255),E=v[o]*u,T=v[o+1]*u,L=v[o+2]*u,P=1-i,I=i+u*P,z=I==0?0:1/I;v[o+3]=255*I,v[o+0]=(s+E*P)*z,v[o+1]=(a+T*P)*z,v[o+2]=(c+L*P)*z}else if(r==2){var i=p[n+3],s=p[n],a=p[n+1],c=p[n+2],u=v[o+3],E=v[o],T=v[o+1],L=v[o+2];i==u&&s==E&&a==T&&c==L?(v[o]=0,v[o+1]=0,v[o+2]=0,v[o+3]=0):(v[o]=s,v[o+1]=a,v[o+2]=c,v[o+3]=i)}else if(r==3){var i=p[n+3],s=p[n],a=p[n+1],c=p[n+2],u=v[o+3],E=v[o],T=v[o+1],L=v[o+2];if(i==u&&s==E&&a==T&&c==L)continue;if(i<220&&u>20)return!1}return!0},w.encode=function(p,x,M,v,b,_){v==null&&(v=0),_==null&&(_=!1);for(var g=new Uint8Array(p[0].byteLength*p.length+100),m=[137,80,78,71,13,10,26,10],r=0;r<8;r++)g[r]=m[r];var e=8,t=w._bin,n=w.crc.crc,o=t.writeUint,h=t.writeUshort,f=t.writeASCII,i=w.encode.compressPNG(p,x,M,v,_);o(g,e,13),e+=4,f(g,e,"IHDR"),e+=4,o(g,e,x),e+=4,o(g,e,M),e+=4,g[e]=i.depth,e++,g[e]=i.ctype,e++,g[e]=0,e++,g[e]=0,e++,g[e]=0,e++,o(g,e,n(g,e-17,17)),e+=4,o(g,e,1),e+=4,f(g,e,"sRGB"),e+=4,g[e]=1,e++,o(g,e,n(g,e-5,5)),e+=4;var s=p.length>1;if(s&&(o(g,e,8),e+=4,f(g,e,"acTL"),e+=4,o(g,e,p.length),e+=4,o(g,e,0),e+=4,o(g,e,n(g,e-12,12)),e+=4),i.ctype==3){var a=i.plte.length;o(g,e,a*3),e+=4,f(g,e,"PLTE"),e+=4;for(var r=0;r<a;r++){var c=r*3,u=i.plte[r],E=u&255,T=u>>8&255,L=u>>16&255;g[e+c+0]=E,g[e+c+1]=T,g[e+c+2]=L}if(e+=a*3,o(g,e,n(g,e-a*3-4,a*3+4)),e+=4,i.gotAlpha){o(g,e,a),e+=4,f(g,e,"tRNS"),e+=4;for(var r=0;r<a;r++)g[e+r]=i.plte[r]>>24&255;e+=a,o(g,e,n(g,e-a-4,a+4)),e+=4}}for(var P=0,I=0;I<i.frames.length;I++){var z=i.frames[I];s&&(o(g,e,26),e+=4,f(g,e,"fcTL"),e+=4,o(g,e,P++),e+=4,o(g,e,z.rect.width),e+=4,o(g,e,z.rect.height),e+=4,o(g,e,z.rect.x),e+=4,o(g,e,z.rect.y),e+=4,h(g,e,b[I]),e+=2,h(g,e,1e3),e+=2,g[e]=z.dispose,e++,g[e]=z.blend,e++,o(g,e,n(g,e-30,30)),e+=4);var B=z.cimg,a=B.length;o(g,e,a+(I==0?0:4)),e+=4;var F=e;f(g,e,I==0?"IDAT":"fdAT"),e+=4,I!=0&&(o(g,e,P++),e+=4);for(var r=0;r<a;r++)g[e+r]=B[r];e+=a,o(g,e,n(g,F,e-F)),e+=4}return o(g,e,0),e+=4,f(g,e,"IEND"),e+=4,o(g,e,n(g,e-4,4)),e+=4,g.buffer.slice(0,e)},w.encode.compressPNG=function(p,x,M,v,b){for(var _=w.encode.compress(p,x,M,v,!1,b),g=0;g<p.length;g++){var m=_.frames[g];m.rect.width;var r=m.rect.height,e=m.bpl,t=m.bpp,n=new Uint8Array(r*e+r);m.cimg=w.encode._filterZero(m.img,r,t,e,n)}return _},w.encode.compress=function(p,x,M,v,b,_){_==null&&(_=!1);for(var g=6,m=8,r=4,e=255,t=0;t<p.length;t++)for(var n=new Uint8Array(p[t]),o=n.length,h=0;h<o;h+=4)e&=n[h+3];var f=e!=255,i={},s=[];if(p.length!=0&&(i[0]=0,s.push(0),v!=0&&v--),v!=0){var a=w.quantize(p,v,b);p=a.bufs;for(var h=0;h<a.plte.length;h++){var c=a.plte[h].est.rgba;i[c]==null&&(i[c]=s.length,s.push(c))}}else for(var t=0;t<p.length;t++)for(var u=new Uint32Array(p[t]),o=u.length,h=0;h<o;h++){var c=u[h];if((h<x||c!=u[h-1]&&c!=u[h-x])&&i[c]==null&&(i[c]=s.length,s.push(c),s.length>=300))break}var E=f?b:!1,T=s.length;T<=256&&_==!1&&(T<=2?m=1:T<=4?m=2:T<=16?m=4:m=8,b&&(m=8),f=!0);for(var L=[],t=0;t<p.length;t++){var P=new Uint8Array(p[t]),I=new Uint32Array(P.buffer),z=0,B=0,F=x,W=M,U=0;if(t!=0&&!E){for(var R=b||t==1||L[L.length-2].dispose==2?1:2,V=0,q=1e9,ee=0;ee<R;ee++){for(var _e=new Uint8Array(p[t-1-ee]),se=new Uint32Array(p[t-1-ee]),ie=x,le=M,re=-1,oe=-1,Ae=0;Ae<M;Ae++)for(var Me=0;Me<x;Me++){var h=Ae*x+Me;I[h]!=se[h]&&(Me<ie&&(ie=Me),Me>re&&(re=Me),Ae<le&&(le=Ae),Ae>oe&&(oe=Ae))}var Oe=re==-1?1:(re-ie+1)*(oe-le+1);Oe<q&&(q=Oe,V=ee,re==-1?(z=B=0,F=W=1):(z=ie,B=le,F=re-ie+1,W=oe-le+1))}var _e=new Uint8Array(p[t-1-V]);V==1&&(L[L.length-1].dispose=2);var Q=new Uint8Array(F*W*4);new Uint32Array(Q.buffer),w._copyTile(_e,x,M,Q,F,W,-z,-B,0),w._copyTile(P,x,M,Q,F,W,-z,-B,3)?(w._copyTile(P,x,M,Q,F,W,-z,-B,2),U=1):(w._copyTile(P,x,M,Q,F,W,-z,-B,0),U=0),P=Q,I=new Uint32Array(P.buffer)}var me=4*F;if(T<=256&&_==!1){me=Math.ceil(m*F/8);for(var Q=new Uint8Array(me*W),Ae=0;Ae<W;Ae++){var h=Ae*me,Ce=Ae*F;if(m==8)for(var Me=0;Me<F;Me++)Q[h+Me]=i[I[Ce+Me]];else if(m==4)for(var Me=0;Me<F;Me++)Q[h+(Me>>1)]|=i[I[Ce+Me]]<<4-(Me&1)*4;else if(m==2)for(var Me=0;Me<F;Me++)Q[h+(Me>>2)]|=i[I[Ce+Me]]<<6-(Me&3)*2;else if(m==1)for(var Me=0;Me<F;Me++)Q[h+(Me>>3)]|=i[I[Ce+Me]]<<7-(Me&7)*1}P=Q,g=3,r=1}else if(f==!1&&p.length==1){for(var Q=new Uint8Array(F*W*3),Pe=F*W,h=0;h<Pe;h++){var We=h*3,Ue=h*4;Q[We]=P[Ue],Q[We+1]=P[Ue+1],Q[We+2]=P[Ue+2]}P=Q,g=2,r=3,me=3*F}L.push({rect:{x:z,y:B,width:F,height:W},img:P,bpl:me,bpp:r,blend:U,dispose:E?1:0})}return{ctype:g,depth:m,plte:s,gotAlpha:f,frames:L}},w.encode._filterZero=function(p,x,M,v,b){for(var _=[],g=0;g<5;g++)if(!(x*v>5e5&&(g==2||g==3||g==4))){for(var m=0;m<x;m++)w.encode._filterLine(b,p,m,v,M,g);if(_.push(O.deflate(b)),M==1)break}for(var r,e=1e9,t=0;t<_.length;t++)_[t].length<e&&(r=t,e=_[t].length);return _[r]},w.encode._filterLine=function(p,x,M,v,b,_){var g=M*v,m=g+M,r=w.decode._paeth;if(p[m]=_,m++,_==0)for(var e=0;e<v;e++)p[m+e]=x[g+e];else if(_==1){for(var e=0;e<b;e++)p[m+e]=x[g+e];for(var e=b;e<v;e++)p[m+e]=x[g+e]-x[g+e-b]+256&255}else if(M==0){for(var e=0;e<b;e++)p[m+e]=x[g+e];if(_==2)for(var e=b;e<v;e++)p[m+e]=x[g+e];if(_==3)for(var e=b;e<v;e++)p[m+e]=x[g+e]-(x[g+e-b]>>1)+256&255;if(_==4)for(var e=b;e<v;e++)p[m+e]=x[g+e]-r(x[g+e-b],0,0)+256&255}else{if(_==2)for(var e=0;e<v;e++)p[m+e]=x[g+e]+256-x[g+e-v]&255;if(_==3){for(var e=0;e<b;e++)p[m+e]=x[g+e]+256-(x[g+e-v]>>1)&255;for(var e=b;e<v;e++)p[m+e]=x[g+e]+256-(x[g+e-v]+x[g+e-b]>>1)&255}if(_==4){for(var e=0;e<b;e++)p[m+e]=x[g+e]+256-r(0,x[g+e-v],0)&255;for(var e=b;e<v;e++)p[m+e]=x[g+e]+256-r(x[g+e-b],x[g+e-v],x[g+e-b-v])&255}}},w.crc={table:function(){for(var p=new Uint32Array(256),x=0;x<256;x++){for(var M=x,v=0;v<8;v++)M&1?M=3988292384^M>>>1:M=M>>>1;p[x]=M}return p}(),update:function(p,x,M,v){for(var b=0;b<v;b++)p=w.crc.table[(p^x[M+b])&255]^p>>>8;return p},crc:function(p,x,M){return w.crc.update(4294967295,p,x,M)^4294967295}},w.quantize=function(p,x,M){for(var v=[],b=0,_=0;_<p.length;_++)v.push(w.encode.alphaMul(new Uint8Array(p[_]),M)),b+=p[_].byteLength;for(var g=new Uint8Array(b),m=new Uint32Array(g.buffer),r=0,_=0;_<v.length;_++){for(var e=v[_],t=e.length,n=0;n<t;n++)g[r+n]=e[n];r+=t}var o={i0:0,i1:g.length,bst:null,est:null,tdst:0,left:null,right:null};o.bst=w.quantize.stats(g,o.i0,o.i1),o.est=w.quantize.estats(o.bst);for(var h=[o];h.length<x;){for(var f=0,i=0,_=0;_<h.length;_++)h[_].est.L>f&&(f=h[_].est.L,i=_);if(f<.001)break;var s=h[i],a=w.quantize.splitPixels(g,m,s.i0,s.i1,s.est.e,s.est.eMq255),c={i0:s.i0,i1:a,bst:null,est:null,tdst:0,left:null,right:null};c.bst=w.quantize.stats(g,c.i0,c.i1),c.est=w.quantize.estats(c.bst);var u={i0:a,i1:s.i1,bst:null,est:null,tdst:0,left:null,right:null};u.bst={R:[],m:[],N:s.bst.N-c.bst.N};for(var _=0;_<16;_++)u.bst.R[_]=s.bst.R[_]-c.bst.R[_];for(var _=0;_<4;_++)u.bst.m[_]=s.bst.m[_]-c.bst.m[_];u.est=w.quantize.estats(u.bst),s.left=c,s.right=u,h[i]=c,h.push(u)}h.sort(function(R,V){return V.bst.N-R.bst.N});for(var E=0;E<v.length;E++){for(var T=w.quantize.planeDst,L=new Uint8Array(v[E].buffer),P=new Uint32Array(v[E].buffer),I=L.length,_=0;_<I;_+=4){for(var z=L[_]*.00392156862745098,B=L[_+1]*(1/255),F=L[_+2]*(1/255),W=L[_+3]*(1/255),U=o;U.left;)U=T(U.est,z,B,F,W)<=0?U.left:U.right;P[_>>2]=U.est.rgba}v[E]=P.buffer}return{bufs:v,plte:h}},w.quantize.getNearest=function(p,x,M,v,b){if(p.left==null)return p.tdst=w.quantize.dist(p.est.q,x,M,v,b),p;var _=w.quantize.planeDst(p.est,x,M,v,b),g=p.left,m=p.right;_>0&&(g=p.right,m=p.left);var r=w.quantize.getNearest(g,x,M,v,b);if(r.tdst<=_*_)return r;var e=w.quantize.getNearest(m,x,M,v,b);return e.tdst<r.tdst?e:r},w.quantize.planeDst=function(p,x,M,v,b){var _=p.e;return _[0]*x+_[1]*M+_[2]*v+_[3]*b-p.eMq},w.quantize.dist=function(p,x,M,v,b){var _=x-p[0],g=M-p[1],m=v-p[2],r=b-p[3];return _*_+g*g+m*m+r*r},w.quantize.splitPixels=function(p,x,M,v,b,_){var g=w.quantize.vecDot;for(v-=4;M<v;){for(;g(p,M,b)<=_;)M+=4;for(;g(p,v,b)>_;)v-=4;if(M>=v)break;var m=x[M>>2];x[M>>2]=x[v>>2],x[v>>2]=m,M+=4,v-=4}for(;g(p,M,b)>_;)M-=4;return M+4},w.quantize.vecDot=function(p,x,M){return p[x]*M[0]+p[x+1]*M[1]+p[x+2]*M[2]+p[x+3]*M[3]},w.quantize.stats=function(p,x,M){for(var v=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],b=[0,0,0,0],_=M-x>>2,g=x;g<M;g+=4){var m=p[g]*.00392156862745098,r=p[g+1]*(1/255),e=p[g+2]*(1/255),t=p[g+3]*(1/255);b[0]+=m,b[1]+=r,b[2]+=e,b[3]+=t,v[0]+=m*m,v[1]+=m*r,v[2]+=m*e,v[3]+=m*t,v[5]+=r*r,v[6]+=r*e,v[7]+=r*t,v[10]+=e*e,v[11]+=e*t,v[15]+=t*t}return v[4]=v[1],v[8]=v[2],v[12]=v[3],v[9]=v[6],v[13]=v[7],v[14]=v[11],{R:v,m:b,N:_}},w.quantize.estats=function(p){var x=p.R,M=p.m,v=p.N,b=M[0],_=M[1],g=M[2],m=M[3],r=v==0?0:1/v,e=[x[0]-b*b*r,x[1]-b*_*r,x[2]-b*g*r,x[3]-b*m*r,x[4]-_*b*r,x[5]-_*_*r,x[6]-_*g*r,x[7]-_*m*r,x[8]-g*b*r,x[9]-g*_*r,x[10]-g*g*r,x[11]-g*m*r,x[12]-m*b*r,x[13]-m*_*r,x[14]-m*g*r,x[15]-m*m*r],t=e,n=w.M4,o=[.5,.5,.5,.5],h=0,f=0;if(v!=0)for(var i=0;i<10&&(o=n.multVec(t,o),f=Math.sqrt(n.dot(o,o)),o=n.sml(1/f,o),!(Math.abs(f-h)<1e-9));i++)h=f;var s=[b*r,_*r,g*r,m*r],a=n.dot(n.sml(255,s),o),c=s[3]<.001?0:1/s[3];return{Cov:e,q:s,e:o,L:h,eMq255:a,eMq:n.dot(o,s),rgba:(Math.round(255*s[3])<<24|Math.round(255*s[2]*c)<<16|Math.round(255*s[1]*c)<<8|Math.round(255*s[0]*c)<<0)>>>0}},w.M4={multVec:function(p,x){return[p[0]*x[0]+p[1]*x[1]+p[2]*x[2]+p[3]*x[3],p[4]*x[0]+p[5]*x[1]+p[6]*x[2]+p[7]*x[3],p[8]*x[0]+p[9]*x[1]+p[10]*x[2]+p[11]*x[3],p[12]*x[0]+p[13]*x[1]+p[14]*x[2]+p[15]*x[3]]},dot:function(p,x){return p[0]*x[0]+p[1]*x[1]+p[2]*x[2]+p[3]*x[3]},sml:function(p,x){return[p*x[0],p*x[1],p*x[2],p*x[3]]}},w.encode.alphaMul=function(p,x){for(var M=new Uint8Array(p.length),v=p.length>>2,b=0;b<v;b++){var _=b<<2,g=p[_+3];x&&(g=g<128?0:255);var m=g*(1/255);M[_+0]=p[_+0]*m,M[_+1]=p[_+1]*m,M[_+2]=p[_+2]*m,M[_+3]=g}return M}}(A,S)})()},"./node_modules/upng-js/node_modules/pako/index.js":(K,C,d)=>{var A=d("./node_modules/upng-js/node_modules/pako/lib/utils/common.js").assign,S=d("./node_modules/upng-js/node_modules/pako/lib/deflate.js"),w=d("./node_modules/upng-js/node_modules/pako/lib/inflate.js"),O=d("./node_modules/upng-js/node_modules/pako/lib/zlib/constants.js"),p={};A(p,S,w,O),K.exports=p},"./node_modules/upng-js/node_modules/pako/lib/deflate.js":(K,C,d)=>{var A=d("./node_modules/upng-js/node_modules/pako/lib/zlib/deflate.js"),S=d("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),w=d("./node_modules/upng-js/node_modules/pako/lib/utils/strings.js"),O=d("./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js"),p=d("./node_modules/upng-js/node_modules/pako/lib/zlib/zstream.js"),x=Object.prototype.toString,M=0,v=4,b=0,_=1,g=2,m=-1,r=0,e=8;function t(f){if(!(this instanceof t))return new t(f);this.options=S.assign({level:m,method:e,chunkSize:16384,windowBits:15,memLevel:8,strategy:r,to:""},f||{});var i=this.options;i.raw&&i.windowBits>0?i.windowBits=-i.windowBits:i.gzip&&i.windowBits>0&&i.windowBits<16&&(i.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;var s=A.deflateInit2(this.strm,i.level,i.method,i.windowBits,i.memLevel,i.strategy);if(s!==b)throw new Error(O[s]);if(i.header&&A.deflateSetHeader(this.strm,i.header),i.dictionary){var a;if(typeof i.dictionary=="string"?a=w.string2buf(i.dictionary):x.call(i.dictionary)==="[object ArrayBuffer]"?a=new Uint8Array(i.dictionary):a=i.dictionary,s=A.deflateSetDictionary(this.strm,a),s!==b)throw new Error(O[s]);this._dict_set=!0}}t.prototype.push=function(f,i){var s=this.strm,a=this.options.chunkSize,c,u;if(this.ended)return!1;u=i===~~i?i:i===!0?v:M,typeof f=="string"?s.input=w.string2buf(f):x.call(f)==="[object ArrayBuffer]"?s.input=new Uint8Array(f):s.input=f,s.next_in=0,s.avail_in=s.input.length;do{if(s.avail_out===0&&(s.output=new S.Buf8(a),s.next_out=0,s.avail_out=a),c=A.deflate(s,u),c!==_&&c!==b)return this.onEnd(c),this.ended=!0,!1;(s.avail_out===0||s.avail_in===0&&(u===v||u===g))&&(this.options.to==="string"?this.onData(w.buf2binstring(S.shrinkBuf(s.output,s.next_out))):this.onData(S.shrinkBuf(s.output,s.next_out)))}while((s.avail_in>0||s.avail_out===0)&&c!==_);return u===v?(c=A.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===b):(u===g&&(this.onEnd(b),s.avail_out=0),!0)},t.prototype.onData=function(f){this.chunks.push(f)},t.prototype.onEnd=function(f){f===b&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=S.flattenChunks(this.chunks)),this.chunks=[],this.err=f,this.msg=this.strm.msg};function n(f,i){var s=new t(i);if(s.push(f,!0),s.err)throw s.msg||O[s.err];return s.result}function o(f,i){return i=i||{},i.raw=!0,n(f,i)}function h(f,i){return i=i||{},i.gzip=!0,n(f,i)}C.Deflate=t,C.deflate=n,C.deflateRaw=o,C.gzip=h},"./node_modules/upng-js/node_modules/pako/lib/inflate.js":(K,C,d)=>{var A=d("./node_modules/upng-js/node_modules/pako/lib/zlib/inflate.js"),S=d("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),w=d("./node_modules/upng-js/node_modules/pako/lib/utils/strings.js"),O=d("./node_modules/upng-js/node_modules/pako/lib/zlib/constants.js"),p=d("./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js"),x=d("./node_modules/upng-js/node_modules/pako/lib/zlib/zstream.js"),M=d("./node_modules/upng-js/node_modules/pako/lib/zlib/gzheader.js"),v=Object.prototype.toString;function b(m){if(!(this instanceof b))return new b(m);this.options=S.assign({chunkSize:16384,windowBits:0,to:""},m||{});var r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),r.windowBits>=0&&r.windowBits<16&&!(m&&m.windowBits)&&(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&(r.windowBits&15)===0&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new x,this.strm.avail_out=0;var e=A.inflateInit2(this.strm,r.windowBits);if(e!==O.Z_OK)throw new Error(p[e]);if(this.header=new M,A.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=w.string2buf(r.dictionary):v.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(e=A.inflateSetDictionary(this.strm,r.dictionary),e!==O.Z_OK)))throw new Error(p[e])}b.prototype.push=function(m,r){var e=this.strm,t=this.options.chunkSize,n=this.options.dictionary,o,h,f,i,s,a=!1;if(this.ended)return!1;h=r===~~r?r:r===!0?O.Z_FINISH:O.Z_NO_FLUSH,typeof m=="string"?e.input=w.binstring2buf(m):v.call(m)==="[object ArrayBuffer]"?e.input=new Uint8Array(m):e.input=m,e.next_in=0,e.avail_in=e.input.length;do{if(e.avail_out===0&&(e.output=new S.Buf8(t),e.next_out=0,e.avail_out=t),o=A.inflate(e,O.Z_NO_FLUSH),o===O.Z_NEED_DICT&&n&&(o=A.inflateSetDictionary(this.strm,n)),o===O.Z_BUF_ERROR&&a===!0&&(o=O.Z_OK,a=!1),o!==O.Z_STREAM_END&&o!==O.Z_OK)return this.onEnd(o),this.ended=!0,!1;e.next_out&&(e.avail_out===0||o===O.Z_STREAM_END||e.avail_in===0&&(h===O.Z_FINISH||h===O.Z_SYNC_FLUSH))&&(this.options.to==="string"?(f=w.utf8border(e.output,e.next_out),i=e.next_out-f,s=w.buf2string(e.output,f),e.next_out=i,e.avail_out=t-i,i&&S.arraySet(e.output,e.output,f,i,0),this.onData(s)):this.onData(S.shrinkBuf(e.output,e.next_out))),e.avail_in===0&&e.avail_out===0&&(a=!0)}while((e.avail_in>0||e.avail_out===0)&&o!==O.Z_STREAM_END);return o===O.Z_STREAM_END&&(h=O.Z_FINISH),h===O.Z_FINISH?(o=A.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,o===O.Z_OK):(h===O.Z_SYNC_FLUSH&&(this.onEnd(O.Z_OK),e.avail_out=0),!0)},b.prototype.onData=function(m){this.chunks.push(m)},b.prototype.onEnd=function(m){m===O.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=S.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg};function _(m,r){var e=new b(r);if(e.push(m,!0),e.err)throw e.msg||p[e.err];return e.result}function g(m,r){return r=r||{},r.raw=!0,_(m,r)}C.Inflate=b,C.inflate=_,C.inflateRaw=g,C.ungzip=_},"./node_modules/upng-js/node_modules/pako/lib/utils/common.js":(K,C)=>{var d=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";function A(O,p){return Object.prototype.hasOwnProperty.call(O,p)}C.assign=function(O){for(var p=Array.prototype.slice.call(arguments,1);p.length;){var x=p.shift();if(x){if(typeof x!="object")throw new TypeError(x+"must be non-object");for(var M in x)A(x,M)&&(O[M]=x[M])}}return O},C.shrinkBuf=function(O,p){return O.length===p?O:O.subarray?O.subarray(0,p):(O.length=p,O)};var S={arraySet:function(O,p,x,M,v){if(p.subarray&&O.subarray){O.set(p.subarray(x,x+M),v);return}for(var b=0;b<M;b++)O[v+b]=p[x+b]},flattenChunks:function(O){var p,x,M,v,b,_;for(M=0,p=0,x=O.length;p<x;p++)M+=O[p].length;for(_=new Uint8Array(M),v=0,p=0,x=O.length;p<x;p++)b=O[p],_.set(b,v),v+=b.length;return _}},w={arraySet:function(O,p,x,M,v){for(var b=0;b<M;b++)O[v+b]=p[x+b]},flattenChunks:function(O){return[].concat.apply([],O)}};C.setTyped=function(O){O?(C.Buf8=Uint8Array,C.Buf16=Uint16Array,C.Buf32=Int32Array,C.assign(C,S)):(C.Buf8=Array,C.Buf16=Array,C.Buf32=Array,C.assign(C,w))},C.setTyped(d)},"./node_modules/upng-js/node_modules/pako/lib/utils/strings.js":(K,C,d)=>{var A=d("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),S=!0,w=!0;try{String.fromCharCode.apply(null,[0])}catch{S=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{w=!1}for(var O=new A.Buf8(256),p=0;p<256;p++)O[p]=p>=252?6:p>=248?5:p>=240?4:p>=224?3:p>=192?2:1;O[254]=O[254]=1,C.string2buf=function(M){var v,b,_,g,m,r=M.length,e=0;for(g=0;g<r;g++)b=M.charCodeAt(g),(b&64512)===55296&&g+1<r&&(_=M.charCodeAt(g+1),(_&64512)===56320&&(b=65536+(b-55296<<10)+(_-56320),g++)),e+=b<128?1:b<2048?2:b<65536?3:4;for(v=new A.Buf8(e),m=0,g=0;m<e;g++)b=M.charCodeAt(g),(b&64512)===55296&&g+1<r&&(_=M.charCodeAt(g+1),(_&64512)===56320&&(b=65536+(b-55296<<10)+(_-56320),g++)),b<128?v[m++]=b:b<2048?(v[m++]=192|b>>>6,v[m++]=128|b&63):b<65536?(v[m++]=224|b>>>12,v[m++]=128|b>>>6&63,v[m++]=128|b&63):(v[m++]=240|b>>>18,v[m++]=128|b>>>12&63,v[m++]=128|b>>>6&63,v[m++]=128|b&63);return v};function x(M,v){if(v<65534&&(M.subarray&&w||!M.subarray&&S))return String.fromCharCode.apply(null,A.shrinkBuf(M,v));for(var b="",_=0;_<v;_++)b+=String.fromCharCode(M[_]);return b}C.buf2binstring=function(M){return x(M,M.length)},C.binstring2buf=function(M){for(var v=new A.Buf8(M.length),b=0,_=v.length;b<_;b++)v[b]=M.charCodeAt(b);return v},C.buf2string=function(M,v){var b,_,g,m,r=v||M.length,e=new Array(r*2);for(_=0,b=0;b<r;){if(g=M[b++],g<128){e[_++]=g;continue}if(m=O[g],m>4){e[_++]=65533,b+=m-1;continue}for(g&=m===2?31:m===3?15:7;m>1&&b<r;)g=g<<6|M[b++]&63,m--;if(m>1){e[_++]=65533;continue}g<65536?e[_++]=g:(g-=65536,e[_++]=55296|g>>10&1023,e[_++]=56320|g&1023)}return x(e,_)},C.utf8border=function(M,v){var b;for(v=v||M.length,v>M.length&&(v=M.length),b=v-1;b>=0&&(M[b]&192)===128;)b--;return b<0||b===0?v:b+O[M[b]]>v?b:v}},"./node_modules/upng-js/node_modules/pako/lib/zlib/adler32.js":K=>{function C(d,A,S,w){for(var O=d&65535|0,p=d>>>16&65535|0,x=0;S!==0;){x=S>2e3?2e3:S,S-=x;do O=O+A[w++]|0,p=p+O|0;while(--x);O%=65521,p%=65521}return O|p<<16|0}K.exports=C},"./node_modules/upng-js/node_modules/pako/lib/zlib/constants.js":K=>{K.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},"./node_modules/upng-js/node_modules/pako/lib/zlib/crc32.js":K=>{function C(){for(var S,w=[],O=0;O<256;O++){S=O;for(var p=0;p<8;p++)S=S&1?3988292384^S>>>1:S>>>1;w[O]=S}return w}var d=C();function A(S,w,O,p){var x=d,M=p+O;S^=-1;for(var v=p;v<M;v++)S=S>>>8^x[(S^w[v])&255];return S^-1}K.exports=A},"./node_modules/upng-js/node_modules/pako/lib/zlib/deflate.js":(K,C,d)=>{var A=d("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),S=d("./node_modules/upng-js/node_modules/pako/lib/zlib/trees.js"),w=d("./node_modules/upng-js/node_modules/pako/lib/zlib/adler32.js"),O=d("./node_modules/upng-js/node_modules/pako/lib/zlib/crc32.js"),p=d("./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js"),x=0,M=1,v=3,b=4,_=5,g=0,m=1,r=-2,e=-3,t=-5,n=-1,o=1,h=2,f=3,i=4,s=0,a=2,c=8,u=9,E=15,T=8,L=29,P=256,I=P+1+L,z=30,B=19,F=2*I+1,W=15,U=3,R=258,V=R+U+1,q=32,ee=42,se=69,ie=73,le=91,re=103,oe=113,Ae=666,Me=1,Oe=2,_e=3,Q=4,me=3;function Ce(D,ce){return D.msg=p[ce],ce}function Pe(D){return(D<<1)-(D>4?9:0)}function We(D){for(var ce=D.length;--ce>=0;)D[ce]=0}function Ue(D){var ce=D.state,de=ce.pending;de>D.avail_out&&(de=D.avail_out),de!==0&&(A.arraySet(D.output,ce.pending_buf,ce.pending_out,de,D.next_out),D.next_out+=de,ce.pending_out+=de,D.total_out+=de,D.avail_out-=de,ce.pending-=de,ce.pending===0&&(ce.pending_out=0))}function ze(D,ce){S._tr_flush_block(D,D.block_start>=0?D.block_start:-1,D.strstart-D.block_start,ce),D.block_start=D.strstart,Ue(D.strm)}function Be(D,ce){D.pending_buf[D.pending++]=ce}function Ie(D,ce){D.pending_buf[D.pending++]=ce>>>8&255,D.pending_buf[D.pending++]=ce&255}function Se(D,ce,de,H){var te=D.avail_in;return te>H&&(te=H),te===0?0:(D.avail_in-=te,A.arraySet(ce,D.input,D.next_in,te,de),D.state.wrap===1?D.adler=w(D.adler,ce,te,de):D.state.wrap===2&&(D.adler=O(D.adler,ce,te,de)),D.next_in+=te,D.total_in+=te,te)}function Te(D,ce){var de=D.max_chain_length,H=D.strstart,te,pe,ke=D.prev_length,je=D.nice_match,Ve=D.strstart>D.w_size-V?D.strstart-(D.w_size-V):0,Qe=D.window,_t=D.w_mask,et=D.prev,$e=D.strstart+R,Je=Qe[H+ke-1],gt=Qe[H+ke];D.prev_length>=D.good_match&&(de>>=2),je>D.lookahead&&(je=D.lookahead);do if(te=ce,!(Qe[te+ke]!==gt||Qe[te+ke-1]!==Je||Qe[te]!==Qe[H]||Qe[++te]!==Qe[H+1])){H+=2,te++;do;while(Qe[++H]===Qe[++te]&&Qe[++H]===Qe[++te]&&Qe[++H]===Qe[++te]&&Qe[++H]===Qe[++te]&&Qe[++H]===Qe[++te]&&Qe[++H]===Qe[++te]&&Qe[++H]===Qe[++te]&&Qe[++H]===Qe[++te]&&H<$e);if(pe=R-($e-H),H=$e-R,pe>ke){if(D.match_start=ce,ke=pe,pe>=je)break;Je=Qe[H+ke-1],gt=Qe[H+ke]}}while((ce=et[ce&_t])>Ve&&--de!==0);return ke<=D.lookahead?ke:D.lookahead}function Ge(D){var ce=D.w_size,de,H,te,pe,ke;do{if(pe=D.window_size-D.lookahead-D.strstart,D.strstart>=ce+(ce-V)){A.arraySet(D.window,D.window,ce,ce,0),D.match_start-=ce,D.strstart-=ce,D.block_start-=ce,H=D.hash_size,de=H;do te=D.head[--de],D.head[de]=te>=ce?te-ce:0;while(--H);H=ce,de=H;do te=D.prev[--de],D.prev[de]=te>=ce?te-ce:0;while(--H);pe+=ce}if(D.strm.avail_in===0)break;if(H=Se(D.strm,D.window,D.strstart+D.lookahead,pe),D.lookahead+=H,D.lookahead+D.insert>=U)for(ke=D.strstart-D.insert,D.ins_h=D.window[ke],D.ins_h=(D.ins_h<<D.hash_shift^D.window[ke+1])&D.hash_mask;D.insert&&(D.ins_h=(D.ins_h<<D.hash_shift^D.window[ke+U-1])&D.hash_mask,D.prev[ke&D.w_mask]=D.head[D.ins_h],D.head[D.ins_h]=ke,ke++,D.insert--,!(D.lookahead+D.insert<U)););}while(D.lookahead<V&&D.strm.avail_in!==0)}function Ne(D,ce){var de=65535;for(de>D.pending_buf_size-5&&(de=D.pending_buf_size-5);;){if(D.lookahead<=1){if(Ge(D),D.lookahead===0&&ce===x)return Me;if(D.lookahead===0)break}D.strstart+=D.lookahead,D.lookahead=0;var H=D.block_start+de;if((D.strstart===0||D.strstart>=H)&&(D.lookahead=D.strstart-H,D.strstart=H,ze(D,!1),D.strm.avail_out===0)||D.strstart-D.block_start>=D.w_size-V&&(ze(D,!1),D.strm.avail_out===0))return Me}return D.insert=0,ce===b?(ze(D,!0),D.strm.avail_out===0?_e:Q):(D.strstart>D.block_start&&(ze(D,!1),D.strm.avail_out===0),Me)}function k(D,ce){for(var de,H;;){if(D.lookahead<V){if(Ge(D),D.lookahead<V&&ce===x)return Me;if(D.lookahead===0)break}if(de=0,D.lookahead>=U&&(D.ins_h=(D.ins_h<<D.hash_shift^D.window[D.strstart+U-1])&D.hash_mask,de=D.prev[D.strstart&D.w_mask]=D.head[D.ins_h],D.head[D.ins_h]=D.strstart),de!==0&&D.strstart-de<=D.w_size-V&&(D.match_length=Te(D,de)),D.match_length>=U)if(H=S._tr_tally(D,D.strstart-D.match_start,D.match_length-U),D.lookahead-=D.match_length,D.match_length<=D.max_lazy_match&&D.lookahead>=U){D.match_length--;do D.strstart++,D.ins_h=(D.ins_h<<D.hash_shift^D.window[D.strstart+U-1])&D.hash_mask,de=D.prev[D.strstart&D.w_mask]=D.head[D.ins_h],D.head[D.ins_h]=D.strstart;while(--D.match_length!==0);D.strstart++}else D.strstart+=D.match_length,D.match_length=0,D.ins_h=D.window[D.strstart],D.ins_h=(D.ins_h<<D.hash_shift^D.window[D.strstart+1])&D.hash_mask;else H=S._tr_tally(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++;if(H&&(ze(D,!1),D.strm.avail_out===0))return Me}return D.insert=D.strstart<U-1?D.strstart:U-1,ce===b?(ze(D,!0),D.strm.avail_out===0?_e:Q):D.last_lit&&(ze(D,!1),D.strm.avail_out===0)?Me:Oe}function Z(D,ce){for(var de,H,te;;){if(D.lookahead<V){if(Ge(D),D.lookahead<V&&ce===x)return Me;if(D.lookahead===0)break}if(de=0,D.lookahead>=U&&(D.ins_h=(D.ins_h<<D.hash_shift^D.window[D.strstart+U-1])&D.hash_mask,de=D.prev[D.strstart&D.w_mask]=D.head[D.ins_h],D.head[D.ins_h]=D.strstart),D.prev_length=D.match_length,D.prev_match=D.match_start,D.match_length=U-1,de!==0&&D.prev_length<D.max_lazy_match&&D.strstart-de<=D.w_size-V&&(D.match_length=Te(D,de),D.match_length<=5&&(D.strategy===o||D.match_length===U&&D.strstart-D.match_start>4096)&&(D.match_length=U-1)),D.prev_length>=U&&D.match_length<=D.prev_length){te=D.strstart+D.lookahead-U,H=S._tr_tally(D,D.strstart-1-D.prev_match,D.prev_length-U),D.lookahead-=D.prev_length-1,D.prev_length-=2;do++D.strstart<=te&&(D.ins_h=(D.ins_h<<D.hash_shift^D.window[D.strstart+U-1])&D.hash_mask,de=D.prev[D.strstart&D.w_mask]=D.head[D.ins_h],D.head[D.ins_h]=D.strstart);while(--D.prev_length!==0);if(D.match_available=0,D.match_length=U-1,D.strstart++,H&&(ze(D,!1),D.strm.avail_out===0))return Me}else if(D.match_available){if(H=S._tr_tally(D,0,D.window[D.strstart-1]),H&&ze(D,!1),D.strstart++,D.lookahead--,D.strm.avail_out===0)return Me}else D.match_available=1,D.strstart++,D.lookahead--}return D.match_available&&(H=S._tr_tally(D,0,D.window[D.strstart-1]),D.match_available=0),D.insert=D.strstart<U-1?D.strstart:U-1,ce===b?(ze(D,!0),D.strm.avail_out===0?_e:Q):D.last_lit&&(ze(D,!1),D.strm.avail_out===0)?Me:Oe}function Y(D,ce){for(var de,H,te,pe,ke=D.window;;){if(D.lookahead<=R){if(Ge(D),D.lookahead<=R&&ce===x)return Me;if(D.lookahead===0)break}if(D.match_length=0,D.lookahead>=U&&D.strstart>0&&(te=D.strstart-1,H=ke[te],H===ke[++te]&&H===ke[++te]&&H===ke[++te])){pe=D.strstart+R;do;while(H===ke[++te]&&H===ke[++te]&&H===ke[++te]&&H===ke[++te]&&H===ke[++te]&&H===ke[++te]&&H===ke[++te]&&H===ke[++te]&&te<pe);D.match_length=R-(pe-te),D.match_length>D.lookahead&&(D.match_length=D.lookahead)}if(D.match_length>=U?(de=S._tr_tally(D,1,D.match_length-U),D.lookahead-=D.match_length,D.strstart+=D.match_length,D.match_length=0):(de=S._tr_tally(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++),de&&(ze(D,!1),D.strm.avail_out===0))return Me}return D.insert=0,ce===b?(ze(D,!0),D.strm.avail_out===0?_e:Q):D.last_lit&&(ze(D,!1),D.strm.avail_out===0)?Me:Oe}function ue(D,ce){for(var de;;){if(D.lookahead===0&&(Ge(D),D.lookahead===0)){if(ce===x)return Me;break}if(D.match_length=0,de=S._tr_tally(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++,de&&(ze(D,!1),D.strm.avail_out===0))return Me}return D.insert=0,ce===b?(ze(D,!0),D.strm.avail_out===0?_e:Q):D.last_lit&&(ze(D,!1),D.strm.avail_out===0)?Me:Oe}function fe(D,ce,de,H,te){this.good_length=D,this.max_lazy=ce,this.nice_length=de,this.max_chain=H,this.func=te}var Ee;Ee=[new fe(0,0,0,0,Ne),new fe(4,4,8,4,k),new fe(4,5,16,8,k),new fe(4,6,32,32,k),new fe(4,4,16,16,Z),new fe(8,16,32,32,Z),new fe(8,16,128,128,Z),new fe(8,32,128,256,Z),new fe(32,128,258,1024,Z),new fe(32,258,258,4096,Z)];function we(D){D.window_size=2*D.w_size,We(D.head),D.max_lazy_match=Ee[D.level].max_lazy,D.good_match=Ee[D.level].good_length,D.nice_match=Ee[D.level].nice_length,D.max_chain_length=Ee[D.level].max_chain,D.strstart=0,D.block_start=0,D.lookahead=0,D.insert=0,D.match_length=D.prev_length=U-1,D.match_available=0,D.ins_h=0}function N(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=c,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new A.Buf16(F*2),this.dyn_dtree=new A.Buf16((2*z+1)*2),this.bl_tree=new A.Buf16((2*B+1)*2),We(this.dyn_ltree),We(this.dyn_dtree),We(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new A.Buf16(W+1),this.heap=new A.Buf16(2*I+1),We(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new A.Buf16(2*I+1),We(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function ae(D){var ce;return!D||!D.state?Ce(D,r):(D.total_in=D.total_out=0,D.data_type=a,ce=D.state,ce.pending=0,ce.pending_out=0,ce.wrap<0&&(ce.wrap=-ce.wrap),ce.status=ce.wrap?ee:oe,D.adler=ce.wrap===2?0:1,ce.last_flush=x,S._tr_init(ce),g)}function ve(D){var ce=ae(D);return ce===g&&we(D.state),ce}function Le(D,ce){return!D||!D.state||D.state.wrap!==2?r:(D.state.gzhead=ce,g)}function ne(D,ce,de,H,te,pe){if(!D)return r;var ke=1;if(ce===n&&(ce=6),H<0?(ke=0,H=-H):H>15&&(ke=2,H-=16),te<1||te>u||de!==c||H<8||H>15||ce<0||ce>9||pe<0||pe>i)return Ce(D,r);H===8&&(H=9);var je=new N;return D.state=je,je.strm=D,je.wrap=ke,je.gzhead=null,je.w_bits=H,je.w_size=1<<je.w_bits,je.w_mask=je.w_size-1,je.hash_bits=te+7,je.hash_size=1<<je.hash_bits,je.hash_mask=je.hash_size-1,je.hash_shift=~~((je.hash_bits+U-1)/U),je.window=new A.Buf8(je.w_size*2),je.head=new A.Buf16(je.hash_size),je.prev=new A.Buf16(je.w_size),je.lit_bufsize=1<<te+6,je.pending_buf_size=je.lit_bufsize*4,je.pending_buf=new A.Buf8(je.pending_buf_size),je.d_buf=1*je.lit_bufsize,je.l_buf=3*je.lit_bufsize,je.level=ce,je.strategy=pe,je.method=de,ve(D)}function ye(D,ce){return ne(D,ce,c,E,T,s)}function j(D,ce){var de,H,te,pe;if(!D||!D.state||ce>_||ce<0)return D?Ce(D,r):r;if(H=D.state,!D.output||!D.input&&D.avail_in!==0||H.status===Ae&&ce!==b)return Ce(D,D.avail_out===0?t:r);if(H.strm=D,de=H.last_flush,H.last_flush=ce,H.status===ee)if(H.wrap===2)D.adler=0,Be(H,31),Be(H,139),Be(H,8),H.gzhead?(Be(H,(H.gzhead.text?1:0)+(H.gzhead.hcrc?2:0)+(H.gzhead.extra?4:0)+(H.gzhead.name?8:0)+(H.gzhead.comment?16:0)),Be(H,H.gzhead.time&255),Be(H,H.gzhead.time>>8&255),Be(H,H.gzhead.time>>16&255),Be(H,H.gzhead.time>>24&255),Be(H,H.level===9?2:H.strategy>=h||H.level<2?4:0),Be(H,H.gzhead.os&255),H.gzhead.extra&&H.gzhead.extra.length&&(Be(H,H.gzhead.extra.length&255),Be(H,H.gzhead.extra.length>>8&255)),H.gzhead.hcrc&&(D.adler=O(D.adler,H.pending_buf,H.pending,0)),H.gzindex=0,H.status=se):(Be(H,0),Be(H,0),Be(H,0),Be(H,0),Be(H,0),Be(H,H.level===9?2:H.strategy>=h||H.level<2?4:0),Be(H,me),H.status=oe);else{var ke=c+(H.w_bits-8<<4)<<8,je=-1;H.strategy>=h||H.level<2?je=0:H.level<6?je=1:H.level===6?je=2:je=3,ke|=je<<6,H.strstart!==0&&(ke|=q),ke+=31-ke%31,H.status=oe,Ie(H,ke),H.strstart!==0&&(Ie(H,D.adler>>>16),Ie(H,D.adler&65535)),D.adler=1}if(H.status===se)if(H.gzhead.extra){for(te=H.pending;H.gzindex<(H.gzhead.extra.length&65535)&&!(H.pending===H.pending_buf_size&&(H.gzhead.hcrc&&H.pending>te&&(D.adler=O(D.adler,H.pending_buf,H.pending-te,te)),Ue(D),te=H.pending,H.pending===H.pending_buf_size));)Be(H,H.gzhead.extra[H.gzindex]&255),H.gzindex++;H.gzhead.hcrc&&H.pending>te&&(D.adler=O(D.adler,H.pending_buf,H.pending-te,te)),H.gzindex===H.gzhead.extra.length&&(H.gzindex=0,H.status=ie)}else H.status=ie;if(H.status===ie)if(H.gzhead.name){te=H.pending;do{if(H.pending===H.pending_buf_size&&(H.gzhead.hcrc&&H.pending>te&&(D.adler=O(D.adler,H.pending_buf,H.pending-te,te)),Ue(D),te=H.pending,H.pending===H.pending_buf_size)){pe=1;break}H.gzindex<H.gzhead.name.length?pe=H.gzhead.name.charCodeAt(H.gzindex++)&255:pe=0,Be(H,pe)}while(pe!==0);H.gzhead.hcrc&&H.pending>te&&(D.adler=O(D.adler,H.pending_buf,H.pending-te,te)),pe===0&&(H.gzindex=0,H.status=le)}else H.status=le;if(H.status===le)if(H.gzhead.comment){te=H.pending;do{if(H.pending===H.pending_buf_size&&(H.gzhead.hcrc&&H.pending>te&&(D.adler=O(D.adler,H.pending_buf,H.pending-te,te)),Ue(D),te=H.pending,H.pending===H.pending_buf_size)){pe=1;break}H.gzindex<H.gzhead.comment.length?pe=H.gzhead.comment.charCodeAt(H.gzindex++)&255:pe=0,Be(H,pe)}while(pe!==0);H.gzhead.hcrc&&H.pending>te&&(D.adler=O(D.adler,H.pending_buf,H.pending-te,te)),pe===0&&(H.status=re)}else H.status=re;if(H.status===re&&(H.gzhead.hcrc?(H.pending+2>H.pending_buf_size&&Ue(D),H.pending+2<=H.pending_buf_size&&(Be(H,D.adler&255),Be(H,D.adler>>8&255),D.adler=0,H.status=oe)):H.status=oe),H.pending!==0){if(Ue(D),D.avail_out===0)return H.last_flush=-1,g}else if(D.avail_in===0&&Pe(ce)<=Pe(de)&&ce!==b)return Ce(D,t);if(H.status===Ae&&D.avail_in!==0)return Ce(D,t);if(D.avail_in!==0||H.lookahead!==0||ce!==x&&H.status!==Ae){var Ve=H.strategy===h?ue(H,ce):H.strategy===f?Y(H,ce):Ee[H.level].func(H,ce);if((Ve===_e||Ve===Q)&&(H.status=Ae),Ve===Me||Ve===_e)return D.avail_out===0&&(H.last_flush=-1),g;if(Ve===Oe&&(ce===M?S._tr_align(H):ce!==_&&(S._tr_stored_block(H,0,0,!1),ce===v&&(We(H.head),H.lookahead===0&&(H.strstart=0,H.block_start=0,H.insert=0))),Ue(D),D.avail_out===0))return H.last_flush=-1,g}return ce!==b?g:H.wrap<=0?m:(H.wrap===2?(Be(H,D.adler&255),Be(H,D.adler>>8&255),Be(H,D.adler>>16&255),Be(H,D.adler>>24&255),Be(H,D.total_in&255),Be(H,D.total_in>>8&255),Be(H,D.total_in>>16&255),Be(H,D.total_in>>24&255)):(Ie(H,D.adler>>>16),Ie(H,D.adler&65535)),Ue(D),H.wrap>0&&(H.wrap=-H.wrap),H.pending!==0?g:m)}function De(D){var ce;return!D||!D.state?r:(ce=D.state.status,ce!==ee&&ce!==se&&ce!==ie&&ce!==le&&ce!==re&&ce!==oe&&ce!==Ae?Ce(D,r):(D.state=null,ce===oe?Ce(D,e):g))}function Re(D,ce){var de=ce.length,H,te,pe,ke,je,Ve,Qe,_t;if(!D||!D.state||(H=D.state,ke=H.wrap,ke===2||ke===1&&H.status!==ee||H.lookahead))return r;for(ke===1&&(D.adler=w(D.adler,ce,de,0)),H.wrap=0,de>=H.w_size&&(ke===0&&(We(H.head),H.strstart=0,H.block_start=0,H.insert=0),_t=new A.Buf8(H.w_size),A.arraySet(_t,ce,de-H.w_size,H.w_size,0),ce=_t,de=H.w_size),je=D.avail_in,Ve=D.next_in,Qe=D.input,D.avail_in=de,D.next_in=0,D.input=ce,Ge(H);H.lookahead>=U;){te=H.strstart,pe=H.lookahead-(U-1);do H.ins_h=(H.ins_h<<H.hash_shift^H.window[te+U-1])&H.hash_mask,H.prev[te&H.w_mask]=H.head[H.ins_h],H.head[H.ins_h]=te,te++;while(--pe);H.strstart=te,H.lookahead=U-1,Ge(H)}return H.strstart+=H.lookahead,H.block_start=H.strstart,H.insert=H.lookahead,H.lookahead=0,H.match_length=H.prev_length=U-1,H.match_available=0,D.next_in=Ve,D.input=Qe,D.avail_in=je,H.wrap=ke,g}C.deflateInit=ye,C.deflateInit2=ne,C.deflateReset=ve,C.deflateResetKeep=ae,C.deflateSetHeader=Le,C.deflate=j,C.deflateEnd=De,C.deflateSetDictionary=Re,C.deflateInfo="pako deflate (from Nodeca project)"},"./node_modules/upng-js/node_modules/pako/lib/zlib/gzheader.js":K=>{function C(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}K.exports=C},"./node_modules/upng-js/node_modules/pako/lib/zlib/inffast.js":K=>{var C=30,d=12;K.exports=function(S,w){var O,p,x,M,v,b,_,g,m,r,e,t,n,o,h,f,i,s,a,c,u,E,T,L,P;O=S.state,p=S.next_in,L=S.input,x=p+(S.avail_in-5),M=S.next_out,P=S.output,v=M-(w-S.avail_out),b=M+(S.avail_out-257),_=O.dmax,g=O.wsize,m=O.whave,r=O.wnext,e=O.window,t=O.hold,n=O.bits,o=O.lencode,h=O.distcode,f=(1<<O.lenbits)-1,i=(1<<O.distbits)-1;e:do{n<15&&(t+=L[p++]<<n,n+=8,t+=L[p++]<<n,n+=8),s=o[t&f];t:for(;;){if(a=s>>>24,t>>>=a,n-=a,a=s>>>16&255,a===0)P[M++]=s&65535;else if(a&16){c=s&65535,a&=15,a&&(n<a&&(t+=L[p++]<<n,n+=8),c+=t&(1<<a)-1,t>>>=a,n-=a),n<15&&(t+=L[p++]<<n,n+=8,t+=L[p++]<<n,n+=8),s=h[t&i];i:for(;;){if(a=s>>>24,t>>>=a,n-=a,a=s>>>16&255,a&16){if(u=s&65535,a&=15,n<a&&(t+=L[p++]<<n,n+=8,n<a&&(t+=L[p++]<<n,n+=8)),u+=t&(1<<a)-1,u>_){S.msg="invalid distance too far back",O.mode=C;break e}if(t>>>=a,n-=a,a=M-v,u>a){if(a=u-a,a>m&&O.sane){S.msg="invalid distance too far back",O.mode=C;break e}if(E=0,T=e,r===0){if(E+=g-a,a<c){c-=a;do P[M++]=e[E++];while(--a);E=M-u,T=P}}else if(r<a){if(E+=g+r-a,a-=r,a<c){c-=a;do P[M++]=e[E++];while(--a);if(E=0,r<c){a=r,c-=a;do P[M++]=e[E++];while(--a);E=M-u,T=P}}}else if(E+=r-a,a<c){c-=a;do P[M++]=e[E++];while(--a);E=M-u,T=P}for(;c>2;)P[M++]=T[E++],P[M++]=T[E++],P[M++]=T[E++],c-=3;c&&(P[M++]=T[E++],c>1&&(P[M++]=T[E++]))}else{E=M-u;do P[M++]=P[E++],P[M++]=P[E++],P[M++]=P[E++],c-=3;while(c>2);c&&(P[M++]=P[E++],c>1&&(P[M++]=P[E++]))}}else if((a&64)===0){s=h[(s&65535)+(t&(1<<a)-1)];continue i}else{S.msg="invalid distance code",O.mode=C;break e}break}}else if((a&64)===0){s=o[(s&65535)+(t&(1<<a)-1)];continue t}else if(a&32){O.mode=d;break e}else{S.msg="invalid literal/length code",O.mode=C;break e}break}}while(p<x&&M<b);c=n>>3,p-=c,n-=c<<3,t&=(1<<n)-1,S.next_in=p,S.next_out=M,S.avail_in=p<x?5+(x-p):5-(p-x),S.avail_out=M<b?257+(b-M):257-(M-b),O.hold=t,O.bits=n}},"./node_modules/upng-js/node_modules/pako/lib/zlib/inflate.js":(K,C,d)=>{var A=d("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),S=d("./node_modules/upng-js/node_modules/pako/lib/zlib/adler32.js"),w=d("./node_modules/upng-js/node_modules/pako/lib/zlib/crc32.js"),O=d("./node_modules/upng-js/node_modules/pako/lib/zlib/inffast.js"),p=d("./node_modules/upng-js/node_modules/pako/lib/zlib/inftrees.js"),x=0,M=1,v=2,b=4,_=5,g=6,m=0,r=1,e=2,t=-2,n=-3,o=-4,h=-5,f=8,i=1,s=2,a=3,c=4,u=5,E=6,T=7,L=8,P=9,I=10,z=11,B=12,F=13,W=14,U=15,R=16,V=17,q=18,ee=19,se=20,ie=21,le=22,re=23,oe=24,Ae=25,Me=26,Oe=27,_e=28,Q=29,me=30,Ce=31,Pe=32,We=852,Ue=592,ze=15,Be=ze;function Ie(ne){return(ne>>>24&255)+(ne>>>8&65280)+((ne&65280)<<8)+((ne&255)<<24)}function Se(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new A.Buf16(320),this.work=new A.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function Te(ne){var ye;return!ne||!ne.state?t:(ye=ne.state,ne.total_in=ne.total_out=ye.total=0,ne.msg="",ye.wrap&&(ne.adler=ye.wrap&1),ye.mode=i,ye.last=0,ye.havedict=0,ye.dmax=32768,ye.head=null,ye.hold=0,ye.bits=0,ye.lencode=ye.lendyn=new A.Buf32(We),ye.distcode=ye.distdyn=new A.Buf32(Ue),ye.sane=1,ye.back=-1,m)}function Ge(ne){var ye;return!ne||!ne.state?t:(ye=ne.state,ye.wsize=0,ye.whave=0,ye.wnext=0,Te(ne))}function Ne(ne,ye){var j,De;return!ne||!ne.state||(De=ne.state,ye<0?(j=0,ye=-ye):(j=(ye>>4)+1,ye<48&&(ye&=15)),ye&&(ye<8||ye>15))?t:(De.window!==null&&De.wbits!==ye&&(De.window=null),De.wrap=j,De.wbits=ye,Ge(ne))}function k(ne,ye){var j,De;return ne?(De=new Se,ne.state=De,De.window=null,j=Ne(ne,ye),j!==m&&(ne.state=null),j):t}function Z(ne){return k(ne,Be)}var Y=!0,ue,fe;function Ee(ne){if(Y){var ye;for(ue=new A.Buf32(512),fe=new A.Buf32(32),ye=0;ye<144;)ne.lens[ye++]=8;for(;ye<256;)ne.lens[ye++]=9;for(;ye<280;)ne.lens[ye++]=7;for(;ye<288;)ne.lens[ye++]=8;for(p(M,ne.lens,0,288,ue,0,ne.work,{bits:9}),ye=0;ye<32;)ne.lens[ye++]=5;p(v,ne.lens,0,32,fe,0,ne.work,{bits:5}),Y=!1}ne.lencode=ue,ne.lenbits=9,ne.distcode=fe,ne.distbits=5}function we(ne,ye,j,De){var Re,D=ne.state;return D.window===null&&(D.wsize=1<<D.wbits,D.wnext=0,D.whave=0,D.window=new A.Buf8(D.wsize)),De>=D.wsize?(A.arraySet(D.window,ye,j-D.wsize,D.wsize,0),D.wnext=0,D.whave=D.wsize):(Re=D.wsize-D.wnext,Re>De&&(Re=De),A.arraySet(D.window,ye,j-De,Re,D.wnext),De-=Re,De?(A.arraySet(D.window,ye,j-De,De,0),D.wnext=De,D.whave=D.wsize):(D.wnext+=Re,D.wnext===D.wsize&&(D.wnext=0),D.whave<D.wsize&&(D.whave+=Re))),0}function N(ne,ye){var j,De,Re,D,ce,de,H,te,pe,ke,je,Ve,Qe,_t,et=0,$e,Je,gt,ft,Ot,Dt,vt,mt,ct=new A.Buf8(4),At,yt,Bt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!ne||!ne.state||!ne.output||!ne.input&&ne.avail_in!==0)return t;j=ne.state,j.mode===B&&(j.mode=F),ce=ne.next_out,Re=ne.output,H=ne.avail_out,D=ne.next_in,De=ne.input,de=ne.avail_in,te=j.hold,pe=j.bits,ke=de,je=H,mt=m;e:for(;;)switch(j.mode){case i:if(j.wrap===0){j.mode=F;break}for(;pe<16;){if(de===0)break e;de--,te+=De[D++]<<pe,pe+=8}if(j.wrap&2&&te===35615){j.check=0,ct[0]=te&255,ct[1]=te>>>8&255,j.check=w(j.check,ct,2,0),te=0,pe=0,j.mode=s;break}if(j.flags=0,j.head&&(j.head.done=!1),!(j.wrap&1)||(((te&255)<<8)+(te>>8))%31){ne.msg="incorrect header check",j.mode=me;break}if((te&15)!==f){ne.msg="unknown compression method",j.mode=me;break}if(te>>>=4,pe-=4,vt=(te&15)+8,j.wbits===0)j.wbits=vt;else if(vt>j.wbits){ne.msg="invalid window size",j.mode=me;break}j.dmax=1<<vt,ne.adler=j.check=1,j.mode=te&512?I:B,te=0,pe=0;break;case s:for(;pe<16;){if(de===0)break e;de--,te+=De[D++]<<pe,pe+=8}if(j.flags=te,(j.flags&255)!==f){ne.msg="unknown compression method",j.mode=me;break}if(j.flags&57344){ne.msg="unknown header flags set",j.mode=me;break}j.head&&(j.head.text=te>>8&1),j.flags&512&&(ct[0]=te&255,ct[1]=te>>>8&255,j.check=w(j.check,ct,2,0)),te=0,pe=0,j.mode=a;case a:for(;pe<32;){if(de===0)break e;de--,te+=De[D++]<<pe,pe+=8}j.head&&(j.head.time=te),j.flags&512&&(ct[0]=te&255,ct[1]=te>>>8&255,ct[2]=te>>>16&255,ct[3]=te>>>24&255,j.check=w(j.check,ct,4,0)),te=0,pe=0,j.mode=c;case c:for(;pe<16;){if(de===0)break e;de--,te+=De[D++]<<pe,pe+=8}j.head&&(j.head.xflags=te&255,j.head.os=te>>8),j.flags&512&&(ct[0]=te&255,ct[1]=te>>>8&255,j.check=w(j.check,ct,2,0)),te=0,pe=0,j.mode=u;case u:if(j.flags&1024){for(;pe<16;){if(de===0)break e;de--,te+=De[D++]<<pe,pe+=8}j.length=te,j.head&&(j.head.extra_len=te),j.flags&512&&(ct[0]=te&255,ct[1]=te>>>8&255,j.check=w(j.check,ct,2,0)),te=0,pe=0}else j.head&&(j.head.extra=null);j.mode=E;case E:if(j.flags&1024&&(Ve=j.length,Ve>de&&(Ve=de),Ve&&(j.head&&(vt=j.head.extra_len-j.length,j.head.extra||(j.head.extra=new Array(j.head.extra_len)),A.arraySet(j.head.extra,De,D,Ve,vt)),j.flags&512&&(j.check=w(j.check,De,Ve,D)),de-=Ve,D+=Ve,j.length-=Ve),j.length))break e;j.length=0,j.mode=T;case T:if(j.flags&2048){if(de===0)break e;Ve=0;do vt=De[D+Ve++],j.head&&vt&&j.length<65536&&(j.head.name+=String.fromCharCode(vt));while(vt&&Ve<de);if(j.flags&512&&(j.check=w(j.check,De,Ve,D)),de-=Ve,D+=Ve,vt)break e}else j.head&&(j.head.name=null);j.length=0,j.mode=L;case L:if(j.flags&4096){if(de===0)break e;Ve=0;do vt=De[D+Ve++],j.head&&vt&&j.length<65536&&(j.head.comment+=String.fromCharCode(vt));while(vt&&Ve<de);if(j.flags&512&&(j.check=w(j.check,De,Ve,D)),de-=Ve,D+=Ve,vt)break e}else j.head&&(j.head.comment=null);j.mode=P;case P:if(j.flags&512){for(;pe<16;){if(de===0)break e;de--,te+=De[D++]<<pe,pe+=8}if(te!==(j.check&65535)){ne.msg="header crc mismatch",j.mode=me;break}te=0,pe=0}j.head&&(j.head.hcrc=j.flags>>9&1,j.head.done=!0),ne.adler=j.check=0,j.mode=B;break;case I:for(;pe<32;){if(de===0)break e;de--,te+=De[D++]<<pe,pe+=8}ne.adler=j.check=Ie(te),te=0,pe=0,j.mode=z;case z:if(j.havedict===0)return ne.next_out=ce,ne.avail_out=H,ne.next_in=D,ne.avail_in=de,j.hold=te,j.bits=pe,e;ne.adler=j.check=1,j.mode=B;case B:if(ye===_||ye===g)break e;case F:if(j.last){te>>>=pe&7,pe-=pe&7,j.mode=Oe;break}for(;pe<3;){if(de===0)break e;de--,te+=De[D++]<<pe,pe+=8}switch(j.last=te&1,te>>>=1,pe-=1,te&3){case 0:j.mode=W;break;case 1:if(Ee(j),j.mode=se,ye===g){te>>>=2,pe-=2;break e}break;case 2:j.mode=V;break;case 3:ne.msg="invalid block type",j.mode=me}te>>>=2,pe-=2;break;case W:for(te>>>=pe&7,pe-=pe&7;pe<32;){if(de===0)break e;de--,te+=De[D++]<<pe,pe+=8}if((te&65535)!==(te>>>16^65535)){ne.msg="invalid stored block lengths",j.mode=me;break}if(j.length=te&65535,te=0,pe=0,j.mode=U,ye===g)break e;case U:j.mode=R;case R:if(Ve=j.length,Ve){if(Ve>de&&(Ve=de),Ve>H&&(Ve=H),Ve===0)break e;A.arraySet(Re,De,D,Ve,ce),de-=Ve,D+=Ve,H-=Ve,ce+=Ve,j.length-=Ve;break}j.mode=B;break;case V:for(;pe<14;){if(de===0)break e;de--,te+=De[D++]<<pe,pe+=8}if(j.nlen=(te&31)+257,te>>>=5,pe-=5,j.ndist=(te&31)+1,te>>>=5,pe-=5,j.ncode=(te&15)+4,te>>>=4,pe-=4,j.nlen>286||j.ndist>30){ne.msg="too many length or distance symbols",j.mode=me;break}j.have=0,j.mode=q;case q:for(;j.have<j.ncode;){for(;pe<3;){if(de===0)break e;de--,te+=De[D++]<<pe,pe+=8}j.lens[Bt[j.have++]]=te&7,te>>>=3,pe-=3}for(;j.have<19;)j.lens[Bt[j.have++]]=0;if(j.lencode=j.lendyn,j.lenbits=7,At={bits:j.lenbits},mt=p(x,j.lens,0,19,j.lencode,0,j.work,At),j.lenbits=At.bits,mt){ne.msg="invalid code lengths set",j.mode=me;break}j.have=0,j.mode=ee;case ee:for(;j.have<j.nlen+j.ndist;){for(;et=j.lencode[te&(1<<j.lenbits)-1],$e=et>>>24,Je=et>>>16&255,gt=et&65535,!($e<=pe);){if(de===0)break e;de--,te+=De[D++]<<pe,pe+=8}if(gt<16)te>>>=$e,pe-=$e,j.lens[j.have++]=gt;else{if(gt===16){for(yt=$e+2;pe<yt;){if(de===0)break e;de--,te+=De[D++]<<pe,pe+=8}if(te>>>=$e,pe-=$e,j.have===0){ne.msg="invalid bit length repeat",j.mode=me;break}vt=j.lens[j.have-1],Ve=3+(te&3),te>>>=2,pe-=2}else if(gt===17){for(yt=$e+3;pe<yt;){if(de===0)break e;de--,te+=De[D++]<<pe,pe+=8}te>>>=$e,pe-=$e,vt=0,Ve=3+(te&7),te>>>=3,pe-=3}else{for(yt=$e+7;pe<yt;){if(de===0)break e;de--,te+=De[D++]<<pe,pe+=8}te>>>=$e,pe-=$e,vt=0,Ve=11+(te&127),te>>>=7,pe-=7}if(j.have+Ve>j.nlen+j.ndist){ne.msg="invalid bit length repeat",j.mode=me;break}for(;Ve--;)j.lens[j.have++]=vt}}if(j.mode===me)break;if(j.lens[256]===0){ne.msg="invalid code -- missing end-of-block",j.mode=me;break}if(j.lenbits=9,At={bits:j.lenbits},mt=p(M,j.lens,0,j.nlen,j.lencode,0,j.work,At),j.lenbits=At.bits,mt){ne.msg="invalid literal/lengths set",j.mode=me;break}if(j.distbits=6,j.distcode=j.distdyn,At={bits:j.distbits},mt=p(v,j.lens,j.nlen,j.ndist,j.distcode,0,j.work,At),j.distbits=At.bits,mt){ne.msg="invalid distances set",j.mode=me;break}if(j.mode=se,ye===g)break e;case se:j.mode=ie;case ie:if(de>=6&&H>=258){ne.next_out=ce,ne.avail_out=H,ne.next_in=D,ne.avail_in=de,j.hold=te,j.bits=pe,O(ne,je),ce=ne.next_out,Re=ne.output,H=ne.avail_out,D=ne.next_in,De=ne.input,de=ne.avail_in,te=j.hold,pe=j.bits,j.mode===B&&(j.back=-1);break}for(j.back=0;et=j.lencode[te&(1<<j.lenbits)-1],$e=et>>>24,Je=et>>>16&255,gt=et&65535,!($e<=pe);){if(de===0)break e;de--,te+=De[D++]<<pe,pe+=8}if(Je&&(Je&240)===0){for(ft=$e,Ot=Je,Dt=gt;et=j.lencode[Dt+((te&(1<<ft+Ot)-1)>>ft)],$e=et>>>24,Je=et>>>16&255,gt=et&65535,!(ft+$e<=pe);){if(de===0)break e;de--,te+=De[D++]<<pe,pe+=8}te>>>=ft,pe-=ft,j.back+=ft}if(te>>>=$e,pe-=$e,j.back+=$e,j.length=gt,Je===0){j.mode=Me;break}if(Je&32){j.back=-1,j.mode=B;break}if(Je&64){ne.msg="invalid literal/length code",j.mode=me;break}j.extra=Je&15,j.mode=le;case le:if(j.extra){for(yt=j.extra;pe<yt;){if(de===0)break e;de--,te+=De[D++]<<pe,pe+=8}j.length+=te&(1<<j.extra)-1,te>>>=j.extra,pe-=j.extra,j.back+=j.extra}j.was=j.length,j.mode=re;case re:for(;et=j.distcode[te&(1<<j.distbits)-1],$e=et>>>24,Je=et>>>16&255,gt=et&65535,!($e<=pe);){if(de===0)break e;de--,te+=De[D++]<<pe,pe+=8}if((Je&240)===0){for(ft=$e,Ot=Je,Dt=gt;et=j.distcode[Dt+((te&(1<<ft+Ot)-1)>>ft)],$e=et>>>24,Je=et>>>16&255,gt=et&65535,!(ft+$e<=pe);){if(de===0)break e;de--,te+=De[D++]<<pe,pe+=8}te>>>=ft,pe-=ft,j.back+=ft}if(te>>>=$e,pe-=$e,j.back+=$e,Je&64){ne.msg="invalid distance code",j.mode=me;break}j.offset=gt,j.extra=Je&15,j.mode=oe;case oe:if(j.extra){for(yt=j.extra;pe<yt;){if(de===0)break e;de--,te+=De[D++]<<pe,pe+=8}j.offset+=te&(1<<j.extra)-1,te>>>=j.extra,pe-=j.extra,j.back+=j.extra}if(j.offset>j.dmax){ne.msg="invalid distance too far back",j.mode=me;break}j.mode=Ae;case Ae:if(H===0)break e;if(Ve=je-H,j.offset>Ve){if(Ve=j.offset-Ve,Ve>j.whave&&j.sane){ne.msg="invalid distance too far back",j.mode=me;break}Ve>j.wnext?(Ve-=j.wnext,Qe=j.wsize-Ve):Qe=j.wnext-Ve,Ve>j.length&&(Ve=j.length),_t=j.window}else _t=Re,Qe=ce-j.offset,Ve=j.length;Ve>H&&(Ve=H),H-=Ve,j.length-=Ve;do Re[ce++]=_t[Qe++];while(--Ve);j.length===0&&(j.mode=ie);break;case Me:if(H===0)break e;Re[ce++]=j.length,H--,j.mode=ie;break;case Oe:if(j.wrap){for(;pe<32;){if(de===0)break e;de--,te|=De[D++]<<pe,pe+=8}if(je-=H,ne.total_out+=je,j.total+=je,je&&(ne.adler=j.check=j.flags?w(j.check,Re,je,ce-je):S(j.check,Re,je,ce-je)),je=H,(j.flags?te:Ie(te))!==j.check){ne.msg="incorrect data check",j.mode=me;break}te=0,pe=0}j.mode=_e;case _e:if(j.wrap&&j.flags){for(;pe<32;){if(de===0)break e;de--,te+=De[D++]<<pe,pe+=8}if(te!==(j.total&4294967295)){ne.msg="incorrect length check",j.mode=me;break}te=0,pe=0}j.mode=Q;case Q:mt=r;break e;case me:mt=n;break e;case Ce:return o;case Pe:default:return t}return ne.next_out=ce,ne.avail_out=H,ne.next_in=D,ne.avail_in=de,j.hold=te,j.bits=pe,(j.wsize||je!==ne.avail_out&&j.mode<me&&(j.mode<Oe||ye!==b))&&we(ne,ne.output,ne.next_out,je-ne.avail_out),ke-=ne.avail_in,je-=ne.avail_out,ne.total_in+=ke,ne.total_out+=je,j.total+=je,j.wrap&&je&&(ne.adler=j.check=j.flags?w(j.check,Re,je,ne.next_out-je):S(j.check,Re,je,ne.next_out-je)),ne.data_type=j.bits+(j.last?64:0)+(j.mode===B?128:0)+(j.mode===se||j.mode===U?256:0),(ke===0&&je===0||ye===b)&&mt===m&&(mt=h),mt}function ae(ne){if(!ne||!ne.state)return t;var ye=ne.state;return ye.window&&(ye.window=null),ne.state=null,m}function ve(ne,ye){var j;return!ne||!ne.state||(j=ne.state,(j.wrap&2)===0)?t:(j.head=ye,ye.done=!1,m)}function Le(ne,ye){var j=ye.length,De,Re,D;return!ne||!ne.state||(De=ne.state,De.wrap!==0&&De.mode!==z)?t:De.mode===z&&(Re=1,Re=S(Re,ye,j,0),Re!==De.check)?n:(D=we(ne,ye,j,j),D?(De.mode=Ce,o):(De.havedict=1,m))}C.inflateReset=Ge,C.inflateReset2=Ne,C.inflateResetKeep=Te,C.inflateInit=Z,C.inflateInit2=k,C.inflate=N,C.inflateEnd=ae,C.inflateGetHeader=ve,C.inflateSetDictionary=Le,C.inflateInfo="pako inflate (from Nodeca project)"},"./node_modules/upng-js/node_modules/pako/lib/zlib/inftrees.js":(K,C,d)=>{var A=d("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),S=15,w=852,O=592,p=0,x=1,M=2,v=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],b=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],_=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],g=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];K.exports=function(r,e,t,n,o,h,f,i){var s=i.bits,a=0,c=0,u=0,E=0,T=0,L=0,P=0,I=0,z=0,B=0,F,W,U,R,V,q=null,ee=0,se,ie=new A.Buf16(S+1),le=new A.Buf16(S+1),re=null,oe=0,Ae,Me,Oe;for(a=0;a<=S;a++)ie[a]=0;for(c=0;c<n;c++)ie[e[t+c]]++;for(T=s,E=S;E>=1&&ie[E]===0;E--);if(T>E&&(T=E),E===0)return o[h++]=20971520,o[h++]=20971520,i.bits=1,0;for(u=1;u<E&&ie[u]===0;u++);for(T<u&&(T=u),I=1,a=1;a<=S;a++)if(I<<=1,I-=ie[a],I<0)return-1;if(I>0&&(r===p||E!==1))return-1;for(le[1]=0,a=1;a<S;a++)le[a+1]=le[a]+ie[a];for(c=0;c<n;c++)e[t+c]!==0&&(f[le[e[t+c]]++]=c);if(r===p?(q=re=f,se=19):r===x?(q=v,ee-=257,re=b,oe-=257,se=256):(q=_,re=g,se=-1),B=0,c=0,a=u,V=h,L=T,P=0,U=-1,z=1<<T,R=z-1,r===x&&z>w||r===M&&z>O)return 1;for(;;){Ae=a-P,f[c]<se?(Me=0,Oe=f[c]):f[c]>se?(Me=re[oe+f[c]],Oe=q[ee+f[c]]):(Me=96,Oe=0),F=1<<a-P,W=1<<L,u=W;do W-=F,o[V+(B>>P)+W]=Ae<<24|Me<<16|Oe|0;while(W!==0);for(F=1<<a-1;B&F;)F>>=1;if(F!==0?(B&=F-1,B+=F):B=0,c++,--ie[a]===0){if(a===E)break;a=e[t+f[c]]}if(a>T&&(B&R)!==U){for(P===0&&(P=T),V+=u,L=a-P,I=1<<L;L+P<E&&(I-=ie[L+P],!(I<=0));)L++,I<<=1;if(z+=1<<L,r===x&&z>w||r===M&&z>O)return 1;U=B&R,o[U]=T<<24|L<<16|V-h|0}}return B!==0&&(o[V+B]=a-P<<24|4194304|0),i.bits=T,0}},"./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js":K=>{K.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},"./node_modules/upng-js/node_modules/pako/lib/zlib/trees.js":(K,C,d)=>{var A=d("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),S=4,w=0,O=1,p=2;function x(N){for(var ae=N.length;--ae>=0;)N[ae]=0}var M=0,v=1,b=2,_=3,g=258,m=29,r=256,e=r+1+m,t=30,n=19,o=2*e+1,h=15,f=16,i=7,s=256,a=16,c=17,u=18,E=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],T=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],L=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],P=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],I=512,z=new Array((e+2)*2);x(z);var B=new Array(t*2);x(B);var F=new Array(I);x(F);var W=new Array(g-_+1);x(W);var U=new Array(m);x(U);var R=new Array(t);x(R);function V(N,ae,ve,Le,ne){this.static_tree=N,this.extra_bits=ae,this.extra_base=ve,this.elems=Le,this.max_length=ne,this.has_stree=N&&N.length}var q,ee,se;function ie(N,ae){this.dyn_tree=N,this.max_code=0,this.stat_desc=ae}function le(N){return N<256?F[N]:F[256+(N>>>7)]}function re(N,ae){N.pending_buf[N.pending++]=ae&255,N.pending_buf[N.pending++]=ae>>>8&255}function oe(N,ae,ve){N.bi_valid>f-ve?(N.bi_buf|=ae<<N.bi_valid&65535,re(N,N.bi_buf),N.bi_buf=ae>>f-N.bi_valid,N.bi_valid+=ve-f):(N.bi_buf|=ae<<N.bi_valid&65535,N.bi_valid+=ve)}function Ae(N,ae,ve){oe(N,ve[ae*2],ve[ae*2+1])}function Me(N,ae){var ve=0;do ve|=N&1,N>>>=1,ve<<=1;while(--ae>0);return ve>>>1}function Oe(N){N.bi_valid===16?(re(N,N.bi_buf),N.bi_buf=0,N.bi_valid=0):N.bi_valid>=8&&(N.pending_buf[N.pending++]=N.bi_buf&255,N.bi_buf>>=8,N.bi_valid-=8)}function _e(N,ae){var ve=ae.dyn_tree,Le=ae.max_code,ne=ae.stat_desc.static_tree,ye=ae.stat_desc.has_stree,j=ae.stat_desc.extra_bits,De=ae.stat_desc.extra_base,Re=ae.stat_desc.max_length,D,ce,de,H,te,pe,ke=0;for(H=0;H<=h;H++)N.bl_count[H]=0;for(ve[N.heap[N.heap_max]*2+1]=0,D=N.heap_max+1;D<o;D++)ce=N.heap[D],H=ve[ve[ce*2+1]*2+1]+1,H>Re&&(H=Re,ke++),ve[ce*2+1]=H,!(ce>Le)&&(N.bl_count[H]++,te=0,ce>=De&&(te=j[ce-De]),pe=ve[ce*2],N.opt_len+=pe*(H+te),ye&&(N.static_len+=pe*(ne[ce*2+1]+te)));if(ke!==0){do{for(H=Re-1;N.bl_count[H]===0;)H--;N.bl_count[H]--,N.bl_count[H+1]+=2,N.bl_count[Re]--,ke-=2}while(ke>0);for(H=Re;H!==0;H--)for(ce=N.bl_count[H];ce!==0;)de=N.heap[--D],!(de>Le)&&(ve[de*2+1]!==H&&(N.opt_len+=(H-ve[de*2+1])*ve[de*2],ve[de*2+1]=H),ce--)}}function Q(N,ae,ve){var Le=new Array(h+1),ne=0,ye,j;for(ye=1;ye<=h;ye++)Le[ye]=ne=ne+ve[ye-1]<<1;for(j=0;j<=ae;j++){var De=N[j*2+1];De!==0&&(N[j*2]=Me(Le[De]++,De))}}function me(){var N,ae,ve,Le,ne,ye=new Array(h+1);for(ve=0,Le=0;Le<m-1;Le++)for(U[Le]=ve,N=0;N<1<<E[Le];N++)W[ve++]=Le;for(W[ve-1]=Le,ne=0,Le=0;Le<16;Le++)for(R[Le]=ne,N=0;N<1<<T[Le];N++)F[ne++]=Le;for(ne>>=7;Le<t;Le++)for(R[Le]=ne<<7,N=0;N<1<<T[Le]-7;N++)F[256+ne++]=Le;for(ae=0;ae<=h;ae++)ye[ae]=0;for(N=0;N<=143;)z[N*2+1]=8,N++,ye[8]++;for(;N<=255;)z[N*2+1]=9,N++,ye[9]++;for(;N<=279;)z[N*2+1]=7,N++,ye[7]++;for(;N<=287;)z[N*2+1]=8,N++,ye[8]++;for(Q(z,e+1,ye),N=0;N<t;N++)B[N*2+1]=5,B[N*2]=Me(N,5);q=new V(z,E,r+1,e,h),ee=new V(B,T,0,t,h),se=new V(new Array(0),L,0,n,i)}function Ce(N){var ae;for(ae=0;ae<e;ae++)N.dyn_ltree[ae*2]=0;for(ae=0;ae<t;ae++)N.dyn_dtree[ae*2]=0;for(ae=0;ae<n;ae++)N.bl_tree[ae*2]=0;N.dyn_ltree[s*2]=1,N.opt_len=N.static_len=0,N.last_lit=N.matches=0}function Pe(N){N.bi_valid>8?re(N,N.bi_buf):N.bi_valid>0&&(N.pending_buf[N.pending++]=N.bi_buf),N.bi_buf=0,N.bi_valid=0}function We(N,ae,ve,Le){Pe(N),re(N,ve),re(N,~ve),A.arraySet(N.pending_buf,N.window,ae,ve,N.pending),N.pending+=ve}function Ue(N,ae,ve,Le){var ne=ae*2,ye=ve*2;return N[ne]<N[ye]||N[ne]===N[ye]&&Le[ae]<=Le[ve]}function ze(N,ae,ve){for(var Le=N.heap[ve],ne=ve<<1;ne<=N.heap_len&&(ne<N.heap_len&&Ue(ae,N.heap[ne+1],N.heap[ne],N.depth)&&ne++,!Ue(ae,Le,N.heap[ne],N.depth));)N.heap[ve]=N.heap[ne],ve=ne,ne<<=1;N.heap[ve]=Le}function Be(N,ae,ve){var Le,ne,ye=0,j,De;if(N.last_lit!==0)do Le=N.pending_buf[N.d_buf+ye*2]<<8|N.pending_buf[N.d_buf+ye*2+1],ne=N.pending_buf[N.l_buf+ye],ye++,Le===0?Ae(N,ne,ae):(j=W[ne],Ae(N,j+r+1,ae),De=E[j],De!==0&&(ne-=U[j],oe(N,ne,De)),Le--,j=le(Le),Ae(N,j,ve),De=T[j],De!==0&&(Le-=R[j],oe(N,Le,De)));while(ye<N.last_lit);Ae(N,s,ae)}function Ie(N,ae){var ve=ae.dyn_tree,Le=ae.stat_desc.static_tree,ne=ae.stat_desc.has_stree,ye=ae.stat_desc.elems,j,De,Re=-1,D;for(N.heap_len=0,N.heap_max=o,j=0;j<ye;j++)ve[j*2]!==0?(N.heap[++N.heap_len]=Re=j,N.depth[j]=0):ve[j*2+1]=0;for(;N.heap_len<2;)D=N.heap[++N.heap_len]=Re<2?++Re:0,ve[D*2]=1,N.depth[D]=0,N.opt_len--,ne&&(N.static_len-=Le[D*2+1]);for(ae.max_code=Re,j=N.heap_len>>1;j>=1;j--)ze(N,ve,j);D=ye;do j=N.heap[1],N.heap[1]=N.heap[N.heap_len--],ze(N,ve,1),De=N.heap[1],N.heap[--N.heap_max]=j,N.heap[--N.heap_max]=De,ve[D*2]=ve[j*2]+ve[De*2],N.depth[D]=(N.depth[j]>=N.depth[De]?N.depth[j]:N.depth[De])+1,ve[j*2+1]=ve[De*2+1]=D,N.heap[1]=D++,ze(N,ve,1);while(N.heap_len>=2);N.heap[--N.heap_max]=N.heap[1],_e(N,ae),Q(ve,Re,N.bl_count)}function Se(N,ae,ve){var Le,ne=-1,ye,j=ae[1],De=0,Re=7,D=4;for(j===0&&(Re=138,D=3),ae[(ve+1)*2+1]=65535,Le=0;Le<=ve;Le++)ye=j,j=ae[(Le+1)*2+1],!(++De<Re&&ye===j)&&(De<D?N.bl_tree[ye*2]+=De:ye!==0?(ye!==ne&&N.bl_tree[ye*2]++,N.bl_tree[a*2]++):De<=10?N.bl_tree[c*2]++:N.bl_tree[u*2]++,De=0,ne=ye,j===0?(Re=138,D=3):ye===j?(Re=6,D=3):(Re=7,D=4))}function Te(N,ae,ve){var Le,ne=-1,ye,j=ae[1],De=0,Re=7,D=4;for(j===0&&(Re=138,D=3),Le=0;Le<=ve;Le++)if(ye=j,j=ae[(Le+1)*2+1],!(++De<Re&&ye===j)){if(De<D)do Ae(N,ye,N.bl_tree);while(--De!==0);else ye!==0?(ye!==ne&&(Ae(N,ye,N.bl_tree),De--),Ae(N,a,N.bl_tree),oe(N,De-3,2)):De<=10?(Ae(N,c,N.bl_tree),oe(N,De-3,3)):(Ae(N,u,N.bl_tree),oe(N,De-11,7));De=0,ne=ye,j===0?(Re=138,D=3):ye===j?(Re=6,D=3):(Re=7,D=4)}}function Ge(N){var ae;for(Se(N,N.dyn_ltree,N.l_desc.max_code),Se(N,N.dyn_dtree,N.d_desc.max_code),Ie(N,N.bl_desc),ae=n-1;ae>=3&&N.bl_tree[P[ae]*2+1]===0;ae--);return N.opt_len+=3*(ae+1)+5+5+4,ae}function Ne(N,ae,ve,Le){var ne;for(oe(N,ae-257,5),oe(N,ve-1,5),oe(N,Le-4,4),ne=0;ne<Le;ne++)oe(N,N.bl_tree[P[ne]*2+1],3);Te(N,N.dyn_ltree,ae-1),Te(N,N.dyn_dtree,ve-1)}function k(N){var ae=4093624447,ve;for(ve=0;ve<=31;ve++,ae>>>=1)if(ae&1&&N.dyn_ltree[ve*2]!==0)return w;if(N.dyn_ltree[18]!==0||N.dyn_ltree[20]!==0||N.dyn_ltree[26]!==0)return O;for(ve=32;ve<r;ve++)if(N.dyn_ltree[ve*2]!==0)return O;return w}var Z=!1;function Y(N){Z||(me(),Z=!0),N.l_desc=new ie(N.dyn_ltree,q),N.d_desc=new ie(N.dyn_dtree,ee),N.bl_desc=new ie(N.bl_tree,se),N.bi_buf=0,N.bi_valid=0,Ce(N)}function ue(N,ae,ve,Le){oe(N,(M<<1)+(Le?1:0),3),We(N,ae,ve)}function fe(N){oe(N,v<<1,3),Ae(N,s,z),Oe(N)}function Ee(N,ae,ve,Le){var ne,ye,j=0;N.level>0?(N.strm.data_type===p&&(N.strm.data_type=k(N)),Ie(N,N.l_desc),Ie(N,N.d_desc),j=Ge(N),ne=N.opt_len+3+7>>>3,ye=N.static_len+3+7>>>3,ye<=ne&&(ne=ye)):ne=ye=ve+5,ve+4<=ne&&ae!==-1?ue(N,ae,ve,Le):N.strategy===S||ye===ne?(oe(N,(v<<1)+(Le?1:0),3),Be(N,z,B)):(oe(N,(b<<1)+(Le?1:0),3),Ne(N,N.l_desc.max_code+1,N.d_desc.max_code+1,j+1),Be(N,N.dyn_ltree,N.dyn_dtree)),Ce(N),Le&&Pe(N)}function we(N,ae,ve){return N.pending_buf[N.d_buf+N.last_lit*2]=ae>>>8&255,N.pending_buf[N.d_buf+N.last_lit*2+1]=ae&255,N.pending_buf[N.l_buf+N.last_lit]=ve&255,N.last_lit++,ae===0?N.dyn_ltree[ve*2]++:(N.matches++,ae--,N.dyn_ltree[(W[ve]+r+1)*2]++,N.dyn_dtree[le(ae)*2]++),N.last_lit===N.lit_bufsize-1}C._tr_init=Y,C._tr_stored_block=ue,C._tr_flush_block=Ee,C._tr_tally=we,C._tr_align=fe},"./node_modules/upng-js/node_modules/pako/lib/zlib/zstream.js":K=>{function C(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}K.exports=C},"./src/3Dmol.ts":(K,C,d)=>{d.r(C),d.d(C,{CAP:()=>O.CAP,CC:()=>S.CC,CONTEXTS_PER_VIEWPORT:()=>M.CONTEXTS_PER_VIEWPORT,Color:()=>S.Color,CustomLinear:()=>v.CustomLinear,Cylinder:()=>o.Cylinder,GLDraw:()=>O.GLDraw,GLModel:()=>p.GLModel,GLShape:()=>x.GLShape,GLViewer:()=>M.GLViewer,GLVolumetricRender:()=>t.GLVolumetricRender,Gradient:()=>v.Gradient,GradientType:()=>v.GradientType,Label:()=>b.Label,LabelCount:()=>b.LabelCount,MarchingCube:()=>m.MarchingCube,MarchingCubeInitializer:()=>m.MarchingCubeInitializer,Matrix3:()=>n.Matrix3,Matrix4:()=>n.Matrix4,Parsers:()=>_.Parsers,PausableTimer:()=>r.PausableTimer,PointGrid:()=>m.PointGrid,ProteinSurface:()=>m.ProteinSurface,Quaternion:()=>n.Quaternion,ROYGB:()=>v.ROYGB,RWB:()=>v.RWB,Ray:()=>n.Ray,Sinebow:()=>v.Sinebow,Sphere:()=>o.Sphere,SurfaceType:()=>m.SurfaceType,Triangle:()=>o.Triangle,Vector2:()=>n.Vector2,Vector3:()=>n.Vector3,VolumeData:()=>e.VolumeData,adjustVolumeStyle:()=>r.adjustVolumeStyle,applyPartialCharges:()=>g.applyPartialCharges,autoinit:()=>A.autoinit,autoload:()=>A.autoload,base64ToArray:()=>r.base64ToArray,bondLength:()=>_.bondLength,builtinColorSchemes:()=>S.builtinColorSchemes,builtinGradients:()=>v.builtinGradients,chains:()=>S.chains,clamp:()=>n.clamp,conversionMatrix3:()=>n.conversionMatrix3,createStereoViewer:()=>M.createStereoViewer,createViewer:()=>M.createViewer,createViewerGrid:()=>M.createViewerGrid,deepCopy:()=>r.deepCopy,degToRad:()=>n.degToRad,download:()=>r.download,drawCartoon:()=>w.drawCartoon,elementColors:()=>S.elementColors,extend:()=>r.extend,get:()=>r.get,getAtomProperty:()=>r.getAtomProperty,getColorFromStyle:()=>r.getColorFromStyle,getElement:()=>r.getElement,getExtent:()=>r.getExtent,getGradient:()=>v.getGradient,getPropertyRange:()=>r.getPropertyRange,getbin:()=>r.getbin,htmlColors:()=>S.htmlColors,inflateString:()=>r.inflateString,isEmptyObject:()=>r.isEmptyObject,isNumeric:()=>r.isNumeric,makeFunction:()=>r.makeFunction,mergeGeos:()=>r.mergeGeos,normalizeValue:()=>v.normalizeValue,partialCharges:()=>g.partialCharges,processing_autoinit:()=>A.processing_autoinit,residues:()=>S.residues,setBondLength:()=>_.setBondLength,setSyncSurface:()=>m.setSyncSurface,specStringToObject:()=>r.specStringToObject,splitMesh:()=>x.splitMesh,ssColors:()=>S.ssColors,subdivide_spline:()=>w.subdivide_spline,syncSurface:()=>m.syncSurface,viewers:()=>A.viewers});var A=d("./src/autoload.ts"),S=d("./src/colors.ts"),w=d("./src/glcartoon.ts"),O=d("./src/GLDraw.ts"),p=d("./src/GLModel.ts"),x=d("./src/GLShape.ts"),M=d("./src/GLViewer.ts"),v=d("./src/Gradient.ts"),b=d("./src/Label.ts"),_=d("./src/parsers/index.ts"),g=d("./src/partialCharges.ts"),m=d("./src/ProteinSurface4.ts");d("./src/specs.ts");var r=d("./src/utilities.ts"),e=d("./src/VolumeData.ts"),t=d("./src/VolumetricRender.ts"),n=d("./src/WebGL/math/index.ts"),o=d("./src/WebGL/shapes/index.ts")},"./src/GLDraw.ts":(K,C,d)=>{d.r(C),d.d(C,{CAP:()=>S,GLDraw:()=>w});var A=d("./src/WebGL/math/index.ts"),S;(function(O){O[O.NONE=0]="NONE",O[O.FLAT=1]="FLAT",O[O.ROUND=2]="ROUND"})(S||(S={}));var w;(function(O){function p(r,e,t){var n=Math.hypot(r,e),o,h,f,i,s;n<1e-4?(h=0,f=1):(h=-r/n,f=e/n),e=-h*r+f*e,o=Math.hypot(e,t),o<1e-4?(i=0,s=1):(i=t/o,s=e/o);var a=new Float32Array(9);return a[0]=f,a[1]=h,a[2]=0,a[3]=-h*s,a[4]=f*s,a[5]=i,a[6]=h*i,a[7]=-f*i,a[8]=s,a}class x{constructor(){this.cache={};let e=[],t=4,n=Math.pow(2,t),o=2,h=Math.pow(2,o),f=n/h,i;for(e[0]=new A.Vector3(-1,0,0),e[f]=new A.Vector3(0,0,1),e[f*2]=new A.Vector3(1,0,0),e[f*3]=new A.Vector3(0,0,-1),o=3;o<=t;o++){for(h=Math.pow(2,o-1),f=n/h,i=0;i<h-1;i++)e[f/2+i*f]=e[i*f].clone().add(e[(i+1)*f]).normalize();i=h-1,e[f/2+i*f]=e[i*f].clone().add(e[0]).normalize()}this.basisVectors=e}getVerticesForRadius(e,t,n){if(typeof this.cache<"u"&&this.cache[e]!==void 0&&this.cache[e][t+n]!==void 0)return this.cache[e][t+n];for(var o=this.basisVectors.length,h=[],f=[],i,s=0;s<o;s++)h.push(this.basisVectors[s].clone().multiplyScalar(e)),h.push(this.basisVectors[s].clone().multiplyScalar(e)),i=this.basisVectors[s].clone().normalize(),f.push(i),f.push(i);var a=[],c=10,u=o,E=0,T=Math.PI*2,L=0,P=Math.PI,I,z,B=!1,F=!1;for(z=0;z<=c;z++){B=z===0||z===c,F=z===c/2;var W=[],U=[];for(I=0;I<=u;I++){if(F){var R=I<u?2*I:0;U.push(R+1),W.push(R);continue}var V=I/u,q=z/c;if(!B||I===0)if(I<u){var ee=new A.Vector3;ee.x=-e*Math.cos(E+V*T)*Math.sin(L+q*P),t==1?ee.y=0:ee.y=e*Math.cos(L+q*P),ee.z=e*Math.sin(E+V*T)*Math.sin(L+q*P),Math.abs(ee.x)<1e-5&&(ee.x=0),Math.abs(ee.y)<1e-5&&(ee.y=0),Math.abs(ee.z)<1e-5&&(ee.z=0),t==S.FLAT?(i=new A.Vector3(0,Math.cos(L+q*P),0),i.normalize()):(i=new A.Vector3(ee.x,ee.y,ee.z),i.normalize()),h.push(ee),f.push(i),W.push(h.length-1)}else W.push(h.length-u);else B&&W.push(h.length-1)}F&&a.push(U),a.push(W)}var se={vertices:h,normals:f,verticesRows:a,w:u,h:c};return e in this.cache||(this.cache[e]={}),this.cache[e][t+n]=se,se}}var M=new x;function v(r,e,t,n,o,h=0,f=0){if(!e||!t)return;let i=function(pe){if(typeof pe=="string"){let ke=pe;return ke.toLowerCase()=="flat"?S.FLAT:ke.toLowerCase()=="round"?S.ROUND:S.NONE}else return pe};h=i(h),f=i(f);var s=f||h;o=o||{r:0,g:0,b:0};var a=p(t.x-e.x,t.y-e.y,t.z-e.z),c=M.getVerticesForRadius(n,f,"to"),u=c.w,E=c.h,T=s?E*u+2:2*u,L=r.updateGeoGroup(T),P=c.vertices,I=c.normals,z=c.verticesRows,B=z[E/2],F=z[E/2+1],W=L.vertices,U,R,V,q,ee,se,ie=L.vertexArray,le=L.normalArray,re=L.colorArray,oe=L.faceArray;for(V=0;V<u;++V){var Ae=2*V;q=a[0]*P[Ae].x+a[3]*P[Ae].y+a[6]*P[Ae].z,ee=a[1]*P[Ae].x+a[4]*P[Ae].y+a[7]*P[Ae].z,se=a[5]*P[Ae].y+a[8]*P[Ae].z,U=3*(W+Ae),R=L.faceidx,ie[U]=q+e.x,ie[U+1]=ee+e.y,ie[U+2]=se+e.z,ie[U+3]=q+t.x,ie[U+4]=ee+t.y,ie[U+5]=se+t.z,le[U]=q,le[U+3]=q,le[U+1]=ee,le[U+4]=ee,le[U+2]=se,le[U+5]=se,re[U]=o.r,re[U+3]=o.r,re[U+1]=o.g,re[U+4]=o.g,re[U+2]=o.b,re[U+5]=o.b,oe[R]=F[V]+W,oe[R+1]=F[V+1]+W,oe[R+2]=B[V]+W,oe[R+3]=B[V]+W,oe[R+4]=F[V+1]+W,oe[R+5]=B[V+1]+W,L.faceidx+=6}if(s){var Me=f?0:E/2,Oe=h?E+1:E/2+1,_e,Q,me,Ce,Pe,We,Ue,ze,Be,Ie,Se,Te,Ge,Ne,k,Z,Y,ue,fe,Ee,we,N,ae,ve,Le,ne,ye,j,De,Re,D,ce;for(ee=Me;ee<Oe;ee++)if(ee!==E/2){var de=ee<=E/2?t:e,H=M.getVerticesForRadius(n,f,"to"),te=M.getVerticesForRadius(n,h,"from");for(de===t?(P=H.vertices,I=H.normals,z=H.verticesRows):de==e&&(P=te.vertices,I=te.normals,z=te.verticesRows),q=0;q<u;q++)R=L.faceidx,_e=z[ee][q+1],De=(_e+W)*3,Q=z[ee][q],Re=(Q+W)*3,me=z[ee+1][q],D=(me+W)*3,Ce=z[ee+1][q+1],ce=(Ce+W)*3,Pe=a[0]*P[_e].x+a[3]*P[_e].y+a[6]*P[_e].z,We=a[0]*P[Q].x+a[3]*P[Q].y+a[6]*P[Q].z,Ue=a[0]*P[me].x+a[3]*P[me].y+a[6]*P[me].z,ze=a[0]*P[Ce].x+a[3]*P[Ce].y+a[6]*P[Ce].z,Be=a[1]*P[_e].x+a[4]*P[_e].y+a[7]*P[_e].z,Ie=a[1]*P[Q].x+a[4]*P[Q].y+a[7]*P[Q].z,Se=a[1]*P[me].x+a[4]*P[me].y+a[7]*P[me].z,Te=a[1]*P[Ce].x+a[4]*P[Ce].y+a[7]*P[Ce].z,Ge=a[5]*P[_e].y+a[8]*P[_e].z,Ne=a[5]*P[Q].y+a[8]*P[Q].z,k=a[5]*P[me].y+a[8]*P[me].z,Z=a[5]*P[Ce].y+a[8]*P[Ce].z,ie[De]=Pe+de.x,ie[Re]=We+de.x,ie[D]=Ue+de.x,ie[ce]=ze+de.x,ie[De+1]=Be+de.y,ie[Re+1]=Ie+de.y,ie[D+1]=Se+de.y,ie[ce+1]=Te+de.y,ie[De+2]=Ge+de.z,ie[Re+2]=Ne+de.z,ie[D+2]=k+de.z,ie[ce+2]=Z+de.z,re[De]=o.r,re[Re]=o.r,re[D]=o.r,re[ce]=o.r,re[De+1]=o.g,re[Re+1]=o.g,re[D+1]=o.g,re[ce+1]=o.g,re[De+2]=o.b,re[Re+2]=o.b,re[D+2]=o.b,re[ce+2]=o.b,Y=a[0]*I[_e].x+a[3]*I[_e].y+a[6]*I[_e].z,ue=a[0]*I[Q].x+a[3]*I[Q].y+a[6]*I[Q].z,fe=a[0]*I[me].x+a[3]*I[me].y+a[6]*I[me].z,Ee=a[0]*I[Ce].x+a[3]*I[Ce].y+a[6]*I[Ce].z,we=a[1]*I[_e].x+a[4]*I[_e].y+a[7]*I[_e].z,N=a[1]*I[Q].x+a[4]*I[Q].y+a[7]*I[Q].z,ae=a[1]*I[me].x+a[4]*I[me].y+a[7]*I[me].z,ve=a[1]*I[Ce].x+a[4]*I[Ce].y+a[7]*I[Ce].z,Le=a[5]*I[_e].y+a[8]*I[_e].z,ne=a[5]*I[Q].y+a[8]*I[Q].z,ye=a[5]*I[me].y+a[8]*I[me].z,j=a[5]*I[Ce].y+a[8]*I[Ce].z,ee===0?(le[De]=Y,le[D]=fe,le[ce]=Ee,le[De+1]=we,le[D+1]=ae,le[ce+1]=ve,le[De+2]=Le,le[D+2]=ye,le[ce+2]=j,oe[R]=_e+W,oe[R+1]=me+W,oe[R+2]=Ce+W,L.faceidx+=3):ee===Oe-1?(le[De]=Y,le[Re]=ue,le[D]=fe,le[De+1]=we,le[Re+1]=N,le[D+1]=ae,le[De+2]=Le,le[Re+2]=ne,le[D+2]=ye,oe[R]=_e+W,oe[R+1]=Q+W,oe[R+2]=me+W,L.faceidx+=3):(le[De]=Y,le[Re]=ue,le[ce]=Ee,le[De+1]=we,le[Re+1]=N,le[ce+1]=ve,le[De+2]=Le,le[Re+2]=ne,le[ce+2]=j,le[Re]=ue,le[D]=fe,le[ce]=Ee,le[Re+1]=N,le[D+1]=ae,le[ce+1]=ve,le[Re+2]=ne,le[D+2]=ye,le[ce+2]=j,oe[R]=_e+W,oe[R+1]=Q+W,oe[R+2]=Ce+W,oe[R+3]=Q+W,oe[R+4]=me+W,oe[R+5]=Ce+W,L.faceidx+=6)}}L.vertices+=T}O.drawCylinder=v;function b(r,e,t,n,o){if(!e||!t)return;o=o||{r:0,g:0,b:0};let h=new A.Vector3(t.x-e.x,t.y-e.y,t.z-e.z);var f=p(h.x,h.y,h.z);h=h.normalize();var i=M.basisVectors.length,s=M.basisVectors,a=i+2,c=r.updateGeoGroup(a),u=c.vertices,E,T,L,P,I,z,B=c.vertexArray,F=c.normalArray,W=c.colorArray,U=c.faceArray;for(E=u*3,B[E]=e.x,B[E+1]=e.y,B[E+2]=e.z,F[E]=-h.x,F[E+1]=-h.y,F[E+2]=-h.z,W[E]=o.r,W[E+1]=o.g,W[E+2]=o.b,B[E+3]=t.x,B[E+4]=t.y,B[E+5]=t.z,F[E+3]=h.x,F[E+4]=h.y,F[E+5]=h.z,W[E+3]=o.r,W[E+4]=o.g,W[E+5]=o.b,E+=6,L=0;L<i;++L){var R=s[L].clone();R.multiplyScalar(n),P=f[0]*R.x+f[3]*R.y+f[6]*R.z,I=f[1]*R.x+f[4]*R.y+f[7]*R.z,z=f[5]*R.y+f[8]*R.z,B[E]=P+e.x,B[E+1]=I+e.y,B[E+2]=z+e.z,F[E]=P,F[E+1]=I,F[E+2]=z,W[E]=o.r,W[E+1]=o.g,W[E+2]=o.b,E+=3}for(c.vertices+=i+2,T=c.faceidx,L=0;L<i;L++){var V=u+2+L,q=u+2+(L+1)%i;U[T]=V,U[T+1]=q,U[T+2]=u,T+=3,U[T]=V,U[T+1]=q,U[T+2]=u+1,T+=3}c.faceidx+=6*i}O.drawCone=b;class _{constructor(){this.cache=new Map}getVerticesForRadius(e,t){t=t||2,this.cache.has(t)||this.cache.set(t,new Map);let n=this.cache.get(t);if(n.has(e))return n.get(e);var o={vertices:[],verticesRows:[],normals:[]},h=16*t,f=10*t;e<1&&(h=10*t,f=8*t);var i=0,s=Math.PI*2,a=0,c=Math.PI,u,E;for(E=0;E<=f;E++){let L=[];for(u=0;u<=h;u++){let P=u/h,I=E/f,z=-e*Math.cos(i+P*s)*Math.sin(a+I*c),B=e*Math.cos(a+I*c),F=e*Math.sin(i+P*s)*Math.sin(a+I*c);var T=new A.Vector3(z,B,F);T.normalize(),o.vertices.push({x:z,y:B,z:F}),o.normals.push(T),L.push(o.vertices.length-1)}o.verticesRows.push(L)}return n.set(e,o),o}}var g=new _;function m(r,e,t,n,o){var h=g.getVerticesForRadius(t,o),f=h.vertices,i=h.normals,s=r.updateGeoGroup(f.length),a=s.vertices,c=s.vertexArray,u=s.colorArray,E=s.faceArray,T=s.lineArray,L=s.normalArray;for(let z=0,B=f.length;z<B;++z){let F=3*(a+z),W=f[z];c[F]=W.x+e.x,c[F+1]=W.y+e.y,c[F+2]=W.z+e.z,u[F]=n.r,u[F+1]=n.g,u[F+2]=n.b}s.vertices+=f.length;let P=h.verticesRows,I=P.length-1;for(let z=0;z<I;z++){let B=P[z].length-1;for(let F=0;F<B;F++){let W=s.faceidx,U=s.lineidx,R=P[z][F+1]+a,V=R*3,q=P[z][F]+a,ee=q*3,se=P[z+1][F]+a,ie=se*3,le=P[z+1][F+1]+a,re=le*3,oe=i[R-a],Ae=i[q-a],Me=i[se-a],Oe=i[le-a];Math.abs(f[R-a].y)===t?(L[V]=oe.x,L[ie]=Me.x,L[re]=Oe.x,L[V+1]=oe.y,L[ie+1]=Me.y,L[re+1]=Oe.y,L[V+2]=oe.z,L[ie+2]=Me.z,L[re+2]=Oe.z,E[W]=R,E[W+1]=se,E[W+2]=le,T[U]=R,T[U+1]=se,T[U+2]=R,T[U+3]=le,T[U+4]=se,T[U+5]=le,s.faceidx+=3,s.lineidx+=6):Math.abs(f[se-a].y)===t?(L[V]=oe.x,L[ee]=Ae.x,L[ie]=Me.x,L[V+1]=oe.y,L[ee+1]=Ae.y,L[ie+1]=Me.y,L[V+2]=oe.z,L[ee+2]=Ae.z,L[ie+2]=Me.z,E[W]=R,E[W+1]=q,E[W+2]=se,T[U]=R,T[U+1]=q,T[U+2]=R,T[U+3]=se,T[U+4]=q,T[U+5]=se,s.faceidx+=3,s.lineidx+=6):(L[V]=oe.x,L[ee]=Ae.x,L[re]=Oe.x,L[V+1]=oe.y,L[ee+1]=Ae.y,L[re+1]=Oe.y,L[V+2]=oe.z,L[ee+2]=Ae.z,L[re+2]=Oe.z,L[ee]=Ae.x,L[ie]=Me.x,L[re]=Oe.x,L[ee+1]=Ae.y,L[ie+1]=Me.y,L[re+1]=Oe.y,L[ee+2]=Ae.z,L[ie+2]=Me.z,L[re+2]=Oe.z,E[W]=R,E[W+1]=q,E[W+2]=le,E[W+3]=q,E[W+4]=se,E[W+5]=le,T[U]=R,T[U+1]=q,T[U+2]=R,T[U+3]=le,T[U+4]=q,T[U+5]=se,T[U+6]=se,T[U+7]=le,s.faceidx+=6,s.lineidx+=8)}}}O.drawSphere=m})(w||(w={}))},"./src/GLModel.ts":(K,C,d)=>{d.r(C),d.d(C,{GLModel:()=>m});var A=d("./src/WebGL/index.ts"),S=d("./src/WebGL/shapes/index.ts"),w=d("./src/WebGL/math/index.ts"),O=d("./src/colors.ts"),p=d("./src/GLDraw.ts"),x=d("./src/glcartoon.ts"),M=d("./src/utilities.ts"),v=d("./src/Gradient.ts"),b=d("./src/parsers/index.ts"),_=d("./node_modules/netcdfjs/lib-esm/index.js"),g=d("./src/parsers/utils/assignBonds.ts");class m{static sameObj(e,t){return e&&t?JSON.stringify(e)==JSON.stringify(t):e==t}constructor(e,t,n){this.atoms=[],this.frames=[],this.box=null,this.atomdfs=null,this.id=0,this.hidden=!1,this.molObj=null,this.renderedMolObj=null,this.lastColors=null,this.modelData={},this.modelDatas=null,this.idMatrix=new w.Matrix4,this.dontDuplicateAtoms=!0,this.defaultColor=O.elementColors.defaultColor,this.defaultStickRadius=.25,this.options=t||{},this.viewer=n,this.ElementColors=this.options.defaultcolors?this.options.defaultcolors:O.elementColors.defaultColors,this.defaultSphereRadius=this.options.defaultSphereRadius?this.options.defaultSphereRadius:1.5,this.defaultCartoonQuality=this.options.cartoonQuality?this.options.cartoonQuality:10,this.id=e}getRadiusFromStyle(e,t){var n=this.defaultSphereRadius;if(typeof t.radius<"u")n=t.radius;else if(m.vdwRadii[e.elem])n=m.vdwRadii[e.elem];else if(e.elem.length>1){let o=e.elem;o=o[0].toUpperCase()+o[1].toLowerCase(),m.vdwRadii[o]&&(n=m.vdwRadii[o])}return typeof t.scale<"u"&&(n*=t.scale),n}drawAtomCross(e,t){if(e.style.cross){var n=e.style.cross;if(!n.hidden){var o=n.linewidth||m.defaultlineWidth;t[o]||(t[o]=new A.Geometry);var h=t[o].updateGeoGroup(6),f=this.getRadiusFromStyle(e,n),i=[[f,0,0],[-f,0,0],[0,f,0],[0,-f,0],[0,0,f],[0,0,-f]],s=e.clickable||e.hoverable;s&&e.intersectionShape===void 0&&(e.intersectionShape={sphere:[],cylinder:[],line:[]});for(var a=(0,M.getColorFromStyle)(e,n),c=h.vertexArray,u=h.colorArray,E=0;E<6;E++){var T=h.vertices*3;if(h.vertices++,c[T]=e.x+i[E][0],c[T+1]=e.y+i[E][1],c[T+2]=e.z+i[E][2],u[T]=a.r,u[T+1]=a.g,u[T+2]=a.b,s){var L=new w.Vector3(i[E][0],i[E][1],i[E][2]);L.multiplyScalar(.1),L.set(L.x+e.x,L.y+e.y,L.z+e.z),e.intersectionShape.line.push(L)}}}}}getGoodCross(e,t,n,o){for(var h=null,f=-1,i=0,s=e.bonds.length;i<s;i++)if(e.bonds[i]!=t.index){let c=e.bonds[i],u=this.atoms[c],T=new w.Vector3(u.x,u.y,u.z).clone();T.sub(n);let L=T.clone();L.cross(o);var a=L.lengthSq();if(a>f&&(f=a,h=L,f>.1))return h}return h}getSideBondV(e,t,n){var o,h,f,i,s,a=new w.Vector3(e.x,e.y,e.z),c=new w.Vector3(t.x,t.y,t.z),u=c.clone(),E=null;if(u.sub(a),e.bonds.length===1)t.bonds.length===1?(E=u.clone(),Math.abs(E.x)>1e-4?E.y+=1:E.x+=1):(o=(n+1)%t.bonds.length,h=t.bonds[o],f=this.atoms[h],f.index==e.index&&(o=(o+1)%t.bonds.length,h=t.bonds[o],f=this.atoms[h]),i=new w.Vector3(f.x,f.y,f.z),s=i.clone(),s.sub(a),E=s.clone(),E.cross(u));else if(E=this.getGoodCross(e,t,a,u),E.lengthSq()<.01){var T=this.getGoodCross(t,e,a,u);T!=null&&(E=T)}return E.lengthSq()<.01&&(E=u.clone(),Math.abs(E.x)>1e-4?E.y+=1:E.x+=1),E.cross(u),E.normalize(),E}addLine(e,t,n,o,h,f){e[n]=o.x,e[n+1]=o.y,e[n+2]=o.z,t[n]=f.r,t[n+1]=f.g,t[n+2]=f.b,e[n+3]=h.x,e[n+4]=h.y,e[n+5]=h.z,t[n+3]=f.r,t[n+4]=f.g,t[n+5]=f.b}drawBondLines(e,t,n){if(e.style.line){var o=e.style.line;if(!o.hidden){var h,f,i,s,a=o.linewidth||m.defaultlineWidth;n[a]||(n[a]=new A.Geometry);for(var c=n[a].updateGeoGroup(6*e.bonds.length),u=c.vertexArray,E=c.colorArray,T=0;T<e.bonds.length;T++){var L=e.bonds[T],P=t[L];if(P.style.line&&!(e.index>=P.index)){var I=new w.Vector3(e.x,e.y,e.z),z=new w.Vector3(P.x,P.y,P.z),B=I.clone().add(z).multiplyScalar(.5),F=!1,W=e.clickable||e.hoverable,U=P.clickable||P.hoverable;(W||U)&&(W&&(e.intersectionShape===void 0&&(e.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),e.intersectionShape.line.push(I),e.intersectionShape.line.push(B)),U&&(P.intersectionShape===void 0&&(P.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),P.intersectionShape.line.push(B),P.intersectionShape.line.push(z)));var R=(0,M.getColorFromStyle)(e,e.style.line),V=(0,M.getColorFromStyle)(P,P.style.line);if(e.bondStyles&&e.bondStyles[T]){var q=e.bondStyles[T];if(!q.iswire)continue;q.singleBond&&(F=!0),typeof q.color1<"u"&&(R=O.CC.color(q.color1)),typeof q.color2<"u"&&(V=O.CC.color(q.color2))}var ee=c.vertices*3,se,ie;if(e.bondOrder[T]>1&&e.bondOrder[T]<4&&!F){var le=this.getSideBondV(e,P,T),re=z.clone();re.sub(I),e.bondOrder[T]==2?(le.multiplyScalar(.1),h=I.clone(),h.add(le),f=I.clone(),f.sub(le),i=h.clone(),i.add(re),s=f.clone(),s.add(re),R==V?(c.vertices+=4,this.addLine(u,E,ee,h,i,R),this.addLine(u,E,ee+6,f,s,R)):(c.vertices+=8,re.multiplyScalar(.5),se=h.clone(),se.add(re),ie=f.clone(),ie.add(re),this.addLine(u,E,ee,h,se,R),this.addLine(u,E,ee+6,se,i,V),this.addLine(u,E,ee+12,f,ie,R),this.addLine(u,E,ee+18,ie,s,V))):e.bondOrder[T]==3&&(le.multiplyScalar(.1),h=I.clone(),h.add(le),f=I.clone(),f.sub(le),i=h.clone(),i.add(re),s=f.clone(),s.add(re),R==V?(c.vertices+=6,this.addLine(u,E,ee,I,z,R),this.addLine(u,E,ee+6,h,i,R),this.addLine(u,E,ee+12,f,s,R)):(c.vertices+=12,re.multiplyScalar(.5),se=h.clone(),se.add(re),ie=f.clone(),ie.add(re),this.addLine(u,E,ee,I,B,R),this.addLine(u,E,ee+6,B,z,V),this.addLine(u,E,ee+12,h,se,R),this.addLine(u,E,ee+18,se,i,V),this.addLine(u,E,ee+24,f,ie,R),this.addLine(u,E,ee+30,ie,s,V)))}else R==V?(c.vertices+=2,this.addLine(u,E,ee,I,z,R)):(c.vertices+=4,this.addLine(u,E,ee,I,B,R),this.addLine(u,E,ee+6,B,z,V))}}}}}drawAtomSphere(e,t){if(e.style.sphere){var n=e.style.sphere;if(!n.hidden){var o=(0,M.getColorFromStyle)(e,n),h=this.getRadiusFromStyle(e,n);if((e.clickable===!0||e.hoverable)&&e.intersectionShape!==void 0){var f=new w.Vector3(e.x,e.y,e.z);e.intersectionShape.sphere.push(new S.Sphere(f,h))}p.GLDraw.drawSphere(t,e,h,o)}}}drawAtomClickSphere(e){if(e.style.clicksphere){var t=e.style.clicksphere;if(!t.hidden){var n=this.getRadiusFromStyle(e,t);if((e.clickable===!0||e.hoverable)&&e.intersectionShape!==void 0){var o=new w.Vector3(e.x,e.y,e.z);e.intersectionShape.sphere.push(new S.Sphere(o,n))}}}}drawAtomInstanced(e,t){if(e.style.sphere){var n=e.style.sphere;if(!n.hidden){var o=this.getRadiusFromStyle(e,n),h=(0,M.getColorFromStyle)(e,n),f=t.updateGeoGroup(1),i=f.vertices,s=i*3,a=f.vertexArray,c=f.colorArray,u=f.radiusArray;if(a[s]=e.x,a[s+1]=e.y,a[s+2]=e.z,c[s]=h.r,c[s+1]=h.g,c[s+2]=h.b,u[i]=o,(e.clickable===!0||e.hoverable)&&e.intersectionShape!==void 0){var E=new w.Vector3(e.x,e.y,e.z);e.intersectionShape.sphere.push(new S.Sphere(E,o))}f.vertices+=1}}}drawSphereImposter(e,t,n,o){var h=e.updateGeoGroup(4),f,i=h.vertices,s=i*3,a=h.vertexArray,c=h.colorArray;for(f=0;f<4;f++)a[s+3*f]=t.x,a[s+3*f+1]=t.y,a[s+3*f+2]=t.z;var u=h.normalArray;for(f=0;f<4;f++)c[s+3*f]=o.r,c[s+3*f+1]=o.g,c[s+3*f+2]=o.b;u[s+0]=-n,u[s+1]=n,u[s+2]=0,u[s+3]=-n,u[s+4]=-n,u[s+5]=0,u[s+6]=n,u[s+7]=-n,u[s+8]=0,u[s+9]=n,u[s+10]=n,u[s+11]=0,h.vertices+=4;var E=h.faceArray,T=h.faceidx;E[T+0]=i,E[T+1]=i+1,E[T+2]=i+2,E[T+3]=i+2,E[T+4]=i+3,E[T+5]=i,h.faceidx+=6}drawAtomImposter(e,t){if(e.style.sphere){var n=e.style.sphere;if(!n.hidden){var o=this.getRadiusFromStyle(e,n),h=(0,M.getColorFromStyle)(e,n);if((e.clickable===!0||e.hoverable)&&e.intersectionShape!==void 0){var f=new w.Vector3(e.x,e.y,e.z);e.intersectionShape.sphere.push(new S.Sphere(f,o))}this.drawSphereImposter(t,e,o,h)}}}calculateDashes(e,t,n,o,h){var f=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)+Math.pow(e.z-t.z,2));n=Math.max(n,0),h=Math.max(h,0)+2*n,o=Math.max(o,.001),o+h>f&&(o=f,h=0);var i=Math.floor((f-o)/(o+h))+1,s=i*o;h=(f-s)/i;for(var a,c=new w.Vector3(e.x,e.y,e.z),u=new w.Vector3((t.x-e.x)/(f/h),(t.y-e.y)/(f/h),(t.z-e.z)/(f/h)),E=new w.Vector3((t.x-e.x)/(f/o),(t.y-e.y)/(f/o),(t.z-e.z)/(f/o)),T=[],L=0;L<i;L++)a=new w.Vector3(c.x+E.x,c.y+E.y,c.z+E.z),T.push({from:c,to:a}),c=new w.Vector3(a.x+u.x,a.y+u.y,a.z+u.z);return T}static drawStickImposter(e,t,n,o,h,f=0,i=0){for(var s=e.updateGeoGroup(4),a=s.vertices,c=a*3,u=s.vertexArray,E=s.colorArray,T=s.radiusArray,L=s.normalArray,P=h.r,I=h.g,z=h.b,B=function(V){var q=-V;return q==0&&(q=-1e-4),q},F=c,W=0;W<4;W++)u[F]=t.x,L[F]=n.x,E[F]=P,F++,u[F]=t.y,L[F]=n.y,E[F]=I,F++,u[F]=t.z,L[F]=n.z,W<2?E[F]=z:E[F]=B(z),F++;s.vertices+=4,T[a]=-o,T[a+1]=o,T[a+2]=-o,T[a+3]=o;var U=s.faceArray,R=s.faceidx;U[R+0]=a,U[R+1]=a+1,U[R+2]=a+2,U[R+3]=a+2,U[R+4]=a+3,U[R+5]=a,s.faceidx+=6}drawBondSticks(e,t,n){var o,h;if(e.style.stick){var f=e.style.stick;if(!f.hidden){var i=f.radius||this.defaultStickRadius,s=f.doubleBondScaling||.4,a=f.tripleBondScaling||.25,c=((o=f.dashedBondConfig)===null||o===void 0?void 0:o.dashLength)||.1,u=((h=f.dashedBondConfig)===null||h===void 0?void 0:h.gapLength)||.25,E=i,T=f.singleBonds||!1,L=f.dashedBonds||!1,P=0,I=0,z,B,F,W,U,R,V,q,ee,se,ie,le=(0,M.getColorFromStyle)(e,f),re,oe,Ae;!e.capDrawn&&e.bonds.length<4&&(P=2);var Me=ae=>{var ve=n.imposter?m.drawStickImposter:p.GLDraw.drawCylinder;return!L&&ae>=1?ve:(Le,ne,ye,j,De,Re=0,D=0,ce=.1,de=.25)=>{var H=this.calculateDashes(ne,ye,j,ce,de);H.forEach(te=>{ve(Le,te.from,te.to,j,De,Re,D)})}};for(F=0;F<e.bonds.length;F++){var Oe=Me(e.bondOrder[F]),_e=e.bonds[F],Q=t[_e];if(re=oe=Ae=null,e.index<Q.index){var me=Q.style;if(!me.stick||me.stick.hidden)continue;var Ce=(0,M.getColorFromStyle)(Q,me.stick);if(E=i,W=T,e.bondStyles&&e.bondStyles[F]){if(U=e.bondStyles[F],U.iswire)continue;U.radius&&(E=U.radius),U.singleBond&&(W=!0),typeof U.color1<"u"&&(le=O.CC.color(U.color1)),typeof U.color2<"u"&&(Ce=O.CC.color(U.color2))}var Pe=new w.Vector3(e.x,e.y,e.z),We=new w.Vector3(Q.x,Q.y,Q.z);if(e.bondOrder[F]<=1||W||e.bondOrder[F]>3){if(e.bondOrder[F]<1&&(E*=e.bondOrder[F]),!Q.capDrawn&&Q.bonds.length<4&&(I=2),le!=Ce?(re=new w.Vector3().addVectors(Pe,We).multiplyScalar(.5),Oe(n,Pe,re,E,le,P,0,c,u),Oe(n,re,We,E,Ce,0,I,c,u)):Oe(n,Pe,We,E,le,P,I,c,u),z=e.clickable||e.hoverable,B=Q.clickable||Q.hoverable,z||B){if(re||(re=new w.Vector3().addVectors(Pe,We).multiplyScalar(.5)),z){var Ue=new S.Cylinder(Pe,re,E),ze=new S.Sphere(Pe,E);e.intersectionShape.cylinder.push(Ue),e.intersectionShape.sphere.push(ze)}if(B){var Be=new S.Cylinder(We,re,E),Ie=new S.Sphere(We,E);Q.intersectionShape.cylinder.push(Be),Q.intersectionShape.sphere.push(Ie)}}}else if(e.bondOrder[F]>1){var Se=0,Te=0;E!=i&&(Se=2,Te=2);var Ge=We.clone(),Ne=null;Ge.sub(Pe);var k,Z,Y,ue,fe;Ne=this.getSideBondV(e,Q,F),e.bondOrder[F]==2?(k=E*s,Ne.multiplyScalar(k*1.5),Z=Pe.clone(),Z.add(Ne),Y=Pe.clone(),Y.sub(Ne),ue=Z.clone(),ue.add(Ge),fe=Y.clone(),fe.add(Ge),le!=Ce?(re=new w.Vector3().addVectors(Z,ue).multiplyScalar(.5),oe=new w.Vector3().addVectors(Y,fe).multiplyScalar(.5),Oe(n,Z,re,k,le,Se,0),Oe(n,re,ue,k,Ce,0,Te),Oe(n,Y,oe,k,le,Se,0),Oe(n,oe,fe,k,Ce,0,Te)):(Oe(n,Z,ue,k,le,Se,Te),Oe(n,Y,fe,k,le,Se,Te)),z=e.clickable||e.hoverable,B=Q.clickable||Q.hoverable,(z||B)&&(re||(re=new w.Vector3().addVectors(Z,ue).multiplyScalar(.5)),oe||(oe=new w.Vector3().addVectors(Y,fe).multiplyScalar(.5)),z&&(R=new S.Cylinder(Z,re,k),V=new S.Cylinder(Y,oe,k),e.intersectionShape.cylinder.push(R),e.intersectionShape.cylinder.push(V)),B&&(ee=new S.Cylinder(ue,re,k),se=new S.Cylinder(fe,oe,k),Q.intersectionShape.cylinder.push(ee),Q.intersectionShape.cylinder.push(se)))):e.bondOrder[F]==3&&(k=E*a,Ne.cross(Ge),Ne.normalize(),Ne.multiplyScalar(k*3),Z=Pe.clone(),Z.add(Ne),Y=Pe.clone(),Y.sub(Ne),ue=Z.clone(),ue.add(Ge),fe=Y.clone(),fe.add(Ge),le!=Ce?(re=new w.Vector3().addVectors(Z,ue).multiplyScalar(.5),oe=new w.Vector3().addVectors(Y,fe).multiplyScalar(.5),Ae=new w.Vector3().addVectors(Pe,We).multiplyScalar(.5),Oe(n,Z,re,k,le,Se,0),Oe(n,re,ue,k,Ce,0,Te),Oe(n,Pe,Ae,k,le,P,0),Oe(n,Ae,We,k,Ce,0,I),Oe(n,Y,oe,k,le,Se,0),Oe(n,oe,fe,k,Ce,0,Te)):(Oe(n,Z,ue,k,le,Se,Te),Oe(n,Pe,We,k,le,P,I),Oe(n,Y,fe,k,le,Se,Te)),z=e.clickable||e.hoverable,B=Q.clickable||Q.hoverable,(z||B)&&(re||(re=new w.Vector3().addVectors(Z,ue).multiplyScalar(.5)),oe||(oe=new w.Vector3().addVectors(Y,fe).multiplyScalar(.5)),Ae||(Ae=new w.Vector3().addVectors(Pe,We).multiplyScalar(.5)),z&&(R=new S.Cylinder(Z.clone(),re.clone(),k),V=new S.Cylinder(Y.clone(),oe.clone(),k),q=new S.Cylinder(Pe.clone(),Ae.clone(),k),e.intersectionShape.cylinder.push(R),e.intersectionShape.cylinder.push(V),e.intersectionShape.cylinder.push(q)),B&&(ee=new S.Cylinder(ue.clone(),re.clone(),k),se=new S.Cylinder(fe.clone(),oe.clone(),k),ie=new S.Cylinder(We.clone(),Ae.clone(),k),Q.intersectionShape.cylinder.push(ee),Q.intersectionShape.cylinder.push(se),Q.intersectionShape.cylinder.push(ie))))}}}var Ee=!1,we=0,N=!1;for(F=0;F<e.bonds.length;F++)W=T,e.bondStyles&&e.bondStyles[F]&&(U=e.bondStyles[F],U.singleBond&&(W=!0),U.radius&&U.radius!=i&&(N=!0)),(W||e.bondOrder[F]==1)&&we++;N?we>0&&(Ee=!0):we==0&&(e.bonds.length>0||f.showNonBonded)&&(Ee=!0),Ee&&(E=i,n.imposter?this.drawSphereImposter(n.sphereGeometry,e,E,le):p.GLDraw.drawSphere(n,e,E,le))}}}createMolObj(e,t){t=t||{};var n=new A.Object3D,o=[],h={},f={},i=this.drawAtomSphere,s=null,a=null;t.supportsImposters?(i=this.drawAtomImposter,s=new A.Geometry(!0),s.imposter=!0,a=new A.Geometry(!0,!0),a.imposter=!0,a.sphereGeometry=new A.Geometry(!0),a.sphereGeometry.imposter=!0,a.drawnCaps={}):t.supportsAIA?(i=this.drawAtomInstanced,s=new A.Geometry(!1,!0,!0),s.instanced=!0,a=new A.Geometry(!0)):(s=new A.Geometry(!0),a=new A.Geometry(!0));var c,u,E,T,L={},P=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(c=0,E=e.length;c<E;c++){var I=e[c];if(I&&I.style){(I.clickable||I.hoverable)&&I.intersectionShape===void 0&&(I.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),T={line:void 0,cross:void 0,stick:void 0,sphere:void 0};for(u in T)I.style[u]?I.style[u].opacity?T[u]=parseFloat(I.style[u].opacity):T[u]=1:T[u]=void 0,L[u]?T[u]!=null&&L[u]!=T[u]&&(console.log("Warning: "+u+" opacity is ambiguous"),L[u]=1):L[u]=T[u];i.call(this,I,s),this.drawAtomClickSphere(I),this.drawAtomCross(I,f),this.drawBondLines(I,e,h),this.drawBondSticks(I,e,a),typeof I.style.cartoon<"u"&&!I.style.cartoon.hidden&&(I.style.cartoon.color==="spectrum"&&typeof I.resi=="number"&&!I.hetflag&&(I.resi<P[0]&&(P[0]=I.resi),I.resi>P[1]&&(P[1]=I.resi)),o.push(I))}}if(o.length>0&&(0,x.drawCartoon)(n,o,P,this.defaultCartoonQuality),s&&s.vertices>0){s.initTypedArrays();var z=null,B=null;s.imposter?z=new A.SphereImposterMaterial({ambient:0,vertexColors:!0,reflectivity:0}):s.instanced?(B=new A.Geometry(!0),p.GLDraw.drawSphere(B,{x:0,y:0,z:0},1,new O.Color(.5,.5,.5)),B.initTypedArrays(),z=new A.InstancedMaterial({sphereMaterial:new A.MeshLambertMaterial({ambient:0,vertexColors:!0,reflectivity:0}),sphere:B})):z=new A.MeshLambertMaterial({ambient:0,vertexColors:!0,reflectivity:0}),L.sphere<1&&L.sphere>=0&&(z.transparent=!0,z.opacity=L.sphere),B=new A.Mesh(s,z),n.add(B)}if(a.vertices>0){var F=null,W=null,U=a.sphereGeometry;(!U||typeof U.vertices>"u"||U.vertices==0)&&(U=null),a.initTypedArrays(),U&&U.initTypedArrays();var R={ambient:0,vertexColors:!0,reflectivity:0};a.imposter?(F=new A.StickImposterMaterial(R),W=new A.SphereImposterMaterial(R)):(F=new A.MeshLambertMaterial(R),W=new A.MeshLambertMaterial(R),F.wireframe&&(a.setUpWireframe(),U&&U.setUpWireframe())),L.stick<1&&L.stick>=0&&(F.transparent=!0,F.opacity=L.stick,W.transparent=!0,W.opacity=L.stick);var V=new A.Mesh(a,F);if(n.add(V),U){var q=new A.Mesh(U,W);n.add(q)}}var ee;for(c in h)if(h.hasOwnProperty(c)){ee=c;var se=new A.LineBasicMaterial({linewidth:ee,vertexColors:!0});L.line<1&&L.line>=0&&(se.transparent=!0,se.opacity=L.line),h[c].initTypedArrays();var ie=new A.Line(h[c],se,A.LineStyle.LinePieces);n.add(ie)}for(c in f)if(f.hasOwnProperty(c)){ee=c;var le=new A.LineBasicMaterial({linewidth:ee,vertexColors:!0});L.cross<1&&L.cross>=0&&(le.transparent=!0,le.opacity=L.cross),f[c].initTypedArrays();var re=new A.Line(f[c],le,A.LineStyle.LinePieces);n.add(re)}if(this.dontDuplicateAtoms&&this.modelData.symmetries&&this.modelData.symmetries.length>0){var oe=new A.Object3D,Ae;for(Ae=0;Ae<this.modelData.symmetries.length;Ae++){var Me=new A.Object3D;Me=n.clone(),Me.matrix.copy(this.modelData.symmetries[Ae]),Me.matrixAutoUpdate=!1,oe.add(Me)}return oe}return n}getViewer(){return this.viewer}getInternalState(){return{atoms:this.atoms,frames:this.frames}}setInternalState(e){this.atoms=e.atoms,this.frames=e.frames,this.molObj=null}getCrystData(){if(this.modelData.cryst){if(!this.modelData.cryst.matrix){const e=this.modelData.cryst;this.modelData.cryst.matrix=(0,w.conversionMatrix3)(e.a,e.b,e.c,e.alpha,e.beta,e.gamma)}return this.modelData.cryst}else return null}setCrystData(e,t,n,o,h,f){e=e||1,t=t||1,n=n||1,o=o||90,h=h||90,f=f||90;const i=(0,w.conversionMatrix3)(e,t,n,o,h,f);this.modelData.cryst={a:e,b:t,c:n,alpha:o,beta:h,gamma:f,matrix:i}}setCrystMatrix(e){e=e||new w.Matrix3(1,0,0,0,1,0,0,0,1),this.modelData.cryst={matrix:e}}getSymmetries(){return typeof this.modelData.symmetries>"u"&&(this.modelData.symmetries=[this.idMatrix]),this.modelData.symmetries}setSymmetries(e){typeof e>"u"?this.modelData.symmetries=[this.idMatrix]:(this.modelData.symmetries=e,this.molObj=null)}getID(){return this.id}getNumFrames(){return this.frames.numFrames!=null?this.frames.numFrames:this.frames.length}adjustCoord(e,t,n,o){var h=t-e;return h<-n?t+o:h>n?t-o:t}adjustCoordinatesToBox(){if(this.box&&this.atomdfs)for(var e=this.box[0],t=this.box[1],n=this.box[2],o=e*.9,h=t*.9,f=n*.9,i=0;i<this.atomdfs.length;i++)for(var s=this.atomdfs[i],a=1;a<s.length;a++){var c=this.atoms[s[a][0]],u=this.atoms[s[a][1]];c.x=this.adjustCoord(u.x,c.x,o,e),c.y=this.adjustCoord(u.y,c.y,h,t),c.z=this.adjustCoord(u.z,c.z,f,n)}}setFrame(e){var t=this.getNumFrames();let n=this,o=this.viewer;return new Promise(function(h,f){if(t==0&&h(),(e<0||e>=t)&&(e=t-1),n.frames.url!=null){var i=n.frames.url;(0,M.getbin)(i+"/traj/frame/"+e+"/"+n.frames.path,void 0,"POST",void 0).then(function(s){for(var a=new Float32Array(s,44),c=0,u=0;u<n.atoms.length;u++)n.atoms[u].x=a[c++],n.atoms[u].y=a[c++],n.atoms[u].z=a[c++];n.box&&n.atomdfs&&n.adjustCoordinatesToBox(),h()}).catch(f)}else n.atoms=n.frames[e],h();n.molObj=null,n.modelDatas&&e<n.modelDatas.length&&(n.modelData=n.modelDatas[e],n.unitCellObjects&&o&&(o.removeUnitCell(n),o.addUnitCell(n)))})}addFrame(e){this.frames.push(e)}vibrate(e=10,t=1,n=!1,o){var h=0,f=e;let i=this.viewer;n&&(h=-e,f=e),this.frames!==void 0&&this.frames.origIndex!==void 0?this.setFrame(this.frames.origIndex):this.setFrame(0),h<f&&(this.frames=[]),n&&(this.frames.origIndex=e);for(var s=h;s<f;s++){var a=[],c=this.frames.length;if(s==0&&!o){this.frames.push(this.atoms);continue}for(var u=0;u<this.atoms.length;u++){var E=(0,M.getAtomProperty)(this.atoms[u],"dx"),T=(0,M.getAtomProperty)(this.atoms[u],"dy"),L=(0,M.getAtomProperty)(this.atoms[u],"dz"),P=new w.Vector3(E,T,L),I=new w.Vector3(this.atoms[u].x,this.atoms[u].y,this.atoms[u].z),z=s*t/e;P.multiplyScalar(z),I.add(P);var B={};for(var F in this.atoms[u])B[F]=this.atoms[u][F];if(B.x=I.x,B.y=I.y,B.z=I.z,a.push(B),i&&o){var W=(0,M.extend)({},o),U=new w.Vector3(E,T,L);if(U.multiplyScalar(t),U.add(I),W.start=I,W.end=U,W.frame=c,!W.color){var R=B.style.sphere;R||(R=B.style.stick),R||(R=B.style.line),W.color=(0,M.getColorFromStyle)(B,R)}i.addArrow(W)}}this.frames.push(a)}}setAtomDefaults(e){for(let t=0;t<e.length;t++){let n=e[t];n&&(n.style=n.style||(0,M.deepCopy)(m.defaultAtomStyle),n.color=n.color||this.ElementColors[n.elem]||this.defaultColor,n.model=this.id,(n.clickable||n.hoverable)&&(n.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}))}}addMolData(e,t,n={}){var o=m.parseMolData(e,t,n);this.dontDuplicateAtoms=!n.duplicateAssemblyAtoms;var h=o.modelData;if(h&&(Array.isArray(h)?(this.modelData=h[0],n.frames&&(this.modelDatas=h)):this.modelData=h),o.box?this.box=o.box:this.box=null,this.frames.length==0){for(let i=0;i<o.length;i++)o[i].length!=0&&this.frames.push(o[i]);this.frames[0]&&(this.atoms=this.frames[0])}else if(n.frames)for(let i=0;i<o.length;i++)this.frames.push(o[i]);else for(var f=0;f<o.length;f++)this.addAtoms(o[f]);for(let i=0;i<this.frames.length;i++)this.setAtomDefaults(this.frames[i]);n.vibrate&&n.vibrate.frames&&n.vibrate.amplitude&&this.vibrate(n.vibrate.frames,n.vibrate.amplitude),n.style&&this.setStyle({},n.style)}setDontDuplicateAtoms(e){this.dontDuplicateAtoms=e}setModelData(e){this.modelData=e}propertyMatches(e,t){if(e==t)return!0;if(typeof t=="string"&&typeof e=="number"){var n=t.match(/(-?\d+)\s*-\s*(-?\d+)/);if(n){var o=parseInt(n[1]),h=parseInt(n[2]);if(n&&e>=o&&e<=h)return!0}}return!1}static deepCopyAndCache(e,t){if(typeof e!="object"||e==null||e instanceof m||e.__cache_created)return e;const n={};for(const o in e){const h=e[o];if(Array.isArray(h)){n[o]=[];for(let f=0;f<h.length;f++)n[o].push(m.deepCopyAndCache(h[f],t))}else typeof h=="object"&&o!="properties"&&o!="model"?n[o]=m.deepCopyAndCache(h,t):n[o]=h;if(o=="and"||o=="or"){const f=[];for(const i of n[o]){const s=new Set;for(const a of t.selectedAtoms(i))s.add(a.index);f.push(s)}if(o=="and"){const i=function(a,c){const u=new Set;for(const E of c)a.has(E)&&u.add(E);return u};let s=new Set(f[0]);for(const a of f.splice(1))s=i(s,a);n[o].__cached_results=s}else if(o=="or"){const i=new Set;for(const s of f)for(const a of s)i.add(a);n[o].__cached_results=i}}}return n.__cache_created=!0,n}atomIsSelected(e,t){if(typeof t>"u")return!0;var n=!!t.invert,o=!0;for(var h in t)if(h=="and"||h=="or"||h=="not"){if(h=="not"){if(this.atomIsSelected(e,t[h])){o=!1;break}}else if(t[h].__cached_results===void 0&&(t=m.deepCopyAndCache(t,this)),o=t[h].__cached_results.has(e.index),!o)break}else if(h==="predicate"){if(!t.predicate(e)){o=!1;break}}else if(h=="properties"&&e[h]){for(var f in t.properties)if(!f.startsWith("__cache")){if(typeof e.properties[f]>"u"){o=!1;break}if(e.properties[f]!=t.properties[f]){o=!1;break}}}else if(h=="model"){let c=t.model;if(typeof c=="number"&&c<0&&(c=this.viewer.getNextModelId()+c),Array.isArray(c)){let u=!1;for(let E=0;E<c.length;E++)if(c[E]==this||c[E]==this.id){u=!0;break}if(!u){o=!1;break}}else if(c!=this&&c!=this.id){o=!1;break}}else if(t.hasOwnProperty(h)&&!m.ignoredKeys.has(h)&&!h.startsWith("__cache")){if(typeof e[h]>"u"){o=!1;break}let c=!1;if(h==="bonds"){var i=t[h];if(i!=e.bonds.length){o=!1;break}}else if(Array.isArray(t[h])){var s=t[h],a=e[h];for(let u=0;u<s.length;u++)if(this.propertyMatches(a,s[u])){c=!0;break}if(!c){o=!1;break}}else{let u=t[h];if(!this.propertyMatches(e[h],u)){o=!1;break}}}return n?!o:o}static squaredDistance(e,t){var n=t.x-e.x,o=t.y-e.y,h=t.z-e.z;return n*n+o*o+h*h}expandAtomList(e,t){if(t<=0)return e;for(var n=(0,M.getExtent)(e,void 0),o=[[],[],[]],h=0;h<3;h++)o[0][h]=n[0][h]-t,o[1][h]=n[1][h]+t,o[2][h]=n[2][h];var f=[];for(let c=0;c<this.atoms.length;c++){var i=this.atoms[c].x,s=this.atoms[c].y,a=this.atoms[c].z;i>=o[0][0]&&i<=o[1][0]&&s>=o[0][1]&&s<=o[1][1]&&a>=o[0][2]&&a<=o[1][2]&&(i>=n[0][0]&&i<=n[1][0]&&s>=n[0][1]&&s<=n[1][1]&&a>=n[0][2]&&a<=n[1][2]||f.push(this.atoms[c]))}return f}static getFloat(e){return typeof e=="number"?e:parseFloat(e)}selectedAtoms(e,t){var n=[];e=m.deepCopyAndCache(e||{},this),t||(t=this.atoms);for(var o=t.length,h=0;h<o;h++){var f=t[h];f&&this.atomIsSelected(f,e)&&n.push(f)}if(e.hasOwnProperty("expand")){const B=m.getFloat(e.expand);let F=this.expandAtomList(n,B),W=n.length;const U=B*B;for(let R=0;R<F.length;R++)for(let V=0;V<W;V++){var i=m.squaredDistance(F[R],n[V]);i<U&&i>0&&n.push(F[R])}}if(e.hasOwnProperty("within")&&e.within.hasOwnProperty("sel")&&e.within.hasOwnProperty("distance")){var s=this.selectedAtoms(e.within.sel,this.atoms),a={};const B=m.getFloat(e.within.distance),F=B*B;for(let W=0;W<s.length;W++)for(let U=0;U<n.length;U++){let R=m.squaredDistance(s[W],n[U]);R<F&&R>0&&(a[U]=1)}var c=[];if(e.within.invert)for(let W=0;W<n.length;W++)a[W]||c.push(n[W]);else for(let W in a)c.push(n[W]);n=c}if(e.hasOwnProperty("byres")){var u={},E=[],T=[];for(let B=0;B<n.length;B++){let F=n[B];var L=F.chain,P=F.resi;if(u[L]===void 0&&(u[L]={}),F.hasOwnProperty("resi")&&u[L][P]===void 0){for(u[L][P]=!0,T.push(F);T.length>0;)if(F=T.pop(),L=F.chain,P=F.resi,E[F.index]===void 0){E[F.index]=!0;for(var I=0;I<F.bonds.length;I++){var z=this.atoms[F.bonds[I]];E[z.index]===void 0&&z.hasOwnProperty("resi")&&z.chain==L&&z.resi==P&&(T.push(z),n.push(z))}}}}}return n}addAtoms(e){this.molObj=null;var t=this.atoms.length,n=[],o;for(o=0;o<e.length;o++)typeof e[o].index>"u"&&(e[o].index=o),typeof e[o].serial>"u"&&(e[o].serial=o),n[e[o].index]=t+o;for(o=0;o<e.length;o++){var h=e[o],f=n[h.index],i=(0,M.extend)({},h);i.index=f,i.bonds=[],i.bondOrder=[],i.model=this.id,i.style=i.style||(0,M.deepCopy)(m.defaultAtomStyle),typeof i.color>"u"&&(i.color=this.ElementColors[i.elem]||this.defaultColor);for(var s=h.bonds?h.bonds.length:0,a=0;a<s;a++){var c=n[h.bonds[a]];typeof c<"u"&&(i.bonds.push(c),i.bondOrder.push(h.bondOrder?h.bondOrder[a]:1))}this.atoms.push(i)}}assignBonds(){(0,g.assignBonds)(this.atoms,{assignBonds:!0})}removeAtoms(e){this.molObj=null;var t=[],n;for(n=0;n<e.length;n++)t[e[n].index]=!0;var o=[];for(n=0;n<this.atoms.length;n++){var h=this.atoms[n];t[h.index]||o.push(h)}this.atoms=[],this.addAtoms(o)}setStyle(e,t,n){typeof t>"u"&&typeof n>"u"&&(t=e,e={}),e=e,typeof t=="string"&&(t=(0,M.specStringToObject)(t));var o=!1,h=this,f=function(s){var a=h.selectedAtoms(e,s);for(let c=0;c<s.length;c++)s[c]&&(s[c].capDrawn=!1);for(let c=0;c<a.length;c++){o=!0,(a[c].clickable||a[c].hoverable)&&(a[c].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),n||(a[c].style={});for(let u in t)t.hasOwnProperty(u)&&(a[c].style[u]=a[c].style[u]||{},Object.assign(a[c].style[u],t[u]))}};if(e.frame!==void 0&&e.frame<this.frames.length){let s=e.frame;s<0&&(s=this.frames.length+s),f(this.frames[s])}else{f(this.atoms);for(var i=0;i<this.frames.length;i++)this.frames[i]!==this.atoms&&f(this.frames[i])}o&&(this.molObj=null)}setClickable(e,t,n){if(t=!!t,n=(0,M.makeFunction)(n),n===null){console.log("Callback is not a function");return}var o=this.selectedAtoms(e,this.atoms),h=o.length;for(let f=0;f<h;f++)o[f].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},o[f].clickable=t,n&&(o[f].callback=n);h>0&&(this.molObj=null)}setHoverable(e,t,n,o){if(t=!!t,n=(0,M.makeFunction)(n),o=(0,M.makeFunction)(o),n===null){console.log("Hover_callback is not a function");return}if(o===null){console.log("Unhover_callback is not a function");return}var h=this.selectedAtoms(e,this.atoms),f=h.length;for(let i=0;i<f;i++)h[i].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},h[i].hoverable=t,n&&(h[i].hover_callback=n),o&&(h[i].unhover_callback=o);f>0&&(this.molObj=null)}enableContextMenu(e,t){t=!!t;var n,o=this.selectedAtoms(e,this.atoms),h=o.length;for(n=0;n<h;n++)o[n].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},o[n].contextMenuEnabled=t;h>0&&(this.molObj=null)}setColorByElement(e,t){if(!(this.molObj!==null&&m.sameObj(t,this.lastColors))){this.lastColors=t;var n=this.selectedAtoms(e,n);n.length>0&&(this.molObj=null);for(var o=0;o<n.length;o++){var h=n[o];typeof t[h.elem]<"u"&&(h.color=t[h.elem])}}}setColorByProperty(e,t,n,o){var h,f,i=this.selectedAtoms(e,i);for(this.lastColors=null,i.length>0&&(this.molObj=null),typeof n=="string"&&typeof v.Gradient.builtinGradients[n]<"u"&&(n=new v.Gradient.builtinGradients[n]),n=n,o||(o=n.range()),o||(o=(0,M.getPropertyRange)(i,t)),h=0;h<i.length;h++){f=i[h];var s=(0,M.getAtomProperty)(f,t);s!=null&&(f.color=n.valueToHex(parseFloat(f.properties[t]),o))}}setColorByFunction(e,t){var n=this.selectedAtoms(e,n);if(typeof t=="function"){this.lastColors=null,n.length>0&&(this.molObj=null);for(let o=0;o<n.length;o++){let h=n[o];h.color=t(h)}}}toCDObject(e=!1){var t={a:[],b:[]};e&&(t.s=[]);for(let o=0;o<this.atoms.length;o++){let h={},f=this.atoms[o];if(h.x=f.x,h.y=f.y,h.z=f.z,f.elem!="C"&&(h.l=f.elem),e){for(var n=0;n<t.s.length&&JSON.stringify(f.style)!==JSON.stringify(t.s[n]);)n++;n===t.s.length&&t.s.push(f.style),n!==0&&(h.s=n)}t.a.push(h);for(let i=0;i<f.bonds.length;i++){let s=o,a=f.bonds[i];if(s>=a)continue;let c={b:s,e:a},u=f.bondOrder[i];u!=1&&(c.o=u),t.b.push(c)}}return t}globj(e,t){(this.molObj===null||t.regen)&&(this.molObj=this.createMolObj(this.atoms,t),this.renderedMolObj&&(e.remove(this.renderedMolObj),this.renderedMolObj=null),this.renderedMolObj=this.molObj.clone(),this.hidden&&(this.renderedMolObj.setVisible(!1),this.molObj.setVisible(!1)),e.add(this.renderedMolObj))}exportVRML(){var e=this.createMolObj(this.atoms,{supportsImposters:!1,supportsAIA:!1});return e.vrml()}removegl(e){this.renderedMolObj&&(this.renderedMolObj.geometry!==void 0&&this.renderedMolObj.geometry.dispose(),this.renderedMolObj.material!==void 0&&this.renderedMolObj.material.dispose(),e.remove(this.renderedMolObj),this.renderedMolObj=null),this.molObj=null}hide(){this.hidden=!0,this.renderedMolObj&&this.renderedMolObj.setVisible(!1),this.molObj&&this.molObj.setVisible(!1)}show(){this.hidden=!1,this.renderedMolObj&&this.renderedMolObj.setVisible(!0),this.molObj&&this.molObj.setVisible(!0)}addPropertyLabels(e,t,n){let o=this.selectedAtoms(t),h=this.viewer,f=(0,M.deepCopy)(n);for(let s=0;s<o.length;s++){let a=o[s];var i=null;typeof a[e]<"u"?i=String(a[e]):typeof a.properties[e]<"u"&&(i=String(a.properties[e])),i!=null&&(f.position=a,h.addLabel(i,f))}}addResLabels(e,t,n=!1){let o=this.viewer;var h=[],f=function(s,a){for(var c=s.selectedAtoms(e,c),u={},E=0;E<c.length;E++){var T=c[E],L=T.chain,P=T.resn,I=T.resi,z=P+""+I;u[L]||(u[L]={}),u[L][z]||(u[L][z]=[]),u[L][z].push(T)}var B=(0,M.deepCopy)(t);for(let W in u)if(u.hasOwnProperty(W)){var F=u[W];for(let U in F)if(F.hasOwnProperty(U)){let R=F[U],V=new w.Vector3(0,0,0);for(let ee=0;ee<R.length;ee++){let se=R[ee];V.x+=se.x,V.y+=se.y,V.z+=se.z}V.divideScalar(R.length),B.position=V,B.frame=a;let q=o.addLabel(U,B,void 0,!0);h.push(q)}}};if(n){var i=this.getNumFrames();let s=this.atoms;for(let a=0;a<i;a++)this.frames[a]&&(this.atoms=this.frames[a],f(this,a));this.atoms=s}else f(this);return h}setupDFS(){this.atomdfs=[];var e=this,t=new Int8Array(this.atoms.length);t.fill(0);for(var n=function(i,s,a){a.push([i,s]);var c=e.atoms[i];t[i]=1;for(var u=0;u<c.bonds.length;u++){var E=c.bonds[u];e.atoms[E]&&!t[E]&&n(E,i,a)}},o=0;o<this.atoms.length;o++){var h=this.atoms[o];if(h&&!t[o]){var f=[];n(o,-1,f),this.atomdfs.push(f)}}}setCoordinatesFromURL(e,t){this.frames=[];var n=this;return this.box&&this.setupDFS(),e.startsWith("http")||(e="http://"+e),(0,M.get)(e+"/traj/numframes/"+t,function(o){if(!isNaN(parseInt(o)))return n.frames.push(n.atoms),n.frames.numFrames=o,n.frames.url=e,n.frames.path=t,n.setFrame(0)})}setCoordinates(e,t){if(t=t||"",!e)return[];if(/\.gz$/.test(t)){t=t.replace(/\.gz$/,"");try{e=(0,M.inflateString)(e)}catch(u){console.log(u)}}var n={mdcrd:"",inpcrd:"",pdb:"",netcdf:"",array:""};if(n.hasOwnProperty(t)){this.frames=[];for(var o=this.atoms.length,h=m.parseCrd(e,t),f=0;f<h.length;){for(var i=[],s=0;s<o;s++){var a={};for(var c in this.atoms[s])a[c]=this.atoms[s][c];i[s]=a,i[s].x=h[f++],i[s].y=h[f++],i[s].z=h[f++]}this.frames.push(i)}return this.atoms=this.frames[0],this.frames}return[]}addAtomSpecs(e){}static parseCrd(e,t){var n=[],o=0;if(t=="pdb")for(var h=e.indexOf(`
ATOM`);h!=-1;){for(;e.slice(h,h+5)==`
ATOM`||e.slice(h,h+7)==`
HETATM`;)n[o++]=parseFloat(e.slice(h+31,h+39)),n[o++]=parseFloat(e.slice(h+39,h+47)),n[o++]=parseFloat(e.slice(h+47,h+55)),h=e.indexOf(`
`,h+54),e.slice(h,h+4)==`
TER`&&(h=e.indexOf(`
`,h+5));h=e.indexOf(`
ATOM`,h)}else if(t=="netcdf"){var f=new _.NetCDFReader(e);n=[].concat.apply([],f.getDataVariable("coordinates"))}else{if(t=="array"||Array.isArray(e))return e.flat(2);{let i=e.indexOf(`
`);t=="inpcrd"&&(i=e.indexOf(`
`,i+1)),e=e.slice(i+1),n=e.match(/\S+/g).map(parseFloat)}}return n}static parseMolData(e,t="",n){if(!e)return[];if(/\.gz$/.test(t)){t=t.replace(/\.gz$/,"");try{t.match(/bcif/i)?e=(0,M.inflateString)(e,!1):e=(0,M.inflateString)(e)}catch(f){console.log(f)}}typeof b.Parsers[t]>"u"&&(t=t.split(".").pop(),typeof b.Parsers[t]>"u"&&(console.log("Unknown format: "+t),e instanceof Uint8Array?t="bcif":e.match(/^@<TRIPOS>MOLECULE/gm)?t="mol2":e.match(/^data_/gm)&&e.match(/^loop_/gm)?t="cif":e.match(/^HETATM/gm)||e.match(/^ATOM/gm)?t="pdb":e.match(/ITEM: TIMESTEP/gm)?t="lammpstrj":e.match(/^.*\n.*\n.\s*(\d+)\s+(\d+)/gm)?t="sdf":e.match(/^%VERSION\s+VERSION_STAMP/gm)?t="prmtop":t="xyz",console.log("Best guess: "+t)));var o=b.Parsers[t],h=o(e,n);return h}}m.defaultAtomStyle={line:{}},m.defaultlineWidth=1,m.vdwRadii={H:1.2,He:1.4,Li:1.82,Be:1.53,B:1.92,C:1.7,N:1.55,O:1.52,F:1.47,Ne:1.54,Na:2.27,Mg:1.73,Al:1.84,Si:2.1,P:1.8,S:1.8,Cl:1.75,Ar:1.88,K:2.75,Ca:2.31,Ni:1.63,Cu:1.4,Zn:1.39,Ga:1.87,Ge:2.11,As:1.85,Se:1.9,Br:1.85,Kr:2.02,Rb:3.03,Sr:2.49,Pd:1.63,Ag:1.72,Cd:1.58,In:1.93,Sn:2.17,Sb:2.06,Te:2.06,I:1.98,Xe:2.16,Cs:3.43,Ba:2.68,Pt:1.75,Au:1.66,Hg:1.55,Tl:1.96,Pb:2.02,Bi:2.07,Po:1.97,At:2.02,Rn:2.2,Fr:3.48,Ra:2.83,U:1.86},m.ignoredKeys=new Set(["props","invert","model","frame","byres","expand","within","and","or","not"])},"./src/GLShape.ts":(K,C,d)=>{d.r(C),d.d(C,{GLShape:()=>_,splitMesh:()=>g});var A=d("./src/WebGL/index.ts"),S=d("./src/WebGL/shapes/index.ts"),w=d("./src/WebGL/math/index.ts"),O=d("./src/colors.ts"),p=d("./src/ProteinSurface4.ts"),x=d("./src/VolumeData.ts"),M=d("./src/GLDraw.ts"),v=d("./src/glcartoon.ts"),b=d("./src/utilities.ts");class _{static finalizeGeo(r){var e=r.updateGeoGroup(0);e.vertices>0&&e.truncateArrayBuffers(!0,!0)}static updateColor(r,e){e=e||O.CC.color(e),r.colorsNeedUpdate=!0;var t,n,o;e.constructor!==Array&&(t=e.r,n=e.g,o=e.b);for(let h in r.geometryGroups){let f=r.geometryGroups[h],i=f.colorArray;for(let s=0,a=f.vertices;s<a;++s){if(e.constructor===Array){let c=e[s];t=c.r,n=c.g,o=c.b}i[s*3]=t,i[s*3+1]=n,i[s*3+2]=o}}}static drawArrow(r,e,t){var n=t.start,o=t.end,h=t.radius,f=t.radiusRatio,i=t.mid,s=t.midpos;if(!(n&&o))return;var a=e.updateGeoGroup(51),c=new w.Vector3(o.x,o.y,o.z).sub(n);if(s){let ne=c.length();s>0?i=s/ne:i=(ne+s)/ne}c.multiplyScalar(i);var u=new w.Vector3(n.x,n.y,n.z).add(c),E=c.clone().negate();let T=new w.Vector3(n.x,n.y,n.z);r.intersectionShape.cylinder.push(new S.Cylinder(T,u.clone(),h)),r.intersectionShape.sphere.push(new S.Sphere(T,h));var L=[];L[0]=c.clone(),Math.abs(L[0].x)>1e-4?L[0].y+=1:L[0].x+=1,L[0].cross(c),L[0].normalize(),L[4]=L[0].clone(),L[4].crossVectors(L[0],c),L[4].normalize(),L[8]=L[0].clone().negate(),L[12]=L[4].clone().negate(),L[2]=L[0].clone().add(L[4]).normalize(),L[6]=L[4].clone().add(L[8]).normalize(),L[10]=L[8].clone().add(L[12]).normalize(),L[14]=L[12].clone().add(L[0]).normalize(),L[1]=L[0].clone().add(L[2]).normalize(),L[3]=L[2].clone().add(L[4]).normalize(),L[5]=L[4].clone().add(L[6]).normalize(),L[7]=L[6].clone().add(L[8]).normalize(),L[9]=L[8].clone().add(L[10]).normalize(),L[11]=L[10].clone().add(L[12]).normalize(),L[13]=L[12].clone().add(L[14]).normalize(),L[15]=L[14].clone().add(L[0]).normalize();var P=a.vertices,I=a.vertexArray,z=a.faceArray,B=a.normalArray,F=a.lineArray,W,U,R;for(U=0,R=L.length;U<R;++U){W=3*(P+3*U);var V=L[U].clone().multiplyScalar(h).add(n),q=L[U].clone().multiplyScalar(h).add(u),ee=L[U].clone().multiplyScalar(h*f).add(u);if(I[W]=V.x,I[W+1]=V.y,I[W+2]=V.z,I[W+3]=q.x,I[W+4]=q.y,I[W+5]=q.z,I[W+6]=ee.x,I[W+7]=ee.y,I[W+8]=ee.z,U>0){var se=I[W-3],ie=I[W-2],le=I[W-1],re=new w.Vector3(se,ie,le),oe=new w.Vector3(o.x,o.y,o.z),Ae=u.clone(),Me=new w.Vector3(ee.x,ee.y,ee.z);r.intersectionShape.triangle.push(new S.Triangle(Me,oe,re)),r.intersectionShape.triangle.push(new S.Triangle(re.clone(),Ae,Me.clone()))}}a.vertices+=48,W=a.vertices*3,I[W]=n.x,I[W+1]=n.y,I[W+2]=n.z,I[W+3]=u.x,I[W+4]=u.y,I[W+5]=u.z,I[W+6]=o.x,I[W+7]=o.y,I[W+8]=o.z,a.vertices+=3;var Oe,_e,Q,me,Ce,Pe,We,Ue,ze,Be,Ie,Se,Te,Ge,Ne,k,Z,Y,ue,fe=a.vertices-3,Ee=a.vertices-2,we=a.vertices-1,N=fe*3,ae=Ee*3,ve=we*3;for(U=0,R=L.length-1;U<R;++U){var Le=P+3*U;W=Le*3,_e=a.faceidx,Q=a.lineidx,me=Le,Be=me*3,Ce=Le+1,Ie=Ce*3,Pe=Le+2,Se=Pe*3,We=Le+4,Te=We*3,Ue=Le+5,Ge=Ue*3,ze=Le+3,Ne=ze*3,k=Z=L[U],Y=ue=L[U+1],B[Be]=k.x,B[Ie]=Z.x,B[Ne]=ue.x,B[Be+1]=k.y,B[Ie+1]=Z.y,B[Ne+1]=ue.y,B[Be+2]=k.z,B[Ie+2]=Z.z,B[Ne+2]=ue.z,B[Ie]=Z.x,B[Te]=Y.x,B[Ne]=ue.x,B[Ie+1]=Z.y,B[Te+1]=Y.y,B[Ne+1]=ue.y,B[Ie+2]=Z.z,B[Te+2]=Y.z,B[Ne+2]=ue.z,B[Se]=Z.x,B[Ge]=Y.x,B[Se+1]=Z.y,B[Ge+1]=Y.y,B[Se+2]=Z.z,B[Ge+2]=Y.z,z[_e]=me,z[_e+1]=Ce,z[_e+2]=ze,z[_e+3]=Ce,z[_e+4]=We,z[_e+5]=ze,z[_e+6]=me,z[_e+7]=ze,z[_e+8]=fe,z[_e+9]=Pe,z[_e+10]=Ee,z[_e+11]=Ue,z[_e+12]=Pe,z[_e+13]=we,z[_e+14]=Ue,F[Q]=me,F[Q+1]=Ce,F[Q+2]=me,F[Q+3]=ze,F[Q+4]=We,F[Q+5]=ze,F[Q+6]=me,F[Q+7]=ze,F[Q+8]=Pe,F[Q+9]=Ce,F[Q+10]=Pe,F[Q+11]=Ue,F[Q+12]=We,F[Q+13]=Ue,F[Q+14]=Pe,F[Q+15]=we,F[Q+16]=Pe,F[Q+17]=Ue,F[Q+18]=we,F[Q+19]=Ue,a.faceidx+=15,a.lineidx+=20}Oe=[P+45,P+46,P+1,P,P+47,P+2],_e=a.faceidx,Q=a.lineidx,me=Oe[0],Be=me*3,Ce=Oe[1],Ie=Ce*3,Pe=Oe[4],Se=Pe*3,We=Oe[2],Te=We*3,Ue=Oe[5],Ge=Ue*3,ze=Oe[3],Ne=ze*3,k=Z=L[15],Y=ue=L[0],B[Be]=k.x,B[Ie]=Z.x,B[Ne]=ue.x,B[Be+1]=k.y,B[Ie+1]=Z.y,B[Ne+1]=ue.y,B[Be+2]=k.z,B[Ie+2]=Z.z,B[Ne+2]=ue.z,B[Ie]=Z.x,B[Te]=Y.x,B[Ne]=ue.x,B[Ie+1]=Z.y,B[Te+1]=Y.y,B[Ne+1]=ue.y,B[Ie+2]=Z.z,B[Te+2]=Y.z,B[Ne+2]=ue.z,B[Se]=Z.x,B[Ge]=Y.x,B[Se+1]=Z.y,B[Ge+1]=Y.y,B[Se+2]=Z.z,B[Ge+2]=Y.z,c.normalize(),E.normalize(),B[N]=E.x,B[ae]=B[ve]=c.x,B[N+1]=E.y,B[ae+1]=B[ve+1]=c.y,B[N+2]=E.z,B[ae+2]=B[ve+2]=c.z,z[_e]=me,z[_e+1]=Ce,z[_e+2]=ze,z[_e+3]=Ce,z[_e+4]=We,z[_e+5]=ze,z[_e+6]=me,z[_e+7]=ze,z[_e+8]=fe,z[_e+9]=Pe,z[_e+10]=Ee,z[_e+11]=Ue,z[_e+12]=Pe,z[_e+13]=we,z[_e+14]=Ue,F[Q]=me,F[Q+1]=Ce,F[Q+2]=me,F[Q+3]=ze,F[Q+4]=We,F[Q+5]=ze,F[Q+6]=me,F[Q+7]=ze,F[Q+8]=Pe,F[Q+9]=Ce,F[Q+10]=Pe,F[Q+11]=Ue,F[Q+12]=We,F[Q+13]=Ue,F[Q+14]=Pe,F[Q+15]=we,F[Q+16]=Pe,F[Q+17]=Ue,F[Q+18]=we,F[Q+19]=Ue,a.faceidx+=15,a.lineidx+=20}static updateBoundingFromPoints(r,e,t,n){r.center.set(0,0,0);let o=1/0,h=1/0,f=1/0,i=-1/0,s=-1/0,a=-1/0;r.box&&(o=r.box.min.x,i=r.box.max.x,h=r.box.min.y,s=r.box.max.y,f=r.box.min.z,a=r.box.max.z);for(let T=0,L=n;T<L;T++){var c=t[T*3],u=t[T*3+1],E=t[T*3+2];c<o&&(o=c),u<h&&(h=u),E<f&&(f=E),c>i&&(i=c),u>s&&(s=u),E>a&&(a=E)}r.center.set((i+o)/2,(s+h)/2,(a+f)/2),r.radius=r.center.distanceTo({x:i,y:s,z:a}),r.box={min:{x:o,y:h,z:f},max:{x:i,y:s,z:a}}}static addCustomGeo(r,e,t,n,o){var h=e.addGeoGroup(),f=t.vertexArr,i=t.normalArr,s=t.faceArr;h.vertices=f.length,h.faceidx=s.length;var a,c,u,E,T,L,P,I,z,B=h.vertexArray,F=h.colorArray;for(n.constructor!==Array&&(I=n.r,z=n.g,E=n.b),L=0,P=h.vertices;L<P;++L)a=L*3,c=f[L],B[a]=c.x,B[a+1]=c.y,B[a+2]=c.z,n.constructor===Array&&(T=n[L],I=T.r,z=T.g,E=T.b),F[a]=I,F[a+1]=z,F[a+2]=E;if(o)for(L=0,P=h.faceidx/3;L<P;++L){a=L*3,u=s[a],E=s[a+1],T=s[a+2];var W=new w.Vector3,U=new w.Vector3,R=new w.Vector3;r.intersectionShape.triangle.push(new S.Triangle(W.copy(f[u]),U.copy(f[E]),R.copy(f[T])))}if(o){var V=new w.Vector3(0,0,0),q=0;for(let ie=0;ie<e.geometryGroups.length;ie++)V.add(e.geometryGroups[ie].getCentroid()),q++;V.divideScalar(q),_.updateBoundingFromPoints(r.boundingSphere,{centroid:V},B,h.vertices)}if(h.faceArray=new Uint16Array(s),h.truncateArrayBuffers(!0,!0),i.length<h.vertices)h.setNormals();else{var ee=h.normalArray=new Float32Array(h.vertices*3),se;for(L=0,P=h.vertices;L<P;++L)a=L*3,se=i[L],ee[a]=se.x,ee[a+1]=se.y,ee[a+2]=se.z}h.setLineIndices(),h.lineidx=h.lineArray.length}static updateFromStyle(r,e){typeof e.color<"u"?(r.color=e.color||new O.Color,e.color instanceof O.Color||(r.color=O.CC.color(e.color))):r.color=O.CC.color(0),r.wireframe=!!e.wireframe,r.opacity=e.alpha?(0,w.clamp)(e.alpha,0,1):1,typeof e.opacity<"u"&&(r.opacity=(0,w.clamp)(e.opacity,0,1)),r.side=e.side!==void 0?e.side:A.DoubleSide,r.linewidth=typeof e.linewidth>"u"?1:e.linewidth,r.clickable=!!e.clickable,r.callback=(0,b.makeFunction)(e.callback),r.hoverable=!!e.hoverable,r.hover_callback=(0,b.makeFunction)(e.hover_callback),r.unhover_callback=(0,b.makeFunction)(e.unhover_callback),r.contextMenuEnabled=!!e.contextMenuEnabled,r.hidden=e.hidden,r.frame=e.frame}constructor(r){this.color=16777215,this.hidden=!1,this.wireframe=!1,this.opacity=1,this.linewidth=1,this.clickable=!1,this.hoverable=!1,this.contextMenuEnabled=!1,this.side=A.DoubleSide,this.stylespec=r||{},this.boundingSphere=new S.Sphere,this.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},_.updateFromStyle(this,this.stylespec),this.components=[],this.shapeObj=null,this.renderedShapeObj=null,this.geo=new A.Geometry(!0),this.linegeo=new A.Geometry(!0)}updateStyle(r){for(var e in r)this.stylespec[e]=r[e];if(_.updateFromStyle(this,this.stylespec),r.voldata&&r.volscheme){(0,b.adjustVolumeStyle)(r);const t=r.volscheme,n=r.voldata,o=O.CC,h=t.range()||[-1,1];this.geo.setColors(function(f,i,s){let a=n.getVal(f,i,s);return o.color(t.valueToHex(a,h))}),delete this.color}}addCustom(r){r.vertexArr=r.vertexArr||[],r.faceArr=r.faceArr||[],r.normalArr=r.normalArr||[],_.drawCustom(this,this.geo,r)}addSphere(r){r.center||(r.center=new w.Vector3(0,0,0)),r.radius=r.radius?(0,w.clamp)(r.radius,0,1/0):1.5,r.color=O.CC.color(r.color),this.intersectionShape.sphere.push(new S.Sphere(r.center,r.radius)),M.GLDraw.drawSphere(this.geo,r.center,r.radius,r.color,r.quality),this.components.push({centroid:new w.Vector3(r.center.x,r.center.y,r.center.z)});var e=this.geo.updateGeoGroup(0);_.updateBoundingFromPoints(this.boundingSphere,this.components,e.vertexArray,e.vertices)}addBox(r){var e=r.dimensions||{w:1,h:1,d:1},t;typeof e.w=="number"?t={x:e.w,y:0,z:0}:t=e.w;var n;typeof e.h=="number"?n={x:0,y:e.h,z:0}:n=e.h;var o;typeof e.d=="number"?o={x:0,y:0,z:e.d}:o=e.d;var h=r.corner;h==null&&(r.center!==void 0?h={x:r.center.x-.5*(t.x+n.x+o.x),y:r.center.y-.5*(t.y+n.y+o.y),z:r.center.z-.5*(t.z+n.z+o.z)}:h={x:0,y:0,z:0});var f=[{x:h.x,y:h.y,z:h.z},{x:h.x+t.x,y:h.y+t.y,z:h.z+t.z},{x:h.x+n.x,y:h.y+n.y,z:h.z+n.z},{x:h.x+t.x+n.x,y:h.y+t.y+n.y,z:h.z+t.z+n.z},{x:h.x+o.x,y:h.y+o.y,z:h.z+o.z},{x:h.x+t.x+o.x,y:h.y+t.y+o.y,z:h.z+t.z+o.z},{x:h.x+n.x+o.x,y:h.y+n.y+o.y,z:h.z+n.z+o.z},{x:h.x+t.x+n.x+o.x,y:h.y+t.y+n.y+o.y,z:h.z+t.z+n.z+o.z}],i=[],s=[];i.splice(i.length,0,f[0],f[1],f[2],f[3]),s.splice(s.length,0,0,2,1,1,2,3);var a=4;i.splice(i.length,0,f[2],f[3],f[6],f[7]),s.splice(s.length,0,a+0,a+2,a+1,a+1,a+2,a+3),a+=4,i.splice(i.length,0,f[4],f[5],f[0],f[1]),s.splice(s.length,0,a+0,a+2,a+1,a+1,a+2,a+3),a+=4,i.splice(i.length,0,f[6],f[7],f[4],f[5]),s.splice(s.length,0,a+0,a+2,a+1,a+1,a+2,a+3),a+=4,i.splice(i.length,0,f[3],f[1],f[7],f[5]),s.splice(s.length,0,a+0,a+2,a+1,a+1,a+2,a+3),a+=4,i.splice(i.length,0,f[2],f[6],f[0],f[4]),s.splice(s.length,0,a+0,a+2,a+1,a+1,a+2,a+3),a+=4;var c=(0,b.extend)({},r);c.vertexArr=i,c.faceArr=s,c.normalArr=[],_.drawCustom(this,this.geo,c);var u=new w.Vector3;this.components.push({centroid:u.addVectors(f[0],f[7]).multiplyScalar(.5)});var E=this.geo.updateGeoGroup(0);_.updateBoundingFromPoints(this.boundingSphere,this.components,E.vertexArray,E.vertices)}addCylinder(r){var e,t;r.start?e=new w.Vector3(r.start.x||0,r.start.y||0,r.start.z||0):e=new w.Vector3(0,0,0),r.end?(t=new w.Vector3(r.end.x,r.end.y||0,r.end.z||0),typeof t.x>"u"&&(t.x=3)):t=new w.Vector3(0,0,0);var n=r.radius||.1,o=O.CC.color(r.color);this.intersectionShape.cylinder.push(new S.Cylinder(e,t,n)),M.GLDraw.drawCylinder(this.geo,e,t,n,o,r.fromCap,r.toCap);var h=new w.Vector3;this.components.push({centroid:h.addVectors(e,t).multiplyScalar(.5)});var f=this.geo.updateGeoGroup(0);_.updateBoundingFromPoints(this.boundingSphere,this.components,f.vertexArray,f.vertices)}addDashedCylinder(r){r.dashLength=r.dashLength||.25,r.gapLength=r.gapLength||.25;var e;r.start?e=new w.Vector3(r.start.x||0,r.start.y||0,r.start.z||0):e=new w.Vector3(0,0,0);var t;r.end?(t=new w.Vector3(r.end.x,r.end.y||0,r.end.z||0),typeof t.x>"u"&&(t.x=3)):t=new w.Vector3(3,0,0);for(var n=r.radius||.1,o=O.CC.color(r.color),h=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)+Math.pow(e.z-t.z,2)),f=h/(r.gapLength+r.dashLength),i=new w.Vector3(r.start.x||0,r.start.y||0,r.start.z||0),s=new w.Vector3(r.end.x,r.end.y||0,r.end.z||0),a=new w.Vector3((t.x-e.x)/(h/r.gapLength),(t.y-e.y)/(h/r.gapLength),(t.z-e.z)/(h/r.gapLength)),c=new w.Vector3((t.x-e.x)/(h/r.dashLength),(t.y-e.y)/(h/r.dashLength),(t.z-e.z)/(h/r.dashLength)),u=0;u<f;u++)s=new w.Vector3(i.x+c.x,i.y+c.y,i.z+c.z),this.intersectionShape.cylinder.push(new S.Cylinder(i,s,n)),M.GLDraw.drawCylinder(this.geo,i,s,n,o,r.fromCap,r.toCap),i=new w.Vector3(s.x+a.x,s.y+a.y,s.z+a.z);var E=new w.Vector3;this.components.push({centroid:E.addVectors(e,t).multiplyScalar(.5)});var T=this.geo.updateGeoGroup(0);_.updateBoundingFromPoints(this.boundingSphere,this.components,T.vertexArray,T.vertices)}addCurve(r){r.points=r.points||[],r.smooth=r.smooth||10,typeof r.fromCap>"u"&&(r.fromCap=2),typeof r.toCap>"u"&&(r.toCap=2);var e=(0,v.subdivide_spline)(r.points,r.smooth);if(e.length<3){console.log("Too few points in addCurve");return}var t=r.radius||.1,n=O.CC.color(r.color),o=0,h=e.length-1,f=e[0].distanceTo(e[1]),i=Math.ceil(2*t/f);if(r.toArrow){h-=i;let u={start:e[h],end:e[e.length-1],radius:t,color:n,mid:1e-4};this.addArrow(u)}if(r.fromArrow){o+=i;let u={start:e[o],end:e[0],radius:t,color:n,mid:1e-4};this.addArrow(u)}for(var s=Math.ceil(e.length/2),a={radius:t,color:n,fromCap:2,toCap:2},c=o;c<h;c++)a.start=e[c],a.end=e[c+1],a.fromCap=2,a.toCap=2,c<s?(a.fromCap=2,a.toCap=0):c>s?(a.fromCap=0,a.toCap=2):(a.fromCap=2,a.toCap=2),this.addCylinder(a)}addLine(r){var e,t;r.start?e=new w.Vector3(r.start.x||0,r.start.y||0,r.start.z||0):e=new w.Vector3(0,0,0),r.end?(t=new w.Vector3(r.end.x,r.end.y||0,r.end.z||0),typeof t.x>"u"&&(t.x=3)):t=new w.Vector3(3,0,0);var n=this.geo.updateGeoGroup(2),o=n.vertices,h=o*3,f=n.vertexArray;f[h]=e.x,f[h+1]=e.y,f[h+2]=e.z,f[h+3]=t.x,f[h+4]=t.y,f[h+5]=t.z,n.vertices+=2;var i=n.lineArray,s=n.lineidx;i[s]=o,i[s+1]=o+1,n.lineidx+=2;var a=new w.Vector3;this.components.push({centroid:a.addVectors(e,t).multiplyScalar(.5)}),n=this.geo.updateGeoGroup(0),_.updateBoundingFromPoints(this.boundingSphere,this.components,n.vertexArray,n.vertices)}addArrow(r){if(r.start?r.start=new w.Vector3(r.start.x||0,r.start.y||0,r.start.z||0):r.start=new w.Vector3(0,0,0),r.dir instanceof w.Vector3&&typeof r.length=="number"){var e=r.dir.clone().multiplyScalar(r.length).add(r.start);r.end=e}else r.end?(r.end=new w.Vector3(r.end.x,r.end.y||0,r.end.z||0),typeof r.end.x>"u"&&(r.end.x=3)):r.end=new w.Vector3(3,0,0);r.radius=r.radius||.1,r.radiusRatio=r.radiusRatio||1.618034,r.mid=0<r.mid&&r.mid<1?r.mid:.618034,_.drawArrow(this,this.geo,r);var t=new w.Vector3;this.components.push({centroid:t.addVectors(r.start,r.end).multiplyScalar(.5)});var n=this.geo.updateGeoGroup(0);_.updateBoundingFromPoints(this.boundingSphere,this.components,n.vertexArray,n.vertices)}static distance_from(r,e){return Math.sqrt(Math.pow(r.x-e.x,2)+Math.pow(r.y-e.y,2)+Math.pow(r.z-e.z,2))}static inSelectedRegion(r,e,t){for(var n=0;n<e.length;n++)if(_.distance_from(e[n],r)<=t)return!0;return!1}addIsosurface(r,e,t,n){var o=e.isoval!==void 0&&typeof e.isoval=="number"?e.isoval:0,h=!!e.voxel,f=e.smoothness===void 0?1:e.smoothness,i=r.size.x,s=r.size.y,a=r.size.z,c=new Int16Array(i*s*a),u=r.data,E,T;for(E=0,T=c.length;E<T;++E)c[E]=-1;var L=new Uint8Array(i*s*a);for(E=0,T=u.length;E<T;++E){var P=o>=0?u[E]-o:o-u[E];P>0&&(L[E]|=_.ISDONE)}var I=[],z=[];p.MarchingCube.march(L,I,z,{fulltable:!0,voxel:h,unitCube:r.unit,origin:r.origin,matrix:r.matrix,nX:i,nY:s,nZ:a}),!h&&f>0&&p.MarchingCube.laplacianSmooth(f,I,z);var B=[],F=[],W=[];if(e.selectedRegion&&e.coords===void 0&&(e.coords=e.selectedRegion),e.coords===void 0&&e.selection!==void 0&&(n?e.coords=n.selectedAtoms(e.selection):console.log("addIsosurface needs viewer is selection provided.")),e.coords!==void 0){var U=e.coords[0].x,R=e.coords[0].y,V=e.coords[0].z,q=e.coords[0].x,ee=e.coords[0].y,se=e.coords[0].z;for(let Q=0;Q<e.coords.length;Q++)e.coords[Q].x>U?U=e.coords[Q].x:e.coords[Q].x<q&&(q=e.coords[Q].x),e.coords[Q].y>R?R=e.coords[Q].y:e.coords[Q].y<ee&&(ee=e.coords[Q].y),e.coords[Q].z>V?V=e.coords[Q].z:e.coords[Q].z<se&&(se=e.coords[Q].z);var ie=2;e.radius!==void 0&&(ie=e.radius),e.selectedOffset!==void 0&&(ie=e.selectedOffset),e.seldist!==void 0&&(ie=e.seldist),q-=ie,U+=ie,ee-=ie,R+=ie,se-=ie,V+=ie;for(let Q=0;Q<I.length;Q++)I[Q].x>q&&I[Q].x<U&&I[Q].y>ee&&I[Q].y<R&&I[Q].z>se&&I[Q].z<V&&_.inSelectedRegion(I[Q],e.coords,ie)?(B.push(F.length),F.push(I[Q])):B.push(-1);for(let Q=0;Q+2<z.length;Q+=3)B[z[Q]]!==-1&&B[z[Q+1]]!==-1&&B[z[Q+2]]!==-1&&(W.push(z[Q]-(z[Q]-B[z[Q]])),W.push(z[Q+1]-(z[Q+1]-B[z[Q+1]])),W.push(z[Q+2]-(z[Q+2]-B[z[Q+2]])));I=F,z=W}_.drawCustom(this,this.geo,{vertexArr:I,faceArr:z,normalArr:[],clickable:e.clickable,hoverable:e.hoverable}),this.updateStyle(e);var le=new w.Vector3(r.origin.x,r.origin.y,r.origin.z),re=new w.Vector3(r.size.x*r.unit.x,r.size.y*r.unit.y,r.size.z*r.unit.z),oe=new w.Vector3(0,0,0),Ae=le.clone(),Me=le.clone().add(re);for(let Q=0;Q<I.length;Q++)oe.add(I[Q]),Ae.max(I[Q]),Me.min(I[Q]);oe.divideScalar(I.length);var Oe=oe.distanceTo(Me),_e=oe.distanceTo(Ae);this.boundingSphere.center=oe,this.boundingSphere.radius=Math.max(Oe,_e),typeof t=="function"&&t()}addVolumetricData(r,e,t){r=new x.VolumeData(r,e),this.addIsosurface(r,t)}finalize(){return _.finalizeGeo(this.geo),this.geo.initTypedArrays(),this.geo}globj(r){if(this.renderedShapeObj&&(r.remove(this.renderedShapeObj),this.renderedShapeObj=null),!this.hidden){_.finalizeGeo(this.geo),this.geo.initTypedArrays(),this.wireframe&&this.geo.setUpWireframe(),typeof this.color<"u"&&_.updateColor(this.geo,this.color),this.shapeObj=new A.Object3D;var e=null;this.side==A.DoubleSide?e=new A.MeshDoubleLambertMaterial({wireframe:this.wireframe,side:this.side,transparent:this.opacity<1,opacity:this.opacity,wireframeLinewidth:this.linewidth,vertexColors:A.Coloring.VertexColors}):e=new A.MeshLambertMaterial({wireframe:this.wireframe,side:this.side,transparent:this.opacity<1,opacity:this.opacity,wireframeLinewidth:this.linewidth,vertexColors:A.Coloring.VertexColors});var t=new A.Mesh(this.geo,e);if(this.shapeObj.add(t),this.linegeo&&this.linegeo.vertices>0){var n=new A.LineBasicMaterial({linewidth:this.linewidth,color:this.color}),o=new A.Line(this.linegeo,n,A.LineStyle.LinePieces);this.shapeObj.add(o)}this.renderedShapeObj=this.shapeObj.clone(),r.add(this.renderedShapeObj)}}removegl(r){this.renderedShapeObj&&(this.renderedShapeObj.geometry!==void 0&&this.renderedShapeObj.geometry.dispose(),this.renderedShapeObj.material!==void 0&&this.renderedShapeObj.material.dispose(),r.remove(this.renderedShapeObj),this.renderedShapeObj=null),this.shapeObj=null}get position(){return this.boundingSphere.center}get x(){return this.boundingSphere.center.x}get y(){return this.boundingSphere.center.y}get z(){return this.boundingSphere.center.z}}_.ISDONE=2,_.drawCustom=function(m,r,e){var t=e,n=t.vertexArr,o=t.faceArr;(n.length===0||o.length===0)&&console.warn("Error adding custom shape component: No vertices and/or face indices supplied!");var h=e.color;typeof h>"u"&&(h=m.color),h=O.CC.color(h);for(var f=g(t),i=0,s=f.length;i<s;i++)_.addCustomGeo(m,r,f[i],f[i].colorArr?f[i].colorArr:h,e.clickable)};function g(m){var r=64e3;if(m.vertexArr.length<r)return[m];var e=[{vertexArr:[],normalArr:[],faceArr:[]}];m.colorArr&&(e.colorArr=[]);var t=[],n=[],o=0,h=m.faceArr;for(let i=0,s=h.length;i<s;i+=3){let a=e[o];for(let c=0;c<3;c++){var f=h[i+c];t[f]!==o&&(t[f]=o,n[f]=a.vertexArr.length,a.vertexArr.push(m.vertexArr[f]),m.normalArr&&m.normalArr[f]&&a.normalArr.push(m.normalArr[f]),m.colorArr&&m.colorArr[f]&&a.colorArr.push(m.colorArr[f])),a.faceArr.push(n[f])}a.vertexArr.length>=r&&(e.push({vertexArr:[],normalArr:[],faceArr:[]}),m.colorArr&&(e.colorArr=[]),o++)}return e}},"./src/GLViewer.ts":(K,C,d)=>{d.r(C),d.d(C,{CONTEXTS_PER_VIEWPORT:()=>r,GLViewer:()=>t,createStereoViewer:()=>h,createViewer:()=>n,createViewerGrid:()=>o});var A=d("./node_modules/upng-js/UPNG.js"),S=d("./src/GLModel.ts"),w=d("./src/GLShape.ts"),O=d("./src/Gradient.ts"),p=d("./src/Label.ts"),x=d("./src/ProteinSurface4.ts"),M=d("./src/VolumeData.ts"),v=d("./src/VolumetricRender.ts"),b=d("./src/WebGL/index.ts"),_=d("./src/WebGL/math/index.ts"),g=d("./src/colors.ts"),m=d("./src/utilities.ts");const r=16;class e extends Array{constructor(i){super(...i)}getSymmetries(){if(this.length==0)return[];let i=this[0];return typeof i.symmetries>"u"&&this.setSymmetries([new _.Matrix4]),i.symmetries}setSymmetries(i){typeof i>"u"&&(i=[new _.Matrix4]);for(let s of this)s.symmetries=i,s.finished=!1}}class t{getWidth(){let i=this.container,s=i.offsetWidth;if(s==0&&i.style.display==="none"){let a=i.style.position,c=i.style.visibility;i.style.display="block",i.style.visibility="hidden",i.style.position="absolute",s=i.offsetWidth,i.style.display="none",i.style.visibility=c,i.style.position=a}return s}getHeight(){let i=this.container,s=i.offsetHeight;if(s==0&&i.style.display==="none"){let a=i.style.position,c=i.style.visibility;i.style.display="block",i.style.visibility="hidden",i.style.position="absolute",s=i.offsetHeight,i.style.display="none",i.style.visibility=c,i.style.position=a}return s}setupRenderer(){let i=Object.assign(Object.assign({},this.config),{preserveDrawingBuffer:!0,premultipliedAlpha:!1,containerWidth:this.WIDTH,containerHeight:this.HEIGHT});this.renderer=new b.Renderer(i),this.renderer.domElement.style.width="100%",this.renderer.domElement.style.height="100%",this.renderer.domElement.style.padding="0",this.renderer.domElement.style.position="absolute",this.renderer.domElement.style.top="0px",this.renderer.domElement.style.left="0px",this.renderer.domElement.style.zIndex="0"}initializeScene(){this.scene=new b.Scene,this.scene.fog=new b.Fog(this.bgColor,100,200),this.modelGroup=new b.Object3D,this.rotationGroup=new b.Object3D,this.rotationGroup.useQuaternion=!0,this.rotationGroup.quaternion=new _.Quaternion(0,0,0,1),this.rotationGroup.add(this.modelGroup),this.scene.add(this.rotationGroup);var i=new b.Light(16777215);i.position=new _.Vector3(.2,.2,1).normalize(),i.intensity=1,this.scene.add(i)}_handleLostContext(i){const s=function(a){const c=a.getBoundingClientRect();return!(c.right<0||c.bottom<0||c.top>(window.innerHeight||document.documentElement.clientHeight)||c.left>(window.innerWidth||document.documentElement.clientWidth))};if(s(this.container)){let a=0;for(let c of document.getElementsByTagName("canvas"))if(s(c)&&c._3dmol_viewer!=null&&(c._3dmol_viewer.resize(),a+=1,a>=r))break}}initContainer(i){this.container=i,this.WIDTH=this.getWidth(),this.HEIGHT=this.getHeight(),this.ASPECT=this.renderer.getAspect(this.WIDTH,this.HEIGHT),this.renderer.setSize(this.WIDTH,this.HEIGHT),this.container.append(this.renderer.domElement),this.glDOM=this.renderer.domElement,this.glDOM._3dmol_viewer=this,this.glDOM.addEventListener("webglcontextlost",this._handleLostContext.bind(this)),this.nomouse||(this.glDOM.addEventListener("mousedown",this._handleMouseDown.bind(this),{passive:!1}),this.glDOM.addEventListener("touchstart",this._handleMouseDown.bind(this),{passive:!1}),this.glDOM.addEventListener("wheel",this._handleMouseScroll.bind(this),{passive:!1}),this.glDOM.addEventListener("mousemove",this._handleMouseMove.bind(this),{passive:!1}),this.glDOM.addEventListener("touchmove",this._handleMouseMove.bind(this),{passive:!1}),this.glDOM.addEventListener("contextmenu",this._handleContextMenu.bind(this),{passive:!1}))}decAnim(){this.animated--,this.animated<0&&(this.animated=0)}incAnim(){this.animated++}nextSurfID(){var i=0;for(let a in this.surfaces)if(this.surfaces.hasOwnProperty(a)){var s=parseInt(a);isNaN(s)||s>i&&(i=s)}return i+1}setSlabAndFog(){let i=this.camera.position.z-this.rotationGroup.position.z;i<1&&(i=1),this.camera.near=i+this.slabNear,!this.camera.ortho&&this.camera.near<1&&(this.camera.near=1),this.camera.far=i+this.slabFar,this.camera.near+1>this.camera.far&&(this.camera.far=this.camera.near+1),this.camera.fov=this.fov,this.camera.right=i*Math.tan(Math.PI/180*this.fov),this.camera.left=-this.camera.right,this.camera.top=this.camera.right/this.ASPECT,this.camera.bottom=-this.camera.top,this.camera.updateProjectionMatrix(),this.scene.fog.near=this.camera.near+this.fogStart*(this.camera.far-this.camera.near),this.scene.fog.far=this.camera.near+this.fogEnd*(this.camera.far-this.camera.near),this.config.disableFog&&(this.scene.fog.near=this.scene.fog.far)}show(i){if(this.renderer.setViewport(),!!this.scene&&(this.setSlabAndFog(),this.renderer.render(this.scene,this.camera),this.viewChangeCallback&&this.viewChangeCallback(this._viewer.getView()),!i&&this.linkedViewers.length>0))for(var s=this._viewer.getView(),a=0;a<this.linkedViewers.length;a++){var c=this.linkedViewers[a];c.setView(s,!0)}}updateClickables(){this.clickables.splice(0,this.clickables.length),this.hoverables.splice(0,this.hoverables.length),this.contextMenuEnabledObjects.splice(0,this.contextMenuEnabledObjects.length);for(let i=0,s=this.models.length;i<s;i++){let a=this.models[i];if(a){let c=a.selectedAtoms({clickable:!0}),u=a.selectedAtoms({hoverable:!0}),E=a.selectedAtoms({contextMenuEnabled:!0});for(let T=0;T<u.length;T++)this.hoverables.push(u[T]);for(let T=0;T<c.length;T++)this.clickables.push(c[T]);for(let T=0;T<E.length;T++)this.contextMenuEnabledObjects.push(E[T])}}for(let i=0,s=this.shapes.length;i<s;i++){let a=this.shapes[i];a&&a.clickable&&this.clickables.push(a),a&&a.hoverable&&this.hoverables.push(a),a&&a.contextMenuEnabled&&this.contextMenuEnabledObjects.push(a)}}handleClickSelection(i,s,a){let c=this.targetedObjects(i,s,this.clickables);if(c.length){var u=c[0].clickable;u.callback!==void 0&&(typeof u.callback!="function"&&(u.callback=(0,m.makeFunction)(u.callback)),typeof u.callback=="function"&&(this.mouseButton===3&&this.contextMenuEnabledObjects.includes(u)&&this.userContextMenuHandler||u.callback(u,this._viewer,a,this.container,c)))}}canvasOffset(){let i=this.glDOM,s=i.getBoundingClientRect(),a=i.ownerDocument,c=a.documentElement,u=a.defaultView;return{top:s.top+u.pageYOffset-c.clientTop,left:s.left+u.pageXOffset-c.clientLeft}}setHover(i,s,a){this.current_hover!=i&&(this.current_hover&&(typeof this.current_hover.unhover_callback!="function"&&(this.current_hover.unhover_callback=(0,m.makeFunction)(this.current_hover.unhover_callback)),this.current_hover.unhover_callback(this.current_hover,this._viewer,s,this.container,a)),this.current_hover=i,i&&i.hover_callback!==void 0&&(typeof i.hover_callback!="function"&&(i.hover_callback=(0,m.makeFunction)(i.hover_callback)),typeof i.hover_callback=="function"&&i.hover_callback(i,this._viewer,s,this.container,a)))}handleHoverSelection(i,s,a){if(this.hoverables.length==0)return;let c=this.targetedObjects(i,s,this.hoverables);if(c.length){var u=c[0].clickable;this.setHover(u,a,c),this.current_hover=u}else this.setHover(null)}handleHoverContinue(i,s){let a=this.targetedObjects(i,s,this.hoverables);(a.length==0||a[0]===void 0)&&this.setHover(null),a[0]!==void 0&&a[0].clickable!==this.current_hover&&this.setHover(null)}closeEnoughForClick(i,{allowTolerance:s=i.targetTouches,tolerance:a=5}={}){const c=this.getX(i),u=this.getY(i);if(s){const E=Math.abs(c-this.mouseStartX),T=Math.abs(u-this.mouseStartY);return E<=a&&T<=a}else return c===this.mouseStartX&&u===this.mouseStartY}calcTouchDistance(i){var s=i.targetTouches[0].pageX-i.targetTouches[1].pageX,a=i.targetTouches[0].pageY-i.targetTouches[1].pageY;return Math.hypot(s,a)}getX(i){var s=i.pageX;return s==null&&(s=i.pageX),i.targetTouches&&i.targetTouches[0]?s=i.targetTouches[0].pageX:i.changedTouches&&i.changedTouches[0]&&(s=i.changedTouches[0].pageX),s}getY(i){var s=i.pageY;return s==null&&(s=i.pageY),i.targetTouches&&i.targetTouches[0]?s=i.targetTouches[0].pageY:i.changedTouches&&i.changedTouches[0]&&(s=i.changedTouches[0].pageY),s}isInViewer(i,s){if(this.viewers!=null){var a=this.WIDTH/this.cols,c=this.HEIGHT/this.rows,u=this.canvasOffset(),E=i-u.left,T=s-u.top,L=this.rows-Math.floor(T/c)-1,P=Math.floor(E/a);if(L!=this.row||P!=this.col)return!1}return!0}adjustZoomToLimits(i){if(this.config.lowerZoomLimit&&this.config.lowerZoomLimit>0){let s=this.CAMERA_Z-this.config.lowerZoomLimit;i>s&&(i=s)}if(this.config.upperZoomLimit&&this.config.upperZoomLimit>0){let s=this.CAMERA_Z-this.config.upperZoomLimit;i<s&&(i=s)}return i>this.CAMERA_Z-1&&(i=this.CAMERA_Z-1),i}static slerp(i,s,a){if(a==1)return s.clone();if(a==0)return i.clone();let c=i.x*s.x+i.y*s.y+i.z*s.z+i.w*s.w;if(c>.9995){let z=new _.Quaternion(i.x+a*(s.x-i.x),i.y+a*(s.y-i.y),i.z+a*(s.z-i.z),i.w+a*(s.w-i.w));return z.normalize(),z}c<0&&(s=s.clone().multiplyScalar(-1),c=-c),c>1?c=1:c<-1&&(c=-1);var u=Math.acos(c),E=u*a,T=s.clone();T.sub(i.clone().multiplyScalar(c)),T.normalize();var L=Math.cos(E),P=Math.sin(E),I=new _.Quaternion(i.x*L+T.x*P,i.y*L+T.y*P,i.z*L+T.z*P,i.w*L+T.w*P);return I.normalize(),I}constructor(i,s={}){if(this.nomouse=!1,this.glDOM=null,this.models=[],this.surfaces={},this.shapes=[],this.labels=[],this.clickables=[],this.hoverables=[],this.contextMenuEnabledObjects=[],this.current_hover=null,this.hoverDuration=500,this.longTouchDuration=1e3,this.viewer_frame=0,this.viewChangeCallback=null,this.stateChangeCallback=null,this.NEAR=1,this.FAR=800,this.CAMERA_Z=150,this.fov=20,this.linkedViewers=[],this.renderer=null,this.control_all=!1,this.scene=null,this.rotationGroup=null,this.modelGroup=null,this.fogStart=.4,this.fogEnd=1,this.slabNear=-50,this.slabFar=50,this.cq=new _.Quaternion(0,0,0,1),this.dq=new _.Quaternion(0,0,0,1),this.animated=0,this.animationTimers=new Set,this.isDragging=!1,this.mouseStartX=0,this.mouseStartY=0,this.touchDistanceStart=0,this.touchHold=!1,this.currentModelPos=0,this.cz=0,this.cslabNear=0,this.cslabFar=0,this.userContextMenuHandler=null,this.config=s,this.callback=this.config.callback,this.defaultcolors=this.config.defaultcolors,this.defaultcolors||(this.defaultcolors=g.elementColors.defaultColors),this.nomouse=!!this.config.nomouse,this.bgColor=0,this.config.backgroundColor=this.config.backgroundColor||"#ffffff",typeof this.config.backgroundColor<"u"&&(this.bgColor=g.CC.color(this.config.backgroundColor).getHex()),this.config.backgroundAlpha=this.config.backgroundAlpha==null?1:this.config.backgroundAlpha,this.camerax=0,typeof this.config.camerax<"u"&&(this.camerax=typeof this.config.camerax=="string"?parseFloat(this.config.camerax):this.config.camerax),this._viewer=this,this.container=i,this.config.hoverDuration!=null&&(this.hoverDuration=this.config.hoverDuration),this.config.antialias===void 0&&(this.config.antialias=!0),this.config.cartoonQuality===void 0&&(this.config.cartoonQuality=10),this.WIDTH=this.getWidth(),this.HEIGHT=this.getHeight(),this.setupRenderer(),this.row=this.config.row==null?0:this.config.row,this.col=this.config.col==null?0:this.config.col,this.cols=this.config.cols,this.rows=this.config.rows,this.viewers=this.config.viewers,this.control_all=this.config.control_all,this.ASPECT=this.renderer.getAspect(this.WIDTH,this.HEIGHT),this.camera=new b.Camera(this.fov,this.ASPECT,this.NEAR,this.FAR,this.config.orthographic),this.camera.position=new _.Vector3(this.camerax,0,this.CAMERA_Z),this.lookingAt=new _.Vector3,this.camera.lookAt(this.lookingAt),this.raycaster=new b.Raycaster(new _.Vector3(0,0,0),new _.Vector3(0,0,0)),this.projector=new b.Projector,this.initializeScene(),this.renderer.setClearColorHex(this.bgColor,this.config.backgroundAlpha),this.scene.fog.color=g.CC.color(this.bgColor),document.body.addEventListener("mouseup",this._handleMouseUp.bind(this)),document.body.addEventListener("touchend",this._handleMouseUp.bind(this)),this.initContainer(this.container),this.config.style&&this.setViewStyle(this.config),window.addEventListener("resize",this.resize.bind(this)),typeof window.ResizeObserver<"u"&&(this.divwatcher=new window.ResizeObserver(this.resize.bind(this)),this.divwatcher.observe(this.container)),typeof window.IntersectionObserver<"u"){let a=(c,u)=>{c.forEach(E=>{E.isIntersecting&&this.resize()})};this.intwatcher=new window.IntersectionObserver(a),this.intwatcher.observe(this.container)}try{typeof this.callback=="function"&&this.callback(this)}catch(a){console.log("error with glviewer callback: "+a)}}targetedObjects(i,s,a){var c={x:i,y:s,z:-1};return Array.isArray(a)||(a=this.selectedAtoms(a)),a.length==0?[]:(this.raycaster.setFromCamera(c,this.camera),this.raycaster.intersectObjects(this.modelGroup,a))}modelToScreen(i){let s=!1;Array.isArray(i)||(i=[i],s=!0);let a=this.renderer.getXRatio(),c=this.renderer.getYRatio(),u=this.col,E=this.row,T=u*(this.WIDTH/a),L=(c-E-1)*(this.HEIGHT/c),P=[],I=this.canvasOffset();return i.forEach(z=>{let B=new _.Vector3(z.x,z.y,z.z);B.applyMatrix4(this.modelGroup.matrixWorld),this.projector.projectVector(B,this.camera);let F=this.WIDTH/a*(B.x+1)/2+I.left+T,W=-(this.HEIGHT/c)*(B.y-1)/2+I.top+L;P.push({x:F,y:W})}),s&&(P=P[0]),P}screenOffsetToModel(i,s,a){var c=i/this.WIDTH,u=s/this.HEIGHT,E=a===void 0?this.rotationGroup.position.z:a,T=this.rotationGroup.quaternion,L=new _.Vector3(0,0,E);return this.projector.projectVector(L,this.camera),L.x+=c*2,L.y-=u*2,this.projector.unprojectVector(L,this.camera),L.z=0,L.applyQuaternion(T),L}screenToModelDistance(i,s){let a=this.canvasOffset(),c=new _.Vector3(s.x,s.y,s.z);c.applyMatrix4(this.modelGroup.matrixWorld);let u=c.clone();this.projector.projectVector(c,this.camera);let E=new _.Vector3((i.x-a.left)*2/this.WIDTH-1,(i.y-a.top)*2/-this.HEIGHT+1,c.z);return this.projector.unprojectVector(E,this.camera),E.distanceTo(u)}setViewChangeCallback(i){(typeof i=="function"||i==null)&&(this.viewChangeCallback=i)}setStateChangeCallback(i){(typeof i=="function"||i==null)&&(this.stateChangeCallback=i)}getConfig(){return this.config}setConfig(i){this.config=i,i.ambientOcclusion&&this.renderer.enableAmbientOcclusion(i.ambientOcclusion)}getInternalState(){var i={models:[],surfaces:[],shapes:[],labels:[]};for(let s=0;s<this.models.length;s++)this.models[s]&&(i.models[s]=this.models[s].getInternalState());return i}setInternalState(i){this.clear();var s=i.models;for(let a=0;a<s.length;a++)s[a]&&(this.models[a]=new S.GLModel(a,void 0,this),this.models[a].setInternalState(s[a]));this.render()}setZoomLimits(i,s){typeof i<"u"&&(this.config.lowerZoomLimit=i),s&&(this.config.upperZoomLimit=s),this.rotationGroup.position.z=this.adjustZoomToLimits(this.rotationGroup.position.z),this.show()}setCameraParameters(i){i.fov!==void 0&&(this.fov=i.fov,this.camera.fov=this.fov),i.z!==void 0&&(this.CAMERA_Z=i.z,this.camera.z=this.CAMERA_Z),i.orthographic!==void 0&&(this.camera.ortho=i.orthographic),this.setSlabAndFog()}_handleMouseDown(i){if(i.preventDefault(),!this.scene)return;var s=this.getX(i),a=this.getY(i);if(s===void 0)return;this.isDragging=!0,this.mouseButton=i.which,this.mouseStartX=s,this.mouseStartY=a,this.touchHold=!0,this.touchDistanceStart=0,i.targetTouches&&i.targetTouches.length==2&&(this.touchDistanceStart=this.calcTouchDistance(i)),this.cq=this.rotationGroup.quaternion.clone(),this.cz=this.rotationGroup.position.z,this.currentModelPos=this.modelGroup.position.clone(),this.cslabNear=this.slabNear,this.cslabFar=this.slabFar;let c=this;i.targetTouches&&i.targetTouches.length===1&&(this.longTouchTimeout=setTimeout(function(){if(c.touchHold==!0){c.glDOM=c.renderer.domElement;const u=i.targetTouches[0],E=new PointerEvent("contextmenu",Object.assign(Object.assign({},i),{pageX:u.pageX,pageY:u.pageY,screenX:u.screenX,screenY:u.screenY,clientX:u.clientX,clientY:u.clientY}));c.glDOM.dispatchEvent(E)}},this.longTouchDuration))}_handleMouseUp(i){if(this.touchHold=!1,this.isDragging&&this.scene){var s=this.getX(i),a=this.getY(i);if(this.closeEnoughForClick(i)&&this.isInViewer(s,a)){let c=this.mouseXY(s,a);this.handleClickSelection(c.x,c.y,i)}}this.isDragging=!1}_handleMouseScroll(i){if(i.preventDefault(),!!this.scene){var s=this.getX(i),a=this.getY(i);if(s!==void 0&&!(!this.control_all&&!this.isInViewer(s,a))){var c=(this.CAMERA_Z-this.rotationGroup.position.z)*.85,u=1;if(i.ctrlKey&&(u=-1),i.detail)this.rotationGroup.position.z+=u*c*i.detail/10;else if(i.wheelDelta){let E=i.wheelDelta*600/(i.wheelDelta+600);this.rotationGroup.position.z-=u*c*E/400}this.rotationGroup.position.z=this.adjustZoomToLimits(this.rotationGroup.position.z),this.show()}}}pngURI(){return this.getCanvas().toDataURL("image/png")}apngURI(i){let s=this;return i=i||1,new Promise(function(a){let c=0,u=s.viewChangeCallback,E=[],T=[],L=Date.now();s.viewChangeCallback=function(){T.push(Date.now()-L),L=Date.now(),E.push(new Promise(P=>{s.getCanvas().toBlob(function(I){I.arrayBuffer().then(P)},"image/png")})),c+=1,c==i&&(s.viewChangeCallback=u,Promise.all(E).then(P=>{let I=[];for(let R=0;R<P.length;R++){let V=(0,A.decode)(P[R]);I.push((0,A.toRGBA8)(V)[0])}let z=s.getCanvas().width,B=s.getCanvas().height,F=(0,A.encode)(I,z,B,0,T),W=new Blob([F],{type:"image/png"}),U=new FileReader;U.onload=function(R){a(R.target.result)},U.readAsDataURL(W)}))}})}getCanvas(){return this.glDOM}getRenderer(){return this.renderer}setHoverDuration(i){this.hoverDuration=i}mouseXY(i,s){let a=this.canvasOffset(),c=this.renderer.getXRatio(),u=this.renderer.getYRatio(),E=this.col,T=this.row,L=E*(this.WIDTH/c),P=(u-T-1)*(this.HEIGHT/u),I=(i-a.left-L)/(this.WIDTH/c)*2-1,z=-((s-a.top-P)/(this.HEIGHT/u))*2+1;return{x:I,y:z}}_handleMouseMove(i){clearTimeout(this.hoverTimeout),i.preventDefault();let s=this.getX(i),a=this.getY(i);if(s===void 0)return;let c=this.renderer.getXRatio(),u=this.renderer.getYRatio(),E=this.mouseXY(s,a),T=this;this.current_hover!==null&&this.handleHoverContinue(E.x,E.y);var L=0;if(!(!this.control_all&&!this.isInViewer(s,a))&&this.scene&&(this.hoverables.length>0&&(this.hoverTimeout=setTimeout(function(){T.handleHoverSelection(E.x,E.y,i)},this.hoverDuration)),!!this.isDragging)){i.targetTouches&&(i.targetTouches.length>1||i.targetTouches.length===1&&!this.closeEnoughForClick(i))&&clearTimeout(this.longTouchTimeout);var P=(s-this.mouseStartX)/this.WIDTH,I=(a-this.mouseStartY)/this.HEIGHT;if(this.touchDistanceStart!=0&&i.targetTouches&&i.targetTouches.length==2){var z=this.calcTouchDistance(i);L=2,I=(z-this.touchDistanceStart)*2/(this.WIDTH+this.HEIGHT)}else i.targetTouches&&i.targetTouches.length==3&&(L=1);P*=c,I*=u;var B=Math.hypot(P,I),F;if(L==3||this.mouseButton==3&&i.ctrlKey)this.slabNear=this.cslabNear+P*100,this.slabFar=this.cslabFar-I*100;else if(L==2||this.mouseButton==3||i.shiftKey)F=(this.CAMERA_Z-this.rotationGroup.position.z)*.85,F<80&&(F=80),this.rotationGroup.position.z=this.cz+I*F,this.rotationGroup.position.z=this.adjustZoomToLimits(this.rotationGroup.position.z);else if(L==1||this.mouseButton==2||i.ctrlKey){var W=this.screenOffsetToModel(c*(s-this.mouseStartX),u*(a-this.mouseStartY));this.modelGroup.position.addVectors(this.currentModelPos,W)}else if((L===0||this.mouseButton==1)&&B!==0){var U=Math.sin(B*Math.PI)/B;this.dq.x=Math.cos(B*Math.PI),this.dq.y=0,this.dq.z=U*P,this.dq.w=-U*I,this.rotationGroup.quaternion.set(1,0,0,0),this.rotationGroup.quaternion.multiply(this.dq),this.rotationGroup.quaternion.multiply(this.cq)}this.show()}}_handleContextMenu(i){if(i.preventDefault(),this.closeEnoughForClick(i)){var c=this.mouseStartX,u=this.mouseStartY,a=this.canvasOffset();let E=this.mouseXY(c,u),T=E.x,L=E.y,P=this.targetedObjects(T,L,this.contextMenuEnabledObjects);var s=null;P.length&&(s=P[0].clickable);var a=this.canvasOffset(),c=this.mouseStartX-a.left,u=this.mouseStartY-a.top;this.userContextMenuHandler&&(this.userContextMenuHandler(s,c,u,P,i),this.isDragging=!1)}}setContainer(i){let s=(0,m.getElement)(i)||this.container;return this.initContainer(s),this}setBackgroundColor(i,s){(typeof s>"u"||s<0||s>1)&&(s=1);var a=g.CC.color(i);return this.scene.fog.color=a,this.bgColor=a.getHex(),this.renderer.setClearColorHex(a.getHex(),s),this.show(),this}setProjection(i){this.camera.ortho=i==="orthographic",this.setSlabAndFog()}setViewStyle(i){if(i=i||{},i.style=i.style||"",i.style.includes("outline")?this.renderer.enableOutline(i):this.renderer.disableOutline(),i.style.includes("ambientOcclusion")){var s={};i.strength&&(s.strength=i.strength),i.radius&&(s.radius=i.radius),this.renderer.enableAmbientOcclusion(s)}else this.renderer.disableAmbientOcclusion();return this}updateSize(){this.renderer.setSize(this.WIDTH,this.HEIGHT),this.ASPECT=this.renderer.getAspect(this.WIDTH,this.HEIGHT),this.renderer.setSize(this.WIDTH,this.HEIGHT),this.camera.aspect=this.ASPECT,this.camera.updateProjectionMatrix()}setWidth(i){return this.WIDTH=i||this.WIDTH,this.updateSize(),this}setHeight(i){return this.HEIGHT=i||this.HEIGHT,this.updateSize(),this}resize(){this.WIDTH=this.getWidth(),this.HEIGHT=this.getHeight();let i=!1;if(this.renderer.isLost()&&this.WIDTH>0&&this.HEIGHT>0){let s=!1,a=this.container.querySelector("canvas");a&&a!=this.renderer.getCanvas()?this.config.canvas=a:(a.remove(),this.config&&this.config.canvas!=null&&(delete this.config.canvas,s=!0)),this.setupRenderer(),this.initContainer(this.container),this.renderer.setClearColorHex(this.bgColor,this.config.backgroundAlpha),i=!0,s&&(this.config.canvas=this.renderer.getCanvas())}if(this.WIDTH==0||this.HEIGHT==0?this.animated&&this._viewer.pauseAnimate():this.animated&&this._viewer.resumeAnimate(),this.updateSize(),i){let s=this.renderer.supportedExtensions();if(s.regen=!0,this.viewers)for(let a=0,c=this.viewers.length;a<c;a++)for(let u=0,E=this.viewers[a].length;u<E;u++)this.viewers[a][u].render(null,s);this._viewer.render(null,s)}else this.WIDTH>0&&this.HEIGHT>0&&this.show();return this}getModel(i){return i===void 0?this.models.length==0?null:this.models[this.models.length-1]:i instanceof S.GLModel?i:i in this.models?this.models[i]:this.models.length==0?null:this.models[this.models.length-1]}spin(i,s=1,a=!1){if(clearInterval(this.spinInterval),typeof i>"u"&&(i="y"),typeof i=="boolean")if(i)i="y";else return;Array.isArray(i)&&(i={x:i[0],y:i[1],z:i[2]});var c=this;this.spinInterval=setInterval(function(){!c.getCanvas().isConnected&&c.renderer.isLost()&&clearInterval(c.spinInterval),(!a||c.container.checkVisibility&&c.container.checkVisibility())&&c.rotate(1*s,i)},25)}animateMotion(i,s,a,c,u,E){var T=20,L=Math.ceil(i/T);L<1&&(L=1),this.incAnim();var P={mpos:this.modelGroup.position.clone(),rz:this.rotationGroup.position.z,rot:this.rotationGroup.quaternion.clone(),cam:this.lookingAt.clone()};if(s){let B=new Array(L);for(let R=0;R<L;R++){let V=(R+1)/L,q={mpos:P.mpos,rz:P.rz,rot:P.rot};q.mpos=a.clone().sub(P.mpos).multiplyScalar(V).add(P.mpos),q.rz=P.rz+V*(c-P.rz),q.rot=t.slerp(P.rot,u,V),q.cam=E.clone().sub(P.cam).multiplyScalar(V).add(P.cam),B[R]=q}let F=0,W=this,U=function(){var R=B[F];F+=1,W.modelGroup.position=R.mpos,W.rotationGroup.position.z=R.rz,W.rotationGroup.quaternion=R.rot,W.camera.lookAt(R.cam),F<B.length?setTimeout(U,T):W.decAnim(),W.show()};setTimeout(U,T)}else{var I={};let B=1/L;if(a&&(I.mpos=a.clone().sub(P.mpos).multiplyScalar(B)),typeof c<"u"&&c!=null&&(I.rz=B*(c-P.rz)),u){var z=t.slerp(P.rot,u,B);I.rot=P.rot.clone().inverse().multiply(z)}E&&(I.cam=E.clone().sub(P.cam).multiplyScalar(B));let F=0,W=this,U=function(){F+=1,I.mpos&&W.modelGroup.position.add(I.mpos),I.rz&&(W.rotationGroup.position.z+=I.rz),I.rot&&W.rotationGroup.quaternion.multiply(I.rot),I.cam&&(W.lookingAt.add(I.cam),W.camera.lookAt(W.lookingAt)),F<L?setTimeout(U,T):W.decAnim(),W.show()};setTimeout(U,T)}}rotate(i,s="y",a=0,c=!1){if(s=="x"?s={x:1,y:0,z:0}:s=="y"?s={x:0,y:1,z:0}:s=="z"&&(s={x:0,y:0,z:1}),s=="vx"?s={vx:1,vy:0,vz:0}:s=="vy"?s={vx:0,vy:1,vz:0}:s=="vz"&&(s={vx:0,vy:0,vz:1}),typeof s.vx<"u"){var u=new _.Vector3(s.vx,s.vy,s.vz);u.applyQuaternion(this.rotationGroup.quaternion),s={x:u.x,y:u.y,z:u.z}}var E=function(I){var z=Math.sin(I/2),B=Math.cos(I/2),F=0,W=0,U=0;return F=s.x*z,W=s.y*z,U=s.z*z,new _.Quaternion(F,W,U,B).normalize()},T=Math.PI*i/180,L=E(T);if(a){var P=new _.Quaternion().copy(this.rotationGroup.quaternion).multiply(L);this.animateMotion(a,c,this.modelGroup.position,this.rotationGroup.position.z,P,this.lookingAt)}else this.rotationGroup.quaternion.multiply(L),this.show();return this}surfacesFinished(){for(var i in this.surfaces)if(!this.surfaces[i][0].done)return!1;return!0}getView(){if(!this.modelGroup)return[0,0,0,0,0,0,0,1];var i=this.modelGroup.position,s=this.rotationGroup.quaternion;return[i.x,i.y,i.z,this.rotationGroup.position.z,s.x,s.y,s.z,s.w]}setView(i,s){return i===void 0||!(i instanceof Array||i.length!==8)?this:!this.modelGroup||!this.rotationGroup?this:(this.modelGroup.position.x=i[0],this.modelGroup.position.y=i[1],this.modelGroup.position.z=i[2],this.rotationGroup.position.z=i[3],this.rotationGroup.quaternion.x=i[4],this.rotationGroup.quaternion.y=i[5],this.rotationGroup.quaternion.z=i[6],this.rotationGroup.quaternion.w=i[7],typeof i[8]<"u"&&(this.rotationGroup.position.x=i[8],this.rotationGroup.position.y=i[9]),this.show(s),this)}render(i,s){this.renderer.setViewport(),this.updateClickables();var a=this.getView();this.stateChangeCallback&&this.stateChangeCallback(this.getInternalState());var c,u;for(s||(s=this.renderer.supportedExtensions()),c=0;c<this.models.length;c++)this.models[c]&&this.models[c].globj(this.modelGroup,s);for(c=0;c<this.shapes.length;c++)this.shapes[c]&&(typeof this.shapes[c].frame>"u"||this.viewer_frame<0||this.shapes[c].frame<0||this.shapes[c].frame==this.viewer_frame?this.shapes[c].globj(this.modelGroup,s):this.shapes[c].removegl(this.modelGroup));for(c=0;c<this.labels.length;c++)s.regen&&(this.labels[c].dispose(),this.modelGroup.remove(this.labels[c].sprite),this.labels[c].setContext(),this.modelGroup.add(this.labels[c].sprite)),this.labels[c]&&typeof this.labels[c].frame<"u"&&this.labels[c].frame>=0&&(this.modelGroup.remove(this.labels[c].sprite),(this.viewer_frame<0||this.labels[c].frame==this.viewer_frame)&&this.modelGroup.add(this.labels[c].sprite));for(c in this.surfaces)if(this.surfaces.hasOwnProperty(c)){var E=this.surfaces[c];for(u=0;u<E.length;u++)if(E.hasOwnProperty(u)){var T=E[u].geo;if(!E[u].finished||s.regen){T.verticesNeedUpdate=!0,T.elementsNeedUpdate=!0,T.normalsNeedUpdate=!0,T.colorsNeedUpdate=!0,T.buffersNeedUpdate=!0,E[u].mat.needsUpdate=!0,E[u].done&&(E[u].finished=!0),E[u].lastGL&&this.modelGroup.remove(E[u].lastGL);var L=null;if(E[u].mat instanceof b.LineBasicMaterial?L=new b.Line(T,E[u].mat):("wireframe"in E.style&&E.style.wireframe&&T.setUpWireframe(),L=new b.Mesh(T,E[u].mat)),E[u].mat.transparent&&E[u].mat.opacity==0?L.visible=!1:L.visible=!0,E[u].symmetries.length>1||E[u].symmetries.length==1&&!E[u].symmetries[0].isIdentity()){var P,I=new b.Object3D;for(P=0;P<E[u].symmetries.length;P++){var z=L.clone();z.matrix=E[u].symmetries[P],z.matrixAutoUpdate=!1,I.add(z)}E[u].lastGL=I,this.modelGroup.add(I)}else E[u].lastGL=L,this.modelGroup.add(L)}}}return this.setView(a),typeof i=="function"&&i(this),this}getModelList(i){let s=[];if(typeof i>"u"||typeof i.model>"u")for(let c=0;c<this.models.length;c++)this.models[c]&&s.push(this.models[c]);else{let c=i.model;Array.isArray(c)||(c=[c]);for(let u=0;u<c.length;u++)if(typeof c[u]=="number"){var a=c[u];a<0&&(a+=this.models.length),s.push(this.models[a])}else s.push(c[u])}return s}getAtomsFromSel(i){var s=[];typeof i>"u"&&(i={});var a=this.getModelList(i);for(let c=0;c<a.length;c++)s=s.concat(a[c].selectedAtoms(i));return s}atomIsSelected(i,s){typeof s>"u"&&(s={});for(var a=this.getModelList(s),c=0;c<a.length;c++)if(a[c].atomIsSelected(i,s))return!0;return!1}selectedAtoms(i){return this.getAtomsFromSel(i)}getUniqueValues(i,s){typeof s>"u"&&(s={});var a=this.getAtomsFromSel(s),c={};for(var u in a)if(a[u].hasOwnProperty(i)){var E=a[u][i];c[E]=!0}return Object.keys(c)}pdbData(i){for(var s=this.getAtomsFromSel(i),a="",c=0,u=s.length;c<u;++c)a+=s[c].pdbline+`
`;return a}zoom(i=2,s=0,a=!1){var c=(this.CAMERA_Z-this.rotationGroup.position.z)/i,u=this.CAMERA_Z-c;return s>0?this.animateMotion(s,a,this.modelGroup.position,this.adjustZoomToLimits(u),this.rotationGroup.quaternion,this.lookingAt):(this.rotationGroup.position.z=this.adjustZoomToLimits(u),this.show()),this}translate(i,s,a=0,c=!1){var u=i/this.WIDTH,E=s/this.HEIGHT,T=new _.Vector3(0,0,-this.CAMERA_Z);this.projector.projectVector(T,this.camera),T.x-=u,T.y-=E,this.projector.unprojectVector(T,this.camera),T.z=0;var L=this.lookingAt.clone().add(T);return a>0?this.animateMotion(a,c,this.modelGroup.position,this.rotationGroup.position.z,this.rotationGroup.quaternion,L):(this.lookingAt=L,this.camera.lookAt(this.lookingAt),this.show()),this}translateScene(i,s,a=0,c=!1){var u=this.screenOffsetToModel(i,s),E=this.modelGroup.position.clone().add(u);return a>0?this.animateMotion(a,c,this.modelGroup.position,this.rotationGroup.position.z,this.rotationGroup.quaternion,this.lookingAt):(this.modelGroup.position=E,this.show()),this}fitSlab(i){i=i||{};var s=this.getAtomsFromSel(i),a=(0,m.getExtent)(s),c=a[1][0]-a[0][0],u=a[1][1]-a[0][1],E=a[1][2]-a[0][2],T=Math.hypot(c,u,E);return T<5&&(T=5),this.slabNear=-T/1.9,this.slabFar=T/2,this}center(i={},s=0,a=!1){var c,u,E=this.getAtomsFromSel(i),T=(0,m.getExtent)(E);(0,m.isEmptyObject)(i)?(this.shapes.forEach(V=>{if(V&&V.boundingSphere&&V.boundingSphere.center){var q=V.boundingSphere.center,ee=V.boundingSphere.radius;ee>0?(E.push(new _.Vector3(q.x+ee,q.y,q.z)),E.push(new _.Vector3(q.x-ee,q.y,q.z)),E.push(new _.Vector3(q.x,q.y+ee,q.z)),E.push(new _.Vector3(q.x,q.y-ee,q.z)),E.push(new _.Vector3(q.x,q.y,q.z+ee)),E.push(new _.Vector3(q.x,q.y,q.z-ee))):E.push(q)}}),T=(0,m.getExtent)(E),c=E,u=T):(c=this.getAtomsFromSel({}),u=(0,m.getExtent)(c));var L=new _.Vector3(T[2][0],T[2][1],T[2][2]),P=u[1][0]-u[0][0],I=u[1][1]-u[0][1],z=u[1][2]-u[0][2],B=Math.hypot(P,I,z);B<5&&(B=5),this.slabNear=-B/1.9,this.slabFar=B/2,P=T[1][0]-T[0][0],I=T[1][1]-T[0][1],z=T[1][2]-T[0][2],B=Math.hypot(P,I,z),B<5&&(B=5);for(var F=25,W=0;W<E.length;W++)if(E[W]){var U=L.distanceToSquared(E[W]);U>F&&(F=U)}B=Math.sqrt(F)*2;var R=L.clone().multiplyScalar(-1);return s>0?this.animateMotion(s,a,R,this.rotationGroup.position.z,this.rotationGroup.quaternion,this.lookingAt):(this.modelGroup.position=R,this.show()),this}zoomTo(i={},s=0,a=!1){let c=this.getAtomsFromSel(i),u=(0,m.getExtent)(c),E=u;if((0,m.isEmptyObject)(i)){let q=c&&c.length;if(this.shapes.forEach(ee=>{if(ee&&ee.boundingSphere){if(ee.boundingSphere.box){let le=ee.boundingSphere.box;c.push(new _.Vector3(le.min.x,le.min.y,le.min.z)),c.push(new _.Vector3(le.max.x,le.max.y,le.max.z))}else if(ee.boundingSphere.center){var se=ee.boundingSphere.center,ie=ee.boundingSphere.radius;ie>0?(c.push(new _.Vector3(se.x+ie,se.y,se.z)),c.push(new _.Vector3(se.x-ie,se.y,se.z)),c.push(new _.Vector3(se.x,se.y+ie,se.z)),c.push(new _.Vector3(se.x,se.y-ie,se.z)),c.push(new _.Vector3(se.x,se.y,se.z+ie)),c.push(new _.Vector3(se.x,se.y,se.z-ie))):c.push(se)}}}),E=(0,m.getExtent)(c),!q)for(let ee=0;ee<3;ee++)u[2][ee]=(E[0][ee]+E[1][ee])/2}else{let q=this.getAtomsFromSel({});E=(0,m.getExtent)(q)}var T=new _.Vector3(u[2][0],u[2][1],u[2][2]),L=E[1][0]-E[0][0],P=E[1][1]-E[0][1],I=E[1][2]-E[0][2],z=Math.hypot(L,P,I);z<5&&(z=5),this.slabNear=-z/1.9,this.slabFar=z/2,Object.keys(i).length===0&&(this.slabNear=Math.min(-z*2,-50),this.slabFar=Math.max(z*2,50));var B=this.config.minimumZoomToDistance||5;L=u[1][0]-u[0][0],P=u[1][1]-u[0][1],I=u[1][2]-u[0][2],z=Math.hypot(L,P,I),z<B&&(z=B);for(var F=B*B,W=0;W<c.length;W++)if(c[W]){var U=T.distanceToSquared(c[W]);U>F&&(F=U)}z=Math.sqrt(F)*2;var R=T.clone().multiplyScalar(-1),V=-(z*.5/Math.tan(Math.PI/180*this.camera.fov/2)-this.CAMERA_Z);return V=this.adjustZoomToLimits(V),s>0?this.animateMotion(s,a,R,V,this.rotationGroup.quaternion,this.lookingAt):(this.modelGroup.position=R,this.rotationGroup.position.z=V,this.show()),this}setSlab(i,s){this.slabNear=i,this.slabFar=s}getSlab(){return{near:this.slabNear,far:this.slabFar}}addLabel(i,s={},a,c=!1){if(a){var u=(0,m.getExtent)(this.getAtomsFromSel(a));s.position={x:u[2][0],y:u[2][1],z:u[2][2]}}var E=new p.Label(i,s);return E.setContext(),this.modelGroup.add(E.sprite),this.labels.push(E),c||this.show(),E}addResLabels(i,s,a=!1){let c=this.labels.length;return this.applyToModels("addResLabels",i,s,a),this.show(),this.labels.slice(c)}addPropertyLabels(i,s,a){return this.applyToModels("addPropertyLabels",i,s,a),this.show(),this}removeLabel(i){for(var s=0;s<this.labels.length;s++)if(this.labels[s]==i){this.labels.splice(s,1),i.dispose(),this.modelGroup.remove(i.sprite);break}return this.show(),this}removeAllLabels(){for(var i=0;i<this.labels.length;i++)this.labels[i]&&this.labels[i].sprite&&this.modelGroup.remove(this.labels[i].sprite);return this.labels.splice(0,this.labels.length),this.show(),this}hideAllLabels(){for(var i=0;i<this.labels.length;i++)this.labels[i]&&this.labels[i].hide();return this.show(),this}showAllLabels(){for(var i=0;i<this.labels.length;i++)this.labels[i]&&this.labels[i].show();return this.show(),this}setLabelStyle(i,s){return this.modelGroup.remove(i.sprite),i.dispose(),i.stylespec=s,i.setContext(),this.modelGroup.add(i.sprite),this.show(),i}setLabelText(i,s){return this.modelGroup.remove(i.sprite),i.dispose(),i.text=s,i.setContext(),this.modelGroup.add(i.sprite),this.show(),i}addShape(i){i=i||{};var s=new w.GLShape(i);return s.shapePosition=this.shapes.length,this.shapes.push(s),s}removeShape(i){if(!i)return this;for(i.removegl(this.modelGroup),delete this.shapes[i.shapePosition];this.shapes.length>0&&typeof this.shapes[this.shapes.length-1]>"u";)this.shapes.pop();return this}removeAllShapes(){for(var i=0;i<this.shapes.length;i++){var s=this.shapes[i];s&&s.removegl(this.modelGroup)}return this.shapes.splice(0,this.shapes.length),this}getSelectionCenter(i){if(i.hasOwnProperty("x")&&i.hasOwnProperty("y")&&i.hasOwnProperty("z"))return i;var s=this.getAtomsFromSel(i);if(s.length==0)return{x:0,y:0,z:0};var a=(0,m.getExtent)(s);return{x:a[0][0]+(a[1][0]-a[0][0])/2,y:a[0][1]+(a[1][1]-a[0][1])/2,z:a[0][2]+(a[1][2]-a[0][2])/2}}addSphere(i){i=i||{},i.center=this.getSelectionCenter(i.center);var s=new w.GLShape(i);return s.shapePosition=this.shapes.length,s.addSphere(i),this.shapes.push(s),s.finalize(),s}addBox(i={}){i.corner!=null&&(i.corner=this.getSelectionCenter(i.corner)),i.center!=null&&(i.center=this.getSelectionCenter(i.center));var s=new w.GLShape(i);return s.shapePosition=this.shapes.length,s.addBox(i),this.shapes.push(s),s.finalize(),s}addArrow(i={}){i.start=this.getSelectionCenter(i.start),i.end=this.getSelectionCenter(i.end);var s=new w.GLShape(i);return s.shapePosition=this.shapes.length,s.addArrow(i),this.shapes.push(s),s.finalize(),s}addCylinder(i={}){i.start=this.getSelectionCenter(i.start),i.end=this.getSelectionCenter(i.end);var s=new w.GLShape(i);return s.shapePosition=this.shapes.length,i.dashed?s.addDashedCylinder(i):s.addCylinder(i),this.shapes.push(s),s.finalize(),s}addCurve(i={}){var s=new w.GLShape(i);return s.shapePosition=this.shapes.length,s.addCurve(i),this.shapes.push(s),s.finalize(),s}addLine(i={}){i.start=this.getSelectionCenter(i.start),i.end=this.getSelectionCenter(i.end),i.wireframe=!0;var s=new w.GLShape(i);return s.shapePosition=this.shapes.length,i.dashed?s=this.addLineDashed(i,s):s.addLine(i),this.shapes.push(s),s.finalize(),s}addUnitCell(i,s){i=this.getModel(i),s=s||{alabel:"a",blabel:"b",clabel:"c"},s.box=s.box||{},s.astyle=s.astyle||{color:"red",radius:.1,midpos:-1},s.bstyle=s.bstyle||{color:"green",radius:.1,midpos:-1},s.cstyle=s.cstyle||{color:"blue",radius:.1,midpos:-1},s.alabelstyle=s.alabelstyle||{fontColor:"red",showBackground:!1,alignment:"center",inFront:!1},s.blabelstyle=s.blabelstyle||{fontColor:"green",showBackground:!1,alignment:"center",inFront:!1},s.clabelstyle=s.clabelstyle||{fontColor:"blue",showBackground:!1,alignment:"center",inFront:!1},i.unitCellObjects&&this.removeUnitCell(i),i.unitCellObjects={shapes:[],labels:[]};var a=i.getCrystData(),c=null;if(a){if(a.matrix)c=a.matrix;else{var u=a.a,E=a.b,T=a.c,L=a.alpha,P=a.beta,I=a.gamma;L=L*Math.PI/180,P=P*Math.PI/180,I=I*Math.PI/180;var z,B,F;z=Math.cos(P),B=(Math.cos(L)-Math.cos(P)*Math.cos(I))/Math.sin(I),F=Math.sqrt(Math.max(0,1-z*z-B*B)),c=new _.Matrix3(u,E*Math.cos(I),T*z,0,E*Math.sin(I),T*B,0,0,T*F)}var W=[new _.Vector3(0,0,0),new _.Vector3(1,0,0),new _.Vector3(0,1,0),new _.Vector3(0,0,1),new _.Vector3(1,1,0),new _.Vector3(0,1,1),new _.Vector3(1,0,1),new _.Vector3(1,1,1)];if(a.matrix4)for(let R=0;R<W.length;R++)a.size&&W[R].multiplyVectors(W[R],a.size),W[R]=W[R].applyMatrix4(a.matrix4);else for(let R=0;R<W.length;R++)W[R]=W[R].applyMatrix3(c);if(s.box&&!s.box.hidden){s.box.wireframe=!0;var U=new w.GLShape(s.box);U.shapePosition=this.shapes.length,U.addLine({start:W[0],end:W[1]}),U.addLine({start:W[0],end:W[2]}),U.addLine({start:W[1],end:W[4]}),U.addLine({start:W[2],end:W[4]}),U.addLine({start:W[0],end:W[3]}),U.addLine({start:W[3],end:W[5]}),U.addLine({start:W[2],end:W[5]}),U.addLine({start:W[1],end:W[6]}),U.addLine({start:W[4],end:W[7]}),U.addLine({start:W[6],end:W[7]}),U.addLine({start:W[3],end:W[6]}),U.addLine({start:W[5],end:W[7]}),this.shapes.push(U),i.unitCellObjects.shapes.push(U),U.finalize()}if(!s.astyle.hidden){s.astyle.start=W[0],s.astyle.end=W[1];let R=this.addArrow(s.astyle);i.unitCellObjects.shapes.push(R)}if(!s.bstyle.hidden){s.bstyle.start=W[0],s.bstyle.end=W[2];let R=this.addArrow(s.bstyle);i.unitCellObjects.shapes.push(R)}if(!s.cstyle.hidden){s.cstyle.start=W[0],s.cstyle.end=W[3];let R=this.addArrow(s.cstyle);i.unitCellObjects.shapes.push(R)}if(s.alabel){s.alabelstyle.position=W[1];let R=this.addLabel(s.alabel,s.alabelstyle);i.unitCellObjects.labels.push(R)}if(s.blabel){s.blabelstyle.position=W[2];let R=this.addLabel(s.blabel,s.blabelstyle);i.unitCellObjects.labels.push(R)}if(s.clabel){s.clabelstyle.position=W[3];let R=this.addLabel(s.clabel,s.clabelstyle);i.unitCellObjects.labels.push(R)}}}removeUnitCell(i){if(i=this.getModel(i),i.unitCellObjects){let s=this;i.unitCellObjects.shapes.forEach(function(a){s.removeShape(a)}),i.unitCellObjects.labels.forEach(function(a){s.removeLabel(a)})}delete i.unitCellObjects}replicateUnitCell(i=3,s=i,a=s,c,u,E){c=this.getModel(c);let T=c.getCrystData();if(T){const L=c.selectedAtoms({}),P=T.matrix;let I=function(B){return B%2==0?-B/2:Math.ceil(B/2)};i<=1&&s<=1&&a<=1&&(E=!0,i=s=a=3);let z=function(B,F,W){return!1};if(E){const B=new _.Matrix3().getInverse3(P);z=function(F,W,U){let R=new _.Vector3(F,W,U).applyMatrix3(B);return!(R.x>-1e-4&&R.x<1.0001&&R.y>-1e-4&&R.y<1.0001&&R.z>-1e-4&&R.z<1.0001)}}for(let B=0;B<i;B++)for(let F=0;F<s;F++)for(let W=0;W<a;W++){if(B==0&&F==0&&W==0)continue;let U=new _.Vector3(I(B),I(F),I(W));U.applyMatrix3(P);let R=[];for(let V=0;V<L.length;V++){let q=L[V].x+U.x,ee=L[V].y+U.y,se=L[V].z+U.z;if(z(q,ee,se))continue;let ie={};for(let le in L[V])ie[le]=L[V][le];ie.x=q,ie.y=ee,ie.z=se,R.push(ie)}c.addAtoms(R)}u&&c.assignBonds()}}addLineDashed(i,s){i.dashLength=i.dashLength||.5,i.gapLength=i.gapLength||.5;var a;i.start?a=new _.Vector3(i.start.x||0,i.start.y||0,i.start.z||0):a=new _.Vector3(0,0,0);var c;i.end?c=new _.Vector3(i.end.x,i.end.y||0,i.end.z||0):c=new _.Vector3(0,0,0);var u=new _.Vector3,E=new _.Vector3,T=new _.Vector3,L,P,I,z=a.clone(),B=0;for(u.subVectors(c,a),L=u.length(),u.normalize(),E=u.clone(),T=u.clone(),E.multiplyScalar(i.dashLength),T.multiplyScalar(i.gapLength),P=E.length(),I=T.length();B<L;){if(B+P>L){i.start=a,i.end=c,s.addLine(i);break}z.addVectors(a,E),i.start=a,i.end=z,s.addLine(i),a=z.clone(),B+=P,z.addVectors(a,T),a=z.clone(),B+=I}return s.finalize(),s}addCustom(i){i=i||{};var s=new w.GLShape(i);return s.shapePosition=this.shapes.length,s.addCustom(i),this.shapes.push(s),s.finalize(),s}addVolumetricData(i,s,a={}){var c=new M.VolumeData(i,s);return a.hasOwnProperty("transferfn")?this.addVolumetricRender(c,a):this.addIsosurface(c,a)}addIsosurface(i,s={},a){var c=new w.GLShape(s);return c.shapePosition=this.shapes.length,c.addIsosurface(i,s,a,this),this.shapes.push(c),c}addVolumetricRender(i,s){s=s||{};var a=new v.GLVolumetricRender(i,s,this);return a.shapePosition=this.shapes.length,this.shapes.push(a),a}hasVolumetricRender(){return this.renderer.supportsVolumetric()}enableFog(i){if(i){this.scene.fog=new b.Fog(this.bgColor,100,200),this.config.disableFog=!1;const s=i;s.fogStart==null?this.fogStart=.4:this.fogStart=s.fogStart,s.fogEnd==null?this.fogEnd=1:this.fogEnd=s.fogEnd}else this.config.disableFog=!0,this.show()}setFrame(i){this.viewer_frame=i;let s=this;return new Promise(function(a){var c=s.models.map(function(u){return u.setFrame(i)});Promise.all(c).then(function(){a()})})}getFrame(){return this.viewer_frame}getNumFrames(){var i=0;for(let s=0;s<this.models.length;s++)this.models[s].getNumFrames()>i&&(i=this.models[s].getNumFrames());for(let s=0;s<this.shapes.length;s++)this.shapes[s].frame&&this.shapes[s].frame>=i&&(i=this.shapes[s].frame+1);for(let s=0;s<this.labels.length;s++)this.labels[s].frame&&this.labels[s].frame>=i&&(i=this.labels[s].frame+1);return i}getNextModelId(){return this.models.length}animate(i){this.incAnim();var s=100,a="forward",c=1/0;i=i||{},i.interval&&(s=i.interval),i.loop&&(a=i.loop),i.reps&&(c=i.reps);var u=this.getNumFrames(),E=this,T=0;i.startFrame&&(T=i.startFrame%u);var L=1;i.step&&(L=i.step,c/=L);var P=0,I=u*c,z=new Date,B,F,W=function(U){z=new Date,U=="forward"?E.setFrame(T).then(function(){T=(T+L)%u,B()}):U=="backward"?E.setFrame(u-1-T).then(function(){T=(T+L)%u,B()}):E.setFrame(T).then(function(){T+=L,L*=T%(u-1)==0?-1:1,B()})};return B=function(){if(E.render(),!E.getCanvas().isConnected)E.stopAnimate();else if(++P>=I||!E.isAnimated())F.cancel(),E.animationTimers.delete(F),E.decAnim();else{var U=s-(new Date().getTime()-z.getTime());U=U>0?U:0,F.cancel(),E.animationTimers.delete(F),F=new m.PausableTimer(W,U,a),E.animationTimers.add(F)}},F=new m.PausableTimer(W,0,a),this.animationTimers.add(F),this}stopAnimate(){return this.animated=0,this.animationTimers.forEach(function(i){i.cancel()}),this.animationTimers=new Set,this}pauseAnimate(){return this.animationTimers.forEach(function(i){i.pause()}),this}resumeAnimate(){return this.animationTimers.forEach(function(i){i.resume()}),this}isAnimated(){return this.animated>0}getModelOpt(i){return i&&!i.defaultcolors?(i.defaultcolors=this.defaultcolors,i.cartoonQuality=i.cartoonQuality||this.config.cartoonQuality):typeof i>"u"&&(i={defaultcolors:this.defaultcolors,cartoonQuality:this.config.cartoonQuality}),i}addModel(i,s="",a){a=this.getModelOpt(a);var c=new S.GLModel(this.models.length,a,this);return c.addMolData(i,s,a),this.models.push(c),c}addModels(i,s,a){a=this.getModelOpt(a),a.multimodel=!0,a.frames=!0;for(var c=S.GLModel.parseMolData(i,s,a),u=0;u<c.length;u++){var E=new S.GLModel(this.models.length,a,this);E.setAtomDefaults(c[u]),E.addFrame(c[u]),E.setFrame(0),c.modelData&&E.setModelData(c.modelData[u]),E.setDontDuplicateAtoms(!a.duplicateAssemblyAtoms),this.models.push(E)}return this.models}addModelsAsFrames(i,s,a){a=this.getModelOpt(a),a.multimodel=!0,a.frames=!0;var c=new S.GLModel(this.models.length,a,this);return c.addMolData(i,s,a),this.models.push(c),c}addAsOneMolecule(i,s,a){a=this.getModelOpt(a),a.multimodel=!0,a.onemol=!0;var c=new S.GLModel(this.models.length,a,this);return c.addMolData(i,s,a),this.models.push(c),c}removeModel(i){if(i=this.getModel(i),!!i){for(i.removegl(this.modelGroup),delete this.models[i.getID()];this.models.length>0&&typeof this.models[this.models.length-1]>"u";)this.models.pop();return this}}removeAllModels(){for(var i=0;i<this.models.length;i++){var s=this.models[i];s&&s.removegl(this.modelGroup)}return this.models.splice(0,this.models.length),this}exportJSON(i,s){var a={};return s===void 0?a.m=this.models.map(function(c){return c.toCDObject(i)}):a.m=[this.models[s].toCDObject()],JSON.stringify(a)}exportVRML(){var i=this.modelGroup;this.applyToModels("removegl",this.modelGroup),this.modelGroup=new b.Object3D,this.render(null,{supportsImposters:!1,supportsAIA:!1,regen:!0});var s=`#VRML V2.0 utf8
`+this.modelGroup.vrml()+`
`;return this.applyToModels("removegl",this.modelGroup),this.modelGroup=i,s}createModelFrom(i,s=!1){for(var a=new S.GLModel(this.models.length,this.defaultcolors,this),c=0;c<this.models.length;c++)if(this.models[c]){var u=this.models[c].selectedAtoms(i);a.addAtoms(u),s&&this.models[c].removeAtoms(u)}return this.models.push(a),a}applyToModels(i,s,a,c,u,E,T){for(var L=this.getModelList(s),P=0;P<L.length;P++)L[P][i](s,a,c,u,E,T)}setStyle(i,s){return typeof s>"u"&&(s=i,i={}),this.applyToModels("setStyle",i,s,!1),this}addStyle(i,s){return typeof s>"u"&&(s=i,i={}),this.applyToModels("setStyle",i,s,!0),this}setClickable(i,s,a){return this.applyToModels("setClickable",i,s,a),this}setHoverable(i,s,a,c){return this.applyToModels("setHoverable",i,s,a,c),this}enableContextMenu(i,s){return this.applyToModels("enableContextMenu",i,s),this}vibrate(i,s,a,c){return this.applyToModels("vibrate",i,s,a,c),this}setColorByProperty(i,s,a,c){return this.applyToModels("setColorByProperty",i,s,a,c),this}setColorByElement(i,s){return this.applyToModels("setColorByElement",i,s),this}static getAtomsWithin(i,s){var a=[];for(let u=0;u<i.length;u++){var c=i[u];typeof c>"u"||c.x<s[0][0]||c.x>s[1][0]||c.y<s[0][1]||c.y>s[1][1]||c.z<s[0][2]||c.z>s[1][2]||a.push(c)}return a}static volume(i){var s=i[1][0]-i[0][0],a=i[1][1]-i[0][1],c=i[1][2]-i[0][2];return s*a*c}carveUpExtent(i,s,a){let c=[],u={};for(let z=0,B=s.length;z<B;z++)u[s[z].index]=z;let E=function(z){let B=[];for(let F=0,W=z.length;F<W;F++)z[F].index in u&&B.push(u[z[F].index]);return B},T=function(z){let B=[];return B[0]=[z[0][0],z[0][1],z[0][2]],B[1]=[z[1][0],z[1][1],z[1][2]],B},L=function(z){if(t.volume(z)<t.maxVolume)return[z];var B=z[1][0]-z[0][0],F=z[1][1]-z[0][1],W=z[1][2]-z[0][2],U;B>F&&B>W?U=0:F>B&&F>W?U=1:U=2;var R=T(z),V=T(z),q=(z[1][U]-z[0][U])/2+z[0][U];R[1][U]=q,V[0][U]=q;var ee=L(R),se=L(V);return ee.concat(se)},P=L(i),I=6;for(let z=0,B=P.length;z<B;z++){let F=T(P[z]);F[0][0]-=I,F[0][1]-=I,F[0][2]-=I,F[1][0]+=I,F[1][1]+=I,F[1][2]+=I;let W=t.getAtomsWithin(s,F),U=t.getAtomsWithin(a,P[z]);c.push({extent:P[z],atoms:E(W),toshow:E(U)})}return c}static generateSurfaceMesh(i,s,a){var c=new b.Geometry(!0),u=c.updateGeoGroup(0),E=[];for(let Q=0,me=i.length;Q<me;Q++){var T=i[Q];T&&(typeof T.surfaceColor<"u"?E[Q]=T.surfaceColor:T.color&&(E[Q]=g.CC.color(T.color)))}var L=u.vertexArray,P=s.vertices;for(let Q=0,me=P.length;Q<me;Q++){let Ce=u.vertices*3;L[Ce]=P[Q].x,L[Ce+1]=P[Q].y,L[Ce+2]=P[Q].z,u.vertices++}var I=u.colorArray;let z=u.atomArray;if(a.voldata&&a.volscheme){var B=a.volscheme,F=a.voldata,W=B.range()||[-1,1];for(let Q=0,me=P.length;Q<me;Q++){let Ce=P[Q].atomid,Pe=F.getVal(P[Q].x,P[Q].y,P[Q].z),We=g.CC.color(B.valueToHex(Pe,W)),Ue=Q*3;I[Ue]=We.r,I[Ue+1]=We.g,I[Ue+2]=We.b,z[Q]=i[Ce]}}else if(E.length>0)for(let Q=0,me=P.length;Q<me;Q++){let Ce=P[Q].atomid,Pe=Q*3;I[Pe]=E[Ce].r,I[Pe+1]=E[Ce].g,I[Pe+2]=E[Ce].b,z[Q]=i[Ce]}var U=s.faces;u.faceidx=U.length,c.initTypedArrays();var R=u.vertexArray,V=u.normalArray,q,ee,se,ie;for(let Q=0,me=U.length;Q<me;Q+=3){var le=U[Q],re=U[Q+1],oe=U[Q+2],Ae=le*3,Me=re*3,Oe=oe*3;q=new _.Vector3(R[Ae],R[Ae+1],R[Ae+2]),ee=new _.Vector3(R[Me],R[Me+1],R[Me+2]),se=new _.Vector3(R[Oe],R[Oe+1],R[Oe+2]),se.subVectors(se,ee),q.subVectors(q,ee),se.cross(q),ie=se,ie.normalize(),V[Ae]+=ie.x,V[Me]+=ie.x,V[Oe]+=ie.x,V[Ae+1]+=ie.y,V[Me+1]+=ie.y,V[Oe+1]+=ie.y,V[Ae+2]+=ie.z,V[Me+2]+=ie.z,V[Oe+2]+=ie.z}u.faceArray=new Uint16Array(U);var _e=new b.Mesh(c,a);return _e}static generateMeshSyncHelper(i,s,a,c,u,E){var T=new x.ProteinSurface;return T.initparm(s,i!==1,E),T.fillvoxels(u,a),T.buildboundary(),(i==x.SurfaceType.SES||i==x.SurfaceType.MS)&&(T.fastdistancemap(),T.boundingatom(!1),T.fillvoxelswaals(u,a)),T.marchingcube(i),T.getFacesAndVertices(c)}static getMatWithStyle(i){let s=null;i.onesided?s=new b.MeshLambertMaterial:s=new b.MeshDoubleLambertMaterial,s.vertexColors=b.Coloring.VertexColors;for(var a in i)a==="color"||a==="map"||i.hasOwnProperty(a)&&(s[a]=i[a]);return i.opacity!==void 0&&(i.opacity===1?s.transparent=!1:s.transparent=!0),i.wireframe!==void 0&&(s.wireframe=i.wireframe),s}addMesh(i){let s={geo:i.geometry,mat:i.material,done:!0,finished:!1};var a=this.nextSurfID();return this.surfaces[a]=new e([s]),a}static shallowCopy(i){var s=[];let a=i.length;for(let c=0;c<a;c++)s[c]=(0,m.extend)({},i[c]);return s}addSurface(i,s={},a={},c,u,E){let T=this.nextSurfID(),L=null,P=this,I=x.SurfaceType.VDW;typeof i=="string"?t.surfaceTypeMap[i.toUpperCase()]!==void 0?I=t.surfaceTypeMap[i]:console.log("Surface type : "+i+" is not recognized"):typeof i=="number"&&(I=i);var z=null,B=null,F=t.shallowCopy(this.getAtomsFromSel(a));c?z=t.shallowCopy(this.getAtomsFromSel(c)):z=F,(0,m.adjustVolumeStyle)(s);var W=!1,U;for(U=0;U<this.models.length;U++)if(this.models[U]){var R=this.models[U].getSymmetries();if(R.length>1||R.length==1&&!R[0].isIdentity()){W=!0;break}}var V=function(oe,Ae,Me){u?B=t.shallowCopy(P.getAtomsFromSel(u)):B=Me;var Oe,_e=(0,m.getExtent)(Me,!0);if(s.map&&s.map.prop){var Q=s.map.prop;let Ge=(0,O.getGradient)(s.map.scheme||s.map.gradient||new O.Gradient.RWB),Ne=Ge.range();Ne||(Ne=(0,m.getPropertyRange)(Me,Q)),s.colorscheme={prop:Q,gradient:Ge}}for(let Ge=0,Ne=Ae.length;Ge<Ne;Ge++)Oe=Ae[Ge],Oe.surfaceColor=(0,m.getColorFromStyle)(Oe,s);var me=t.volume(_e),Ce=P.carveUpExtent(_e,Ae,Me);if(B&&B.length&&B.length>0){var Pe=(0,m.getExtent)(B,!0),We=function(Ge,Ne){var k=function(ue,fe){var Ee=ue.extent,we=Ee[1][0]-Ee[0][0],N=Ee[1][1]-Ee[0][1],ae=Ee[1][2]-Ee[0][2],ve=we-fe[2][0];ve*=ve;var Le=N-fe[2][1];Le*=Le;var ne=ae-fe[2][2];return ne*=ne,ve+Le+ne},Z=k(Ge,Pe),Y=k(Ne,Pe);return Z-Y};Ce.sort(We)}var Ue=[];for(let Ge=0,Ne=Ae.length;Ge<Ne;Ge++)Oe=Ae[Ge],Ue[Ge]={x:Oe.x,y:Oe.y,z:Oe.z,serial:Ge,elem:Oe.elem};var ze=!!x.syncSurface;if((typeof $3Dmol>"u"||typeof $3Dmol.SurfaceWorker>"u")&&(console.log("$3Dmol.SurfaceWorker is not defined, using synchronous surface generation."),ze=!0),ze){var Be=function(Ne){return new Promise(function(k){for(var Z=t.generateMeshSyncHelper(I,Ce[Ne].extent,Ce[Ne].atoms,Ce[Ne].toshow,Ue,me),Y=(0,w.splitMesh)({vertexArr:Z.vertices,faceArr:Z.faces}),ue=0,fe=Y.length;ue<fe;ue++){Z={vertices:Y[ue].vertexArr,faces:Y[ue].faceArr};var Ee=t.generateSurfaceMesh(Ae,Z,L);(0,m.mergeGeos)(oe.geo,Ee)}P.render(),k()})},Ie=[];for(let Ge=0;Ge<Ce.length;Ge++)Ie.push(Be(Ge));return Promise.all(Ie).then(function(){return oe.done=!0,P.render(),Promise.resolve(T)})}else{var Se=[];I<0&&(I=0);for(let Ge=0,Ne=t.numWorkers;Ge<Ne;Ge++){var Te=new Worker($3Dmol.SurfaceWorker);Se.push(Te),Te.postMessage({type:-1,atoms:Ue,volume:me})}return new Promise(function(Ge,Ne){var k=0,Z=function(){!Se||!Se.length||Se.forEach(function(Ee){Ee&&Ee.terminate&&Ee.terminate()})},Y=function(Ee){for(var we=(0,w.splitMesh)({vertexArr:Ee.data.vertices,faceArr:Ee.data.faces}),N=0,ae=we.length;N<ae;N++){var ve={vertices:we[N].vertexArr,faces:we[N].faceArr},Le=t.generateSurfaceMesh(Ae,ve,L);(0,m.mergeGeos)(oe.geo,Le)}P.render(),k++,k==Ce.length&&(oe.done=!0,Z(),Ge(T))},ue=function(Ee){Z(),console.log(Ee.message+" ("+Ee.filename+":"+Ee.lineno+")"),Ne(Ee)};for(let Ee=0;Ee<Ce.length;Ee++){var fe=Se[Ee%Se.length];fe.onmessage=Y,fe.onerror=ue,fe.postMessage({type:I,expandedExtent:Ce[Ee].extent,extendedAtoms:Ce[Ee].atoms,atomsToShow:Ce[Ee].toshow})}})}};s=s||{},L=t.getMatWithStyle(s);let q=new e([]);q.style=s,q.atomsel=a,q.allsel=c,q.focus=u;var ee=null;if(W){var se={},ie={};for(U=0;U<this.models.length;U++)se[U]=[],ie[U]=[];for(U=0;U<z.length;U++)se[z[U].model].push(z[U]);for(U=0;U<F.length;U++)ie[F[U].model].push(F[U]);var le=[];for(U=0;U<this.models.length;U++)ie[U].length>0&&(q.push({geo:new b.Geometry(!0),mat:L,done:!1,finished:!1,symmetries:this.models[U].getSymmetries()}),le.push(V(q[q.length-1],se[U],ie[U])));ee=Promise.all(le)}else q.push({geo:new b.Geometry(!0),mat:L,done:!1,finished:!1,symmetries:[new _.Matrix4]}),ee=V(q[q.length-1],z,F);return this.surfaces[T]=q,ee.surfid=T,E&&typeof E=="function"?(ee.then(function(re){E(re)}),T):ee}setSurfaceMaterialStyle(i,s){if((0,m.adjustVolumeStyle)(s),this.surfaces[i]){var a=this.surfaces[i];for(let u=0;u<a.length;u++){var c=a[u].mat=t.getMatWithStyle(s);if(a[u].mat.side=b.FrontSide,s.wireframe&&a[u].geo.setUpWireframe(),s.color){a[u].mat.color=g.CC.color(s.color),a[u].geo.colorsNeedUpdate=!0;const E=g.CC.color(s.color);a[u].geo.setColor(E)}else if(c.voldata&&c.volscheme){const E=c.volscheme,T=c.voldata,L=g.CC,P=E.range()||[-1,1];a[u].geo.setColors(function(I,z,B){let F=T.getVal(I,z,B);return L.color(E.valueToHex(F,P))})}else{a[u].geo.colorsNeedUpdate=!0;for(let E of a[u].geo.geometryGroups)for(let T=0;T<E.vertices;T++){let L=(0,m.getColorFromStyle)(E.atomArray[T],s),P=3*T;E.colorArray[P]=L.r,E.colorArray[P+1]=L.g,E.colorArray[P+2]=L.b}}a[u].finished=!1}}return this}getSurface(i){return this.surfaces[i]}removeSurface(i){for(var s=this.surfaces[i],a=0;a<s.length;a++)s[a]&&s[a].lastGL&&(s[a].geo!==void 0&&s[a].geo.dispose(),s[a].mat!==void 0&&s[a].mat.dispose(),this.modelGroup.remove(s[a].lastGL));return delete this.surfaces[i],this.show(),this}removeAllSurfaces(){for(var i in this.surfaces)if(this.surfaces.hasOwnProperty(i)){for(var s=this.surfaces[i],a=0;a<s.length;a++)s[a]&&s[a].lastGL&&(s[a].geo!==void 0&&s[a].geo.dispose(),s[a].mat!==void 0&&s[a].mat.dispose(),this.modelGroup.remove(s[a].lastGL));delete this.surfaces[i]}return this.show(),this}jmolMoveTo(){var i=this.modelGroup.position,s="center { "+-i.x+" "+-i.y+" "+-i.z+" }; ",a=this.rotationGroup.quaternion;return s+="moveto .5 quaternion { "+a.x+" "+a.y+" "+a.z+" "+a.w+" };",s}clear(){return this.removeAllSurfaces(),this.removeAllModels(),this.removeAllLabels(),this.removeAllShapes(),this.show(),this}mapAtomProperties(i,s){s=s||{};var a=this.getAtomsFromSel(s);if(typeof i=="function")for(let E=0,T=a.length;E<T;E++){let L=a[E];i(L)}else for(let E=0,T=a.length;E<T;E++){var c=a[E];for(let L=0,P=i.length;L<P;L++){let I=i[L];if(I.props)for(var u in I.props)I.props.hasOwnProperty(u)&&this.atomIsSelected(c,I)&&(c.properties||(c.properties={}),c.properties[u]=I.props[u])}}return this}linkViewer(i){return this.linkedViewers.push(i),this}getPerceivedDistance(){return this.CAMERA_Z-this.rotationGroup.position.z}setPerceivedDistance(i){this.rotationGroup.position.z=this.CAMERA_Z-i}setAutoEyeSeparation(i,s){var a=this.getPerceivedDistance();return s||(s=5),i||this.camera.position.x>0?this.camera.position.x=a*Math.tan(Math.PI/180*s):this.camera.position.x=-a*Math.tan(Math.PI/180*s),this.camera.lookAt(new _.Vector3(0,0,this.rotationGroup.position.z)),this.camera.position.x}setDefaultCartoonQuality(i){this.config.cartoonQuality=i}}t.numWorkers=4,t.maxVolume=64e3,t.surfaceTypeMap={VDW:x.SurfaceType.VDW,MS:x.SurfaceType.MS,SAS:x.SurfaceType.SAS,SES:x.SurfaceType.SES};function n(f,i){if(f=(0,m.getElement)(f),!!f){i=i||{};try{var s=new t(f,i);return s}catch(a){throw"error creating viewer: "+a}}}function o(f,i={},s={}){if(f=(0,m.getElement)(f),!!f){var a=[],c=document.createElement("canvas");s.rows=i.rows,s.cols=i.cols,s.control_all=i.control_all!=null?i.control_all:!1,f.appendChild(c);try{for(var u=0;u<i.rows;u++){for(var E=[],T=0;T<i.cols;T++){s.row=u,s.col=T,s.canvas=c,s.viewers=a,s.control_all=i.control_all;var L=n(f,(0,m.extend)({},s));E.push(L)}a.unshift(E)}}catch(P){throw"error creating viewer grid: "+P}return a}}function h(f){var i=this;if(f=(0,m.getElement)(f),!!f){var s=o(f,{rows:1,cols:2,control_all:!0});this.glviewer1=s[0][0],this.glviewer2=s[0][1],this.glviewer1.setAutoEyeSeparation(!1),this.glviewer2.setAutoEyeSeparation(!0),this.glviewer1.linkViewer(this.glviewer2),this.glviewer2.linkViewer(this.glviewer1);for(var a=Object.getOwnPropertyNames(this.glviewer1.__proto__).filter(function(u){return typeof i.glviewer1[u]=="function"}),c=0;c<a.length;c++)this[a[c]]=function(u){return function(){var E=this.glviewer1[u].apply(this.glviewer1,arguments),T=this.glviewer2[u].apply(this.glviewer2,arguments);return[E,T]}}(a[c]);this.setCoordinates=function(u,E,T){for(var L=0;L<u.length;L++)u[L].setCoordinates(E,T)},this.surfacesFinished=function(){return this.glviewer1.surfacesFinished()&&this.glviewer2.surfacesFinished()},this.isAnimated=function(){return this.glviewer1.isAnimated()||this.glviewer2.isAnimated()},this.render=function(u){this.glviewer1.render(),this.glviewer2.render(),u&&u(this)},this.getCanvas=function(){return this.glviewer1.getCanvas()}}}},"./src/Gradient.ts":(K,C,d)=>{d.r(C),d.d(C,{CustomLinear:()=>v,Gradient:()=>_,GradientType:()=>S,ROYGB:()=>x,RWB:()=>p,Sinebow:()=>M,builtinGradients:()=>b,getGradient:()=>O,normalizeValue:()=>w});var A=d("./src/colors.ts");class S{}function w(g,m,r){return m>=g?(r<g&&(r=g),r>m&&(r=m),{lo:g,hi:m,val:r}):(r>g&&(r=g),r<m&&(r=m),r=g-r+m,{lo:m,hi:g,val:r})}function O(g){if(g instanceof S)return g;if(g.gradient!==void 0&&b[g.gradient]){let m=g.min===void 0?-1:g.min,r=g.max===void 0?1:g.max;return g.mid===void 0?g.colors===void 0?new b[g.gradient](m,r):new b[g.gradient](m,r,g.colors):new b[g.gradient](m,r,g.mid)}else if(typeof g.gradient=="string"&&g.gradient.startsWith("linear_")){let m=g.gradient.split("_");m.shift();let r=g.min===void 0?-1:g.min,e=g.max===void 0?1:g.max;return new v(r,e,m)}return g}class p extends S{constructor(m,r,e){super(),this.gradient="RWB",this.mult=1,this.mid=e,this.min=m,this.max=r,typeof r>"u"&&Array.isArray(m)&&m.length>=2?(this.max=m[1],this.min=m[0]):m&&r&&!Array.isArray(m)&&(this.min=m,this.max=r)}range(){return typeof this.min<"u"&&typeof this.max<"u"?[this.min,this.max]:null}valueToHex(m,r){var e,t;if(m=this.mult*m,r?(e=r[0],t=r[1]):(e=this.min,t=this.max),m===void 0)return 16777215;var n=w(e,t,m);e=n.lo,t=n.hi,m=n.val;var o=(t+e)/2;r&&typeof r[2]<"u"?o=r[2]:typeof this.mid<"u"?o=this.mid:o=(e+t)/2;var h,f;return m<o?(h=Math.floor(255*Math.sqrt((m-e)/(o-e))),f=16711680+256*h+h,f):m>o?(h=Math.floor(255*Math.sqrt(1-(m-o)/(t-o))),f=65536*h+256*h+255,f):16777215}}class x extends S{constructor(m,r){super(),this.gradient="ROYGB",this.mult=1,this.min=m,this.max=r,typeof r>"u"&&Array.isArray(m)&&m.length>=2?(this.max=m[1],this.min=m[0]):m&&r&&!Array.isArray(m)&&(this.min=m,this.max=r)}valueToHex(m,r){var e,t;if(m=this.mult*m,r?(e=r[0],t=r[1]):(e=this.min,t=this.max),typeof m>"u")return 16777215;var n=w(e,t,m);e=n.lo,t=n.hi,m=n.val;var o=(e+t)/2,h=(e+o)/2,f=(o+t)/2,i,s;return m<h?(i=Math.floor(255*Math.sqrt((m-e)/(h-e))),s=16711680+256*i+0,s):m<o?(i=Math.floor(255*Math.sqrt(1-(m-h)/(o-h))),s=65536*i+65280+0,s):m<f?(i=Math.floor(255*Math.sqrt((m-o)/(f-o))),s=65280+1*i,s):(i=Math.floor(255*Math.sqrt(1-(m-f)/(t-f))),s=0+256*i+255,s)}range(){return typeof this.min<"u"&&typeof this.max<"u"?[this.min,this.max]:null}}class M extends S{constructor(m,r){super(),this.gradient="Sinebow",this.mult=1,this.min=m,this.max=r,typeof r>"u"&&Array.isArray(m)&&m.length>=2&&(this.max=m[1],this.min=m[0]),r<m&&(this.mult=-1,this.min*=-1,this.max*=-1)}valueToHex(m,r){var e,t;if(m=this.mult*m,r?(e=r[0],t=r[1]):(e=this.min,t=this.max),typeof m>"u")return 16777215;var n=_.normalizeValue(e,t,m);e=n.lo,t=n.hi,m=n.val;var o=(m-e)/(t-e),h=5*o/6+.5,f=Math.sin(Math.PI*h);f*=f*255;var i=Math.sin(Math.PI*(h+1/3));i*=i*255;var s=Math.sin(Math.PI*(h+2/3));return s*=s*255,65536*Math.floor(f)+256*Math.floor(s)+1*Math.floor(i)}range(){return typeof this.min<"u"&&typeof this.max<"u"?[this.min,this.max]:null}}class v extends S{constructor(m,r,e){super(),this.gradient="linear",this.colors=new Array;var t;if(Array.isArray(m)&&m.length>=2?(this.max=m[1],this.min=m[0],t=r):(this.min=m,this.max=r,t=e),t)for(let n of t)this.colors.push(A.CC.color(n));else this.colors.push(A.CC.color(0))}range(){return typeof this.min<"u"&&typeof this.max<"u"?[this.min,this.max]:null}valueToHex(m,r){var e,t;if(r?(e=r[0],t=r[1]):(e=this.min,t=this.max),m===void 0)return 16777215;var n=w(e,t,m);e=n.lo,t=n.hi,m=n.val;let o=this.colors.length,h=(t-e)/o,f=Math.min(Math.floor((m-e)/h),o-1),i=Math.min(f+1,o-1),s=(m-e-f*h)/h,a=this.colors[f],c=this.colors[i];return new A.Color(a.r+s*(c.r-a.r),a.g+s*(c.g-a.g),a.b+s*(c.b-a.b)).getHex()}}const b={rwb:p,RWB:p,roygb:x,ROYGB:x,sinebow:M,linear:v};class _ extends S{valueToHex(m,r){return 0}range(){return null}}_.RWB=p,_.ROYGB=x,_.Sinebow=M,_.CustomLinear=v,_.builtinGradients=b,_.normalizeValue=w,_.getGradient=O},"./src/Label.ts":(K,C,d)=>{d.r(C),d.d(C,{Label:()=>M,LabelCount:()=>O});var A=d("./src/WebGL/index.ts"),S=d("./src/Gradient.ts"),w=d("./src/colors.ts");let O=0;function p(v,b,_,g,m,r,e){v.beginPath(),v.moveTo(b+r,_),v.lineTo(b+g-r,_),v.quadraticCurveTo(b+g,_,b+g,_+r),v.lineTo(b+g,_+m-r),v.quadraticCurveTo(b+g,_+m,b+g-r,_+m),v.lineTo(b+r,_+m),v.quadraticCurveTo(b,_+m,b,_+m-r),v.lineTo(b,_+r),v.quadraticCurveTo(b,_,b+r,_),v.closePath(),v.fill(),e&&v.stroke()}function x(v,b,_){var g=_;return typeof v<"u"&&(v instanceof w.Color?g=v.scaled():(g=w.CC.color(v),typeof g.scaled<"u"&&(g=g.scaled()))),typeof b<"u"&&(g.a=parseFloat(b)),g}class M{constructor(b,_){this.id=O++,this.stylespec=_||{},this.canvas=document.createElement("canvas"),this.canvas.width=134,this.canvas.height=35,this.context=this.canvas.getContext("2d"),this.sprite=new A.Sprite,this.text=b,this.frame=this.stylespec.frame}getStyle(){return this.stylespec}hide(){this.sprite&&(this.sprite.visible=!1)}show(){this.sprite&&(this.sprite.visible=!0)}setContext(){var b=this.stylespec,_=typeof b.useScreen>"u"?!1:b.useScreen,g=b.showBackground;(g==="0"||g==="false")&&(g=!1),typeof g>"u"&&(g=!0);var m=b.font?b.font:"sans-serif",r=parseInt(b.fontSize)?parseInt(b.fontSize):18,e=x(b.fontColor,b.fontOpacity,{r:255,g:255,b:255,a:1}),t=b.padding?b.padding:4,n=b.borderThickness?b.borderThickness:0,o=x(b.backgroundColor,b.backgroundOpacity,{r:0,g:0,b:0,a:1}),h=x(b.borderColor,b.borderOpacity,o),f=b.position?b.position:{x:-10,y:1,z:1},i=b.inFront!==void 0?b.inFront:!0;(i==="false"||i==="0")&&(i=!1);var s=b.alignment||A.SpriteAlignment.topLeft;typeof s=="string"&&s in A.SpriteAlignment&&(s=A.SpriteAlignment[s]);var a="";b.bold&&(a="bold "),this.context.font=a+r+"px  "+m;var c=this.context.measureText(this.text),u=c.width;g||(n=0);var E=u+2.5*n+2*t,T=r*1.25+2*n+2*t;if(b.backgroundImage){var L=b.backgroundImage,P=b.backgroundWidth?b.backgroundWidth:L.width,I=b.backgroundHeight?b.backgroundHeight:L.height;P>E&&(E=P),I>T&&(T=I)}if(this.canvas.width=E,this.canvas.height=T,this.context.clearRect(0,0,this.canvas.width,this.canvas.height),a="",b.bold&&(a="bold "),this.context.font=a+r+"px  "+m,this.context.fillStyle="rgba("+o.r+","+o.g+","+o.b+","+o.a+")",this.context.strokeStyle="rgba("+h.r+","+h.g+","+h.b+","+h.a+")",b.backgroundGradient){let B=this.context.createLinearGradient(0,T/2,E,T/2),F=S.Gradient.getGradient(b.backgroundGradient),W=F.range(),U=-1,R=1;W&&(U=W[0],R=W[1]);let V=R-U;for(let q=0;q<1.01;q+=.1){let ee=x(F.valueToHex(U+V*q)),se="rgba("+ee.r+","+ee.g+","+ee.b+","+ee.a+")";B.addColorStop(q,se)}this.context.fillStyle=B}this.context.lineWidth=n,g&&p(this.context,n,n,E-2*n,T-2*n,6,n>0),b.backgroundImage&&this.context.drawImage(L,0,0,E,T),this.context.fillStyle="rgba("+e.r+","+e.g+","+e.b+","+e.a+")",this.context.fillText(this.text,n+t,r+n+t,u);var z=new A.Texture(this.canvas);z.needsUpdate=!0,this.sprite.material=new A.SpriteMaterial({map:z,useScreenCoordinates:_,alignment:s,depthTest:!i,screenOffset:b.screenOffset||null}),this.sprite.scale.set(1,1,1),this.sprite.position.set(f.x,f.y,f.z)}dispose(){this.sprite.material.map!==void 0&&this.sprite.material.map.dispose(),this.sprite.material!==void 0&&this.sprite.material.dispose()}}},"./src/ProteinSurface4.ts":(K,C,d)=>{d.r(C),d.d(C,{MarchingCube:()=>x,MarchingCubeInitializer:()=>p,PointGrid:()=>M,ProteinSurface:()=>v,SurfaceType:()=>S,setSyncSurface:()=>O,syncSurface:()=>w});var A=d("./src/WebGL/math/index.ts"),S;(function(b){b[b.VDW=1]="VDW",b[b.MS=2]="MS",b[b.SAS=3]="SAS",b[b.SES=4]="SES"})(S||(S={}));var w=!1;function O(b){w=b}(window.navigator.userAgent.indexOf("MSIE ")>=0||window.navigator.userAgent.indexOf("Trident/")>=0)&&(w=!0);class p{constructor(){this.ISDONE=2,this.edgeTable=new Uint32Array([0,0,0,0,0,0,0,2816,0,0,0,1792,0,3328,3584,3840,0,0,0,138,0,21,0,134,0,0,0,652,0,2067,3865,3600,0,0,0,42,0,0,0,294,0,0,21,28,0,3875,1049,3360,0,168,162,170,0,645,2475,2210,0,687,293,172,4010,3747,3497,3232,0,0,0,0,0,69,0,900,0,0,0,1792,138,131,1608,1920,0,81,0,2074,84,85,84,86,0,81,0,3676,330,1105,1881,1616,0,0,0,42,0,69,0,502,0,0,21,3580,138,2035,1273,1520,2816,104,2337,106,840,581,367,102,2816,3695,3429,3180,1898,1635,1385,1120,0,0,0,0,0,0,0,3910,0,0,69,588,42,2083,41,2880,0,0,0,1722,0,2293,4095,3830,0,255,757,764,2538,2291,3065,2800,0,0,81,338,0,3925,1119,3414,84,855,85,340,2130,2899,89,2384,1792,712,194,1162,4036,3781,3535,3270,708,719,197,204,3018,2755,2505,2240,0,0,0,0,168,420,168,1958,162,162,676,2988,170,163,680,928,3328,3096,3328,3642,52,53,1855,1590,2340,2111,2869,2620,298,51,825,560,3584,3584,3090,3482,1668,1941,1183,1430,146,2975,2069,2460,154,915,153,400,3840,3592,3329,3082,1796,1541,1295,1030,2818,2575,2309,2060,778,515,265,0]),this.triTable=[[],[],[],[],[],[],[],[11,9,8],[],[],[],[8,10,9],[],[10,8,11],[9,11,10],[8,10,9,8,11,10],[],[],[],[1,7,3],[],[4,2,0],[],[2,1,7],[],[],[],[2,7,3,2,9,7],[],[1,4,11,1,0,4],[3,8,0,11,9,4,11,10,9],[4,11,9,11,10,9],[],[],[],[5,3,1],[],[],[],[2,5,8,2,1,5],[],[],[2,4,0],[3,2,4],[],[0,9,1,8,10,5,8,11,10],[3,4,0,3,10,4],[5,8,10,8,11,10],[],[3,5,7],[7,1,5],[1,7,3,1,5,7],[],[9,2,0,9,7,2],[0,3,8,1,7,11,1,5,7],[11,1,7,1,5,7],[],[9,1,0,5,3,2,5,7,3],[8,2,5,8,0,2],[2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[],[],[],[],[],[0,6,2],[],[7,2,9,7,9,8],[],[],[],[8,10,9],[7,1,3],[7,1,0],[6,9,3,6,10,9],[7,10,8,10,9,8],[],[6,0,4],[],[11,1,4,11,3,1],[2,4,6],[2,0,4,2,4,6],[2,4,6],[1,4,2,4,6,2],[],[6,0,4],[],[2,11,3,6,9,4,6,10,9],[8,6,1,8,1,3],[10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[],[],[],[5,3,1],[],[0,6,2],[],[7,4,8,5,2,1,5,6,2],[],[],[2,4,0],[7,4,8,2,11,3,10,5,6],[7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[9,11,8],[3,5,6],[0,5,11,0,11,8],[6,3,5,3,1,5],[3,9,6,3,8,9],[9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[],[],[],[],[],[],[],[1,10,2,9,11,6,9,8,11],[],[],[6,0,2],[3,6,9,3,2,6],[3,5,1],[0,5,1,0,11,5],[0,3,5],[6,9,11,9,8,11],[],[],[],[4,5,9,7,1,10,7,3,1],[],[11,6,7,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[],[],[0,6,4],[8,6,4,8,1,6],[],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[4,2,6],[1,0,9,2,4,8,2,6,4],[2,4,0,2,6,4],[8,2,4,2,6,4],[11,4,1,11,6,4],[0,9,1,4,11,6,4,8,11],[3,6,0,6,4,0],[8,6,4,8,11,6],[10,8,9],[6,3,9,6,7,3],[6,7,1],[10,7,1,7,3,1],[7,11,6,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2],[1,0,9,3,6,7,3,2,6],[7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[],[],[],[],[5,3,7],[8,5,2,8,7,5],[5,3,7],[1,10,2,5,8,7,5,9,8],[1,7,5],[1,7,5],[9,2,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[0,7,1,7,5,1],[9,3,5,3,7,5],[9,7,5,9,8,7],[8,10,11],[3,4,10,3,10,11],[8,10,11],[5,9,4,1,11,3,1,10,11],[2,4,5],[5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[2,8,5,2,11,8],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[11,9,10],[11,9,10],[1,11,4,1,10,11],[8,7,4,11,1,10,11,3,1],[2,7,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[1,7,4],[3,2,11,4,8,7,9,1,0],[11,4,2,4,0,2],[2,11,3,7,4,8],[4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[3,9,11,9,10,11],[0,10,8,10,11,8],[10,3,1,10,11,3],[2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]],this.edgeTable2=[0,265,515,778,2060,2309,2575,2822,1030,1295,1541,1804,3082,3331,3593,3840,400,153,915,666,2460,2197,2975,2710,1430,1183,1941,1692,3482,3219,3993,3728,560,825,51,314,2620,2869,2111,2358,1590,1855,1077,1340,3642,3891,3129,3376,928,681,419,170,2988,2725,2479,2214,1958,1711,1445,1196,4010,3747,3497,3232,2240,2505,2755,3018,204,453,719,966,3270,3535,3781,4044,1226,1475,1737,1984,2384,2137,2899,2650,348,85,863,598,3414,3167,3925,3676,1370,1107,1881,1616,2800,3065,2291,2554,764,1013,255,502,3830,4095,3317,3580,1786,2035,1273,1520,2912,2665,2403,2154,876,613,367,102,3942,3695,3429,3180,1898,1635,1385,1120,1120,1385,1635,1898,3180,3429,3695,3942,102,367,613,876,2154,2403,2665,2912,1520,1273,2035,1786,3580,3317,4095,3830,502,255,1013,764,2554,2291,3065,2800,1616,1881,1107,1370,3676,3925,3167,3414,598,863,85,348,2650,2899,2137,2384,1984,1737,1475,1226,4044,3781,3535,3270,966,719,453,204,3018,2755,2505,2240,3232,3497,3747,4010,1196,1445,1711,1958,2214,2479,2725,2988,170,419,681,928,3376,3129,3891,3642,1340,1077,1855,1590,2358,2111,2869,2620,314,51,825,560,3728,3993,3219,3482,1692,1941,1183,1430,2710,2975,2197,2460,666,915,153,400,3840,3593,3331,3082,1804,1541,1295,1030,2822,2575,2309,2060,778,515,265,0],this.triTable2=[[],[8,3,0],[9,0,1],[8,3,1,8,1,9],[11,2,3],[11,2,0,11,0,8],[11,2,3,0,1,9],[2,1,11,1,9,11,11,9,8],[10,1,2],[8,3,0,1,2,10],[9,0,2,9,2,10],[3,2,8,2,10,8,8,10,9],[10,1,3,10,3,11],[1,0,10,0,8,10,10,8,11],[0,3,9,3,11,9,9,11,10],[8,10,9,8,11,10],[8,4,7],[3,0,4,3,4,7],[1,9,0,8,4,7],[9,4,1,4,7,1,1,7,3],[2,3,11,7,8,4],[7,11,4,11,2,4,4,2,0],[3,11,2,4,7,8,9,0,1],[2,7,11,2,1,7,1,4,7,1,9,4],[10,1,2,8,4,7],[2,10,1,0,4,7,0,7,3],[4,7,8,0,2,10,0,10,9],[2,7,3,2,9,7,7,9,4,2,10,9],[8,4,7,11,10,1,11,1,3],[11,4,7,1,4,11,1,11,10,1,0,4],[3,8,0,7,11,4,11,9,4,11,10,9],[7,11,4,4,11,9,11,10,9],[9,5,4],[3,0,8,4,9,5],[5,4,0,5,0,1],[4,8,5,8,3,5,5,3,1],[11,2,3,9,5,4],[9,5,4,8,11,2,8,2,0],[3,11,2,1,5,4,1,4,0],[8,5,4,2,5,8,2,8,11,2,1,5],[2,10,1,9,5,4],[0,8,3,5,4,9,10,1,2],[10,5,2,5,4,2,2,4,0],[3,4,8,3,2,4,2,5,4,2,10,5],[5,4,9,1,3,11,1,11,10],[0,9,1,4,8,5,8,10,5,8,11,10],[3,4,0,3,10,4,4,10,5,3,11,10],[4,8,5,5,8,10,8,11,10],[9,5,7,9,7,8],[0,9,3,9,5,3,3,5,7],[8,0,7,0,1,7,7,1,5],[1,7,3,1,5,7],[11,2,3,8,9,5,8,5,7],[9,2,0,9,7,2,2,7,11,9,5,7],[0,3,8,2,1,11,1,7,11,1,5,7],[2,1,11,11,1,7,1,5,7],[1,2,10,5,7,8,5,8,9],[9,1,0,10,5,2,5,3,2,5,7,3],[5,2,10,8,2,5,8,5,7,8,0,2],[10,5,2,2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[11,7,6],[0,8,3,11,7,6],[9,0,1,11,7,6],[7,6,11,3,1,9,3,9,8],[2,3,7,2,7,6],[8,7,0,7,6,0,0,6,2],[1,9,0,3,7,6,3,6,2],[7,6,2,7,2,9,2,1,9,7,9,8],[1,2,10,6,11,7],[2,10,1,7,6,11,8,3,0],[11,7,6,10,9,0,10,0,2],[7,6,11,3,2,8,8,2,10,8,10,9],[6,10,7,10,1,7,7,1,3],[6,10,1,6,1,7,7,1,0,7,0,8],[9,0,3,6,9,3,6,10,9,6,3,7],[6,10,7,7,10,8,10,9,8],[8,4,6,8,6,11],[11,3,6,3,0,6,6,0,4],[0,1,9,4,6,11,4,11,8],[1,9,4,11,1,4,11,3,1,11,4,6],[3,8,2,8,4,2,2,4,6],[2,0,4,2,4,6],[1,9,0,3,8,2,2,8,4,2,4,6],[9,4,1,1,4,2,4,6,2],[10,1,2,11,8,4,11,4,6],[10,1,2,11,3,6,6,3,0,6,0,4],[0,2,10,0,10,9,4,11,8,4,6,11],[2,11,3,6,9,4,6,10,9],[8,4,6,8,6,1,6,10,1,8,1,3],[1,0,10,10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[9,5,4,7,6,11],[4,9,5,3,0,8,11,7,6],[6,11,7,4,0,1,4,1,5],[6,11,7,4,8,5,5,8,3,5,3,1],[4,9,5,6,2,3,6,3,7],[9,5,4,8,7,0,0,7,6,0,6,2],[4,0,1,4,1,5,6,3,7,6,2,3],[7,4,8,5,2,1,5,6,2],[6,11,7,1,2,10,9,5,4],[11,7,6,8,3,0,1,2,10,9,5,4],[11,7,6,10,5,2,2,5,4,2,4,0],[7,4,8,2,11,3,10,5,6],[4,9,5,6,10,7,7,10,1,7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[5,6,9,6,11,9,9,11,8],[0,9,5,0,5,3,3,5,6,3,6,11],[0,1,5,0,5,11,5,6,11,0,11,8],[11,3,6,6,3,5,3,1,5],[9,5,6,3,9,6,3,8,9,3,6,2],[5,6,9,9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[1,2,10,5,6,9,9,6,11,9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[10,6,5],[8,3,0,10,6,5],[0,1,9,5,10,6],[10,6,5,9,8,3,9,3,1],[3,11,2,10,6,5],[6,5,10,2,0,8,2,8,11],[1,9,0,6,5,10,11,2,3],[1,10,2,5,9,6,9,11,6,9,8,11],[1,2,6,1,6,5],[0,8,3,2,6,5,2,5,1],[5,9,6,9,0,6,6,0,2],[9,6,5,3,6,9,3,9,8,3,2,6],[11,6,3,6,5,3,3,5,1],[0,5,1,0,11,5,5,11,6,0,8,11],[0,5,9,0,3,5,3,6,5,3,11,6],[5,9,6,6,9,11,9,8,11],[10,6,5,4,7,8],[5,10,6,7,3,0,7,0,4],[5,10,6,0,1,9,8,4,7],[4,5,9,6,7,10,7,1,10,7,3,1],[7,8,4,2,3,11,10,6,5],[11,6,7,10,2,5,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[7,8,4,5,1,2,5,2,6],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,8,0,7,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,4,5,8,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[10,6,4,10,4,9],[8,3,0,9,10,6,9,6,4],[1,10,0,10,6,0,0,6,4],[8,6,4,8,1,6,6,1,10,8,3,1],[2,3,11,6,4,9,6,9,10],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,11,6,3,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[9,1,4,1,2,4,4,2,6],[1,0,9,3,2,8,2,4,8,2,6,4],[2,4,0,2,6,4],[3,2,8,8,2,4,2,6,4],[1,4,9,11,4,1,11,1,3,11,6,4],[0,9,1,4,11,6,4,8,11],[11,6,3,3,6,0,6,4,0],[8,6,4,8,11,6],[6,7,10,7,8,10,10,8,9],[9,3,0,6,3,9,6,9,10,6,7,3],[6,1,10,6,7,1,7,0,1,7,8,0],[6,7,10,10,7,1,7,3,1],[7,11,6,3,8,2,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2,2,9,1,7,8,9],[1,0,9,3,6,7,3,2,6],[8,0,7,7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[11,7,5,11,5,10],[3,0,8,7,5,10,7,10,11],[9,0,1,10,11,7,10,7,5],[3,1,9,3,9,8,7,10,11,7,5,10],[10,2,5,2,3,5,5,3,7],[5,10,2,8,5,2,8,7,5,8,2,0],[9,0,1,10,2,5,5,2,3,5,3,7],[1,10,2,5,8,7,5,9,8],[2,11,1,11,7,1,1,7,5],[0,8,3,2,11,1,1,11,7,1,7,5],[9,0,2,9,2,7,2,11,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[8,7,0,0,7,1,7,5,1],[0,3,9,9,3,5,3,7,5],[9,7,5,9,8,7],[4,5,8,5,10,8,8,10,11],[3,0,4,3,4,10,4,5,10,3,10,11],[0,1,9,4,5,8,8,5,10,8,10,11],[5,9,4,1,11,3,1,10,11],[3,8,4,3,4,2,2,4,5,2,5,10],[10,2,5,5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[8,4,5,2,8,5,2,11,8,2,5,1],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[4,5,8,8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[7,4,11,4,9,11,11,9,10],[3,0,8,7,4,11,11,4,9,11,9,10],[11,7,4,1,11,4,1,10,11,1,4,0],[8,7,4,11,1,10,11,3,1],[2,3,7,2,7,9,7,4,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[2,11,7,2,7,1,1,7,4,1,4,9],[3,2,11,4,8,7,9,1,0],[7,4,11,11,4,2,4,0,2],[2,11,3,7,4,8],[9,1,4,4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[0,9,3,3,9,11,9,10,11],[1,10,0,0,10,8,10,11,8],[10,3,1,10,11,3],[3,8,2,2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[2,11,1,1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]]}march(_,g,m,r){let e=!!r.fulltable,t=r.hasOwnProperty("origin")&&r.origin.hasOwnProperty("x")?r.origin:{x:0,y:0,z:0},n=!!r.voxel,o=r.matrix,h=r.nX||0,f=r.nY||0,i=r.nZ||0,s=r.scale||1,a=null;r.unitCube?a=r.unitCube:a={x:s,y:s,z:s};let c=new Int32Array(h*f*i),u,E;for(u=0,E=c.length;u<E;++u)c[u]=-1;let T=function(z,B,F,W,U,R){let V={x:0,y:0,z:0},q=!!(W&1<<U),ee=!!(W&1<<R),se=U;if(!q&&ee&&(se=R),se&1&&F++,se&2&&B++,se&4&&z++,o){let le=new A.Vector3(z,B,F);le=le.applyMatrix4(o),V={x:le.x,y:le.y,z:le.z}}else V.x=t.x+a.x*z,V.y=t.y+a.y*B,V.z=t.z+a.z*F;let ie=(f*z+B)*i+F;return n?(g.push(V),g.length-1):(c[ie]<0&&(c[ie]=g.length,g.push(V)),c[ie])},L=new Int32Array(12),P=e?this.edgeTable2:this.edgeTable,I=e?this.triTable2:this.triTable;for(u=0;u<h-1;++u)for(let z=0;z<f-1;++z)for(let B=0;B<i-1;++B){let F=0;for(let R=0;R<8;++R){let V=(f*(u+((R&4)>>2))+z+((R&2)>>1))*i+B+(R&1),q=!!(_[V]&this.ISDONE);F|=q<<R}if(F===0||F===255)continue;let W=P[F];if(W===0)continue;let U=I[F];W&1&&(L[0]=T(u,z,B,F,0,1)),W&2&&(L[1]=T(u,z,B,F,1,3)),W&4&&(L[2]=T(u,z,B,F,3,2)),W&8&&(L[3]=T(u,z,B,F,2,0)),W&16&&(L[4]=T(u,z,B,F,4,5)),W&32&&(L[5]=T(u,z,B,F,5,7)),W&64&&(L[6]=T(u,z,B,F,7,6)),W&128&&(L[7]=T(u,z,B,F,6,4)),W&256&&(L[8]=T(u,z,B,F,0,4)),W&512&&(L[9]=T(u,z,B,F,1,5)),W&1024&&(L[10]=T(u,z,B,F,3,7)),W&2048&&(L[11]=T(u,z,B,F,2,6));for(let R=0;R<U.length;R+=3){let V=L[U[R]],q=L[U[R+1]],ee=L[U[R+2]];n&&R>=3&&(g.push(g[V]),V=g.length-1,g.push(g[q]),q=g.length-1,g.push(g[ee]),ee=g.length-1),m.push(V),m.push(q),m.push(ee)}}}laplacianSmooth(_,g,m){let r=new Array(g.length),e,t,n,o,h;for(e=0,t=g.length;e<t;e++)r[e]={x:0,y:0,z:0};let f=new Array(20),i;for(e=0;e<20;e++)f[e]=new Array(g.length);for(e=0,t=g.length;e<t;e++)f[0][e]=0;for(e=0,t=m.length/3;e<t;e++){let c=e*3,u=e*3+1,E=e*3+2;for(i=!0,n=0,o=f[0][m[c]];n<o;n++)if(m[u]==f[n+1][m[c]]){i=!1;break}for(i&&(f[0][m[c]]++,f[f[0][m[c]]][m[c]]=m[u]),i=!0,n=0,o=f[0][m[c]];n<o;n++)if(m[E]==f[n+1][m[c]]){i=!1;break}for(i&&(f[0][m[c]]++,f[f[0][m[c]]][m[c]]=m[E]),i=!0,n=0,o=f[0][m[u]];n<o;n++)if(m[c]==f[n+1][m[u]]){i=!1;break}for(i&&(f[0][m[u]]++,f[f[0][m[u]]][m[u]]=m[c]),i=!0,n=0,o=f[0][m[u]];n<o;n++)if(m[E]==f[n+1][m[u]]){i=!1;break}for(i&&(f[0][m[u]]++,f[f[0][m[u]]][m[u]]=m[E]),i=!0,n=0;n<f[0][m[E]];n++)if(m[c]==f[n+1][m[E]]){i=!1;break}for(i&&(f[0][m[E]]++,f[f[0][m[E]]][m[E]]=m[c]),i=!0,n=0,o=f[0][m[E]];n<o;n++)if(m[u]==f[n+1][m[E]]){i=!1;break}i&&(f[0][m[E]]++,f[f[0][m[E]]][m[E]]=m[u])}let s=1,a=.5;for(h=0;h<_;h++){for(e=0,t=g.length;e<t;e++)if(f[0][e]<3)r[e].x=g[e].x,r[e].y=g[e].y,r[e].z=g[e].z;else if(f[0][e]==3||f[0][e]==4){for(r[e].x=0,r[e].y=0,r[e].z=0,n=0,o=f[0][e];n<o;n++)r[e].x+=g[f[n+1][e]].x,r[e].y+=g[f[n+1][e]].y,r[e].z+=g[f[n+1][e]].z;r[e].x+=a*g[e].x,r[e].y+=a*g[e].y,r[e].z+=a*g[e].z,r[e].x/=a+f[0][e],r[e].y/=a+f[0][e],r[e].z/=a+f[0][e]}else{for(r[e].x=0,r[e].y=0,r[e].z=0,n=0,o=f[0][e];n<o;n++)r[e].x+=g[f[n+1][e]].x,r[e].y+=g[f[n+1][e]].y,r[e].z+=g[f[n+1][e]].z;r[e].x+=s*g[e].x,r[e].y+=s*g[e].y,r[e].z+=s*g[e].z,r[e].x/=s+f[0][e],r[e].y/=s+f[0][e],r[e].z/=s+f[0][e]}for(e=0,t=g.length;e<t;e++)g[e].x=r[e].x,g[e].y=r[e].y,g[e].z=r[e].z}}}let x=new p;class M{constructor(_,g,m){this.data=new Int32Array(_*g*m*3),this.width=g,this.height=m}set(_,g,m,r){let e=((_*this.width+g)*this.height+m)*3;this.data[e]=r.ix,this.data[e+1]=r.iy,this.data[e+2]=r.iz}get(_,g,m){let r=((_*this.width+g)*this.height+m)*3;return{ix:this.data[r],iy:this.data[r+1],iz:this.data[r+2]}}}class v{constructor(){this.INOUT=1,this.ISDONE=2,this.ISBOUND=4,this.ptranx=0,this.ptrany=0,this.ptranz=0,this.probeRadius=1.4,this.defaultScaleFactor=2,this.scaleFactor=this.defaultScaleFactor,this.pHeight=0,this.pWidth=0,this.pLength=0,this.cutRadius=0,this.vpBits=null,this.vpDistance=null,this.vpAtomID=null,this.pminx=0,this.pminy=0,this.pminz=0,this.pmaxx=0,this.pmaxy=0,this.pmaxz=0,this.depty={},this.widxz={},this.faces=[],this.verts=[],this.vdwRadii={H:1.2,Li:1.82,Na:2.27,K:2.75,C:1.7,N:1.55,O:1.52,F:1.47,P:1.8,S:1.8,CL:1.75,BR:1.85,SE:1.9,ZN:1.39,CU:1.4,NI:1.63,X:2},this.nb=[new Int32Array([1,0,0]),new Int32Array([-1,0,0]),new Int32Array([0,1,0]),new Int32Array([0,-1,0]),new Int32Array([0,0,1]),new Int32Array([0,0,-1]),new Int32Array([1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,1]),new Int32Array([0,-1,-1]),new Int32Array([1,1,1]),new Int32Array([1,1,-1]),new Int32Array([1,-1,1]),new Int32Array([-1,1,1]),new Int32Array([1,-1,-1]),new Int32Array([-1,-1,1]),new Int32Array([-1,1,-1]),new Int32Array([-1,-1,-1])],v.MarchingCube||(v.MarchingCube=new p)}getVDWIndex(_){return!_.elem||typeof this.vdwRadii[_.elem]>"u"?"X":_.elem}getFacesAndVertices(_){let g={};for(let e=0,t=_.length;e<t;e++)g[_[e]]=!0;let m=this.verts;for(let e=0,t=m.length;e<t;e++)m[e].x=m[e].x/this.scaleFactor-this.ptranx,m[e].y=m[e].y/this.scaleFactor-this.ptrany,m[e].z=m[e].z/this.scaleFactor-this.ptranz;let r=[];for(let e=0,t=this.faces.length;e<t;e+=3){let n=this.faces[e],o=this.faces[e+1],h=this.faces[e+2],f=m[n].atomid,i=m[o].atomid,s=m[h].atomid,a=f;i<a&&(a=i),s<a&&(a=s),g[a]&&n!==o&&o!==h&&n!==h&&(r.push(n),r.push(o),r.push(h))}return this.vpBits=null,this.vpDistance=null,this.vpAtomID=null,{vertices:m,faces:r}}initparm(_,g,m){m>1e6&&(this.scaleFactor=this.defaultScaleFactor/2);let r=1/this.scaleFactor*5.5;this.pminx=_[0][0],this.pmaxx=_[1][0],this.pminy=_[0][1],this.pmaxy=_[1][1],this.pminz=_[0][2],this.pmaxz=_[1][2],g?(this.pminx-=this.probeRadius+r,this.pminy-=this.probeRadius+r,this.pminz-=this.probeRadius+r,this.pmaxx+=this.probeRadius+r,this.pmaxy+=this.probeRadius+r,this.pmaxz+=this.probeRadius+r):(this.pminx-=r,this.pminy-=r,this.pminz-=r,this.pmaxx+=r,this.pmaxy+=r,this.pmaxz+=r),this.pminx=Math.floor(this.pminx*this.scaleFactor)/this.scaleFactor,this.pminy=Math.floor(this.pminy*this.scaleFactor)/this.scaleFactor,this.pminz=Math.floor(this.pminz*this.scaleFactor)/this.scaleFactor,this.pmaxx=Math.ceil(this.pmaxx*this.scaleFactor)/this.scaleFactor,this.pmaxy=Math.ceil(this.pmaxy*this.scaleFactor)/this.scaleFactor,this.pmaxz=Math.ceil(this.pmaxz*this.scaleFactor)/this.scaleFactor,this.ptranx=-this.pminx,this.ptrany=-this.pminy,this.ptranz=-this.pminz,this.pLength=Math.ceil(this.scaleFactor*(this.pmaxx-this.pminx))+1,this.pWidth=Math.ceil(this.scaleFactor*(this.pmaxy-this.pminy))+1,this.pHeight=Math.ceil(this.scaleFactor*(this.pmaxz-this.pminz))+1,this.boundingatom(g),this.cutRadius=this.probeRadius*this.scaleFactor,this.vpBits=new Uint8Array(this.pLength*this.pWidth*this.pHeight),this.vpDistance=new Float64Array(this.pLength*this.pWidth*this.pHeight),this.vpAtomID=new Int32Array(this.pLength*this.pWidth*this.pHeight)}boundingatom(_){let g={};for(const m in this.vdwRadii){let r=this.vdwRadii[m];_?g[m]=(r+this.probeRadius)*this.scaleFactor+.5:g[m]=r*this.scaleFactor+.5;let e=g[m]*g[m];this.widxz[m]=Math.floor(g[m])+1,this.depty[m]=new Int32Array(this.widxz[m]*this.widxz[m]);let t=0;for(let n=0;n<this.widxz[m];n++)for(let o=0;o<this.widxz[m];o++){let h=n*n+o*o;if(h>e)this.depty[m][t]=-1;else{let f=Math.sqrt(e-h);this.depty[m][t]=Math.floor(f)}t++}}}fillvoxels(_,g){for(let m=0,r=this.vpBits.length;m<r;m++)this.vpBits[m]=0,this.vpDistance[m]=-1,this.vpAtomID[m]=-1;for(let m in g){let r=_[g[m]];r!==void 0&&this.fillAtom(r,_)}for(let m=0,r=this.vpBits.length;m<r;m++)this.vpBits[m]&this.INOUT&&(this.vpBits[m]|=this.ISDONE)}fillAtom(_,g){let m=Math.floor(.5+this.scaleFactor*(_.x+this.ptranx)),r=Math.floor(.5+this.scaleFactor*(_.y+this.ptrany)),e=Math.floor(.5+this.scaleFactor*(_.z+this.ptranz)),t=this.getVDWIndex(_),n=0,o=this.pWidth*this.pHeight;for(let h=0,f=this.widxz[t];h<f;h++)for(let i=0;i<f;i++){if(this.depty[t][n]!=-1){for(let s=-1;s<2;s++)for(let a=-1;a<2;a++)for(let c=-1;c<2;c++)if(s!==0&&a!==0&&c!==0){let u=s*h,E=c*i;for(let T=0;T<=this.depty[t][n];T++){let L=T*a,P=m+u,I=r+L,z=e+E;if(P<0||I<0||z<0||P>=this.pLength||I>=this.pWidth||z>=this.pHeight)continue;let B=P*o+I*this.pHeight+z;if(!(this.vpBits[B]&this.INOUT))this.vpBits[B]|=this.INOUT,this.vpAtomID[B]=_.serial;else{let F=g[this.vpAtomID[B]];if(F.serial!=_.serial){let W=m+u-Math.floor(.5+this.scaleFactor*(F.x+this.ptranx)),U=r+L-Math.floor(.5+this.scaleFactor*(F.y+this.ptrany)),R=e+E-Math.floor(.5+this.scaleFactor*(F.z+this.ptranz));u*u+L*L+E*E<W*W+U*U+R*R&&(this.vpAtomID[B]=_.serial)}}}}}n++}}fillvoxelswaals(_,g){for(let m=0,r=this.vpBits.length;m<r;m++)this.vpBits[m]&=~this.ISDONE;for(let m in g){let r=_[g[m]];r!==void 0&&this.fillAtomWaals(r,_)}}fillAtomWaals(_,g){let m=0,r=Math.floor(.5+this.scaleFactor*(_.x+this.ptranx)),e=Math.floor(.5+this.scaleFactor*(_.y+this.ptrany)),t=Math.floor(.5+this.scaleFactor*(_.z+this.ptranz)),n=this.getVDWIndex(_),o=this.pWidth*this.pHeight;for(let h=0,f=this.widxz[n];h<f;h++)for(let i=0;i<f;i++){if(this.depty[n][m]!=-1){for(let s=-1;s<2;s++)for(let a=-1;a<2;a++)for(let c=-1;c<2;c++)if(s!==0&&a!==0&&c!==0){let u=s*h,E=c*i;for(let T=0;T<=this.depty[n][m];T++){let L=T*a,P=r+u,I=e+L,z=t+E;if(P<0||I<0||z<0||P>=this.pLength||I>=this.pWidth||z>=this.pHeight)continue;let B=P*o+I*this.pHeight+z;if(!(this.vpBits[B]&this.ISDONE))this.vpBits[B]|=this.ISDONE,this.vpAtomID[B]=_.serial;else{let F=g[this.vpAtomID[B]];if(F.serial!=_.serial){let W=r+u-Math.floor(.5+this.scaleFactor*(F.x+this.ptranx)),U=e+L-Math.floor(.5+this.scaleFactor*(F.y+this.ptrany)),R=t+E-Math.floor(.5+this.scaleFactor*(F.z+this.ptranz));u*u+L*L+E*E<W*W+U*U+R*R&&(this.vpAtomID[B]=_.serial)}}}}}m++}}buildboundary(){let _=this.pWidth*this.pHeight;for(let g=0;g<this.pLength;g++)for(let m=0;m<this.pHeight;m++)for(let r=0;r<this.pWidth;r++){let e=g*_+r*this.pHeight+m;if(this.vpBits[e]&this.INOUT){let t=0;for(;t<26;){let n=g+this.nb[t][0],o=m+this.nb[t][2],h=r+this.nb[t][1];if(n>-1&&n<this.pLength&&h>-1&&h<this.pWidth&&o>-1&&o<this.pHeight&&!(this.vpBits[n*_+h*this.pHeight+o]&this.INOUT)){this.vpBits[e]|=this.ISBOUND;break}else t++}}}}fastdistancemap(){let _=new M(this.pLength,this.pWidth,this.pHeight),g=this.pWidth*this.pHeight,m=this.cutRadius*this.cutRadius,r=[],e=[],t;for(let h=0;h<this.pLength;h++)for(let f=0;f<this.pWidth;f++)for(let i=0;i<this.pHeight;i++)if(t=h*g+f*this.pHeight+i,this.vpBits[t]&=~this.ISDONE,this.vpBits[t]&this.INOUT&&this.vpBits[t]&this.ISBOUND){let s={ix:h,iy:f,iz:i};_.set(h,f,i,s),r.push(s),this.vpDistance[t]=0,this.vpBits[t]|=this.ISDONE,this.vpBits[t]&=~this.ISBOUND}do{e=this.fastoneshell(r,_),r=[];for(let h=0,f=e.length;h<f;h++)t=g*e[h].ix+this.pHeight*e[h].iy+e[h].iz,this.vpBits[t]&=~this.ISBOUND,this.vpDistance[t]<=1.0404*m&&r.push({ix:e[h].ix,iy:e[h].iy,iz:e[h].iz})}while(r.length!==0);r=[],e=[],_=null;let n=this.scaleFactor-.5;n<0&&(n=0);let o=m-.5/(.1+n);for(let h=0;h<this.pLength;h++)for(let f=0;f<this.pWidth;f++)for(let i=0;i<this.pHeight;i++)t=h*g+f*this.pHeight+i,this.vpBits[t]&=~this.ISBOUND,this.vpBits[t]&this.INOUT&&(!(this.vpBits[t]&this.ISDONE)||this.vpBits[t]&this.ISDONE&&this.vpDistance[t]>=o)&&(this.vpBits[t]|=this.ISBOUND)}fastoneshell(_,g){let m,r,e,t,n,o,h,f,i,s=[];if(_.length===0)return s;let a={ix:-1,iy:-1,iz:-1},c=this.pWidth*this.pHeight;for(let u=0,E=_.length;u<E;u++){m=_[u].ix,r=_[u].iy,e=_[u].iz,f=g.get(m,r,e);for(let T=0;T<6;T++)a.ix=m+this.nb[T][0],a.iy=r+this.nb[T][1],a.iz=e+this.nb[T][2],a.ix<this.pLength&&a.ix>-1&&a.iy<this.pWidth&&a.iy>-1&&a.iz<this.pHeight&&a.iz>-1&&(i=a.ix*c+this.pHeight*a.iy+a.iz,this.vpBits[i]&this.INOUT&&!(this.vpBits[i]&this.ISDONE)?(g.set(a.ix,a.iy,e+this.nb[T][2],f),t=a.ix-f.ix,n=a.iy-f.iy,o=a.iz-f.iz,h=t*t+n*n+o*o,this.vpDistance[i]=h,this.vpBits[i]|=this.ISDONE,this.vpBits[i]|=this.ISBOUND,s.push({ix:a.ix,iy:a.iy,iz:a.iz})):this.vpBits[i]&this.INOUT&&this.vpBits[i]&this.ISDONE&&(t=a.ix-f.ix,n=a.iy-f.iy,o=a.iz-f.iz,h=t*t+n*n+o*o,h<this.vpDistance[i]&&(g.set(a.ix,a.iy,a.iz,f),this.vpDistance[i]=h,this.vpBits[i]&this.ISBOUND||(this.vpBits[i]|=this.ISBOUND,s.push({ix:a.ix,iy:a.iy,iz:a.iz})))))}for(let u=0,E=_.length;u<E;u++){m=_[u].ix,r=_[u].iy,e=_[u].iz,f=g.get(m,r,e);for(let T=6;T<18;T++)a.ix=m+this.nb[T][0],a.iy=r+this.nb[T][1],a.iz=e+this.nb[T][2],a.ix<this.pLength&&a.ix>-1&&a.iy<this.pWidth&&a.iy>-1&&a.iz<this.pHeight&&a.iz>-1&&(i=a.ix*c+this.pHeight*a.iy+a.iz,this.vpBits[i]&this.INOUT&&!(this.vpBits[i]&this.ISDONE)?(g.set(a.ix,a.iy,e+this.nb[T][2],f),t=a.ix-f.ix,n=a.iy-f.iy,o=a.iz-f.iz,h=t*t+n*n+o*o,this.vpDistance[i]=h,this.vpBits[i]|=this.ISDONE,this.vpBits[i]|=this.ISBOUND,s.push({ix:a.ix,iy:a.iy,iz:a.iz})):this.vpBits[i]&this.INOUT&&this.vpBits[i]&this.ISDONE&&(t=a.ix-f.ix,n=a.iy-f.iy,o=a.iz-f.iz,h=t*t+n*n+o*o,h<this.vpDistance[i]&&(g.set(a.ix,a.iy,a.iz,f),this.vpDistance[i]=h,this.vpBits[i]&this.ISBOUND||(this.vpBits[i]|=this.ISBOUND,s.push({ix:a.ix,iy:a.iy,iz:a.iz})))))}for(let u=0,E=_.length;u<E;u++){m=_[u].ix,r=_[u].iy,e=_[u].iz,f=g.get(m,r,e);for(let T=18;T<26;T++)a.ix=m+this.nb[T][0],a.iy=r+this.nb[T][1],a.iz=e+this.nb[T][2],a.ix<this.pLength&&a.ix>-1&&a.iy<this.pWidth&&a.iy>-1&&a.iz<this.pHeight&&a.iz>-1&&(i=a.ix*c+this.pHeight*a.iy+a.iz,this.vpBits[i]&this.INOUT&&!(this.vpBits[i]&this.ISDONE)?(g.set(a.ix,a.iy,e+this.nb[T][2],f),t=a.ix-f.ix,n=a.iy-f.iy,o=a.iz-f.iz,h=t*t+n*n+o*o,this.vpDistance[i]=h,this.vpBits[i]|=this.ISDONE,this.vpBits[i]|=this.ISBOUND,s.push({ix:a.ix,iy:a.iy,iz:a.iz})):this.vpBits[i]&this.INOUT&&this.vpBits[i]&this.ISDONE&&(t=a.ix-f.ix,n=a.iy-f.iy,o=a.iz-f.iz,h=t*t+n*n+o*o,h<this.vpDistance[i]&&(g.set(a.ix,a.iy,a.iz,f),this.vpDistance[i]=h,this.vpBits[i]&this.ISBOUND||(this.vpBits[i]|=this.ISBOUND,s.push({ix:a.ix,iy:a.iy,iz:a.iz})))))}return s}marchingcubeinit(_){for(let g=0,m=this.vpBits.length;g<m;g++)_==1?this.vpBits[g]&=~this.ISBOUND:_==4?(this.vpBits[g]&=~this.ISDONE,this.vpBits[g]&this.ISBOUND&&(this.vpBits[g]|=this.ISDONE),this.vpBits[g]&=~this.ISBOUND):_==2?this.vpBits[g]&this.ISBOUND&&this.vpBits[g]&this.ISDONE?this.vpBits[g]&=~this.ISBOUND:this.vpBits[g]&this.ISBOUND&&!(this.vpBits[g]&this.ISDONE)&&(this.vpBits[g]|=this.ISDONE):_==3&&(this.vpBits[g]&=~this.ISBOUND)}marchingcube(_){this.marchingcubeinit(_),this.verts=[],this.faces=[],v.MarchingCube.march(this.vpBits,this.verts,this.faces,{smooth:1,nX:this.pLength,nY:this.pWidth,nZ:this.pHeight});let g=this.pWidth*this.pHeight;for(let m=0,r=this.verts.length;m<r;m++)this.verts[m].atomid=this.vpAtomID[this.verts[m].x*g+this.pHeight*this.verts[m].y+this.verts[m].z];v.MarchingCube.laplacianSmooth(1,this.verts,this.faces)}}v.MarchingCube=new p},"./src/SurfaceWorker.js":()=>{$3Dmol.workerString=(function(){self.onmessage=function(K){var C=K.data,d=C.type;if(d<0)self.atomData=C.atoms,self.volume=C.volume,self.ps=new ProteinSurface;else{var A=self.ps;A.initparm(C.expandedExtent,d!=1,self.volume),A.fillvoxels(self.atomData,C.extendedAtoms),A.buildboundary(),(d===4||d===2)&&(A.fastdistancemap(),A.boundingatom(!1),A.fillvoxelswaals(self.atomData,C.extendedAtoms)),A.marchingcube(d);var S=A.getFacesAndVertices(C.atomsToShow);self.postMessage(S)}}}).toString().replace(/(^.*?\{|\}$)/g,""),$3Dmol.workerString+=`;
function _classCallCheck() {};`,$3Dmol.workerString+=`;
`+$3Dmol.Vector3.toString(),$3Dmol.workerString+=`;
`+$3Dmol.MarchingCubeInitializer.toString()+`;

`,$3Dmol.workerString+=`;
`+$3Dmol.PointGrid.toString()+`;
`,$3Dmol.workerString+=`;
var ProteinSurface = `+$3Dmol.ProteinSurface.toString()+`;
`,$3Dmol.SurfaceWorker=window.URL?window.URL.createObjectURL(new Blob([$3Dmol.workerString],{type:"text/javascript"})):void 0},"./src/VolumeData.ts":(K,C,d)=>{d.r(C),d.d(C,{VolumeData:()=>x});var A=d("./src/utilities.ts"),S=d("./src/WebGL/math/index.ts"),w=d("./src/parsers/VASP.ts"),O=d("./src/parsers/CUBE.ts"),p=d("./node_modules/pako/dist/pako.esm.mjs");class x{constructor(v,b,_){if(this.unit={x:1,y:1,z:1},this.origin={x:0,y:0,z:0},this.size={x:0,y:0,z:0},this.data=new Float32Array([]),this.matrix=null,this.inversematrix=null,this.isbinary=new Set(["ccp4","CCP4"]),this.getCoordinates=function(t){var n=t/(this.size.y*this.size.z),o=t%(this.size.y*this.size.z),h=t%this.size.z;return n*=this.unit.x,o*=this.unit.y,h*=this.unit.z,n+=this.origin.x,o+=this.origin.y,h+=this.origin.z,{x:n,y:o,z:h}},this.vasp=function(t){var n=t.replace(/^\s+/,"").split(/[\n\r]/),o=(0,w.VASP)(t)[0],h=o.length;if(h==0){console.warn("No good formating of CHG or CHGCAR file, not atomic information provided in the file."),this.data=[];return}var f=1.889725992,i=.036749309,s=parseFloat(n[1]),a;a=n[2].replace(/^\s+/,"").split(/\s+/);var c=new S.Vector3(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2])).multiplyScalar(s*f);a=n[3].replace(/^\s+/,"").split(/\s+/);var u=new S.Vector3(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2])).multiplyScalar(s*f);a=n[4].replace(/^\s+/,"").split(/\s+/);var E=new S.Vector3(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2])).multiplyScalar(s*f),T=c.x*(u.y*E.z-E.y*u.z)-u.x*(c.y*E.z-E.y*c.z)+E.x*(c.y*u.z-u.y*c.z);T=Math.abs(T)/Math.pow(f,3);var L=1/T;n.splice(0,8+h+1);var P=n[0].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),I=Math.abs(parseFloat(P[0])),z=Math.abs(parseFloat(P[1])),B=Math.abs(parseFloat(P[2])),F=this.origin=new S.Vector3(0,0,0);this.size={x:I,y:z,z:B},this.unit=new S.Vector3(c.x,u.y,E.z),c=c.multiplyScalar(1/(f*I)),u=u.multiplyScalar(1/(f*z)),E=E.multiplyScalar(1/(f*B)),(c.y!=0||c.z!=0||u.x!=0||u.z!=0||E.x!=0||E.y!=0)&&(this.matrix=new S.Matrix4(c.x,u.x,E.x,0,c.y,u.y,E.y,0,c.z,u.z,E.z,0,0,0,0,1),this.matrix=this.matrix.multiplyMatrices(this.matrix,new S.Matrix4().makeTranslation(F.x,F.y,F.z)),this.origin=new S.Vector3(0,0,0),this.unit=new S.Vector3(1,1,1)),n.splice(0,1);var W=n.join(" ");W=W.replace(/^\s+/,"");var U=W.split(/[\s\r]+/);U.splice(I*z*B+1);for(var R=Float32Array.from(U,parseFloat),V=0;V<R.length;V++)R[V]=R[V]*L*i;this.data=R},this.dx=function(t){var n=t.split(/[\n\r]+/),o,h=/gridpositions\s+counts\s+(\d+)\s+(\d+)\s+(\d+)/,f=/^origin\s+(\S+)\s+(\S+)\s+(\S+)/,i=/^delta\s+(\S+)\s+(\S+)\s+(\S+)/,s=/data follows/,a=0;for(a=0;a<n.length;a++){var c=n[a];if(o=h.exec(c)){var u=parseInt(o[1]),E=parseInt(o[2]),T=parseInt(o[3]);this.size={x:u,y:E,z:T}}else if(o=i.exec(c)){var L=parseFloat(o[1]);if((parseFloat(o[2])!=0||parseFloat(o[3])!=0)&&console.warn("Non-orthogonal delta matrix not currently supported in dx format"),a+=1,c=n[a],o=i.exec(c),o==null){console.error("Parse error in dx delta matrix");return}var P=parseFloat(o[2]);if((parseFloat(o[1])!=0||parseFloat(o[3])!=0)&&console.warn("Non-orthogonal delta matrix not currently supported in dx format"),a+=1,c=n[a],o=i.exec(c),o==null){console.error("Parse error in dx delta matrix");return}var I=parseFloat(o[3]);(parseFloat(o[1])!=0||parseFloat(o[2])!=0)&&console.warn("Non-orthogonal delta matrix not currently supported in dx format"),this.unit=new S.Vector3(L,P,I)}else if(o=f.exec(c)){var z=parseFloat(o[1]),B=parseFloat(o[2]),F=parseFloat(o[3]);this.origin=new S.Vector3(z,B,F)}else if(o=s.exec(c))break}if(a+=1,!this.size||!this.origin||!this.unit||!this.size){console.error("Error parsing dx format");return}var W=n.splice(a).join(" "),U=W.split(/[\s\r]+/);this.data=Float32Array.from(U,parseFloat)},b=b.toLowerCase(),/\.gz$/.test(b)){b=b.replace(/\.gz$/,"");try{this[b]&&this.isbinary.has(b)?(typeof v=="string"&&(v=(0,A.base64ToArray)(v)),v=(0,p.inflate)(v)):v=new TextDecoder("utf-8").decode((0,p.inflate)(v))}catch(t){console.error(t)}}if(this[b]&&(this.isbinary.has(b)&&typeof v=="string"&&(v=(0,A.base64ToArray)(v)),this[b](v)),_){if(_.negate)for(let t=0,n=this.data.length;t<n;t++)this.data[t]=-this.data[t];if(_.normalize){var g=0;for(let t=0,n=this.data.length;t<n;t++)g+=this.data[t];var m=g/this.data.length;g=0;for(let t=0,n=this.data.length;t<n;t++){var r=this.data[t]-m;g+=r*r}var e=g/this.data.length;for(let t=0,n=this.data.length;t<n;t++)this.data[t]=(this.data[t]-m)/e}}}getIndex(v,b,_){if(this.matrix){this.inversematrix==null&&(this.inversematrix=new S.Matrix4().getInverse(this.matrix));var g=new S.Vector3(v,b,_);g=g.applyMatrix4(this.inversematrix),v=g.x,b=g.y,_=g.z}else v-=this.origin.x,b-=this.origin.y,_-=this.origin.z,v/=this.unit.x,b/=this.unit.y,_/=this.unit.z;return v=Math.round(v),b=Math.round(b),_=Math.round(_),v<0||v>=this.size.x||b<0||b>=this.size.y||_<0||_>=this.size.z?-1:v*this.size.y*this.size.z+b*this.size.z+_}getVal(v,b,_){let g=this.getIndex(v,b,_);return g<0?0:this.data[g]}cube(v){var b=v.split(/\r?\n/);if(!(b.length<6)){var _=(0,O.CUBE)(v,{}).modelData[0].cryst,g=b[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),m=parseFloat(g[0]),r=Math.abs(m);this.origin=_.origin,this.size=_.size,this.unit=_.unit,this.matrix=_.matrix4;var e=6;m<0&&e++;var t=b.splice(r+e).join(" ");t=t.replace(/^\s+/,"");var n=t.split(/[\s\r]+/);this.data=Float32Array.from(n,parseFloat)}}ccp4(v){var b={};v=new Int8Array(v);var _=new Int32Array(v.buffer,0,56),g=new Float32Array(v.buffer,0,56),m=new DataView(v.buffer);if(b.MAP=String.fromCharCode(m.getUint8(208),m.getUint8(209),m.getUint8(210),m.getUint8(211)),b.MACHST=[m.getUint8(212),m.getUint8(213)],b.MACHST[0]===17&&b.MACHST[1]===17)for(var r=v.byteLength,e=0;e<r;e+=4)m.setFloat32(e,m.getFloat32(e),!0);b.NX=_[0],b.NY=_[1],b.NZ=_[2],b.MODE=_[3],b.NXSTART=_[4],b.NYSTART=_[5],b.NZSTART=_[6],b.MX=_[7],b.MY=_[8],b.MZ=_[9],b.xlen=g[10],b.ylen=g[11],b.zlen=g[12],b.alpha=g[13],b.beta=g[14],b.gamma=g[15],b.MAPC=_[16],b.MAPR=_[17],b.MAPS=_[18],b.DMIN=g[19],b.DMAX=g[20],b.DMEAN=g[21],b.ISPG=_[22],b.NSYMBT=_[23],b.LSKFLG=_[24],b.originX=g[49],b.originY=g[50],b.originZ=g[51],b.ARMS=g[54];var t=b,n=[t.xlen,0,0],o=[t.ylen*Math.cos(Math.PI/180*t.gamma),t.ylen*Math.sin(Math.PI/180*t.gamma),0],h=[t.zlen*Math.cos(Math.PI/180*t.beta),t.zlen*(Math.cos(Math.PI/180*t.alpha)-Math.cos(Math.PI/180*t.gamma)*Math.cos(Math.PI/180*t.beta))/Math.sin(Math.PI/180*t.gamma),0];h[2]=Math.sqrt(t.zlen*t.zlen*Math.sin(Math.PI/180*t.beta)*Math.sin(Math.PI/180*t.beta)-h[1]*h[1]);var f=[0,n,o,h],i=[0,t.MX,t.MY,t.MZ],s=[0,t.MAPC,t.MAPR,t.MAPS];this.matrix=new S.Matrix4,this.matrix.set(f[s[1]][0]/i[s[1]],f[s[2]][0]/i[s[2]],f[s[3]][0]/i[s[3]],0,f[s[1]][1]/i[s[1]],f[s[2]][1]/i[s[2]],f[s[3]][1]/i[s[3]],0,f[s[1]][2]/i[s[1]],f[s[2]][2]/i[s[2]],f[s[3]][2]/i[s[3]],0,0,0,0,1),this.matrix=this.matrix.multiplyMatrices(this.matrix,new S.Matrix4().makeTranslation(t.NXSTART+t.originX,t.NYSTART+t.originY,t.NZSTART+t.originZ)),this.origin=new S.Vector3(0,0,0),this.unit=new S.Vector3(1,1,1),this.size={x:b.NX,y:b.NY,z:b.NZ},this.dimensionorder=[b.MAPC,b.MAPR,b.MAPS];var a=new Float32Array(v.buffer,1024+b.NSYMBT),c=b.NX,u=b.NY,E=b.NZ;this.data=new Float32Array(c*u*E);for(let T=0;T<c;T++)for(let L=0;L<u;L++)for(let P=0;P<E;P++)this.data[(T*u+L)*E+P]=a[(P*u+L)*c+T]}}},"./src/VolumetricRender.ts":(K,C,d)=>{d.r(C),d.d(C,{GLVolumetricRender:()=>x});var A=d("./src/WebGL/shapes/index.ts"),S=d("./src/WebGL/math/index.ts"),w=d("./src/WebGL/index.ts"),O=d("./src/colors.ts"),p=d("./src/GLShape.ts");class x{static interpolateArray(v,b){function _(h,f,i){return h+(f-h)*i}var g=[],m=(v.length-1)/(b-1);g[0]=v[0];for(var r=1;r<b-1;r++){var e=r*m,t=Math.floor(e),n=Math.ceil(e),o=e-t;g[r]=_(v[t],v[n],o)}return g[b-1]=v[v.length-1],g}constructor(v,b,_){this.hidden=!1,this.boundingSphere=new A.Sphere,this.renderedShapeObj=null,this.shapeObj=null,this.subsamples=5,this.data=null,this.transferfunctionbuffer=[],this.min=0,this.max=0,b=b||{};var g=Object.assign([],b.transferfn);this.subsamples=b.subsamples||5;let m=256;g.forEach(function(u){u.value=parseFloat(u.value)}),g.sort(function(u,E){return u.value-E.value}),this.min=g[0].value,g.length==0&&g.push(g[0]),this.max=g[g.length-1].value;var r,e,t,n,o,h,f,i,s,a;for(let u=0;u<g.length-1;u++)if(t=O.CC.color(g[u].color),n=O.CC.color(g[u+1].color),s=g[u].opacity,a=g[u+1].opacity,r=Math.floor((g[u].value-this.min)*m/(this.max-this.min)),e=Math.floor((g[u+1].value-this.min)*m/(this.max-this.min)),r!=e){o=x.interpolateArray([t.r*255,n.r*255],e-r),h=x.interpolateArray([t.g*255,n.g*255],e-r),f=x.interpolateArray([t.b*255,n.b*255],e-r),i=x.interpolateArray([s*255,a*255],e-r);for(let E=0;E<o.length;E++)this.transferfunctionbuffer.push(o[E]),this.transferfunctionbuffer.push(h[E]),this.transferfunctionbuffer.push(f[E]),this.transferfunctionbuffer.push(i[E])}if(this.transferfunctionbuffer=new Uint8ClampedArray(this.transferfunctionbuffer),v.matrix){let u=new S.Vector3(0,0,0),E=new S.Vector3(v.size.x,v.size.y,v.size.z),T=new S.Vector3(1,1,1);u.applyMatrix4(v.matrix),E.applyMatrix4(v.matrix),T.applyMatrix4(v.matrix).sub(u),this.extent=[[u.x,u.y,u.z],[E.x,E.y,E.z]];for(let z=1;z<7;z++)E.x=z&1?v.size.x:0,E.y=z&2?v.size.y:0,E.z=z&4?v.size.z:0,E.applyMatrix4(v.matrix),this.extent[0][0]=Math.min(this.extent[0][0],E.x),this.extent[0][1]=Math.min(this.extent[0][1],E.y),this.extent[0][2]=Math.min(this.extent[0][2],E.z),this.extent[1][0]=Math.max(this.extent[1][0],E.x),this.extent[1][1]=Math.max(this.extent[1][1],E.y),this.extent[1][2]=Math.max(this.extent[1][2],E.z);let L=E.x-u.x,P=E.y-u.y,I=E.z-u.z;this.maxdepth=Math.sqrt(L*L+P*P+I*I),this.minunit=Math.min(Math.min(T.x,T.y),T.z),this.texmatrix=new S.Matrix4().identity().scale({x:v.size.x,y:v.size.y,z:v.size.z}),this.texmatrix=this.texmatrix.multiplyMatrices(v.matrix,this.texmatrix),this.texmatrix=this.texmatrix.getInverse(this.texmatrix)}else{this.texmatrix=new S.Matrix4().identity();let u=v.unit.x*v.size.x,E=v.unit.y*v.size.y,T=v.unit.z*v.size.z;this.texmatrix.makeTranslation(-v.origin.x/u,-v.origin.y/E,-v.origin.z/T),this.texmatrix.scale({x:1/u,y:1/E,z:1/T}),this.minunit=Math.min(Math.min(v.unit.x,v.unit.y),v.unit.z),this.extent=[[v.origin.x,v.origin.y,v.origin.z],[v.origin.x+u,v.origin.y+E,v.origin.z+T]],this.maxdepth=Math.sqrt(u*u+E*E+T*T)}var c=new p.GLShape({});if(c.addBox({corner:{x:this.extent[0][0],y:this.extent[0][1],z:this.extent[0][2]},dimensions:{w:this.extent[1][0]-this.extent[0][0],h:this.extent[1][1]-this.extent[0][1],d:this.extent[1][2]-this.extent[0][2]}}),this.geo=c.finalize(),this.boundingSphere.center=new S.Vector3((this.extent[0][0]+this.extent[1][0])/2,(this.extent[0][1]+this.extent[1][1])/2,(this.extent[0][2]+this.extent[1][2])/2),this.boundingSphere.radius=this.maxdepth/2,b.coords===void 0&&b.selection!==void 0&&(_?b.coords=_.selectedAtoms(b.selection):console.log("Need to provide viewer to volumetric renderer if selection specified.")),b.coords!==void 0&&b.seldist!==void 0){let u=new Uint8Array(v.data.length),E=b.seldist,T=E*E;for(let L=0,P=b.coords.length;L<P;L++){let I=b.coords[L],z=I.x-E,B=I.y-E,F=I.z-E,W=I.x+E,U=I.y+E,R=I.z+E;if(v.getIndex(z,B,F)>=0||v.getIndex(W,U,R)>=0)for(let V=z;V<W;V+=this.minunit)for(let q=B;q<U;q+=this.minunit)for(let ee=F;ee<R;ee+=this.minunit){let se=v.getIndex(V,q,ee);se>=0&&!u[se]&&(V-I.x)*(V-I.x)+(q-I.y)*(q-I.y)+(ee-I.z)*(ee-I.z)<T&&(u[se]=1)}}for(let L=0,P=v.data.length;L<P;L++)u[L]==0&&(v.data[L]=1/0)}this.data=v}globj(v){if(this.renderedShapeObj&&(v.remove(this.renderedShapeObj),this.renderedShapeObj=null),!this.hidden){this.shapeObj=new w.Object3D;var b=null,_=new w.Texture(this.data,!0),g=new w.Texture(this.transferfunctionbuffer,!1);_.needsUpdate=!0,g.needsUpdate=!0,g.flipY=!1,b=new w.VolumetricMaterial({transferfn:g,transfermin:this.min,transfermax:this.max,map:_,extent:this.extent,maxdepth:this.maxdepth,texmatrix:this.texmatrix,unit:this.minunit,subsamples:this.subsamples});var m=new w.Mesh(this.geo,b);this.shapeObj.add(m),this.renderedShapeObj=this.shapeObj.clone(),v.add(this.renderedShapeObj)}}removegl(v){this.renderedShapeObj&&(this.renderedShapeObj.geometry!==void 0&&this.renderedShapeObj.geometry.dispose(),this.renderedShapeObj.material!==void 0&&this.renderedShapeObj.material.dispose(),v.remove(this.renderedShapeObj),this.renderedShapeObj=null),this.shapeObj=null}get position(){return this.boundingSphere.center}get x(){return this.boundingSphere.center.x}get y(){return this.boundingSphere.center.y}get z(){return this.boundingSphere.center.z}}},"./src/WebGL/Camera.ts":(K,C,d)=>{d.r(C),d.d(C,{Camera:()=>w});var A=d("./src/WebGL/core/index.ts"),S=d("./src/WebGL/math/index.ts");class w extends A.Object3D{constructor(p=50,x=1,M=.1,v=2e3,b=!1){super(),this.projectionMatrix=new S.Matrix4,this.projectionMatrixInverse=new S.Matrix4,this.matrixWorldInverse=new S.Matrix4,this.fov=p,this.aspect=x,this.near=M,this.far=v;var _=this.position.z;this.right=_*Math.tan(Math.PI/180*p),this.left=-this.right,this.top=this.right/this.aspect,this.bottom=-this.top,this.ortho=!!b,this.updateProjectionMatrix()}lookAt(p){this.matrix.lookAt(this.position,p,this.up),this.rotationAutoUpdate&&(this.useQuaternion===!1&&this.rotation instanceof S.Vector3?this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder):console.error("Unimplemented math operation."))}updateProjectionMatrix(){this.ortho?this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far):this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)}}},"./src/WebGL/Fog.ts":(K,C,d)=>{d.r(C),d.d(C,{Fog:()=>S});var A=d("./src/colors.ts");class S{constructor(O,p=1,x=1e3){this.name="",this.color=new A.Color(O),this.near=p,this.far=x}clone(){return new S(this.color.getHex(),this.near,this.far)}}},"./src/WebGL/Renderer.ts":(K,C,d)=>{d.r(C),d.d(C,{Renderer:()=>r});var A=d("./src/WebGL/Camera.ts"),S=d("./src/WebGL/constants/Sides.ts"),w=d("./src/WebGL/constants/TextureConstants.ts"),O=d("./src/WebGL/core/index.ts"),p=d("./src/colors.ts"),x=d("./src/WebGL/materials/index.ts"),M=d("./src/WebGL/math/index.ts"),v=d("./src/WebGL/objects/index.ts"),b=d("./src/WebGL/shaders/index.ts"),_=d("./src/WebGL/SpritePlugin.ts"),g=null,m=null;class r{constructor(t){this.context=null,this.devicePixelRatio=1,this.sortObjects=!0,this.autoUpdateObjects=!0,this.autoUpdateScene=!0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}},this._offscreen=null,this._bitmap=null,this._programs=[],this._programs_counter=0,this._webglversion=1,this._currentProgram=null,this._currentMaterialId=-1,this._currentGeometryGroupHash=null,this._currentCamera=null,this._geometryGroupCounter=0,this._oldDoubleSided=-1,this._oldFlipSided=-1,this._oldDepthTest=-1,this._oldDepthWrite=-1,this._oldPolygonOffset=null,this._oldLineWidth=null,this._viewportWidth=0,this._viewportHeight=0,this._currentWidth=0,this._currentHeight=0,this._enabledAttributes={},this._vector3=new M.Vector3,this._worldInverse=new M.Matrix4,this._projInverse=new M.Matrix4,this._textureMatrix=new M.Matrix4,this._fullProjModelMatrix=new M.Matrix4,this._fullProjModelMatrixInv=new M.Matrix4,this._direction=new M.Vector3,this._lightsNeedUpdate=!0,this._lights={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}},this.sprites=new _.SpritePlugin,this._screenshader=null,this._AOshader=null,this._blurshader=null,this._vertexattribpos=null,this._aovertexattribpos=null,this._blurvertexattribpos=null,this._screenQuadVBO=null,this._fb=null,this._targetTexture=null,this._depthTexture=null,this._shadingTexture=null,this._scratchTexture=null,this._upscale=null,this._AOstrength=1,this._AOradius=5,this.SHADE_TEXTURE=3,t=t||{},this.row=t.row,this.col=t.col,this.rows=t.rows,this.cols=t.cols,this._canvas=t.canvas!==void 0?t.canvas:document.createElement("canvas"),this._precision=t.precision!==void 0?t.precision:"highp",this._alpha=t.alpha!==void 0?t.alpha:!0,this._premultipliedAlpha=t.premultipliedAlpha!==void 0?t.premultipliedAlpha:!0,this._antialias=t.antialias!==void 0?t.antialias:!1,this._upscale=t.upscale!==void 0?t.upscale:this._antialias,this._preserveDrawingBuffer=t.preserveDrawingBuffer!==void 0?t.preserveDrawingBuffer:!1,this._clearColor=t.clearColor!==void 0?new p.Color(t.clearColor):new p.Color(0),this._clearAlpha=t.clearAlpha!==void 0?t.clearAlpha:0,this._outlineMaterial=new x.MeshOutlineMaterial(t.outline),this._outlineSphereImposterMaterial=new x.SphereImposterOutlineMaterial(t.outline),this._outlineStickImposterMaterial=new x.StickImposterOutlineMaterial(t.outline),this._outlineEnabled=!!t.outline,this._AOEnabled=!!t.ambientOcclusion,t.ambientOcclusion&&typeof t.ambientOcclusion.strength<"u"&&(this._AOstrength=parseFloat(t.ambientOcclusion.strength)),this._AOstrength==0&&(this._AOEnabled=!1),t.ambientOcclusion&&typeof t.ambientOcclusion.radius<"u"&&(this._AOradius=parseFloat(t.ambientOcclusion.radius)),this.domElement=this._canvas,this._canvas.id=t.id,!(t.containerWidth==0||t.containerHeight==0)&&(this.initGL(),this.setDefaultGLState(),this.context=this._gl,this.isWebGL1()?this._extInstanced=this._gl.getExtension("ANGLE_instanced_arrays"):this._extInstanced={vertexAttribDivisorANGLE:this._gl.vertexAttribDivisor.bind(this._gl),drawElementsInstancedANGLE:this._gl.drawElementsInstanced.bind(this._gl)},this._extFragDepth=this._gl.getExtension("EXT_frag_depth"),this._extFloatLinear=this._gl.getExtension("OES_texture_float_linear"),this._extColorBufferFloat=this._gl.getExtension("EXT_color_buffer_float"),this.sprites.init(this))}supportedExtensions(){return{supportsAIA:!!this._extInstanced,supportsImposters:!!this._extFragDepth||!this.isWebGL1(),regen:!1}}getContext(){return this._gl}getCanvas(){return this._canvas}isLost(){return this._gl==null||this._gl.isContextLost()}getPrecision(){return this._precision}setClearColorHex(t,n){this._clearColor.setHex(t),this._clearAlpha=n,this.isLost()||this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha)}enableOutline(t){this._outlineMaterial=new x.MeshOutlineMaterial(t),this._outlineSphereImposterMaterial=new x.SphereImposterOutlineMaterial(t),this._outlineStickImposterMaterial=new x.StickImposterOutlineMaterial(t),this._outlineEnabled=!0}disableOutline(){this._outlineEnabled=!1}enableAmbientOcclusion(t){t&&(t.strength&&(this._AOstrength=t.strength),t.scale&&(this._AOradius=t.scale)),this._AOEnabled=this._AOstrength>0}disableAmbientOcclusion(){this._AOEnabled=!1}setViewport(){if(this._offscreen&&(this._offscreen.width=this._canvas.width,this._offscreen.height=this._canvas.height),this.rows!=null&&this.cols!=null&&this.row!=null&&this.col!=null&&!this.isLost()){var t=this._gl.drawingBufferWidth/this.cols,n=this._gl.drawingBufferHeight/this.rows;this._viewportWidth=t,this._viewportHeight=n,this._gl.enable(this._gl.SCISSOR_TEST),this._gl.scissor(t*this.col,n*this.row,t,n),this._gl.viewport(t*this.col,n*this.row,t,n)}}setSize(t,n){this.devicePixelRatio=window.devicePixelRatio!==void 0?window.devicePixelRatio:1,this._upscale&&this.devicePixelRatio<2&&(this.devicePixelRatio=2),this._canvas.width=t*this.devicePixelRatio,this._canvas.height=n*this.devicePixelRatio,this._canvas.style.width=t+"px",this._canvas.style.height=n+"px",this.rows!=null&&this.cols!=null&&this.row!=null&&this.col!=null?(this.isLost()||(this._viewportWidth=this._gl.drawingBufferWidth/this.cols,this._viewportHeight=this._gl.drawingBufferHeight/this.rows),this.setViewport()):(this._viewportWidth=this._canvas.width,this._viewportHeight=this._canvas.height,this.isLost()||this._gl.viewport(0,0,this._gl.drawingBufferWidth,this._gl.drawingBufferHeight)),this.initFrameBuffer()}clear(t,n,o){var h=0;(t===void 0||t)&&(h|=this._gl.COLOR_BUFFER_BIT),(n===void 0||n)&&(h|=this._gl.DEPTH_BUFFER_BIT),(o===void 0||o)&&(h|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(h)}setMaterialFaces(t,n){var o=t.side===S.DoubleSide,h=t.side===S.BackSide;t.imposter||(h=n?!h:h),this._oldDoubleSided!==o&&(o?this._gl.disable(this._gl.CULL_FACE):this._gl.enable(this._gl.CULL_FACE),this._oldDoubleSided=o),this._oldFlipSided!==h&&(h?this._gl.frontFace(this._gl.CW):this._gl.frontFace(this._gl.CCW),this._oldFlipSided=h),this._gl.cullFace(this._gl.BACK)}setDepthTest(t){this._oldDepthTest!==t&&(t?this._gl.enable(this._gl.DEPTH_TEST):this._gl.disable(this._gl.DEPTH_TEST),this._oldDepthTest=t)}setDepthWrite(t){this._oldDepthWrite!==t&&(this._gl.depthMask(t),this._oldDepthWrite=t)}setBlending(t){t?(this._gl.enable(this._gl.BLEND),this._gl.blendEquationSeparate(this._gl.FUNC_ADD,this._gl.FUNC_ADD),this._gl.blendFuncSeparate(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA)):this._gl.disable(this._gl.BLEND)}initMaterial(t,n,o,h){t.addEventListener("dispose",this.onMaterialDispose.bind(this));var f,i;if(i=t.shaderID,i){var s=b.ShaderLib[i];t.vertexShader=s.vertexShader,t.fragmentShader=s.fragmentShader,t.uniforms=b.ShaderUtils.clone(s.uniforms),t.shaded&&t.makeShaded(this.SHADE_TEXTURE)}f={wireframe:t.wireframe,fragdepth:t.imposter,volumetric:t.volumetric,shaded:t.shaded},t.program=this.buildProgram(t.fragmentShader,t.vertexShader,t.uniforms,f)}renderBuffer(t,n,o,h,f,i){if(h.visible){var s,a;if(s=this.setProgram(t,n,o,h,i,this),!!s){a=s.attributes;var c=!1,u=h.wireframe?1:0,E=f.id*16777215+s.id*2+u;E!==this._currentGeometryGroupHash&&(this._currentGeometryGroupHash=E,c=!0),c&&(this.disableAttributes(),a.position>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,f.__webglVertexBuffer),this.enableAttribute(a.position),this._gl.vertexAttribPointer(a.position,3,this._gl.FLOAT,!1,0,0)),a.color>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,f.__webglColorBuffer),this.enableAttribute(a.color),this._gl.vertexAttribPointer(a.color,3,this._gl.FLOAT,!1,0,0)),a.normal>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,f.__webglNormalBuffer),this.enableAttribute(a.normal),this._gl.vertexAttribPointer(a.normal,3,this._gl.FLOAT,!1,0,0)),a.offset>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,f.__webglOffsetBuffer),this.enableAttribute(a.offset),this._gl.vertexAttribPointer(a.offset,3,this._gl.FLOAT,!1,0,0)),a.radius>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,f.__webglRadiusBuffer),this.enableAttribute(a.radius),this._gl.vertexAttribPointer(a.radius,1,this._gl.FLOAT,!1,0,0)));var T,L;if(i instanceof v.Mesh){if(h.shaderID==="instanced"){var P=h.sphere.geometryGroups[0];c&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,f.__webglVertexBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,P.vertexArray,this._gl.STATIC_DRAW),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,f.__webglNormalBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,P.normalArray,this._gl.STATIC_DRAW),this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,f.__webglFaceBuffer),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,P.faceArray,this._gl.STATIC_DRAW)),T=P.faceidx,this._extInstanced.vertexAttribDivisorANGLE(a.offset,1),this._extInstanced.vertexAttribDivisorANGLE(a.radius,1),this._extInstanced.vertexAttribDivisorANGLE(a.color,1),this._extInstanced.drawElementsInstancedANGLE(this._gl.TRIANGLES,T,this._gl.UNSIGNED_SHORT,0,f.radiusArray.length),this._extInstanced.vertexAttribDivisorANGLE(a.offset,0),this._extInstanced.vertexAttribDivisorANGLE(a.radius,0),this._extInstanced.vertexAttribDivisorANGLE(a.color,0)}else h.wireframe?(L=f.lineidx,this.setLineWidth(h.wireframeLinewidth),c&&this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,f.__webglLineBuffer),this._gl.drawElements(this._gl.LINES,L,this._gl.UNSIGNED_SHORT,0)):(T=f.faceidx,c&&this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,f.__webglFaceBuffer),this._gl.drawElements(this._gl.TRIANGLES,T,this._gl.UNSIGNED_SHORT,0));this.info.render.calls++,this.info.render.vertices+=T,this.info.render.faces+=T/3}else i instanceof v.Line&&(L=f.vertices,this.setLineWidth(h.linewidth),this._gl.drawArrays(this._gl.LINES,0,L),this.info.render.calls++)}}}clearShading(){this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._shadingTexture,0),this.clear(!1,!0,!1),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._depthTexture,0)}setShading(t,n,o){let h=t.__lights,f=t.fog,i=[];for(let c=0,u=t.__webglObjects.length;c<u;c++){let E=t.__webglObjects[c];E.render&&E[o]&&i.push(E)}if(i.length==0)return;this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._shadingTexture,0),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,null,0),this.renderObjects(t.__webglObjects,!0,o+"Depth",n,h,f,!1),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._scratchTexture,0),this.clear(!1,!0,!1),this._gl.useProgram(this._AOshader),this._currentProgram=this._AOshader,this.setDepthTest(-1),this.setDepthWrite(-1);let s=this._AOshader.uniforms;this._gl.uniform1f(s.total_strength,this._AOstrength),this._gl.uniform1f(s.radius,this._AOradius),this._fullProjModelMatrix=new M.Matrix4,this._fullProjModelMatrixInv=new M.Matrix4;let a=i[0].object;this._fullProjModelMatrix.multiplyMatrices(n.projectionMatrix,a._modelViewMatrix),this._fullProjModelMatrixInv.getInverse(this._fullProjModelMatrix),this._gl.uniformMatrix4fv(s.projectionMatrix,!1,this._fullProjModelMatrix.elements),this._gl.uniformMatrix4fv(s.projinv,!1,this._fullProjModelMatrixInv.elements),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._screenQuadVBO),this._gl.enableVertexAttribArray(this._aovertexattribpos),this._gl.vertexAttribPointer(this._aovertexattribpos,2,this._gl.FLOAT,!1,0,0),this._gl.activeTexture(this._gl.TEXTURE0),this._gl.bindTexture(this._gl.TEXTURE_2D,this._shadingTexture),this._gl.drawArrays(this._gl.TRIANGLES,0,6),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._shadingTexture,0),this.clear(!1,!0,!1),this._gl.useProgram(this._blurshader),this._currentProgram=this._blurshader,this.setDepthTest(-1),this.setDepthWrite(-1),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._screenQuadVBO),this._gl.enableVertexAttribArray(this._blurvertexattribpos),this._gl.vertexAttribPointer(this._blurvertexattribpos,2,this._gl.FLOAT,!1,0,0),this._gl.activeTexture(this._gl.TEXTURE0),this._gl.bindTexture(this._gl.TEXTURE_2D,this._scratchTexture),this._gl.drawArrays(this._gl.TRIANGLES,0,6),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,this._targetTexture,0),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._depthTexture,0)}render(t,n){if(!(n instanceof A.Camera)){console.error("Renderer.render: camera is not an instance of Camera.");return}var o,h,f,i,s,a=t.__lights,c=t.fog;if(this._currentMaterialId=-1,this._lightsNeedUpdate=!0,this.autoUpdateScene&&t.updateMatrixWorld(),n.parent===void 0&&n.updateMatrixWorld(),n.matrixWorldInverse.getInverse(n.matrixWorld),this.isLost())return;this.autoUpdateObjects&&this.initWebGLObjects(t),this.info.render.calls=0,this.info.render.vertices=0,this.info.render.faces=0,this.info.render.points=0,this._currentWidth=this._viewportWidth,this._currentHeight=this._viewportHeight,this.setViewport(),this.setFrameBuffer(),this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha),this.clear(!0,!0,!0),s=t.__webglObjects;let u=!1,E=this._AOEnabled;for(o=0,h=s.length;o<h;o++)f=s[o],i=f.object,f.render=!1,i.visible&&(this.setupMatrices(i,n),this.unrollBufferMaterial(f),f.render=!0,f.volumetric&&(u=!0),f.hasAO&&(E=!0));if(this.setBlending(!1),E&&this.setShading(t,n,"opaque"),this.renderObjects(t.__webglObjects,!0,"opaque",n,a,c,!1),E&&this.clearShading(),this.renderSprites(t,n,!1),this.renderObjects(t.__webglObjects,!0,"transparentDepth",n,a,c,!0),this.renderObjects(t.__webglObjects,!1,"transparent",n,a,c,!0),u&&this._fb&&(this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,null,0),this.renderObjects(t.__webglObjects,!1,"volumetric",n,a,c,!0)),this.renderFrameBuffertoScreen(),this.setDepthTest(!0),this.setDepthWrite(!0),this.renderSprites(t,n,!0),this._bitmap){const T=this._offscreen.transferToImageBitmap();this._bitmap.transferFromImageBitmap(T),T.close()}}setFrameBuffer(){if(this.isWebGL1()||!this._fb)return;let t=this._viewportWidth,n=this._viewportHeight;this._gl.enable(this._gl.SCISSOR_TEST),this._gl.scissor(0,0,t,n),this._gl.viewport(0,0,t,n),this._gl.bindTexture(this._gl.TEXTURE_2D,this._targetTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,t,n,0,this._gl.RGBA,this._gl.UNSIGNED_BYTE,null),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.bindTexture(this._gl.TEXTURE_2D,this._depthTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.DEPTH_COMPONENT32F,t,n,0,this._gl.DEPTH_COMPONENT,this._gl.FLOAT,null),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._shadingTexture&&(this._gl.deleteTexture(this._shadingTexture),this._shadingTexture=this._gl.createTexture(),this._gl.bindTexture(this._gl.TEXTURE_2D,this._shadingTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.DEPTH_COMPONENT32F,t,n,0,this._gl.DEPTH_COMPONENT,this._gl.FLOAT,null),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.deleteTexture(this._scratchTexture),this._scratchTexture=this._gl.createTexture(),this._gl.bindTexture(this._gl.TEXTURE_2D,this._scratchTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.DEPTH_COMPONENT32F,t,n,0,this._gl.DEPTH_COMPONENT,this._gl.FLOAT,null),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE)),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._fb),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,this._targetTexture,0),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._shadingTexture,0),this._gl.clearDepth(1),this._gl.clear(this._gl.DEPTH_BUFFER_BIT),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._depthTexture,0)}initFrameBuffer(){if(this.isWebGL1())return;let t=this._viewportWidth,n=this._viewportHeight;this._gl.enable(this._gl.SCISSOR_TEST),this._gl.scissor(0,0,t,n),this._gl.viewport(0,0,t,n),this._targetTexture=this._gl.createTexture(),this._depthTexture=this._gl.createTexture(),this._shadingTexture=this._gl.createTexture(),this._scratchTexture=this._gl.createTexture(),this._fb=this._gl.createFramebuffer();var o=this._antialias?b.ShaderLib.screenaa:b.ShaderLib.screen;this._screenshader=this.buildProgram(o.fragmentShader,o.vertexShader,o.uniforms,{}),this._vertexattribpos=this._gl.getAttribLocation(this._screenshader,"vertexPosition");var h=[1,1,-1,1,-1,-1,-1,-1,1,-1,1,1];this._screenQuadVBO=this._gl.createBuffer(),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._screenQuadVBO),this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(h),this._gl.STATIC_DRAW);let f=b.ShaderLib.ssao;this._AOshader=this.buildProgram(f.fragmentShader,f.vertexShader,f.uniforms,{}),this._aovertexattribpos=this._gl.getAttribLocation(this._AOshader,"vertexPosition");let i=b.ShaderLib.blur;this._blurshader=this.buildProgram(i.fragmentShader,i.vertexShader,i.uniforms,{}),this._blurvertexattribpos=this._gl.getAttribLocation(this._blurshader,"vertexPosition")}renderFrameBuffertoScreen(){this.isWebGL1()||this._fb===null||(this.setViewport(),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._gl.frontFace(this._gl.CCW),this._gl.cullFace(this._gl.BACK),this._gl.useProgram(this._screenshader),this._currentProgram=this._screenshader,this.setDepthTest(-1),this.setDepthWrite(-1),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._screenQuadVBO),this._gl.enableVertexAttribArray(this._vertexattribpos),this._gl.vertexAttribPointer(this._vertexattribpos,2,this._gl.FLOAT,!1,0,0),this._gl.activeTexture(this._gl.TEXTURE0),this._gl.bindTexture(this._gl.TEXTURE_2D,this._targetTexture),this._gl.drawArrays(this._gl.TRIANGLES,0,6))}initWebGLObjects(t){if(t.__webglObjects||(t.__webglObjects=[],t.__webglObjectsImmediate=[],t.__webglSprites=[],t.__webglFlares=[]),t.__objectsAdded.length){for(;t.__objectsAdded.length;)this.addObject(t.__objectsAdded[0],t),t.__objectsAdded.splice(0,1);this._currentGeometryGroupHash=-1}for(;t.__objectsRemoved.length;)this.removeObject(t.__objectsRemoved[0],t),t.__objectsRemoved.splice(0,1);for(var n=0,o=t.__webglObjects.length;n<o;n++)this.updateObject(t.__webglObjects[n].object)}getYRatio(){return this.rows!==void 0&&this.row!==void 0?this.rows:1}getXRatio(){return this.cols!==void 0&&this.col!==void 0?this.cols:1}getAspect(t,n){(t==null||n==null)&&(t=this._canvas.width,n=this._canvas.height);var o=t/n;if(this.rows!=null&&this.cols!=null&&this.row!=null&&this.col!=null){var h=t/this.cols,f=n/this.rows;o=h/f}return o}setTexture(t,n,o){if(t.needsUpdate){t.__webglInit||(t.__webglInit=!0,t.addEventListener("dispose",this.onTextureDispose.bind(this)),t.__webglTexture=this._gl.createTexture(),this.info.memory.textures++),this._gl.activeTexture(this._gl.TEXTURE0+n);var h=o?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D;this._gl.bindTexture(h,t.__webglTexture),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,t.flipY),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,t.unpackAlignment),this._gl.pixelStorei(this._gl.PACK_ALIGNMENT,t.unpackAlignment);var f=this.paramToGL(t.format),i=this.paramToGL(t.type);if(o)this.setTextureParameters(this._gl.TEXTURE_3D,t),this._gl.texImage3D(this._gl.TEXTURE_3D,0,this._gl.R32F,t.image.size.z,t.image.size.y,t.image.size.x,0,this._gl.RED,this._gl.FLOAT,t.image.data);else{var s=t.image,a=s.width,c=s.height;typeof a>"u"&&(a=s.length,f==this._gl.RGBA&&(a/=4),c=1),this.setTextureParameters(this._gl.TEXTURE_2D,t),this.isWebGL1()?this._gl.texImage2D(this._gl.TEXTURE_2D,0,f,f,i,t.image):this._gl.texImage2D(this._gl.TEXTURE_2D,0,f,a,c,0,f,i,t.image)}t.needsUpdate=!1,t.onUpdate&&t.onUpdate()}else this._gl.activeTexture(this._gl.TEXTURE0+n),o?this._gl.bindTexture(this._gl.TEXTURE_3D,t.__webglTexture):this._gl.bindTexture(this._gl.TEXTURE_2D,t.__webglTexture)}supportsVolumetric(){return!this.isWebGL1()}enableAttribute(t){this._enabledAttributes[t]||(this._gl.enableVertexAttribArray(t),this._enabledAttributes[t]=!0)}disableAttributes(){for(let t in this._enabledAttributes)this._enabledAttributes[t]&&(this._gl.disableVertexAttribArray(t),this._enabledAttributes[t]=!1)}setPolygonOffset(t,n,o){this._oldPolygonOffset!==t&&(t?this._gl.enable(this._gl.POLYGON_OFFSET_FILL):this._gl.disable(this._gl.POLYGON_OFFSET_FILL))}setLineWidth(t){t!==this._oldLineWidth&&(this._gl.lineWidth(t),this._oldLineWidth=t)}deallocateGeometry(t){if(t.__webglInit=void 0,t.__webglVertexBuffer!==void 0&&this._gl.deleteBuffer(t.__webglVertexBuffer),t.__webglColorBuffer!==void 0&&this._gl.deleteBuffer(t.__webglColorBuffer),t.geometryGroups!==void 0)for(var n=0,o=t.groups;n<o;n++){var h=t.geometryGroups[n];h.__webglVertexBuffer!==void 0&&this._gl.deleteBuffer(h.__webglVertexBuffer),h.__webglColorBuffer!==void 0&&this._gl.deleteBuffer(h.__webglColorBuffer),h.__webglNormalBuffer!==void 0&&this._gl.deleteBuffer(h.__webglNormalBuffer),h.__webglFaceBuffer!==void 0&&this._gl.deleteBuffer(h.__webglFaceBuffer),h.__webglLineBuffer!==void 0&&this._gl.deleteBuffer(h.__webglLineBuffer)}}deallocateMaterial(t){var n=t.program;if(n!==void 0){t.program=void 0;var o,h,f,i=!1;for(o=0,h=this._programs.length;o<h;o++)if(f=this._programs[o],f.program===n){f.usedTimes--,f.usedTimes===0&&(i=!0);break}if(i===!0){var s=[];for(o=0,h=this._programs.length;o<h;o++)f=this._programs[o],f.program!==n&&s.push(f);this._programs=s,this._gl.deleteProgram(n),this.info.memory.programs--}}}deallocateTexture(t){if(t.image&&t.image.__webglTextureCube)this._gl.deleteTexture(t.image.__webglTextureCube);else{if(!t.__webglInit)return;t.__webglInit=!1,this._gl.deleteTexture(t.__webglTexture)}}onGeometryDispose(t){var n=t.target;n.removeEventListener("dispose",this.onGeometryDispose),this.deallocateGeometry(n),this.info.memory.geometries--}onTextureDispose(t){var n=t.target;n.removeEventListener("dispose",this.onTextureDispose),this.deallocateTexture(n),this.info.memory.textures--}onMaterialDispose(t){var n=t.target;n.removeEventListener("dispose",this.onMaterialDispose),this.deallocateMaterial(n)}getShader(t,n){var o;return!this.isWebGL1()&&!n.startsWith("#version")&&(n=n.replace(/gl_FragDepthEXT/g,"gl_FragDepth"),t=="fragment"?n=n.replace(/varying/g,"in"):n=n.replace(/varying/g,"out"),n=n.replace(/attribute/g,"in"),n=n.replace(/texture2D/g,"texture"),n=n.replace(/\/\/DEFINEFRAGCOLOR/g,"out vec4 glFragColor;"),n=n.replace(/gl_FragColor/g,"glFragColor"),n=`#version 300 es
`+n),t==="fragment"?o=this._gl.createShader(this._gl.FRAGMENT_SHADER):t==="vertex"&&(o=this._gl.createShader(this._gl.VERTEX_SHADER)),o==null?null:(this._gl.shaderSource(o,n),this._gl.compileShader(o),this._gl.getShaderParameter(o,this._gl.COMPILE_STATUS)?o:(console.error(this._gl.getShaderInfoLog(o)),console.error("could not initialize shader"),null))}buildProgram(t,n,o,h){var f,i,s,a,c=[];c.push(t),c.push(n);for(f in h)c.push(f),c.push(h[f]);for(a=c.join(),f=0,i=this._programs.length;f<i;f++){var u=this._programs[f];if(u.code===a)return u.usedTimes++,u.program}if(this.isWebGL1()&&h.volumetric)throw new Error("Volumetric rendering requires webgl2 which is not supported by your hardware.");if(s=this._gl.createProgram(),s==null)return null;var E=this._precision,T="precision "+E+" float;",L=[h.volumetric?"#version 300 es":"",T].join(`
`),P=[h.volumetric?"#version 300 es":"",h.fragdepth&&this.isWebGL1()?"#extension GL_EXT_frag_depth: enable":"",h.shaded?"#define SHADED 1":"",h.wireframe?"#define WIREFRAME 1":"",T].join(`
`),I=this.getShader("fragment",P+t),z=this.getShader("vertex",L+n);z!=null&&this._gl.attachShader(s,z),I!=null&&this._gl.attachShader(s,I),this._gl.linkProgram(s),this._gl.getProgramParameter(s,this._gl.LINK_STATUS)||console.error("Could not initialize shader"),s.uniforms={},s.attributes={};var B,F,W;B=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","vWidth","vHeight"];for(F in o)B.push(F);for(W=0;W<B.length;W++){var U=B[W];s.uniforms[U]=this._gl.getUniformLocation(s,U)}for(B=["position","normal","color","lineDistance","offset","radius"],W=0;W<B.length;W++){var R=B[W];s.attributes[R]=this._gl.getAttribLocation(s,R)}return s.id=this._programs_counter++,this._programs.push({program:s,code:a,usedTimes:1}),this.info.memory.programs=this._programs.length,s}setProgram(t,n,o,h,f,i){if(h.needsUpdate&&(h.program&&this.deallocateMaterial(h),this.initMaterial(h,n,o,f),h.needsUpdate=!1),h.program==null)return null;var s=!1,a=h.program,c=a.uniforms,u=h.uniforms;if(a!=this._currentProgram&&(this._gl.useProgram(a),this._currentProgram=a,s=!0),h.id!=this._currentMaterialId&&(this._currentMaterialId=h.id,s=!0),t!=this._currentCamera&&(this._currentCamera=t,s=!0),c.projectionMatrix&&this._gl.uniformMatrix4fv(c.projectionMatrix,!1,t.projectionMatrix.elements),c.modelViewMatrix&&this._gl.uniformMatrix4fv(c.modelViewMatrix,!1,f._modelViewMatrix.elements),c.normalMatrix&&this._gl.uniformMatrix3fv(c.normalMatrix,!1,f._normalMatrix.elements),c.projinv&&(this._projInverse.getInverse(t.projectionMatrix),this._gl.uniformMatrix4fv(c.projinv,!1,this._projInverse.elements)),c.viewMatrix&&this._gl.uniformMatrix4fv(c.viewMatrix,!1,t.matrixWorldInverse.elements),c.vWidth&&this._gl.uniform1f(c.vWidth,this._viewportWidth),c.vHeight&&this._gl.uniform1f(c.vHeight,this._viewportHeight),s){if(u.fogColor.value=o.color,u.fogNear.value=o.near,u.fogFar.value=o.far,h.shaderID.startsWith("lambert")||h.shaderID==="instanced"||h.shaderID.endsWith("imposter"))this._lightsNeedUpdate&&(this.setupLights(a,n),this._lightsNeedUpdate=!1),u.directionalLightColor.value=this._lights.directional.colors,u.directionalLightDirection.value=this._lights.directional.positions;else if(h.shaderID.endsWith("outline"))u.outlineColor.value=h.outlineColor,u.outlineWidth.value=h.outlineWidth,u.outlinePushback.value=h.outlinePushback,u.outlineMaxPixels.value=h.outlineMaxPixels*this.devicePixelRatio;else if(h.shaderID==="volumetric"){f._modelViewMatrix.getScale(this._direction),this._worldInverse.getInverse(f._modelViewMatrix),this._projInverse.getInverse(t.projectionMatrix),this._textureMatrix.multiplyMatrices(f.material.texmatrix,this._worldInverse),this._gl.uniformMatrix4fv(c.textmat,!1,this._textureMatrix.elements),this._gl.uniformMatrix4fv(c.projinv,!1,this._projInverse.elements);let E=Math.min(Math.min(this._direction.x,this._direction.y),this._direction.z);u.step.value=f.material.unit*E,u.maxdepth.value=f.material.maxdepth*E,u.transfermax.value=f.material.transfermax,u.transfermin.value=f.material.transfermin,u.subsamples.value=f.material.subsamples,i.setTexture(f.material.transferfn,4,!1),i.setTexture(f.material.map,3,!0),this._gl.activeTexture(this._gl.TEXTURE5),this._gl.bindTexture(this._gl.TEXTURE_2D,this._depthTexture)}u.opacity.value=h.opacity,this.loadMaterialUniforms(c,u)}return u.shading&&(u.shading.value==3?(this._gl.activeTexture(this._gl.TEXTURE0+this.SHADE_TEXTURE),this._gl.bindTexture(this._gl.TEXTURE_2D,this._shadingTexture)):console.error("Invalid shading textures.")),a}loadMaterialUniforms(t,n){var o,h,f,i;for(o in n)t[o]&&(h=n[o].type,f=n[o].value,i=t[o],h==="f"?this._gl.uniform1f(i,f):h==="i"?this._gl.uniform1i(i,f):h==="fv"?this._gl.uniform3fv(i,f):h==="c"?this._gl.uniform3f(i,f.r,f.g,f.b):h==="f4"&&this._gl.uniform4f(i,f[0],f[1],f[2],f[3]))}addObject(t,n){var o,h,f,i;if(!t.__webglInit&&(t.__webglInit=!0,t._modelViewMatrix=new M.Matrix4,t._normalMatrix=new M.Matrix3,t.geometry!==void 0&&t.geometry.__webglInit===void 0&&(t.geometry.__webglInit=!0,t.geometry.addEventListener("dispose",this.onGeometryDispose.bind(this))),t instanceof v.Mesh||t instanceof v.Line))for(f=t.geometry,o=0,h=f.geometryGroups.length;o<h;o++)i=f.geometryGroups[o],i.id=this._geometryGroupCounter++,i.__webglVertexBuffer||(t instanceof v.Mesh?(this.createMeshBuffers(i),f.elementsNeedUpdate=!0,f.normalsNeedUpdate=!0):t instanceof v.Line&&this.createLineBuffers(i),f.verticesNeedUpdate=!0,f.colorsNeedUpdate=!0);if(!t.__webglActive){if(t instanceof v.Mesh||t instanceof v.Line)for(f=t.geometry,o=0,h=f.geometryGroups.length;o<h;o++)i=f.geometryGroups[o],this.addBuffer(n.__webglObjects,i,t);else t instanceof v.Sprite&&n.__webglSprites.push(t);t.__webglActive=!0}}updateObject(t){var n=t.geometry,o;if(t instanceof v.Mesh||t instanceof v.Line){for(var h=0,f=n.geometryGroups.length;h<f;h++)o=n.geometryGroups[h],(n.verticesNeedUpdate||n.elementsNeedUpdate||n.colorsNeedUpdate||n.normalsNeedUpdate)&&this.setBuffers(o,this._gl.STATIC_DRAW);n.verticesNeedUpdate=!1,n.elementsNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.buffersNeedUpdate=!1}}removeObject(t,n){t instanceof v.Mesh||t instanceof v.Line?this.removeInstances(n.__webglObjects,t):t instanceof v.Sprite&&this.removeInstancesDirect(n.__webglSprites,t),t.__webglActive=!1}removeInstances(t,n){for(var o=t.length-1;o>=0;--o)t[o].object===n&&t.splice(o,1)}removeInstancesDirect(t,n){for(var o=t.length-1;o>=0;--o)t[o]===n&&t.splice(o,1)}unrollBufferMaterial(t){var n=t.object,o=n.material;if(o.volumetric)t.opaque=null,t.transparent=null,t.volumetric=o;else if(o.transparent){if(t.opaque=null,t.volumetric=null,t.transparent=o,!o.wireframe){let h=o.clone();h.opacity=0,t.transparentDepth=h}}else{if(t.opaque=o,t.transparent=null,t.volumetric=null,!o.wireframe){let h=o.clone();h.opacity=0,t.opaqueDepth=h}o.hasAO&&(t.hasAO=!0),(this._AOEnabled||t.hasAO)&&(t.opaqueShaded=o.clone(),t.opaqueShaded.shaded=!0)}}setBuffers(t,n){var o=t.vertexArray,h=t.colorArray;if(t.__webglOffsetBuffer!==void 0?(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t.__webglOffsetBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,o,n)):(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t.__webglVertexBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,o,n)),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t.__webglColorBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,h,n),t.normalArray&&t.__webglNormalBuffer!==void 0){var f=t.normalArray;this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t.__webglNormalBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,f,n)}if(t.radiusArray&&t.__webglRadiusBuffer!==void 0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t.__webglRadiusBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,t.radiusArray,n)),t.faceArray&&t.__webglFaceBuffer!==void 0){var i=t.faceArray;this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t.__webglFaceBuffer),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,i,n)}if(t.lineArray&&t.__webglLineBuffer!==void 0){var s=t.lineArray;this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t.__webglLineBuffer),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,s,n)}}createMeshBuffers(t){t.radiusArray&&(t.__webglRadiusBuffer=this._gl.createBuffer()),t.useOffset&&(t.__webglOffsetBuffer=this._gl.createBuffer()),t.__webglVertexBuffer=this._gl.createBuffer(),t.__webglNormalBuffer=this._gl.createBuffer(),t.__webglColorBuffer=this._gl.createBuffer(),t.__webglFaceBuffer=this._gl.createBuffer(),t.__webglLineBuffer=this._gl.createBuffer(),this.info.memory.geometries++}createLineBuffers(t){t.__webglVertexBuffer=this._gl.createBuffer(),t.__webglColorBuffer=this._gl.createBuffer(),this.info.memory.geometries++}addBuffer(t,n,o){t.push({buffer:n,object:o,opaque:null,transparent:null})}setupMatrices(t,n){t._modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t._normalMatrix.getInverse(t._modelViewMatrix),t._normalMatrix.transpose()}filterFallback(t){return this._gl.LINEAR}setTextureParameters(t,n){t==this._gl.TEXTURE_2D?(this._gl.texParameteri(t,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(t,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(t,this._gl.TEXTURE_MAG_FILTER,this.filterFallback(n.magFilter)),this._gl.texParameteri(t,this._gl.TEXTURE_MIN_FILTER,this.filterFallback(n.minFilter))):(this._gl.texParameteri(t,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(t,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(t,this._gl.TEXTURE_WRAP_R,this._gl.CLAMP_TO_EDGE),this._extColorBufferFloat&&this._extFloatLinear?(this._gl.texParameteri(t,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(t,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR)):(this._gl.texParameteri(t,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(t,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST)))}paramToGL(t){return t===w.UnsignedByteType?this._gl.UNSIGNED_BYTE:t===w.RGBAFormat?this._gl.RGBA:t===w.NearestFilter?this._gl.NEAREST:0}setupLights(t,n){var o,h,f,i=0,s=0,a=0,c,u,E=this._lights,T=E.directional.colors,L=E.directional.positions,P=0,I=0;for(o=0,h=n.length;o<h;o++)if(f=n[o],c=f.color,u=f.intensity,f instanceof O.Light){if(this._direction.getPositionFromMatrix(f.matrixWorld),this._vector3.getPositionFromMatrix(f.target.matrixWorld),this._direction.sub(this._vector3),this._direction.normalize(),this._direction.x===0&&this._direction.y===0&&this._direction.z===0)continue;L[I]=this._direction.x,L[I+1]=this._direction.y,L[I+2]=this._direction.z,T[I]=c.r*u,T[I+1]=c.g*u,T[I+2]=c.b*u,I+=3,P++}E.ambient[0]=i,E.ambient[1]=s,E.ambient[2]=a,E.directional.length=P}initGL(){try{if(OffscreenCanvas&&!(this.rows!=null&&this.cols!=null&&this.row!=null&&this.col!=null))(m==null||m.isContextLost())&&(g=new OffscreenCanvas(this._canvas.width,this._canvas.height),m=g.getContext("webgl2",{alpha:!0,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,preserveDrawingBuffer:this._preserveDrawingBuffer})),this._offscreen=g,this._gl=m,this._bitmap=this._canvas.getContext("bitmaprenderer",{alpha:!0});else if(!(this._gl=this._canvas.getContext("webgl2",{alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,preserveDrawingBuffer:this._preserveDrawingBuffer}))&&!(this._gl=this._canvas.getContext("experimental-webgl",{alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,preserveDrawingBuffer:this._preserveDrawingBuffer}))&&!(this._gl=this._canvas.getContext("webgl",{alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,preserveDrawingBuffer:this._preserveDrawingBuffer})))throw"Error creating WebGL context.";var t=this._gl.getParameter(this._gl.VERSION);this._webglversion=parseInt(t[6])}catch(n){console.error(n)}}isWebGL1(){return this._webglversion==1}setDefaultGLState(){this._gl.clearDepth(1),this._gl.clearStencil(0),this._gl.enable(this._gl.DEPTH_TEST),this._gl.depthFunc(this._gl.LEQUAL),this._gl.frontFace(this._gl.CCW),this._gl.cullFace(this._gl.BACK),this._gl.enable(this._gl.CULL_FACE),this._gl.enable(this._gl.BLEND),this._gl.blendEquation(this._gl.FUNC_ADD),this._gl.blendFunc(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha)}renderObjects(t,n,o,h,f,i,s){var a,c,u,E,T,L,P;n?(T=t.length-1,L=-1,P=-1):(T=0,L=t.length,P=1);for(var I=T;I!==L;I+=P)if(a=t[I],a.render){if(c=a.object,u=a.buffer,E=a[o],(a.hasAO||this._AOEnabled)&&a[o+"Shaded"]&&(E=a[o+"Shaded"]),!E)continue;this.setBlending(s),this.setDepthTest(E.depthTest),this.setDepthWrite(E.depthWrite),this.setPolygonOffset(E.polygonOffset,E.polygonOffsetFactor,E.polygonOffsetUnits);var z=c._modelViewMatrix.isReflected();if(this.setMaterialFaces(E,z),this.renderBuffer(h,f,i,E,u,c),(this._outlineEnabled||E.outline)&&!E.wireframe&&E.shaderID!=="basic"&&E.opacity!==0){let B=this._outlineMaterial;E.shaderID=="sphereimposter"?B=this._outlineSphereImposterMaterial:E.shaderID=="stickimposter"&&(B=this._outlineStickImposterMaterial),this.renderBuffer(h,f,i,B,u,c)}}}renderSprites(t,n,o){this._currentGeometryGroupHash=-1,this._currentProgram=null,this._currentCamera=null,this._oldDepthWrite=-1,this._oldDepthTest=-1,this._oldDoubleSided=-1,this._currentMaterialId=-1,this._oldFlipSided=-1,this._lightsNeedUpdate=!0,this.sprites.render(t,n,this._currentWidth,this._currentHeight,o),this._currentGeometryGroupHash=-1,this._currentProgram=null,this._currentCamera=null,this._oldDepthWrite=-1,this._oldDepthTest=-1,this._oldDoubleSided=-1,this._currentMaterialId=-1,this._oldFlipSided=-1}}},"./src/WebGL/SpritePlugin.ts":(K,C,d)=>{d.r(C),d.d(C,{SpritePlugin:()=>S});var A=d("./src/WebGL/shaders/index.ts");class S{constructor(){this.sprite={vertices:null,faces:null,vertexBuffer:null,elementBuffer:null,program:null,attributes:{},uniforms:null}}init(p){this.gl=p.context,this.renderer=p,this.precision=p.getPrecision(),this.sprite.vertices=new Float32Array(16),this.sprite.faces=new Uint16Array(6);var x=0;this.sprite.vertices[x++]=-1,this.sprite.vertices[x++]=-1,this.sprite.vertices[x++]=0,this.sprite.vertices[x++]=0,this.sprite.vertices[x++]=1,this.sprite.vertices[x++]=-1,this.sprite.vertices[x++]=1,this.sprite.vertices[x++]=0,this.sprite.vertices[x++]=1,this.sprite.vertices[x++]=1,this.sprite.vertices[x++]=1,this.sprite.vertices[x++]=1,this.sprite.vertices[x++]=-1,this.sprite.vertices[x++]=1,this.sprite.vertices[x++]=0,this.sprite.vertices[x++]=1,x=0,this.sprite.faces[x++]=0,this.sprite.faces[x++]=1,this.sprite.faces[x++]=2,this.sprite.faces[x++]=0,this.sprite.faces[x++]=2,this.sprite.faces[x++]=3,this.sprite.vertexBuffer=this.gl.createBuffer(),this.sprite.elementBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.sprite.vertexBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.sprite.vertices,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.sprite.elementBuffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.sprite.faces,this.gl.STATIC_DRAW),this.sprite.program=this.createProgram(A.ShaderLib.sprite,this.precision||1),this.sprite.attributes={};const M={};this.sprite.attributes.position=this.gl.getAttribLocation(this.sprite.program,"position"),this.sprite.attributes.uv=this.gl.getAttribLocation(this.sprite.program,"uv"),M.uvOffset=this.gl.getUniformLocation(this.sprite.program,"uvOffset"),M.uvScale=this.gl.getUniformLocation(this.sprite.program,"uvScale"),M.rotation=this.gl.getUniformLocation(this.sprite.program,"rotation"),M.scale=this.gl.getUniformLocation(this.sprite.program,"scale"),M.alignment=this.gl.getUniformLocation(this.sprite.program,"alignment"),M.color=this.gl.getUniformLocation(this.sprite.program,"color"),M.map=this.gl.getUniformLocation(this.sprite.program,"map"),M.opacity=this.gl.getUniformLocation(this.sprite.program,"opacity"),M.useScreenCoordinates=this.gl.getUniformLocation(this.sprite.program,"useScreenCoordinates"),M.screenPosition=this.gl.getUniformLocation(this.sprite.program,"screenPosition"),M.modelViewMatrix=this.gl.getUniformLocation(this.sprite.program,"modelViewMatrix"),M.projectionMatrix=this.gl.getUniformLocation(this.sprite.program,"projectionMatrix"),M.fogNear=this.gl.getUniformLocation(this.sprite.program,"fogNear"),M.fogFar=this.gl.getUniformLocation(this.sprite.program,"fogFar"),M.fogColor=this.gl.getUniformLocation(this.sprite.program,"fogColor"),M.alphaTest=this.gl.getUniformLocation(this.sprite.program,"alphaTest"),this.sprite.uniforms=M}render(p,x,M,v,b){var _,g,m,r,e,t,n,o,h,f;if(!this.gl)throw new Error("WebGLRenderer not initialized");let i=[];(_=p?.__webglSprites)===null||_===void 0||_.forEach(U=>{(b&&U.material.depthTest==!1||!b&&U.material.depthTest)&&i.push(U)});let s=i.length;if(!s)return;const a=this.sprite.attributes,c=this.sprite.uniforms;if(!c)throw new Error("Uniforms not defined");var u=M*.5,E=v*.5;this.gl.useProgram(this.sprite.program),this.gl.enableVertexAttribArray(a.position),this.gl.enableVertexAttribArray(a.uv),this.gl.disable(this.gl.CULL_FACE),this.gl.enable(this.gl.BLEND),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.sprite.vertexBuffer),this.gl.vertexAttribPointer(a.position,2,this.gl.FLOAT,!1,16,0),this.gl.vertexAttribPointer(a.uv,2,this.gl.FLOAT,!1,16,8),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.sprite.elementBuffer),this.gl.uniformMatrix4fv(c.projectionMatrix,!1,x.projectionMatrix.elements),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.uniform1i(c.map,0);var T=p.fog;T?(this.gl.uniform3f(c.fogColor,T.color.r,T.color.g,T.color.b),this.gl.uniform1f(c.fogNear,T.near),this.gl.uniform1f(c.fogFar,T.far)):(this.gl.uniform1f(c.fogNear,0),this.gl.uniform1f(c.fogFar,0));var L;let P,I,z,B=[];for(L=0;L<s;L++)P=i[L],I=P.material,I&&(I.depthTest==!1&&!b||!P.visible||I.opacity===0||(I.useScreenCoordinates?P.z=-P.position.z:(P._modelViewMatrix.multiplyMatrices(x.matrixWorldInverse,P.matrixWorld),P.z=-P._modelViewMatrix.elements[14])));for(i.sort(w),L=0;L<s;L++)if(P=i[L],I=P.material,!!I&&!(!P.visible||I.opacity===0)&&I.map&&I.map.image&&I.map.image.width){this.gl.uniform1f(c?.alphaTest||null,I.alphaTest);var F=I.map.image.width,W=I.map.image.height;B[0]=F*this.renderer.devicePixelRatio/M,B[1]=W*this.renderer.devicePixelRatio/v,I.useScreenCoordinates===!0?(this.gl.uniform1i(c.useScreenCoordinates,1),this.gl.uniform3f(c.screenPosition,(P.position.x*this.renderer.devicePixelRatio-u)/u,(E-P.position.y*this.renderer.devicePixelRatio)/E,Math.max(0,Math.min(1,P.position.z)))):(this.gl.uniform1i(c.useScreenCoordinates,0),this.gl.uniformMatrix4fv(c.modelViewMatrix,!1,P._modelViewMatrix.elements)),z=1/(I.scaleByViewport?v:1),B[0]*=z*P.scale.x,B[1]*=z*P.scale.y;let U=(g=I?.alignment)===null||g===void 0?void 0:g.x,R=(m=I?.alignment)===null||m===void 0?void 0:m.y;I.screenOffset&&(U=(U||0)+2*I.screenOffset.x/F,R=(R||0)+2*I.screenOffset.y/W),this.gl.uniform2f(c.uvScale,((r=I?.uvScale)===null||r===void 0?void 0:r.x)||1,((e=I?.uvScale)===null||e===void 0?void 0:e.y)||1),this.gl.uniform2f(c.uvOffset,((t=I?.uvOffset)===null||t===void 0?void 0:t.x)||0,((n=I?.uvOffset)===null||n===void 0?void 0:n.y)||0),this.gl.uniform2f(c.alignment,U||0,R||0),this.gl.uniform1f(c.opacity,I.opacity),this.gl.uniform3f(c.color,((o=I?.color)===null||o===void 0?void 0:o.r)||0,((h=I?.color)===null||h===void 0?void 0:h.g)||0,((f=I?.color)===null||f===void 0?void 0:f.b)||0),this.gl.uniform1f(c.rotation,P.rotation),this.gl.uniform2fv(c.scale,B),this.renderer.setDepthTest(I.depthTest),this.renderer.setDepthWrite(I.depthWrite),this.renderer.setTexture(I.map,0),this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0)}this.gl.enable(this.gl.CULL_FACE)}createProgram(p,x){if(!this.gl)throw new Error("WebGL Rendering context not found");var M=this.gl.createProgram();if(!M)throw new Error("Error creating webgl program");var v=this.gl.createShader(this.gl.FRAGMENT_SHADER),b=this.gl.createShader(this.gl.VERTEX_SHADER);if(!v)throw new Error("Unable to create fragment shader SpritePlugin.createProgram");if(!b)throw new Error("Unable to create vertex shader SpritePlugin.createProgram");var _="precision "+x+` float;
`;if(this.gl.shaderSource(v,_+p.fragmentShader),this.gl.shaderSource(b,_+p.vertexShader),this.gl.compileShader(v),this.gl.compileShader(b),!this.gl.getShaderParameter(v,this.gl.COMPILE_STATUS)||!this.gl.getShaderParameter(b,this.gl.COMPILE_STATUS))throw new Error(`Error compiling shader: 
      ${this.gl.getShaderInfoLog(v)} 
      ${this.gl.getShaderInfoLog(b)}`);return this.gl.attachShader(M,v),this.gl.attachShader(M,b),this.gl.linkProgram(M),this.gl.getProgramParameter(M,this.gl.LINK_STATUS)||console.error("Could not initialize shader"),M}}function w(O,p){return O.z!==p.z?p.z-O.z:p.id-O.id}},"./src/WebGL/constants/Coloring.ts":(K,C,d)=>{d.r(C),d.d(C,{Coloring:()=>A});var A;(function(S){S[S.NoColors=0]="NoColors",S[S.FaceColors=1]="FaceColors",S[S.VertexColors=2]="VertexColors"})(A||(A={}))},"./src/WebGL/constants/Shading.ts":(K,C,d)=>{d.r(C),d.d(C,{Shading:()=>A});var A;(function(S){S[S.NoShading=0]="NoShading",S[S.FlatShading=1]="FlatShading",S[S.SmoothShading=2]="SmoothShading"})(A||(A={}))},"./src/WebGL/constants/Sides.ts":(K,C,d)=>{d.r(C),d.d(C,{BackSide:()=>S,DoubleSide:()=>w,FrontSide:()=>A});const A=0,S=1,w=2},"./src/WebGL/constants/SpriteAlignment.ts":(K,C,d)=>{d.r(C),d.d(C,{SpriteAlignment:()=>S});var A=d("./src/WebGL/math/index.ts");const S={topLeft:new A.Vector2(1,-1),topCenter:new A.Vector2(0,-1),topRight:new A.Vector2(-1,-1),centerLeft:new A.Vector2(1,0),center:new A.Vector2(0,0),centerRight:new A.Vector2(-1,0),bottomLeft:new A.Vector2(1,1),bottomCenter:new A.Vector2(0,1),bottomRight:new A.Vector2(-1,1)}},"./src/WebGL/constants/TextureConstants.ts":(K,C,d)=>{d.r(C),d.d(C,{ClampToEdgeWrapping:()=>A,FloatType:()=>x,LinearFilter:()=>S,LinearMipMapLinearFilter:()=>O,NearestFilter:()=>w,R32Format:()=>b,RFormat:()=>v,RGBAFormat:()=>M,UnsignedByteType:()=>p});const A=1001,S=1006,w=1007,O=1008,p=1009,x=1010,M=1021,v=1022,b=1023},"./src/WebGL/constants/TextureOperations.ts":(K,C,d)=>{d.r(C),d.d(C,{TextureOperations:()=>A});var A;(function(S){S[S.MultiplyOperation=0]="MultiplyOperation",S[S.MixOperation=1]="MixOperation",S[S.AddOperation=2]="AddOperation"})(A||(A={}))},"./src/WebGL/constants/index.ts":(K,C,d)=>{d.r(C),d.d(C,{BackSide:()=>S.BackSide,ClampToEdgeWrapping:()=>p.ClampToEdgeWrapping,Coloring:()=>A.Coloring,DoubleSide:()=>S.DoubleSide,FloatType:()=>p.FloatType,FrontSide:()=>S.FrontSide,LinearFilter:()=>p.LinearFilter,LinearMipMapLinearFilter:()=>p.LinearMipMapLinearFilter,NearestFilter:()=>p.NearestFilter,R32Format:()=>p.R32Format,RFormat:()=>p.RFormat,RGBAFormat:()=>p.RGBAFormat,Shading:()=>w.Shading,SpriteAlignment:()=>O.SpriteAlignment,TextureOperations:()=>x.TextureOperations,UnsignedByteType:()=>p.UnsignedByteType});var A=d("./src/WebGL/constants/Coloring.ts"),S=d("./src/WebGL/constants/Sides.ts"),w=d("./src/WebGL/constants/Shading.ts"),O=d("./src/WebGL/constants/SpriteAlignment.ts"),p=d("./src/WebGL/constants/TextureConstants.ts"),x=d("./src/WebGL/constants/TextureOperations.ts")},"./src/WebGL/core/EventDispatcher.ts":(K,C,d)=>{d.r(C),d.d(C,{EventDispatcher:()=>A});class A{constructor(){this.listeners={}}dispatchEvent(w){var O=this.listeners[w.type];if(O!==void 0){w.target=this;for(var p=0,x=O.length;p<x;p++)O[p].call(this,w)}}removeEventListener(w,O){if(!O)this.listeners[w]=[];else{var p=this.listeners[w].indexOf(O);p!==-1&&this.listeners[w].splice(p,1)}}addEventListener(w,O){this.listeners[w]===void 0&&(this.listeners[w]=[]),this.listeners[w].indexOf(O)===-1&&this.listeners[w].push(O)}}},"./src/WebGL/core/Geometry.ts":(K,C,d)=>{d.r(C),d.d(C,{Geometry:()=>M,GeometryGroup:()=>x,GeometryIDCount:()=>v});var A=d("./src/WebGL/materials/LineBasicMaterial.ts"),S=d("./src/WebGL/core/EventDispatcher.ts"),w=d("./src/WebGL/math/index.ts"),O=d("./src/colors.ts");const p=65535;class x{constructor(_=0){this.vertexArray=null,this.colorArray=null,this.normalArray=null,this.radiusArray=null,this.faceArray=null,this.lineArray=null,this.atomArray=Array(),this.vertices=0,this.faceidx=0,this.lineidx=0,this.__inittedArrays=!1,this.id=_}setColor(_){var g=this.vertexArray,m=this.colorArray;if(!g)throw new Error("vertex array not initialized");if(!m)throw new Error("color array not initialized");let r=O.CC.color(_);for(var e=0;e<g.length;e+=3)m[e]=r.r,m[e+1]=r.g,m[e+2]=r.b}setColors(_){var g=this.vertexArray,m=this.colorArray;if(!g)throw new Error("vertex array not initialized");if(!m)throw new Error("color array not initialized");if(g.length!=m.length){console.log("Cannot re-color geometry group due to mismatched lengths.");return}for(var r=0;r<g.length;r+=3){var e=_(g[r],g[r+1],g[r+2]);e instanceof O.Color||(e=O.CC.color(e)),m[r]=e.r,m[r+1]=e.g,m[r+2]=e.b}}getNumVertices(){return this.vertices}getVertices(){return this.vertexArray}getCentroid(){if(!this.vertexArray)throw new Error("vertex array not initialized");for(var _=new w.Vector3,g,m,r,e,t=0;t<this.vertices;++t)g=t*3,m=this.vertexArray[g],r=this.vertexArray[g+1],e=this.vertexArray[g+2],_.x+=m,_.y+=r,_.z+=e;return _.divideScalar(this.vertices),_}setNormals(){var _=this.faceArray,g=this.vertexArray,m=this.normalArray;if(!(!this.vertices||!this.faceidx)){if(!_)throw new Error("face array not initialized");if(!g)throw new Error("vertex array not initialized");if(!m)throw new Error("normal array not initialized");for(var r,e,t,n,o,h,f,i=0;i<_.length/3;++i)r=_[i*3]*3,e=_[i*3+1]*3,t=_[i*3+2]*3,n=new w.Vector3(g[r],g[r+1],g[r+2]),o=new w.Vector3(g[e],g[e+1],g[e+2]),h=new w.Vector3(g[t],g[t+1],g[t+2]),n.subVectors(n,o),h.subVectors(h,o),h.cross(n),f=h,f.normalize(),m[r]+=f.x,m[e]+=f.x,m[t]+=f.x,m[r+1]+=f.y,m[e+1]+=f.y,m[t+1]+=f.y,m[r+2]+=f.z,m[e+2]+=f.z,m[t+2]+=f.z}}setLineIndices(){if(this.faceidx&&!(this.lineArray&&this.lineArray.length==this.faceidx*2&&this.lineidx==this.faceidx*2)){var _=this.faceArray,g=this.lineArray=new Uint16Array(this.faceidx*2);if(this.lineidx=this.faceidx*2,!_)throw new Error("face array not initialized");for(var m=0;m<this.faceidx/3;++m){var r=m*3,e=r*2,t=_[r],n=_[r+1],o=_[r+2];g[e]=t,g[e+1]=n,g[e+2]=t,g[e+3]=o,g[e+4]=n,g[e+5]=o}}}vrml(_,g){var m,r,e,t,n,o,h,f,i,s,a,c,u,E,T,L,P,I,z="";if(z+=_+`Shape {
`+_+` appearance Appearance {
`+_+`  material Material {
`+_+"   diffuseColor "+((m=g?.color)===null||m===void 0?void 0:m.r)+" "+((r=g?.color)===null||r===void 0?void 0:r.g)+" "+((e=g?.color)===null||e===void 0?void 0:e.b)+`
`,g.wireframe&&this.colorArray){let F=this.colorArray;z+=_+"    emissiveColor "+F[0]+" "+F[1]+" "+F[2]+`
`}g?.transparent&&(z+=_+"   transparency "+(1-g.opacity)+`
`),z+=_+`  }
`,z+=_+` }
`;var B=_;if(_+=" ",g instanceof A.LineBasicMaterial||g.wireframe){z+=_+`geometry IndexedLineSet {
`+_+` colorPerVertex TRUE
`+_+` coord Coordinate {
`+_+`  point [
`;let F,W,U;for(let R=0;R<this.vertices;++R){let V=R*3;F=(t=this.vertexArray)===null||t===void 0?void 0:t[V],W=(n=this.vertexArray)===null||n===void 0?void 0:n[V+1],U=(o=this.vertexArray)===null||o===void 0?void 0:o[V+2],z+=_+"   "+F+" "+W+" "+U+`,
`}if(z+=_+`  ]
`,z+=_+` }
`,this.colorArray&&!g.wireframe){z+=_+` color Color {
`+_+`  color [
`;for(let R=0;R<this.vertices;++R){let V=R*3;F=this.colorArray[V],W=this.colorArray[V+1],U=this.colorArray[V+2],z+=_+"   "+F+" "+W+" "+U+`,
`}z+=_+`  ]
`,z+=_+` }
`}if(z+=_+` coordIndex [
`,g.wireframe&&this.faceArray)for(let R=0;R<this.faceidx;R+=3)F=(h=this.faceArray)===null||h===void 0?void 0:h[R],W=(f=this.faceArray)===null||f===void 0?void 0:f[R+1],U=(i=this.faceArray)===null||i===void 0?void 0:i[R+2],z+=_+"  "+F+", "+W+", "+U+`, -1,
`;else for(let R=0;R<this.vertices-1;R+=2)z+=_+"  "+R+", "+(R+1)+`, -1,
`;z+=_+` ]
`,z+=_+`}
`}else{z+=_+`geometry IndexedFaceSet {
`+_+` colorPerVertex TRUE
`+_+` normalPerVertex TRUE
`+_+` solid FALSE
`,z+=_+` coord Coordinate {
`+_+`  point [
`;let F,W,U;for(let R=0;R<this.vertices;++R){let V=R*3;F=(s=this.vertexArray)===null||s===void 0?void 0:s[V],W=(a=this.vertexArray)===null||a===void 0?void 0:a[V+1],U=(c=this.vertexArray)===null||c===void 0?void 0:c[V+2],z+=_+"   "+F+" "+W+" "+U+`,
`}z+=_+`  ]
`,z+=_+` }
`,z+=_+` normal Normal {
`+_+`  vector [
`;for(let R=0;R<this.vertices;++R){let V=R*3;F=(u=this.normalArray)===null||u===void 0?void 0:u[V],W=(E=this.normalArray)===null||E===void 0?void 0:E[V+1],U=(T=this.normalArray)===null||T===void 0?void 0:T[V+2],z+=_+"   "+F+" "+W+" "+U+`,
`}if(z+=_+`  ]
`,z+=_+` }
`,this.colorArray){z+=_+` color Color {
`+_+`  color [
`;for(let R=0;R<this.vertices;++R){let V=R*3;F=this.colorArray[V],W=this.colorArray[V+1],U=this.colorArray[V+2],z+=_+"   "+F+" "+W+" "+U+`,
`}z+=_+`  ]
`,z+=_+` }
`}z+=_+` coordIndex [
`;for(let R=0;R<this.faceidx;R+=3)F=(L=this.faceArray)===null||L===void 0?void 0:L[R],W=(P=this.faceArray)===null||P===void 0?void 0:P[R+1],U=(I=this.faceArray)===null||I===void 0?void 0:I[R+2],z+=_+"  "+F+", "+W+", "+U+`, -1,
`;z+=_+` ]
`,z+=_+`}
`}return z+=B+"}",z}truncateArrayBuffers(_=!0,g=!1){var m=this.vertexArray,r=this.colorArray,e=this.normalArray,t=this.faceArray,n=this.lineArray,o=this.radiusArray;this.vertexArray=m?.subarray(0,this.vertices*3)||null,this.colorArray=r?.subarray(0,this.vertices*3)||null,_?(this.normalArray=e?.subarray(0,this.vertices*3)||null,this.faceArray=t?.subarray(0,this.faceidx)||null,this.lineidx>0?this.lineArray=n?.subarray(0,this.lineidx)||null:this.lineArray=new Uint16Array(0)):(this.normalArray=new Float32Array(0),this.faceArray=new Uint16Array(0),this.lineArray=new Uint16Array(0)),o&&(this.radiusArray=o.subarray(0,this.vertices)),g&&(this.normalArray&&(this.normalArray=new Float32Array(this.normalArray)),this.faceArray&&(this.faceArray=new Uint16Array(this.faceArray)),this.lineArray&&(this.lineArray=new Uint16Array(this.lineArray)),this.vertexArray&&(this.vertexArray=new Float32Array(this.vertexArray)),this.colorArray&&(this.colorArray=new Float32Array(this.colorArray)),this.radiusArray&&(this.radiusArray=new Float32Array(this.radiusArray))),this.__inittedArrays=!0}}class M extends S.EventDispatcher{constructor(_=!1,g=!1,m=!1){super(),this.name="",this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.buffersNeedUpdate=!1,this.imposter=!1,this.instanced=!1,this.geometryGroups=[],this.groups=0,this.id=v++,this.mesh=_,this.radii=g,this.offset=m}updateGeoGroup(_=0){var g,m=this.groups>0?this.geometryGroups[this.groups-1]:null;return(!m||m.vertices+_>(((g=m?.vertexArray)===null||g===void 0?void 0:g.length)||0)/3)&&(m=this.addGeoGroup()),m}vrml(_,g){for(var m="",r=this.geometryGroups.length,e=0;e<r;e++){var t=this.geometryGroups[e];m+=t.vrml(_,g)+`,
`}return m}addGeoGroup(){var _=new x(this.geometryGroups.length);return this.geometryGroups.push(_),this.groups=this.geometryGroups.length,_.vertexArray=new Float32Array(p*3),_.colorArray=new Float32Array(p*3),this.mesh&&(_.normalArray=new Float32Array(p*3),_.faceArray=new Uint16Array(p*6),_.lineArray=new Uint16Array(p*6)),this.radii&&(_.radiusArray=new Float32Array(p)),_.useOffset=this.offset,_}setUpNormals(..._){for(var g=0;g<this.groups;g++){var m=this.geometryGroups[g];m.setNormals(..._)}}setColors(..._){for(var g=this.geometryGroups.length,m=0;m<g;m++){var r=this.geometryGroups[m];r.setColors(..._)}}setColor(..._){let g=this.geometryGroups.length;for(var m=0;m<g;m++){var r=this.geometryGroups[m];r.setColor(..._)}}setUpWireframe(..._){let g=this.geometryGroups.length;for(var m=0;m<g;m++){var r=this.geometryGroups[m];r.setLineIndices(..._)}}initTypedArrays(){for(var _=0;_<this.groups;_++){var g=this.geometryGroups[_];g.__inittedArrays!==!0&&g.truncateArrayBuffers(this.mesh,!1)}}dispose(){this.dispatchEvent({type:"dispose"})}get vertices(){for(var _=0,g=0;g<this.groups;g++)_+=this.geometryGroups[g].vertices;return _}}let v=0},"./src/WebGL/core/Object3D.ts":(K,C,d)=>{d.r(C),d.d(C,{Light:()=>x,Object3D:()=>O,Object3DIDCount:()=>w,Scene:()=>p});var A=d("./src/WebGL/math/index.ts"),S=d("./src/colors.ts");let w=0;class O{constructor(){this.id=w++,this.name="",this.children=[],this.position=new A.Vector3,this.rotation=new A.Vector3,this.matrix=new A.Matrix4,this.matrixWorld=new A.Matrix4,this.quaternion=new A.Quaternion,this.eulerOrder="XYZ",this.up=new A.Vector3(0,1,0),this.scale=new A.Vector3(1,1,1),this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!0,this.rotationAutoUpdate=!0,this.useQuaternion=!1,this.visible=!0}lookAt(v){this.matrix.lookAt(v,this.position,this.up),this.rotationAutoUpdate&&(this.useQuaternion===!0?console.error("Unimplemented math operation."):this.rotation instanceof A.Vector3&&this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder))}add(v){if(v===this){console.error("Can't add $3Dmol.Object3D to itself");return}v.parent=this,this.children.push(v);for(var b=this;b.parent!==void 0;)b=b.parent;b!==void 0&&b instanceof p&&b.__addObject(v)}remove(v){var b=this.children.indexOf(v);if(b!==-1){v.parent=void 0,this.children.splice(b,1);for(var _=this;_.parent!==void 0;)_=_.parent;_!==void 0&&_ instanceof p&&_.__removeObject(v)}}vrml(v){v||(v=" ");var b=2*Math.atan2(this.quaternion.lengthxyz(),this.quaternion.w),_=0,g=0,m=0;if(b!=0){let t=Math.sin(b/2);_=this.quaternion.x/t,g=this.quaternion.y/t,m=this.quaternion.z/t}var r=v+`Transform {
`+v+" center "+this.position.x+" "+this.position.y+" "+this.position.z+`
`+v+" rotation "+_+" "+g+" "+m+" "+b+`
`+v+` children [
`;this.geometry&&(r+=this.geometry.vrml(v,this.material));for(var e=0;e<this.children.length;e++)r+=this.children[e].vrml(v+" ")+`,
`;return r+=` ]
`,r+="}",r}updateMatrix(){this.matrix.setPosition(this.position),this.useQuaternion===!1&&this.rotation instanceof A.Vector3?this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder):this.matrix.setRotationFromQuaternion(this.quaternion),(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1)&&this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(v){this.matrixAutoUpdate===!0&&this.updateMatrix(),(this.matrixWorldNeedsUpdate===!0||v===!0)&&(this.parent===void 0?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1;for(var b=0;b<this.children.length;b++)this.children[b].updateMatrixWorld(!0)}clone(v){v===void 0&&(v=new O),v.name=this.name,v.up.copy(this.up),v.position.copy(this.position),v.rotation instanceof A.Vector3&&this.rotation instanceof A.Vector3?v.rotation.copy(this.rotation):v.rotation=this.rotation,v.eulerOrder=this.eulerOrder,v.scale.copy(this.scale),v.rotationAutoUpdate=this.rotationAutoUpdate,v.matrix.copy(this.matrix),v.matrixWorld.copy(this.matrixWorld),v.quaternion.copy(this.quaternion),v.matrixAutoUpdate=this.matrixAutoUpdate,v.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,v.useQuaternion=this.useQuaternion,v.visible=this.visible;for(var b=0;b<this.children.length;b++){var _=this.children[b];v.add(_.clone())}return v}setVisible(v){this.visible=v;for(var b=0;b<this.children.length;b++){var _=this.children[b];_.setVisible(v)}}}class p extends O{constructor(){super(...arguments),this.fog=null,this.overrideMaterial=null,this.matrixAutoUpdate=!1,this.__objects=[],this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]}__addObject(v){if(v instanceof x)this.__lights.indexOf(v)===-1&&this.__lights.push(v),v.target&&v.target.parent===void 0&&this.add(v.target);else if(this.__objects.indexOf(v)===-1){this.__objects.push(v),this.__objectsAdded.push(v);var b=this.__objectsRemoved.indexOf(v);b!==-1&&this.__objectsRemoved.splice(b,1)}for(var _=0;_<v.children.length;_++)this.__addObject(v.children[_])}__removeObject(v){var b;if(v instanceof x)b=this.__lights.indexOf(v),b!==-1&&this.__lights.splice(b,1);else if(b=this.__objects.indexOf(v),b!==-1){this.__objects.splice(b,1),this.__objectsRemoved.push(v);var _=this.__objectsAdded.indexOf(v);_!==-1&&this.__objectsAdded.splice(b,1)}for(var g=0;g<v.children.length;g++)this.__removeObject(v.children[g])}}class x extends O{constructor(v,b=1){super(),this.position=new A.Vector3(0,1,0),this.target=new O,this.castShadow=!1,this.onlyShadow=!1,this.color=new S.Color(v),this.intensity=b}}},"./src/WebGL/core/Projector.ts":(K,C,d)=>{d.r(C),d.d(C,{Projector:()=>w});var A=d("./src/WebGL/math/index.ts");const S=new A.Matrix4;class w{static unprojectVector(p,x){return x.projectionMatrixInverse.getInverse(x.projectionMatrix),S.multiplyMatrices(x.matrixWorld,x.projectionMatrixInverse),p.applyProjection(S)}static projectVector(p,x){return x.matrixWorldInverse.getInverse(x.matrixWorld),S.multiplyMatrices(x.projectionMatrix,x.matrixWorldInverse),p.applyProjection(S)}projectVector(p,x){return w.projectVector(p,x)}unprojectVector(p,x){return w.unprojectVector(p,x)}}},"./src/WebGL/core/Raycaster.ts":(K,C,d)=>{d.r(C),d.d(C,{Raycaster:()=>p,intersectObject:()=>t});var A=d("./src/WebGL/math/index.ts"),S=d("./src/WebGL/shapes/index.ts");const w=(n,o)=>n.distance-o.distance,O=new A.Matrix4;class p{constructor(o,h,f,i){this.precision=1e-4,this.linePrecision=.2,this.ray=new A.Ray(o,h),this.ray.direction.lengthSq()>0&&this.ray.direction.normalize(),this.near=i||0,this.far=f||1/0}set(o,h){this.ray.set(o,h)}setFromCamera(o,h){h.ortho?(this.ray.origin.set(o.x,o.y,(h.near+h.far)/(h.near-h.far)).unproject(h),this.ray.direction.set(0,0,-1).transformDirection(h.matrixWorld)):(this.ray.origin.setFromMatrixPosition(h.matrixWorld),this.ray.direction.set(o.x,o.y,o.z),h.projectionMatrixInverse.getInverse(h.projectionMatrix),O.multiplyMatrices(h.matrixWorld,h.projectionMatrixInverse),this.ray.direction.applyProjection(O),this.ray.direction.sub(this.ray.origin).normalize())}intersectObjects(o,h){for(var f=[],i=0,s=h.length;i<s;i++)t(o,h[i],this,f);return f.sort(w),f}}const x=n=>Math.min(Math.max(n,-1),1);var M=new S.Sphere,v=new S.Cylinder,b=new S.Triangle,_=new A.Vector3,g=new A.Vector3,m=new A.Vector3,r=new A.Vector3,e=new A.Vector3;function t(n,o,h,f){if(e.getPositionFromMatrix(n.matrixWorld),o.intersectionShape===void 0||o.hidden)return f;var i=o.intersectionShape,s=h.linePrecision;s*=n.matrixWorld.getMaxScaleOnAxis();var a=s*s;if(o.boundingSphere!==void 0&&o.boundingSphere instanceof S.Sphere&&(M.copy(o.boundingSphere),M.applyMatrix4(n.matrixWorld),!h.ray.isIntersectionSphere(M)))return f;var c,u,E,T,L,P,I,z,B,F,W,U,R,V;for(c=0,u=i.triangle.length;c<u;c++)if(i.triangle[c]instanceof S.Triangle){if(b.copy(i.triangle[c]),b.applyMatrix4(n.matrixWorld),E=b.getNormal(),T=h.ray.direction.dot(E),T>=0||(_.subVectors(b.a,h.ray.origin),I=E.dot(_)/T,I<0))continue;g.copy(h.ray.direction).multiplyScalar(I).add(h.ray.origin),g.sub(b.a),m.copy(b.b).sub(b.a),r.copy(b.c).sub(b.a);var q=m.dot(r),ee=m.lengthSq(),se=r.lengthSq();if(U=(ee*g.dot(r)-q*g.dot(m))/(ee*se-q*q),U<0||U>1||(W=(g.dot(m)-U*q)/ee,W<0||W>1||W+U>1))continue;f.push({clickable:o,distance:I})}for(c=0,u=i.cylinder.length;c<u;c++)if(i.cylinder[c]instanceof S.Cylinder){if(v.copy(i.cylinder[c]),v.applyMatrix4(n.matrixWorld),_.subVectors(v.c1,h.ray.origin),L=_.dot(v.direction),P=_.dot(h.ray.direction),T=x(h.ray.direction.dot(v.direction)),B=1-T*T,B===0)continue;R=(T*P-L)/B,V=(P-T*L)/B,g.copy(v.direction).multiplyScalar(R).add(v.c1),m.copy(h.ray.direction).multiplyScalar(V).add(h.ray.origin),z=r.subVectors(g,m).lengthSq();var ie=v.radius*v.radius;if(z<=ie){if(F=(T*L-P)*(T*L-P)-B*(_.lengthSq()-L*L-ie),F<=0?U=I=Math.sqrt(z):U=I=(P-T*L-Math.sqrt(F))/B,W=T*U-L,W<0||W*W>v.lengthSq()||U<0)continue;f.push({clickable:o,distance:I})}}for(c=0,u=i.line.length;c<u;c+=2){g.copy(i.line[c]),g.applyMatrix4(n.matrixWorld),m.copy(i.line[c+1]),m.applyMatrix4(n.matrixWorld),r.subVectors(m,g);var le=r.lengthSq();r.normalize(),_.subVectors(g,h.ray.origin);var re=_.dot(r);P=_.dot(h.ray.direction),T=x(h.ray.direction.dot(r)),B=1-T*T,B!==0&&(R=(T*P-re)/B,V=(P-T*re)/B,g.add(r.multiplyScalar(R)),m.copy(h.ray.direction).multiplyScalar(V).add(h.ray.origin),z=r.subVectors(m,g).lengthSq(),z<a&&R*R<le&&f.push({clickable:o,distance:V}))}for(c=0,u=i.sphere.length;c<u;c++)if(i.sphere[c]instanceof S.Sphere&&(M.copy(i.sphere[c]),M.applyMatrix4(n.matrixWorld),h.ray.isIntersectionSphere(M))){g.subVectors(M.center,h.ray.origin);var oe=g.dot(h.ray.direction);if(F=oe*oe-(g.lengthSq()-M.radius*M.radius),oe<0)return f;F<=0?I=oe:I=oe-Math.sqrt(F),f.push({clickable:o,distance:I})}return f}},"./src/WebGL/core/Texture.ts":(K,C,d)=>{d.r(C),d.d(C,{Texture:()=>p,TextureIdCount:()=>x});var A=d("./src/WebGL/constants/TextureConstants.ts"),S=d("./src/WebGL/math/index.ts"),w=d("./src/WebGL/core/EventDispatcher.ts"),O=d("./src/WebGL/core/UVMapping.ts");class p extends w.EventDispatcher{constructor(v,b){super(),this.id=x++,this.name="",this.image=v,this.mapping=new O.UVMapping,this.wrapS=A.ClampToEdgeWrapping,this.wrapT=A.ClampToEdgeWrapping,this.anisotropy=1,b?(this.format=A.RFormat,this.type=A.FloatType,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.magFilter=A.NearestFilter,this.minFilter=A.NearestFilter):(this.format=A.RGBAFormat,this.type=A.UnsignedByteType,this.offset=new S.Vector2(0,0),this.repeat=new S.Vector2(1,1),this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.magFilter=A.LinearFilter,this.minFilter=A.LinearMipMapLinearFilter),this.needsUpdate=!1,this.onUpdate=null}clone(v=new p){return v.image=this.image,v.mapping=this.mapping,v.wrapS=this.wrapS,v.wrapT=this.wrapT,v.magFilter=this.magFilter,v.minFilter=this.minFilter,v.anisotropy=this.anisotropy,v.format=this.format,v.type=this.type,v.offset.copy(this.offset),v.repeat.copy(this.repeat),v.premultiplyAlpha=this.premultiplyAlpha,v.flipY=this.flipY,v.unpackAlignment=this.unpackAlignment,v}dispose(){this.dispatchEvent({type:"dispose"})}}let x=0},"./src/WebGL/core/UVMapping.ts":(K,C,d)=>{d.r(C),d.d(C,{UVMapping:()=>A});class A{}},"./src/WebGL/core/index.ts":(K,C,d)=>{d.r(C),d.d(C,{EventDispatcher:()=>A.EventDispatcher,Geometry:()=>S.Geometry,GeometryGroup:()=>S.GeometryGroup,GeometryIDCount:()=>S.GeometryIDCount,Light:()=>w.Light,Object3D:()=>w.Object3D,Object3DIDCount:()=>w.Object3DIDCount,Projector:()=>O.Projector,Raycaster:()=>p.Raycaster,Scene:()=>w.Scene,Texture:()=>x.Texture,TextureIdCount:()=>x.TextureIdCount,UVMapping:()=>M.UVMapping,intersectObject:()=>p.intersectObject});var A=d("./src/WebGL/core/EventDispatcher.ts"),S=d("./src/WebGL/core/Geometry.ts"),w=d("./src/WebGL/core/Object3D.ts"),O=d("./src/WebGL/core/Projector.ts"),p=d("./src/WebGL/core/Raycaster.ts"),x=d("./src/WebGL/core/Texture.ts"),M=d("./src/WebGL/core/UVMapping.ts")},"./src/WebGL/index.ts":(K,C,d)=>{d.r(C),d.d(C,{BackSide:()=>A.BackSide,Camera:()=>v.Camera,ClampToEdgeWrapping:()=>A.ClampToEdgeWrapping,Coloring:()=>A.Coloring,Cylinder:()=>M.Cylinder,DoubleSide:()=>A.DoubleSide,EventDispatcher:()=>S.EventDispatcher,FloatType:()=>A.FloatType,Fog:()=>b.Fog,FrontSide:()=>A.FrontSide,Geometry:()=>S.Geometry,GeometryGroup:()=>S.GeometryGroup,GeometryIDCount:()=>S.GeometryIDCount,ImposterMaterial:()=>w.ImposterMaterial,InstancedMaterial:()=>w.InstancedMaterial,Light:()=>S.Light,Line:()=>p.Line,LineBasicMaterial:()=>w.LineBasicMaterial,LineStyle:()=>p.LineStyle,LinearFilter:()=>A.LinearFilter,LinearMipMapLinearFilter:()=>A.LinearMipMapLinearFilter,Material:()=>w.Material,MaterialIdCount:()=>w.MaterialIdCount,Matrix3:()=>O.Matrix3,Matrix4:()=>O.Matrix4,Mesh:()=>p.Mesh,MeshDoubleLambertMaterial:()=>w.MeshDoubleLambertMaterial,MeshLambertMaterial:()=>w.MeshLambertMaterial,MeshOutlineMaterial:()=>w.MeshOutlineMaterial,NearestFilter:()=>A.NearestFilter,Object3D:()=>S.Object3D,Object3DIDCount:()=>S.Object3DIDCount,Projector:()=>S.Projector,Quaternion:()=>O.Quaternion,R32Format:()=>A.R32Format,RFormat:()=>A.RFormat,RGBAFormat:()=>A.RGBAFormat,Ray:()=>O.Ray,Raycaster:()=>S.Raycaster,Renderer:()=>_.Renderer,Scene:()=>S.Scene,ShaderLib:()=>x.ShaderLib,ShaderUtils:()=>x.ShaderUtils,Shading:()=>A.Shading,Sphere:()=>M.Sphere,SphereImposterMaterial:()=>w.SphereImposterMaterial,SphereImposterOutlineMaterial:()=>w.SphereImposterOutlineMaterial,Sprite:()=>p.Sprite,SpriteAlignment:()=>A.SpriteAlignment,SpriteMaterial:()=>w.SpriteMaterial,SpritePlugin:()=>g.SpritePlugin,StickImposterMaterial:()=>w.StickImposterMaterial,StickImposterOutlineMaterial:()=>w.StickImposterOutlineMaterial,Texture:()=>S.Texture,TextureIdCount:()=>S.TextureIdCount,TextureOperations:()=>A.TextureOperations,Triangle:()=>M.Triangle,UVMapping:()=>S.UVMapping,UnsignedByteType:()=>A.UnsignedByteType,Vector2:()=>O.Vector2,Vector3:()=>O.Vector3,VolumetricMaterial:()=>w.VolumetricMaterial,basic:()=>x.basic,clamp:()=>O.clamp,clone:()=>x.clone,conversionMatrix3:()=>O.conversionMatrix3,degToRad:()=>O.degToRad,instanced:()=>x.instanced,intersectObject:()=>S.intersectObject,lambert:()=>x.lambert,lambertdouble:()=>x.lambertdouble,outline:()=>x.outline,screen:()=>x.screen,screenaa:()=>x.screenaa,sphereimposter:()=>x.sphereimposter,sphereimposteroutline:()=>x.sphereimposteroutline,sprite:()=>x.sprite,stickimposter:()=>x.stickimposter,stickimposteroutline:()=>x.stickimposteroutline,volumetric:()=>x.volumetric});var A=d("./src/WebGL/constants/index.ts"),S=d("./src/WebGL/core/index.ts"),w=d("./src/WebGL/materials/index.ts"),O=d("./src/WebGL/math/index.ts"),p=d("./src/WebGL/objects/index.ts"),x=d("./src/WebGL/shaders/index.ts"),M=d("./src/WebGL/shapes/index.ts"),v=d("./src/WebGL/Camera.ts"),b=d("./src/WebGL/Fog.ts"),_=d("./src/WebGL/Renderer.ts"),g=d("./src/WebGL/SpritePlugin.ts")},"./src/WebGL/materials/ImposterMaterial.ts":(K,C,d)=>{d.r(C),d.d(C,{ImposterMaterial:()=>x});var A=d("./src/WebGL/constants/Coloring.ts"),S=d("./src/WebGL/constants/Shading.ts"),w=d("./src/colors.ts"),O=d("./src/WebGL/math/index.ts"),p=d("./src/WebGL/materials/Material.ts");class x extends p.Material{constructor(v){super(),this.color=new w.Color(16777215),this.ambient=new w.Color(1048575),this.emissive=new w.Color(0),this.imposter=!0,this.wrapAround=!1,this.wrapRGB=new O.Vector3(1,1,1),this.map=void 0,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=S.Shading.SmoothShading,this.shaderID=null,this.vertexColors=A.Coloring.NoColors,this.skinning=!1,this.setValues(v)}clone(v=new x){return super.clone.call(this,v),v.color.copy(this.color),v.ambient.copy(this.ambient),v.emissive.copy(this.emissive),v.wrapAround=this.wrapAround,v.wrapRGB.copy(this.wrapRGB),v.map=this.map,v.lightMap=this.lightMap,v.specularMap=this.specularMap,v.envMap=this.envMap,v.combine=this.combine,v.reflectivity=this.reflectivity,v.refractionRatio=this.refractionRatio,v.fog=this.fog,v.shading=this.shading,v.shaderID=this.shaderID,v.vertexColors=this.vertexColors,v.skinning=this.skinning,v.morphTargets=this.morphTargets,v.morphNormals=this.morphNormals,v}}},"./src/WebGL/materials/InstancedMaterial.ts":(K,C,d)=>{d.r(C),d.d(C,{InstancedMaterial:()=>x});var A=d("./src/WebGL/constants/Coloring.ts"),S=d("./src/WebGL/constants/Shading.ts"),w=d("./src/colors.ts"),O=d("./src/WebGL/math/index.ts"),p=d("./src/WebGL/materials/Material.ts");class x extends p.Material{constructor(v){super(),this.color=new w.Color(16777215),this.ambient=new w.Color(1048575),this.emissive=new w.Color(0),this.wrapAround=!1,this.wrapRGB=new O.Vector3(1,1,1),this.map=void 0,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=S.Shading.SmoothShading,this.shaderID="instanced",this.vertexColors=A.Coloring.NoColors,this.skinning=!1,this.sphere=null,this.setValues(v)}clone(v=new x){return super.clone.call(this,v),v.color.copy(this.color),v.ambient.copy(this.ambient),v.emissive.copy(this.emissive),v.wrapAround=this.wrapAround,v.wrapRGB.copy(this.wrapRGB),v.map=this.map,v.lightMap=this.lightMap,v.specularMap=this.specularMap,v.envMap=this.envMap,v.combine=this.combine,v.reflectivity=this.reflectivity,v.refractionRatio=this.refractionRatio,v.fog=this.fog,v.shading=this.shading,v.shaderID=this.shaderID,v.vertexColors=this.vertexColors,v.skinning=this.skinning,v.morphTargets=this.morphTargets,v.morphNormals=this.morphNormals,v.sphere=this.sphere,v}}},"./src/WebGL/materials/LineBasicMaterial.ts":(K,C,d)=>{d.r(C),d.d(C,{LineBasicMaterial:()=>w});var A=d("./src/colors.ts"),S=d("./src/WebGL/materials/Material.ts");class w extends S.Material{constructor(p){super(),this.color=new A.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=!1,this.fog=!0,this.shaderID="basic",this.setValues(p)}clone(p=new w){return super.clone.call(this,p),p.color.copy(this.color),p}}},"./src/WebGL/materials/Material.ts":(K,C,d)=>{d.r(C),d.d(C,{Material:()=>p,MaterialIdCount:()=>x});var A=d("./src/WebGL/constants/Sides.ts"),S=d("./src/WebGL/core/index.ts"),w=d("./src/WebGL/math/index.ts"),O=d("./src/colors.ts");class p extends S.EventDispatcher{constructor(){super(...arguments),this.id=x++,this.name="",this.side=A.FrontSide,this.opacity=1,this.transparent=!1,this.depthTest=!0,this.depthWrite=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.visible=!0,this.needsUpdate=!0,this.outline=!1,this.wireframe=!1,this.shaded=!1}setValues(v={}){if(v!==void 0)for(var b in v){var _=v[b];if(_===void 0){console.warn("$3Dmol.Material: '"+b+"' parameter is undefined.");continue}if(b in this){var g=this[b];g instanceof O.Color&&_ instanceof O.Color?g.copy(_):g instanceof O.Color?g.set(_):g instanceof w.Vector3&&_ instanceof w.Vector3?g.copy(_):this[b]=_}}}clone(v=new p){return v.name=this.name,v.side=this.side,v.opacity=this.opacity,v.transparent=this.transparent,v.depthTest=this.depthTest,v.depthWrite=this.depthWrite,v.polygonOffset=this.polygonOffset,v.polygonOffsetFactor=this.polygonOffsetFactor,v.polygonOffsetUnits=this.polygonOffsetUnits,v.alphaTest=this.alphaTest,v.overdraw=this.overdraw,v.visible=this.visible,v}makeShaded(v){this.shaded=!0,this.uniforms&&(this.uniforms.shading={type:"i",value:v},this.uniforms.vWidth={type:"f",value:1},this.uniforms.vHeight={type:"f",value:1})}dispose(){this.dispatchEvent({type:"dispose"})}}let x=0},"./src/WebGL/materials/MeshDoubleLambertMaterial.ts":(K,C,d)=>{d.r(C),d.d(C,{MeshDoubleLambertMaterial:()=>w});var A=d("./src/WebGL/constants/Sides.ts"),S=d("./src/WebGL/materials/MeshLambertMaterial.ts");class w extends S.MeshLambertMaterial{constructor(p){super(p),this.shaderID="lambertdouble",this.side=A.DoubleSide,this.outline=!1}clone(p=new w){return super.clone.call(this,p),p}}},"./src/WebGL/materials/MeshLambertMaterial.ts":(K,C,d)=>{d.r(C),d.d(C,{MeshLambertMaterial:()=>x});var A=d("./src/WebGL/constants/Coloring.ts"),S=d("./src/WebGL/constants/Shading.ts"),w=d("./src/WebGL/materials/Material.ts"),O=d("./src/colors.ts"),p=d("./src/WebGL/math/index.ts");class x extends w.Material{constructor(v){super(),this.color=new O.Color(16777215),this.ambient=new O.Color(1048575),this.emissive=new O.Color(0),this.wrapAround=!1,this.wrapRGB=new p.Vector3(1,1,1),this.map=void 0,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=S.Shading.SmoothShading,this.shaderID="lambert",this.vertexColors=A.Coloring.NoColors,this.skinning=!1,this.setValues(v)}clone(v=new x){return super.clone.call(this,v),v.color.copy(this.color),v.ambient.copy(this.ambient),v.emissive.copy(this.emissive),v.wrapAround=this.wrapAround,v.wrapRGB.copy(this.wrapRGB),v.map=this.map,v.lightMap=this.lightMap,v.specularMap=this.specularMap,v.envMap=this.envMap,v.combine=this.combine,v.reflectivity=this.reflectivity,v.refractionRatio=this.refractionRatio,v.fog=this.fog,v.shading=this.shading,v.shaderID=this.shaderID,v.vertexColors=this.vertexColors,v.skinning=this.skinning,v.morphTargets=this.morphTargets,v.morphNormals=this.morphNormals,v}}},"./src/WebGL/materials/MeshOutlineMaterial.ts":(K,C,d)=>{d.r(C),d.d(C,{MeshOutlineMaterial:()=>w});var A=d("./src/colors.ts"),S=d("./src/WebGL/materials/Material.ts");class w extends S.Material{constructor(p){super(),p=p||{},this.fog=!0,this.shaderID="outline",this.wireframe=!1,this.outlineColor=A.CC.color(p.color||new A.Color(0,0,0)),this.outlineWidth=p.width||.1,this.outlinePushback=p.pushback||1,this.outlineMaxPixels=p.maxpixels||0}clone(p=new w){return super.clone.call(this,p),p.fog=this.fog,p.shaderID=this.shaderID,p.wireframe=this.wireframe,p.outlineColor=this.outlineColor,p.outlineWidth=this.outlineWidth,p.outlinePushback=this.outlinePushback,p.outlineMaxPixels=this.outlineMaxPixels,p}}},"./src/WebGL/materials/SphereImposterMaterial.ts":(K,C,d)=>{d.r(C),d.d(C,{SphereImposterMaterial:()=>S});var A=d("./src/WebGL/materials/ImposterMaterial.ts");class S extends A.ImposterMaterial{constructor(O){super(O),this.shaderID="sphereimposter",this.setValues(O)}clone(O=new S){return super.clone.call(this,O),O}}},"./src/WebGL/materials/SphereImposterOutlineMaterial.ts":(K,C,d)=>{d.r(C),d.d(C,{SphereImposterOutlineMaterial:()=>w});var A=d("./src/colors.ts"),S=d("./src/WebGL/materials/ImposterMaterial.ts");class w extends S.ImposterMaterial{constructor(p){super(p),p=p||{},this.shaderID="sphereimposteroutline",this.outlineColor=A.CC.color(p.color||new A.Color(0,0,0)),this.outlineWidth=p.width||.1,this.outlinePushback=p.pushback||1,this.outlineMaxPixels=p.maxpixels||0,this.setValues(p)}clone(p=new w){return super.clone.call(this,p),p.outlineColor=this.outlineColor,p.outlineWidth=this.outlineWidth,p.outlinePushback=this.outlinePushback,p.outlineMaxPixels=this.outlineMaxPixels,p}}},"./src/WebGL/materials/SpriteMaterial.ts":(K,C,d)=>{d.r(C),d.d(C,{SpriteMaterial:()=>x});var A=d("./src/WebGL/constants/SpriteAlignment.ts"),S=d("./src/WebGL/core/Texture.ts"),w=d("./src/colors.ts"),O=d("./src/WebGL/math/index.ts"),p=d("./src/WebGL/materials/Material.ts");class x extends p.Material{constructor(v){super(),this.color=new w.Color(16777215),this.map=new S.Texture,this.useScreenCoordinates=!0,this.fog=!1,this.uvOffset=new O.Vector2(0,0),this.uvScale=new O.Vector2(1,1),this.depthTest=!this.useScreenCoordinates,this.sizeAttenuation=!this.useScreenCoordinates,this.screenOffset=this.screenOffset,this.scaleByViewPort=!this.sizeAttenuation,this.alignment=A.SpriteAlignment.center.clone(),this.setValues(v),v=v||{},v.depthTest===void 0&&(this.depthTest=!this.useScreenCoordinates),v.sizeAttenuation===void 0&&(this.sizeAttenuation=!this.useScreenCoordinates),v.scaleByViewPort===void 0&&(this.scaleByViewPort=!this.sizeAttenuation)}clone(v=new x){return super.clone.call(this,v),v.color.copy(this.color),v.map=this.map,v.useScreenCoordinates=this.useScreenCoordinates,v.screenOffset=this.screenOffset,v.sizeAttenuation=this.sizeAttenuation,v.scaleByViewport=this.scaleByViewPort,v.alignment.copy(this.alignment),v.uvOffset.copy(this.uvOffset),v}}},"./src/WebGL/materials/StickImposterMaterial.ts":(K,C,d)=>{d.r(C),d.d(C,{StickImposterMaterial:()=>S});var A=d("./src/WebGL/materials/ImposterMaterial.ts");class S extends A.ImposterMaterial{constructor(O){super(O),this.shaderID="stickimposter",this.setValues(O)}clone(O=new S){return super.clone.call(this,O),O}}},"./src/WebGL/materials/StickImposterOutlineMaterial.ts":(K,C,d)=>{d.r(C),d.d(C,{StickImposterOutlineMaterial:()=>w});var A=d("./src/colors.ts"),S=d("./src/WebGL/materials/ImposterMaterial.ts");class w extends S.ImposterMaterial{constructor(p={}){super(p),this.shaderID="stickimposteroutline",this.outlineColor=new A.Color(0,0,0),this.outlineWidth=.1,this.outlinePushback=1,this.outlineMaxPixels=0,p.color&&(this.outlineColor=A.CC.color(p.color)),p.width&&(this.outlineWidth=p.width),p.pushback&&(this.outlinePushback=p.pushback),p.maxpixels&&(this.outlineMaxPixels=p.maxpixels),this.setValues(p)}clone(p=new w){return super.clone.call(this,p),p.outlineColor=this.outlineColor,p.outlineWidth=this.outlineWidth,p.outlinePushback=this.outlinePushback,p.outlineMaxPixels=this.outlineMaxPixels,p}}},"./src/WebGL/materials/VolumetricMaterial.ts":(K,C,d)=>{d.r(C),d.d(C,{VolumetricMaterial:()=>O});var A=d("./src/WebGL/constants/Sides.ts"),S=d("./src/colors.ts"),w=d("./src/WebGL/materials/Material.ts");class O extends w.Material{constructor(x){super(),this.transparent=!1,this.volumetric=!0,this.color=new S.Color(16777215),this.transferfn=null,this.map=void 0,this.extent=[],this.maxdepth=100,this.unit=0,this.texmatrix=null,this.transfermin=-1,this.transfermax=1,this.subsamples=5,this.shaderID="volumetric",this.side=A.FrontSide,this.setValues(x)}clone(x=new O){return super.clone.call(this,x),x.transparent=this.transparent,x.volumetric=this.volumetric,x.color=this.color,x.transferfn=this.transferfn,x.map=this.map,x.extent=this.extent,x.maxdepth=this.maxdepth,x.unit=this.unit,x.texmatrix=this.texmatrix,x.transfermin=this.transfermin,x.transfermax=this.transfermax,x.subsamples=this.subsamples,x.shaderID=this.shaderID,x.side=this.side,x}}},"./src/WebGL/materials/index.ts":(K,C,d)=>{d.r(C),d.d(C,{ImposterMaterial:()=>A.ImposterMaterial,InstancedMaterial:()=>S.InstancedMaterial,LineBasicMaterial:()=>w.LineBasicMaterial,Material:()=>O.Material,MaterialIdCount:()=>O.MaterialIdCount,MeshDoubleLambertMaterial:()=>p.MeshDoubleLambertMaterial,MeshLambertMaterial:()=>x.MeshLambertMaterial,MeshOutlineMaterial:()=>M.MeshOutlineMaterial,SphereImposterMaterial:()=>v.SphereImposterMaterial,SphereImposterOutlineMaterial:()=>b.SphereImposterOutlineMaterial,SpriteMaterial:()=>_.SpriteMaterial,StickImposterMaterial:()=>g.StickImposterMaterial,StickImposterOutlineMaterial:()=>m.StickImposterOutlineMaterial,VolumetricMaterial:()=>r.VolumetricMaterial});var A=d("./src/WebGL/materials/ImposterMaterial.ts"),S=d("./src/WebGL/materials/InstancedMaterial.ts"),w=d("./src/WebGL/materials/LineBasicMaterial.ts"),O=d("./src/WebGL/materials/Material.ts"),p=d("./src/WebGL/materials/MeshDoubleLambertMaterial.ts"),x=d("./src/WebGL/materials/MeshLambertMaterial.ts"),M=d("./src/WebGL/materials/MeshOutlineMaterial.ts"),v=d("./src/WebGL/materials/SphereImposterMaterial.ts"),b=d("./src/WebGL/materials/SphereImposterOutlineMaterial.ts"),_=d("./src/WebGL/materials/SpriteMaterial.ts"),g=d("./src/WebGL/materials/StickImposterMaterial.ts"),m=d("./src/WebGL/materials/StickImposterOutlineMaterial.ts"),r=d("./src/WebGL/materials/VolumetricMaterial.ts")},"./src/WebGL/math/Quaternion.ts":(K,C,d)=>{d.r(C),d.d(C,{Quaternion:()=>A});class A{constructor(w,O,p,x){this.x=w||0,this.y=O||0,this.z=p||0,this.w=x!==void 0?x:1}set(w,O,p,x){return this.x=w,this.y=O,this.z=p,this.w=x,this}copy(w){return this.x=w.x,this.y=w.y,this.z=w.z,this.w=w.w,this}conjugate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}inverse(){return this.conjugate().normalize()}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthxyz(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){let w=this.length();return w===0?(this.x=0,this.y=0,this.z=0,this.w=1):(w=1/w,this.x*=w,this.y*=w,this.z*=w,this.w*=w),this}multiply(w){return this.multiplyQuaternions(this,w)}multiplyScalar(w){return this.x*=w,this.y*=w,this.z*=w,this.w*=w,this}multiplyQuaternions(w,O){const p=w.x,x=w.y,M=w.z,v=w.w,b=O.x,_=O.y,g=O.z,m=O.w;return this.x=p*m+v*b+x*g-M*_,this.y=x*m+v*_+M*b-p*g,this.z=M*m+v*g+p*_-x*b,this.w=v*m-p*b-x*_-M*g,this}sub(w){return this.x-=w.x,this.y-=w.y,this.z-=w.z,this.w-=w.w,this}clone(){return new A(this.x,this.y,this.z,this.w)}setFromEuler(w){const O=Math.cos(w.x/2),p=Math.cos(w.y/2),x=Math.cos(w.z/2),M=Math.sin(w.x/2),v=Math.sin(w.y/2),b=Math.sin(w.z/2);return this.x=M*p*x+O*v*b,this.y=O*v*x-M*p*b,this.z=O*p*b+M*v*x,this.w=O*p*x-M*v*b,this}}},"./src/WebGL/math/Vector2.ts":(K,C,d)=>{d.r(C),d.d(C,{Vector2:()=>A});class A{constructor(w,O){this.x=w||0,this.y=O||0}set(w,O){return this.x=w,this.y=O,this}subVectors(w,O){return this.x=w.x-O.x,this.y=w.y-O.y,this}copy(w){return this.x=w.x,this.y=w.y,this}clone(){return new A(this.x,this.y)}}},"./src/WebGL/math/index.ts":(K,C,d)=>{d.r(C),d.d(C,{Matrix3:()=>x.Matrix3,Matrix4:()=>x.Matrix4,Quaternion:()=>A.Quaternion,Ray:()=>x.Ray,Vector2:()=>S.Vector2,Vector3:()=>x.Vector3,clamp:()=>w.clamp,conversionMatrix3:()=>O.conversionMatrix3,degToRad:()=>p.degToRad});var A=d("./src/WebGL/math/Quaternion.ts"),S=d("./src/WebGL/math/Vector2.ts"),w=d("./src/WebGL/math/utils/clamp.ts"),O=d("./src/WebGL/math/utils/conversionMatrix3.ts"),p=d("./src/WebGL/math/utils/degToRad.ts"),x=d("./src/WebGL/math/math.ts")},"./src/WebGL/math/math.ts":(K,C,d)=>{d.r(C),d.d(C,{Matrix3:()=>_,Matrix4:()=>v,Ray:()=>g,Vector3:()=>b});var A=d("./src/WebGL/math/utils/degToRad.ts"),S=d("./src/WebGL/math/utils/clamp.ts"),w,O,p,x,M;class v{constructor(r=1,e=0,t=0,n=0,o=0,h=1,f=0,i=0,s=0,a=0,c=1,u=0,E=0,T=0,L=0,P=1){typeof r<"u"&&typeof r!="number"?this.elements=new Float32Array(r):(this.elements=new Float32Array(16),this.elements[0]=r,this.elements[4]=e,this.elements[8]=t,this.elements[12]=n,this.elements[1]=o,this.elements[5]=h,this.elements[9]=f,this.elements[13]=i,this.elements[2]=s,this.elements[6]=a,this.elements[10]=c,this.elements[14]=u,this.elements[3]=E,this.elements[7]=T,this.elements[11]=L,this.elements[15]=P)}makeScale(r,e,t){throw new Error("Method not implemented.")}set(r,e,t,n,o,h,f,i,s,a,c,u,E,T,L,P){const I=this.elements;return I[0]=r,I[4]=e,I[8]=t,I[12]=n,I[1]=o,I[5]=h,I[9]=f,I[13]=i,I[2]=s,I[6]=a,I[10]=c,I[14]=u,I[3]=E,I[7]=T,I[11]=L,I[15]=P,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}copy(r){const e=r.elements;return this.set(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]),this}matrix3FromTopLeft(){const r=this.elements;return new _(r[0],r[4],r[8],r[1],r[5],r[9],r[2],r[6],r[10])}setRotationFromEuler(r,e){const t=this.elements,{x:n,y:o,z:h}=r,f=Math.cos(n),i=Math.sin(n),s=Math.cos(o),a=Math.sin(o),c=Math.cos(h),u=Math.sin(h);if(e===void 0||e==="XYZ"){const E=f*c,T=f*u,L=i*c,P=i*u;t[0]=s*c,t[4]=-s*u,t[8]=a,t[1]=T+L*a,t[5]=E-P*a,t[9]=-i*s,t[2]=P-E*a,t[6]=L+T*a,t[10]=f*s}else console.error(`Error with matrix4 setRotationFromEuler. Order: ${e}`);return this}setRotationFromQuaternion(r){const e=this.elements,{x:t,y:n,z:o,w:h}=r,f=t+t,i=n+n,s=o+o,a=t*f,c=t*i,u=t*s,E=n*i,T=n*s,L=o*s,P=h*f,I=h*i,z=h*s;return e[0]=1-(E+L),e[4]=c-z,e[8]=u+I,e[1]=c+z,e[5]=1-(a+L),e[9]=T-P,e[2]=u-I,e[6]=T+P,e[10]=1-(a+E),this}multiplyMatrices(r,e){const t=r.elements,n=e.elements,o=this.elements,h=t[0],f=t[4],i=t[8],s=t[12],a=t[1],c=t[5],u=t[9],E=t[13],T=t[2],L=t[6],P=t[10],I=t[14],z=t[3],B=t[7],F=t[11],W=t[15],U=n[0],R=n[4],V=n[8],q=n[12],ee=n[1],se=n[5],ie=n[9],le=n[13],re=n[2],oe=n[6],Ae=n[10],Me=n[14],Oe=n[3],_e=n[7],Q=n[11],me=n[15];return o[0]=h*U+f*ee+i*re+s*Oe,o[4]=h*R+f*se+i*oe+s*_e,o[8]=h*V+f*ie+i*Ae+s*Q,o[12]=h*q+f*le+i*Me+s*me,o[1]=a*U+c*ee+u*re+E*Oe,o[5]=a*R+c*se+u*oe+E*_e,o[9]=a*V+c*ie+u*Ae+E*Q,o[13]=a*q+c*le+u*Me+E*me,o[2]=T*U+L*ee+P*re+I*Oe,o[6]=T*R+L*se+P*oe+I*_e,o[10]=T*V+L*ie+P*Ae+I*Q,o[14]=T*q+L*le+P*Me+I*me,o[3]=z*U+B*ee+F*re+W*Oe,o[7]=z*R+B*se+F*oe+W*_e,o[11]=z*V+B*ie+F*Ae+W*Q,o[15]=z*q+B*le+F*Me+W*me,this}multiplyScalar(r){const e=this.elements;return e[0]*=r,e[4]*=r,e[8]*=r,e[12]*=r,e[1]*=r,e[5]*=r,e[9]*=r,e[13]*=r,e[2]*=r,e[6]*=r,e[10]*=r,e[14]*=r,e[3]*=r,e[7]*=r,e[11]*=r,e[15]*=r,this}makeTranslation(r,e,t){return this.set(1,0,0,r,0,1,0,e,0,0,1,t,0,0,0,1),this}snap(r){const e=Math.pow(10,4),t=this.elements;for(let n=0;n<16;n++){const o=Math.round(t[n]);o===Math.round(t[n]*e)/e&&(t[n]=o)}return this}transpose(){const r=this.elements;let e;return e=r[1],r[1]=r[4],r[4]=e,e=r[2],r[2]=r[8],r[8]=e,e=r[6],r[6]=r[9],r[9]=e,e=r[3],r[3]=r[12],r[12]=e,e=r[7],r[7]=r[13],r[13]=e,e=r[11],r[11]=r[14],r[14]=e,this}setPosition(r){const e=this.elements;return e[12]=r.x,e[13]=r.y,e[14]=r.z,this}translate(r){const e=this.elements;return e[12]+=r.x,e[13]+=r.y,e[14]+=r.z,this}getInverse(r,e){const t=this.elements,n=r.elements,o=n[0],h=n[4],f=n[8],i=n[12],s=n[1],a=n[5],c=n[9],u=n[13],E=n[2],T=n[6],L=n[10],P=n[14],I=n[3],z=n[7],B=n[11],F=n[15];t[0]=c*P*z-u*L*z+u*T*B-a*P*B-c*T*F+a*L*F,t[4]=i*L*z-f*P*z-i*T*B+h*P*B+f*T*F-h*L*F,t[8]=f*u*z-i*c*z+i*a*B-h*u*B-f*a*F+h*c*F,t[12]=i*c*T-f*u*T-i*a*L+h*u*L+f*a*P-h*c*P,t[1]=u*L*I-c*P*I-u*E*B+s*P*B+c*E*F-s*L*F,t[5]=f*P*I-i*L*I+i*E*B-o*P*B-f*E*F+o*L*F,t[9]=i*c*I-f*u*I-i*s*B+o*u*B+f*s*F-o*c*F,t[13]=f*u*E-i*c*E+i*s*L-o*u*L-f*s*P+o*c*P,t[2]=a*P*I-u*T*I+u*E*z-s*P*z-a*E*F+s*T*F,t[6]=i*T*I-h*P*I-i*E*z+o*P*z+h*E*F-o*T*F,t[10]=h*u*I-i*a*I+i*s*z-o*u*z-h*s*F+o*a*F,t[14]=i*a*E-h*u*E-i*s*T+o*u*T+h*s*P-o*a*P,t[3]=c*T*I-a*L*I-c*E*z+s*L*z+a*E*B-s*T*B,t[7]=h*L*I-f*T*I+f*E*z-o*L*z-h*E*B+o*T*B,t[11]=f*a*I-h*c*I-f*s*z+o*c*z+h*s*B-o*a*B,t[15]=h*c*E-f*a*E+f*s*T-o*c*T-h*s*L+o*a*L;const W=o*t[0]+s*t[4]+E*t[8]+I*t[12];if(W===0){const U="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(e)throw new Error(U);return console.warn(U),this.identity(),this}return this.multiplyScalar(1/W),this}isReflected(){const r=this.elements,e=r[0],t=r[4],n=r[8],o=r[1],h=r[5],f=r[9],i=r[2],s=r[6],a=r[10];return e*h*a+o*s*n+i*t*f-i*h*n-o*t*a-e*s*f<0}scale(r){const e=this.elements,{x:t}=r,{y:n}=r,{z:o}=r;return e[0]*=t,e[4]*=n,e[8]*=o,e[1]*=t,e[5]*=n,e[9]*=o,e[2]*=t,e[6]*=n,e[10]*=o,e[3]*=t,e[7]*=n,e[11]*=o,this}getMaxScaleOnAxis(){const r=this.elements,e=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],t=r[4]*r[4]+r[5]*r[5]+r[6]*r[6],n=r[8]*r[8]+r[9]*r[9]+r[10]*r[10];return Math.sqrt(Math.max(e,Math.max(t,n)))}makeFrustum(r,e,t,n,o,h){const f=this.elements,i=2*o/(e-r),s=2*o/(n-t),a=(e+r)/(e-r),c=(n+t)/(n-t),u=-(h+o)/(h-o),E=-2*h*o/(h-o);return f[0]=i,f[4]=0,f[8]=a,f[12]=0,f[1]=0,f[5]=s,f[9]=c,f[13]=0,f[2]=0,f[6]=0,f[10]=u,f[14]=E,f[3]=0,f[7]=0,f[11]=-1,f[15]=0,this}makePerspective(r,e,t,n){const o=t*Math.tan((0,A.degToRad)(r*.5)),h=-o,f=h*e,i=o*e;return this.makeFrustum(f,i,h,o,t,n)}makeOrthographic(r,e,t,n,o,h){const f=this.elements,i=1/(e-r),s=1/(t-n),a=1/(h-o),c=(e+r)*i,u=(t+n)*s,E=(h+o)*a;return f[0]=2*i,f[4]=0,f[8]=0,f[12]=-c,f[1]=0,f[5]=2*s,f[9]=0,f[13]=-u,f[2]=0,f[6]=0,f[10]=-2*a,f[14]=-E,f[3]=0,f[7]=0,f[11]=0,f[15]=1,this}isEqual(r){const e=r.elements,t=this.elements;return t[0]===e[0]&&t[4]===e[4]&&t[8]===e[8]&&t[12]===e[12]&&t[1]===e[1]&&t[5]===e[5]&&t[9]===e[9]&&t[13]===e[13]&&t[2]===e[2]&&t[6]===e[6]&&t[10]===e[10]&&t[14]===e[14]&&t[3]===e[3]&&t[7]===e[7]&&t[11]===e[11]&&t[15]===e[15]}clone(){const r=this.elements;return new v(r[0],r[4],r[8],r[12],r[1],r[5],r[9],r[13],r[2],r[6],r[10],r[14],r[3],r[7],r[11],r[15])}isIdentity(){const r=this.elements;return r[0]===1&&r[4]===0&&r[8]===0&&r[12]===0&&r[1]===0&&r[5]===1&&r[9]===0&&r[13]===0&&r[2]===0&&r[6]===0&&r[10]===1&&r[14]===0&&r[3]===0&&r[7]===0&&r[11]===0&&r[15]===1}isNearlyIdentity(r){return this.clone().snap(r).isIdentity()}getScale(r){const e=this.elements;return r=r||new b,p.set(e[0],e[1],e[2]),x.set(e[4],e[5],e[6]),M.set(e[8],e[9],e[10]),r.x=p.length(),r.y=x.length(),r.z=M.length(),r}lookAt(r,e,t){const n=this.elements;return M.subVectors(r,e).normalize(),M.length()===0&&(M.z=1),p.crossVectors(t,M).normalize(),p.length()===0&&(M.x+=1e-4,p.crossVectors(t,M).normalize()),x.crossVectors(M,p),n[0]=p.x,n[4]=x.x,n[8]=M.x,n[1]=p.y,n[5]=x.y,n[9]=M.y,n[2]=p.z,n[6]=x.z,n[10]=M.z,this}compose(r,e,t){const n=this.elements;return w.identity(),w.setRotationFromQuaternion(e),O.makeScale(t.x,t.y,t.z),this.multiplyMatrices(w,O),n[12]=r.x,n[13]=r.y,n[14]=r.z,this}}w=new v,O=new v;class b{constructor(r,e,t){this.x=r||0,this.y=e||0,this.z=t||0,this.atomid=void 0}set(r,e,t){return this.x=r,this.y=e,this.z=t,this}copy(r){return this.x=r.x,this.y=r.y,this.z=r.z,this}add(r){return this.x+=r.x,this.y+=r.y,this.z+=r.z,this}addVectors(r,e){return this.x=r.x+e.x,this.y=r.y+e.y,this.z=r.z+e.z,this}multiplyVectors(r,e){return this.x=r.x*e.x,this.y=r.y*e.y,this.z=r.z*e.z,this}sub(r){return this.x-=r.x,this.y-=r.y,this.z-=r.z,this}subVectors(r,e){return this.x=r.x-e.x,this.y=r.y-e.y,this.z=r.z-e.z,this}multiplyScalar(r){return this.x*=r,this.y*=r,this.z*=r,this}divideScalar(r){return r!==0?(this.x/=r,this.y/=r,this.z/=r):(this.x=0,this.y=0,this.z=0),this}max(r){return this.x=Math.max(this.x,r.x),this.y=Math.max(this.y,r.y),this.z=Math.max(this.z,r.z),this}min(r){return this.x=Math.min(this.x,r.x),this.y=Math.min(this.y,r.y),this.z=Math.min(this.z,r.z),this}distanceTo(r){return Math.sqrt(this.distanceToSquared(r))}distanceToSquared(r){const e=this.x-r.x,t=this.y-r.y,n=this.z-r.z;return e*e+t*t+n*n}applyMatrix3(r){const{x:e}=this,{y:t}=this,{z:n}=this,o=r.elements;return this.x=o[0]*e+o[3]*t+o[6]*n,this.y=o[1]*e+o[4]*t+o[7]*n,this.z=o[2]*e+o[5]*t+o[8]*n,this}applyMatrix4(r){const{x:e}=this,{y:t}=this,{z:n}=this,o=r.elements;return this.x=o[0]*e+o[4]*t+o[8]*n+o[12],this.y=o[1]*e+o[5]*t+o[9]*n+o[13],this.z=o[2]*e+o[6]*t+o[10]*n+o[14],this}applyProjection(r){const{x:e}=this,{y:t}=this,{z:n}=this,o=r.elements,h=o[3]*e+o[7]*t+o[11]*n+o[15];return this.x=(o[0]*e+o[4]*t+o[8]*n+o[12])/h,this.y=(o[1]*e+o[5]*t+o[9]*n+o[13])/h,this.z=(o[2]*e+o[6]*t+o[10]*n+o[14])/h,this}applyQuaternion(r){const{x:e}=this,{y:t}=this,{z:n}=this,o=r.x,h=r.y,f=r.z,i=r.w,s={};s.x=2*(t*f-n*h),s.y=2*(n*o-e*f),s.z=2*(e*h-t*o);const a={};return a.x=s.y*f-s.z*h,a.y=s.z*o-s.x*f,a.z=s.x*h-s.y*o,this.x=e+i*s.x+a.x,this.y=t+i*s.y+a.y,this.z=n+i*s.z+a.z,this}negate(){return this.multiplyScalar(-1)}dot(r){return this.x*r.x+this.y*r.y+this.z*r.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}normalize(){return this.divideScalar(this.length())}cross(r){const{x:e}=this,{y:t}=this,{z:n}=this;return this.x=t*r.z-n*r.y,this.y=n*r.x-e*r.z,this.z=e*r.y-t*r.x,this}crossVectors(r,e){return this.x=r.y*e.z-r.z*e.y,this.y=r.z*e.x-r.x*e.z,this.z=r.x*e.y-r.y*e.x,this}equals(r){return this.x==r.x&&this.y==r.y&&this.z==r.z}getPositionFromMatrix(r){return this.x=r.elements[12],this.y=r.elements[13],this.z=r.elements[14],this}setEulerFromRotationMatrix(r,e){const t=r.elements,n=t[0],o=t[4],h=t[8],f=t[5],i=t[9],s=t[6],a=t[10];return e===void 0||e==="XYZ"?(this.y=Math.asin((0,S.clamp)(h,-1,1)),Math.abs(h)<.99999?(this.x=Math.atan2(-i,a),this.z=Math.atan2(-o,n)):(this.x=Math.atan2(s,f),this.z=0)):console.error(`Error with vector's setEulerFromRotationMatrix: Unknown order: ${e}`),this}rotateAboutVector(r,e){r.normalize();const t=Math.cos(e),n=Math.sin(e),o=this.clone().multiplyScalar(t),h=r.clone().cross(this).multiplyScalar(n),f=r.clone().multiplyScalar(r.clone().dot(this)).multiplyScalar(1-t),i=o.add(h).add(f);return this.x=i.x,this.y=i.y,this.z=i.z,this}setFromMatrixPosition(r){const e=r.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}transformDirection(r){const{x:e}=this,{y:t}=this,{z:n}=this,o=r.elements;return this.x=o[0]*e+o[4]*t+o[8]*n,this.y=o[1]*e+o[5]*t+o[9]*n,this.z=o[2]*e+o[6]*t+o[10]*n,this.normalize()}clone(){return new b(this.x,this.y,this.z)}unproject(r){const e=w;return e.multiplyMatrices(r.matrixWorld,e.getInverse(r.projectionMatrix)),this.applyMatrix4(e)}}p=new b,x=new b,M=new b;class _{constructor(r=1,e=0,t=0,n=0,o=1,h=0,f=0,i=0,s=1){this.elements=new Float32Array(9),this.set(r,e,t,n,o,h,f,i,s)}set(r,e,t,n,o,h,f,i,s){const a=this.elements;return a[0]=r,a[3]=e,a[6]=t,a[1]=n,a[4]=o,a[7]=h,a[2]=f,a[5]=i,a[8]=s,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(r){const e=r.elements;this.set(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])}multiplyScalar(r){const e=this.elements;return e[0]*=r,e[3]*=r,e[6]*=r,e[1]*=r,e[4]*=r,e[7]*=r,e[2]*=r,e[5]*=r,e[8]*=r,this}getInverse3(r){const e=r.elements,t=this.elements;t[0]=e[4]*e[8]-e[5]*e[7],t[3]=e[6]*e[5]-e[3]*e[8],t[6]=e[3]*e[7]-e[6]*e[4],t[1]=e[7]*e[2]-e[1]*e[8],t[4]=e[0]*e[8]-e[6]*e[2],t[7]=e[1]*e[6]-e[0]*e[7],t[2]=e[1]*e[5]-e[2]*e[4],t[5]=e[2]*e[3]-e[0]*e[5],t[8]=e[0]*e[4]-e[1]*e[3];const n=e[0]*t[0]+e[3]*t[1]+e[6]*t[2];return this.multiplyScalar(1/n),this}getInverse(r,e){const t=r.elements,n=this.elements;n[0]=t[10]*t[5]-t[6]*t[9],n[1]=-t[10]*t[1]+t[2]*t[9],n[2]=t[6]*t[1]-t[2]*t[5],n[3]=-t[10]*t[4]+t[6]*t[8],n[4]=t[10]*t[0]-t[2]*t[8],n[5]=-t[6]*t[0]+t[2]*t[4],n[6]=t[9]*t[4]-t[5]*t[8],n[7]=-t[9]*t[0]+t[1]*t[8],n[8]=t[5]*t[0]-t[1]*t[4];const o=t[0]*n[0]+t[1]*n[3]+t[2]*n[6];if(o===0){const h="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(e)throw new Error(h);return console.warn(h),this.identity(),this}return this.multiplyScalar(1/o),this}getDeterminant(){const r=this.elements;return r[0]*r[4]*r[8]+r[1]*r[5]*r[6]+r[2]*r[3]*r[7]-r[2]*r[4]*r[6]-r[1]*r[3]*r[8]-r[0]*r[5]*r[7]}transpose(){let r;const e=this.elements;return r=e[1],e[1]=e[3],e[3]=r,r=e[2],e[2]=e[6],e[6]=r,r=e[5],e[5]=e[7],e[7]=r,this}clone(){const r=this.elements;return new _(r[0],r[3],r[6],r[1],r[4],r[7],r[2],r[5],r[8])}getMatrix4(){const r=this.elements;return new v(r[0],r[3],r[6],0,r[1],r[4],r[7],0,r[2],r[5],r[8],0)}}class g{constructor(r,e){this.origin=r!==void 0?r:new b,this.direction=e!==void 0?e:new b}set(r,e){return this.origin.copy(r),this.direction.copy(e),this}copy(r){return this.origin.copy(r.origin),this.direction.copy(r.direction),this}at(r,e){return(e||new b).copy(this.direction).multiplyScalar(r).add(this.origin)}recast(r){const e=p;return this.origin.copy(this.at(r,e)),this}closestPointToPoint(r,e){const t=e||new b;t.subVectors(r,this.origin);const n=t.dot(this.direction);return t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(r){const e=p,t=e.subVectors(r,this.origin).dot(this.direction);return e.copy(this.direction).multiplyScalar(t).add(this.origin),e.distanceTo(r)}isIntersectionCylinder(){}isIntersectionSphere(r){return this.distanceToPoint(r.center)<=r.radius}isIntersectionPlane(r){return r.normal.dot(this.direction)!==0||r.distanceToPoint(this.origin)===0}distanceToPlane(r){const e=r.normal.dot(this.direction);return e===0?r.distanceToPoint(this.origin)===0?0:void 0:-(this.origin.dot(r.normal)+r.constant)/e}intersectPlane(r,e){const t=this.distanceToPlane(r);if(t!==void 0)return this.at(t,e)}applyMatrix4(r){return this.direction.add(this.origin).applyMatrix4(r),this.origin.applyMatrix4(r),this.direction.sub(this.origin),this}clone(){return new g().copy(this)}}},"./src/WebGL/math/utils/clamp.ts":(K,C,d)=>{d.r(C),d.d(C,{clamp:()=>A});function A(S,w,O){return Math.min(Math.max(S,w),O)}},"./src/WebGL/math/utils/conversionMatrix3.ts":(K,C,d)=>{d.r(C),d.d(C,{conversionMatrix3:()=>S});var A=d("./src/WebGL/math/math.ts");function S(w,O,p,x,M,v){x=x*Math.PI/180,M=M*Math.PI/180,v=v*Math.PI/180;const b=t=>t*t,_=Math.cos(x),g=Math.cos(M),m=Math.cos(v),r=Math.sin(v);return new A.Matrix3(w,O*m,p*g,0,O*r,p*(_-g*m)/r,0,0,p*Math.sqrt(1-b(_)-b(g)-b(m)+2*_*g*m)/r)}},"./src/WebGL/math/utils/degToRad.ts":(K,C,d)=>{d.r(C),d.d(C,{degToRad:()=>S});const A=Math.PI/180;function S(w){return w*A}},"./src/WebGL/objects/Line.ts":(K,C,d)=>{d.r(C),d.d(C,{Line:()=>O,LineStyle:()=>w});var A=d("./src/WebGL/materials/index.ts"),S=d("./src/WebGL/core/index.ts"),w;(function(p){p[p.LineStrip=0]="LineStrip",p[p.LinePieces=1]="LinePieces"})(w||(w={}));class O extends S.Object3D{constructor(x,M=new A.LineBasicMaterial({color:Math.random()*16777215}),v=w.LineStrip){super(),this.geometry=x,this.material=M,this.type=v}clone(x=new O(this.geometry,this.material,this.type)){return super.clone.call(this,x),x}}},"./src/WebGL/objects/Mesh.ts":(K,C,d)=>{d.r(C),d.d(C,{Mesh:()=>S});var A=d("./src/WebGL/core/index.ts");class S extends A.Object3D{constructor(O,p){super(),this.geometry=O,this.material=p}clone(O){return O===void 0&&(O=new S(this.geometry,this.material)),super.clone.call(this,O),O}}},"./src/WebGL/objects/Sprite.ts":(K,C,d)=>{d.r(C),d.d(C,{Sprite:()=>w});var A=d("./src/WebGL/materials/index.ts"),S=d("./src/WebGL/core/index.ts");class w extends S.Object3D{constructor(p=new A.SpriteMaterial){super(),this.material=p,this.rotation3d=this.rotation,this.rotation=0}updateMatrix(){this.matrix.setPosition(this.position),this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),(this.scale.x!==1||this.scale.y!==1)&&this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0}clone(p=new w(this.material)){return S.Object3D.prototype.clone.call(this,p),p}}},"./src/WebGL/objects/index.ts":(K,C,d)=>{d.r(C),d.d(C,{Line:()=>A.Line,LineStyle:()=>A.LineStyle,Mesh:()=>S.Mesh,Sprite:()=>w.Sprite});var A=d("./src/WebGL/objects/Line.ts"),S=d("./src/WebGL/objects/Mesh.ts"),w=d("./src/WebGL/objects/Sprite.ts")},"./src/WebGL/shaders/ShaderType.ts":(K,C,d)=>{d.r(C)},"./src/WebGL/shaders/index.ts":(K,C,d)=>{d.r(C),d.d(C,{ShaderLib:()=>A.ShaderLib,ShaderUtils:()=>S.ShaderUtils,basic:()=>A.basic,clone:()=>S.clone,instanced:()=>A.instanced,lambert:()=>A.lambert,lambertdouble:()=>A.lambertdouble,outline:()=>A.outline,screen:()=>A.screen,screenaa:()=>A.screenaa,sphereimposter:()=>A.sphereimposter,sphereimposteroutline:()=>A.sphereimposteroutline,sprite:()=>A.sprite,stickimposter:()=>A.stickimposter,stickimposteroutline:()=>A.stickimposteroutline,volumetric:()=>A.volumetric});var A=d("./src/WebGL/shaders/lib/index.ts"),S=d("./src/WebGL/shaders/utils/index.ts");d("./src/WebGL/shaders/ShaderType.ts")},"./src/WebGL/shaders/lib/basic/basic.frag":(K,C,d)=>{d.r(C),d.d(C,{default:()=>A});const A=`uniform mat4 viewMatrix;
uniform float opacity;
uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
varying vec3 vColor;
varying vec4 mvPosition;

//DEFINEFRAGCOLOR
void main() {
    gl_FragColor = vec4( vColor, opacity );
    if(fogNear != fogFar) {
        float depth = -mvPosition.z;
        float fogFactor = smoothstep( fogNear, fogFar, depth );
        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
    }
}`},"./src/WebGL/shaders/lib/basic/basic.vert":(K,C,d)=>{d.r(C),d.d(C,{default:()=>A});const A=`uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;

attribute vec3 position;
attribute vec3 color;

varying vec3 vColor;
varying vec4 mvPosition;

void main() {

    vColor = color;
    mvPosition = modelViewMatrix * vec4( position, 1.0 );
    gl_Position = projectionMatrix * mvPosition;

}`},"./src/WebGL/shaders/lib/basic/index.ts":(K,C,d)=>{d.r(C),d.d(C,{basic:()=>O});var A=d("./src/WebGL/shaders/lib/basic/uniforms.ts"),S=d("./src/WebGL/shaders/lib/basic/basic.frag"),w=d("./src/WebGL/shaders/lib/basic/basic.vert");const O={vertexShader:w.default.replace("#define GLSLIFY 1",""),fragmentShader:S.default.replace("#define GLSLIFY 1",""),uniforms:A.uniforms}},"./src/WebGL/shaders/lib/basic/uniforms.ts":(K,C,d)=>{d.r(C),d.d(C,{uniforms:()=>S});var A=d("./src/colors.ts");const S={opacity:{type:"f",value:1},fogColor:{type:"c",value:new A.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3}}},"./src/WebGL/shaders/lib/blur/blur.frag":(K,C,d)=>{d.r(C),d.d(C,{default:()=>A});const A=`const float INV_TOTAL_SAMPLES_FACTOR = 1.0 / 9.0;
uniform highp sampler2D inTex;
varying highp vec2 vTexCoords;
    
void main() {
 
 vec2 texelSize = 1.0 / vec2(textureSize(inTex,0));
 float blurred_visibility_factor = 0.0f;
 for (int t = -1; t <= 1; ++t) {
  for (int s = -1; s <= 1; ++s) {
   vec2 offset = vec2(float(s), float(t)) * texelSize;
   blurred_visibility_factor += texture2D(inTex, vTexCoords + offset).r;
  }
 }
    
 gl_FragDepthEXT = blurred_visibility_factor * INV_TOTAL_SAMPLES_FACTOR;
 
}`},"./src/WebGL/shaders/lib/blur/blur.vert":(K,C,d)=>{d.r(C),d.d(C,{default:()=>A});const A=`attribute vec2 vertexPosition;
varying highp vec2 vTexCoords;
const vec2 scale = vec2(0.5, 0.5);

void main() {
   vTexCoords  = vertexPosition * scale + scale; // scale vertex attribute to [0,1] range
   gl_Position = vec4(vertexPosition, 0.0, 1.0);
}
        `},"./src/WebGL/shaders/lib/blur/index.ts":(K,C,d)=>{d.r(C),d.d(C,{blur:()=>O});var A=d("./src/WebGL/shaders/lib/blur/uniforms.ts"),S=d("./src/WebGL/shaders/lib/blur/blur.frag"),w=d("./src/WebGL/shaders/lib/blur/blur.vert");const O={fragmentShader:S.default,vertexShader:w.default,uniforms:A.uniforms}},"./src/WebGL/shaders/lib/blur/uniforms.ts":(K,C,d)=>{d.r(C),d.d(C,{uniforms:()=>A});const A={}},"./src/WebGL/shaders/lib/index.ts":(K,C,d)=>{d.r(C),d.d(C,{ShaderLib:()=>n,basic:()=>A.basic,instanced:()=>S.instanced,lambert:()=>w.lambert,lambertdouble:()=>O.lambertdouble,outline:()=>p.outline,screen:()=>x.screen,screenaa:()=>M.screenaa,sphereimposter:()=>v.sphereimposter,sphereimposteroutline:()=>b.sphereimposteroutline,sprite:()=>_.sprite,stickimposter:()=>g.stickimposter,stickimposteroutline:()=>m.stickimposteroutline,volumetric:()=>r.volumetric});var A=d("./src/WebGL/shaders/lib/basic/index.ts"),S=d("./src/WebGL/shaders/lib/instanced/index.ts"),w=d("./src/WebGL/shaders/lib/lambert/index.ts"),O=d("./src/WebGL/shaders/lib/lambertdouble/index.ts"),p=d("./src/WebGL/shaders/lib/outline/index.ts"),x=d("./src/WebGL/shaders/lib/screen/index.ts"),M=d("./src/WebGL/shaders/lib/screenaa/index.ts"),v=d("./src/WebGL/shaders/lib/sphereimposter/index.ts"),b=d("./src/WebGL/shaders/lib/sphereimposteroutline/index.ts"),_=d("./src/WebGL/shaders/lib/sprite/index.ts"),g=d("./src/WebGL/shaders/lib/stickimposter/index.ts"),m=d("./src/WebGL/shaders/lib/stickimposteroutline/index.ts"),r=d("./src/WebGL/shaders/lib/volumetric/index.ts"),e=d("./src/WebGL/shaders/lib/ssao/index.ts"),t=d("./src/WebGL/shaders/lib/blur/index.ts");const n={basic:A.basic,blur:t.blur,instanced:S.instanced,lambert:w.lambert,lambertdouble:O.lambertdouble,outline:p.outline,screen:x.screen,screenaa:M.screenaa,ssao:e.ssao,sphereimposter:v.sphereimposter,sphereimposteroutline:b.sphereimposteroutline,sprite:_.sprite,stickimposter:g.stickimposter,stickimposteroutline:m.stickimposteroutline,volumetric:r.volumetric}},"./src/WebGL/shaders/lib/instanced/index.ts":(K,C,d)=>{d.r(C),d.d(C,{instanced:()=>O});var A=d("./src/WebGL/shaders/lib/instanced/uniforms.ts"),S=d("./src/WebGL/shaders/lib/instanced/instanced.frag"),w=d("./src/WebGL/shaders/lib/instanced/instanced.vert");const O={fragmentShader:S.default.replace("#define GLSLIFY 1",""),vertexShader:w.default.replace("#define GLSLIFY 1",""),uniforms:A.uniforms}},"./src/WebGL/shaders/lib/instanced/instanced.frag":(K,C,d)=>{d.r(C),d.d(C,{default:()=>A});const A=`uniform mat4 viewMatrix;
uniform float opacity;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
#ifdef SHADED
uniform highp sampler2D shading;
#endif
varying vec3 vLightFront;
varying vec3 vColor;
//DEFINEFRAGCOLOR

void main() {

    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );

    #ifndef WIREFRAME
    gl_FragColor.xyz *= vLightFront;
    #endif

#ifdef SHADED
    ivec2 dim = textureSize(shading,0);
    float shadowFactor = texture2D(shading,vec2(gl_FragCoord.x/float(dim.x),gl_FragCoord.y/float(dim.y))).r;
    vColor *= shadowFactor;
#endif
    gl_FragColor = gl_FragColor * vec4( vColor, opacity );
    float depth = gl_FragCoord.z / gl_FragCoord.w;

    float fogFactor = smoothstep( fogNear, fogFar, depth );

    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );

}


`},"./src/WebGL/shaders/lib/instanced/instanced.vert":(K,C,d)=>{d.r(C),d.d(C,{default:()=>A});const A=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 offset;
attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;
attribute float radius;

varying vec3 vColor;
varying vec3 vLightFront;

void main() {

    vColor = color;

    vec3 objectNormal = normal;
    vec3 transformedNormal = normalMatrix * objectNormal;
    vec4 mvPosition = modelViewMatrix * vec4( position * radius + offset, 1.0 );

    vLightFront = vec3( 0.0 );

    transformedNormal = normalize( transformedNormal );

    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vec3 dirVector = normalize( lDirection.xyz );
    float dotProduct = dot( transformedNormal, dirVector );
    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );

    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;

    gl_Position = projectionMatrix * mvPosition;
}

`},"./src/WebGL/shaders/lib/instanced/uniforms.ts":(K,C,d)=>{d.r(C),d.d(C,{uniforms:()=>S});var A=d("./src/colors.ts");const S={opacity:{type:"f",value:1},fogColor:{type:"c",value:new A.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},"./src/WebGL/shaders/lib/lambert/index.ts":(K,C,d)=>{d.r(C),d.d(C,{lambert:()=>O});var A=d("./src/WebGL/shaders/lib/lambert/uniforms.ts"),S=d("./src/WebGL/shaders/lib/lambert/lambert.frag"),w=d("./src/WebGL/shaders/lib/lambert/lambert.vert");const O={fragmentShader:S.default.replace("#define GLSLIFY 1",""),vertexShader:w.default.replace("#define GLSLIFY 1",""),uniforms:A.uniforms}},"./src/WebGL/shaders/lib/lambert/lambert.frag":(K,C,d)=>{d.r(C),d.d(C,{default:()=>A});const A=`uniform mat4 viewMatrix;
uniform float opacity;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
#ifdef SHADED
uniform highp sampler2D shading;
#endif
varying vec3 vLightFront;
varying vec3 vColor;
varying vec4 mvPosition;


//DEFINEFRAGCOLOR

void main() {

    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );

    #ifndef WIREFRAME
    gl_FragColor.xyz *= vLightFront;
    #endif
#ifdef SHADED
    ivec2 dim = textureSize(shading,0);
    float shadowFactor = texture2D(shading,vec2(gl_FragCoord.x/float(dim.x),gl_FragCoord.y/float(dim.y))).r;
    vColor *= shadowFactor;
#endif
    gl_FragColor = gl_FragColor * vec4( vColor, opacity );

    if(fogNear != fogFar) {
        float depth = -mvPosition.z;
        float fogFactor = smoothstep( fogNear, fogFar, depth );
        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
    }

}`},"./src/WebGL/shaders/lib/lambert/lambert.vert":(K,C,d)=>{d.r(C),d.d(C,{default:()=>A});const A=`
uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec3 vColor;
varying vec3 vLightFront;
varying vec4 mvPosition;

void main() {

    vColor = color;

    vec3 objectNormal = normal;
    vec3 transformedNormal = normalMatrix * objectNormal;
    mvPosition = modelViewMatrix * vec4( position, 1.0 );

    vLightFront = vec3( 0.0 );

    transformedNormal = normalize( transformedNormal );

    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vec3 dirVector = normalize( lDirection.xyz );
    float dotProduct = dot( transformedNormal, dirVector );
    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );

    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;

    gl_Position = projectionMatrix * mvPosition;
}`},"./src/WebGL/shaders/lib/lambert/uniforms.ts":(K,C,d)=>{d.r(C),d.d(C,{uniforms:()=>S});var A=d("./src/colors.ts");const S={opacity:{type:"f",value:1},fogColor:{type:"c",value:new A.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},"./src/WebGL/shaders/lib/lambertdouble/index.ts":(K,C,d)=>{d.r(C),d.d(C,{lambertdouble:()=>O});var A=d("./src/WebGL/shaders/lib/lambertdouble/uniforms.ts"),S=d("./src/WebGL/shaders/lib/lambertdouble/lambertdouble.frag"),w=d("./src/WebGL/shaders/lib/lambertdouble/lambertdouble.vert");const O={fragmentShader:S.default.replace("#define GLSLIFY 1",""),vertexShader:w.default.replace("#define GLSLIFY 1",""),uniforms:A.uniforms}},"./src/WebGL/shaders/lib/lambertdouble/lambertdouble.frag":(K,C,d)=>{d.r(C),d.d(C,{default:()=>A});const A=`
#ifdef SHADED
uniform highp sampler2D shading;
#endif

uniform mat4 viewMatrix;
uniform float opacity;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;

varying vec3 vLightFront;
varying vec3 vLightBack;

varying vec3 vColor;
varying vec4 mvPosition;

//DEFINEFRAGCOLOR

void main() {

    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );

    #ifndef WIREFRAME
    if ( gl_FrontFacing )
       gl_FragColor.xyz *= vLightFront;
    else
       gl_FragColor.xyz *= vLightBack;
    #endif

    vec3 color = vColor;
#ifdef SHADED
    ivec2 dim = textureSize(shading,0);
    float shadowFactor = texture2D(shading,vec2(gl_FragCoord.x/float(dim.x),gl_FragCoord.y/float(dim.y))).r;
    color *= shadowFactor;
#endif
    gl_FragColor = gl_FragColor * vec4( color, opacity );

    if(fogNear != fogFar) {
        float depth = -mvPosition.z;
        float fogFactor = smoothstep( fogNear, fogFar, depth );
        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
    }

}


`},"./src/WebGL/shaders/lib/lambertdouble/lambertdouble.vert":(K,C,d)=>{d.r(C),d.d(C,{default:()=>A});const A=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec3 vColor;
varying vec3 vLightFront;
varying vec3 vLightBack;
varying vec4 mvPosition;

void main() {

    vColor = color;

    vec3 objectNormal = normal;
    vec3 transformedNormal = normalMatrix * objectNormal;
    mvPosition = modelViewMatrix * vec4( position, 1.0 );

    vLightFront = vec3( 0.0 );
    vLightBack = vec3( 0.0 );

    transformedNormal = normalize( transformedNormal );

    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vec3 dirVector = normalize( lDirection.xyz );
    float dotProduct = dot( transformedNormal, dirVector );
    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );
    vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );

    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;
    vLightBack += directionalLightColor[ 0 ] * directionalLightWeightingBack;

    gl_Position = projectionMatrix * mvPosition;
}

`},"./src/WebGL/shaders/lib/lambertdouble/uniforms.ts":(K,C,d)=>{d.r(C),d.d(C,{uniforms:()=>S});var A=d("./src/colors.ts");const S={opacity:{type:"f",value:1},fogColor:{type:"c",value:new A.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},"./src/WebGL/shaders/lib/outline/index.ts":(K,C,d)=>{d.r(C),d.d(C,{outline:()=>O});var A=d("./src/WebGL/shaders/lib/outline/uniforms.ts"),S=d("./src/WebGL/shaders/lib/outline/outline.frag"),w=d("./src/WebGL/shaders/lib/outline/outline.vert");const O={fragmentShader:S.default.replace("#define GLSLIFY 1",""),vertexShader:w.default.replace("#define GLSLIFY 1",""),uniforms:A.uniforms}},"./src/WebGL/shaders/lib/outline/outline.frag":(K,C,d)=>{d.r(C),d.d(C,{default:()=>A});const A=`

uniform float opacity;
uniform vec3 outlineColor;
uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;

varying vec4 mvPosition;
//DEFINEFRAGCOLOR

void main() {
    gl_FragColor = vec4( outlineColor, 1 );

    if(fogNear != fogFar) {
        float depth = -mvPosition.z;
        float fogFactor = smoothstep( fogNear, fogFar, depth );
        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
    }
}


`},"./src/WebGL/shaders/lib/outline/outline.vert":(K,C,d)=>{d.r(C),d.d(C,{default:()=>A});const A=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform float outlineWidth;
uniform float outlinePushback;
uniform float vWidth;
uniform float vHeight;
uniform float outlineMaxPixels;

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec4 mvPosition;

void main() {

    vec4 norm = modelViewMatrix*vec4(normalize(normal),0.0);
    mvPosition = modelViewMatrix * vec4( position, 1.0 );
    mvPosition.xy += norm.xy*outlineWidth;
    vec4 outpos = projectionMatrix * mvPosition;

    if(outlineMaxPixels > 0.0) {
        vec4 unadjusted = projectionMatrix*modelViewMatrix * vec4( position, 1.0 );
        float w = outpos.w;
        //normalize homogeneous coords
        unadjusted /= unadjusted.w;
        outpos /= outpos.w;
        vec2 diff = outpos.xy-unadjusted.xy;
        //put into pixels
        diff.x *= vWidth;
        diff.y *= vHeight;
        if ( length(diff) > outlineMaxPixels) {
            vec2 ndiff = normalize(diff)*outlineMaxPixels;
            ndiff.x /= vWidth;
            ndiff.y /= vHeight;
            outpos.xy = unadjusted.xy;
            outpos.xy += ndiff;
        }
        outpos *= w; //if I don't do this things blow up
    }
    gl_Position = outpos;
    mvPosition.z -= outlinePushback; //go backwards in model space
    vec4 pushpos = projectionMatrix*mvPosition; //project to get z in projection space, I'm probably missing some simple math to do the same thing..
    gl_Position.z = gl_Position.w*pushpos.z/pushpos.w;
}

`},"./src/WebGL/shaders/lib/outline/uniforms.ts":(K,C,d)=>{d.r(C),d.d(C,{uniforms:()=>S});var A=d("./src/colors.ts");const S={opacity:{type:"f",value:1},outlineColor:{type:"c",value:new A.Color(0,0,0)},fogColor:{type:"c",value:new A.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1},outlineMaxPixels:{type:"f",value:0}}},"./src/WebGL/shaders/lib/screen/index.ts":(K,C,d)=>{d.r(C),d.d(C,{screen:()=>O});var A=d("./src/WebGL/shaders/lib/screen/uniforms.ts"),S=d("./src/WebGL/shaders/lib/screen/screen.frag"),w=d("./src/WebGL/shaders/lib/screen/screen.vert");const O={fragmentShader:S.default.replace("#define GLSLIFY 1",""),vertexShader:w.default.replace("#define GLSLIFY 1",""),uniforms:A.uniforms}},"./src/WebGL/shaders/lib/screen/screen.frag":(K,C,d)=>{d.r(C),d.d(C,{default:()=>A});const A=`uniform sampler2D colormap;
varying highp vec2 vTexCoords;
uniform vec2 dimensions;
//DEFINEFRAGCOLOR
void main (void) {
   gl_FragColor = texture2D(colormap, vTexCoords);

   //gl_FragColor.g = gl_FragColor.b =  gl_FragColor.r; //debug shading 
}
        `},"./src/WebGL/shaders/lib/screen/screen.vert":(K,C,d)=>{d.r(C),d.d(C,{default:()=>A});const A=`attribute vec2 vertexPosition;
varying highp vec2 vTexCoords;
const vec2 scale = vec2(0.5, 0.5);

void main() {
   vTexCoords  = vertexPosition * scale + scale; // scale vertex attribute to [0,1] range
   gl_Position = vec4(vertexPosition, 0.0, 1.0);
}
        `},"./src/WebGL/shaders/lib/screen/uniforms.ts":(K,C,d)=>{d.r(C),d.d(C,{uniforms:()=>A});const A={}},"./src/WebGL/shaders/lib/screenaa/index.ts":(K,C,d)=>{d.r(C),d.d(C,{screenaa:()=>O});var A=d("./src/WebGL/shaders/lib/screenaa/uniforms.ts"),S=d("./src/WebGL/shaders/lib/screenaa/screenaa.frag"),w=d("./src/WebGL/shaders/lib/screenaa/screenaa.vert");const O={fragmentShader:S.default.replace("#define GLSLIFY 1",""),vertexShader:w.default.replace("#define GLSLIFY 1",""),uniforms:A.uniforms}},"./src/WebGL/shaders/lib/screenaa/screenaa.frag":(K,C,d)=>{d.r(C),d.d(C,{default:()=>A});const A=`
        
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tColor;
varying highp vec2 vTexCoords;

// adapted from https://github.com/kosua20/Rendu
// MIT License Copyright (c) 2017 Simon Rodriguez
// by way of molstar (https://github.com/molstar/molstar/blob/master/src/mol-gl/shader/fxaa.frag.ts)

#define QUALITY(q) ((q) < 5 ? 1.0 : ((q) > 5 ? ((q) < 10 ? 2.0 : ((q) < 11 ? 4.0 : 8.0)) : 1.5))

float rgb2luma(vec3 rgb){
    return sqrt(dot(rgb, vec3(0.299, 0.587, 0.114)));
}

float sampleLuma(vec2 uv) {
    return rgb2luma(texture2D(tColor, uv).rgb);
}

float sampleLuma(vec2 uv, float uOffset, float vOffset) {
    uv += vec2(uOffset, vOffset);
    return sampleLuma(uv);
}

//DEFINEFRAGCOLOR
void main(void) {
    ivec2 dim = textureSize(tColor,0);
    vec2 dimensions = vec2(float(dim.x),float(dim.y));
    vec2 inverseScreenSize = vec2(1.0 / dimensions.x, 1.0 / dimensions.y);
    vec2 coords = vTexCoords;

    vec4 colorCenter = texture2D(tColor, coords);
    float dEdgeThresholdMin = 0.0312;
    float dEdgeThresholdMax = 0.125;
    int dIterations = 12;
    float dSubpixelQuality = 0.3;

    // Luma at the current fragment
    float lumaCenter = rgb2luma(colorCenter.rgb);

    // Luma at the four direct neighbours of the current fragment.
    float lumaDown = sampleLuma(coords, 0.0, -inverseScreenSize.y);
    float lumaUp = sampleLuma(coords, 0.0, inverseScreenSize.y);
    float lumaLeft = sampleLuma(coords, -inverseScreenSize.x, 0.0);
    float lumaRight = sampleLuma(coords, inverseScreenSize.x, 0.0);

    // Find the maximum and minimum luma around the current fragment.
    float lumaMin = min(lumaCenter, min(min(lumaDown, lumaUp), min(lumaLeft, lumaRight)));
    float lumaMax = max(lumaCenter, max(max(lumaDown, lumaUp), max(lumaLeft, lumaRight)));

    // Compute the delta.
    float lumaRange = lumaMax - lumaMin;

    // If the luma variation is lower that a threshold (or if we are in a really dark area),
    // we are not on an edge, don't perform any AA.
    if (lumaRange < max(dEdgeThresholdMin, lumaMax * dEdgeThresholdMax)) {
        gl_FragColor = colorCenter;
        return;
    }

    // Query the 4 remaining corners lumas.
    float lumaDownLeft = sampleLuma(coords, -inverseScreenSize.x, -inverseScreenSize.y);
    float lumaUpRight = sampleLuma(coords, inverseScreenSize.x, inverseScreenSize.y);
    float lumaUpLeft = sampleLuma(coords, -inverseScreenSize.x, inverseScreenSize.y);
    float lumaDownRight = sampleLuma(coords, inverseScreenSize.x, -inverseScreenSize.y);

    // Combine the four edges lumas (using intermediary variables for future computations
    // with the same values).
    float lumaDownUp = lumaDown + lumaUp;
    float lumaLeftRight = lumaLeft + lumaRight;

    // Same for corners
    float lumaLeftCorners = lumaDownLeft + lumaUpLeft;
    float lumaDownCorners = lumaDownLeft + lumaDownRight;
    float lumaRightCorners = lumaDownRight + lumaUpRight;
    float lumaUpCorners = lumaUpRight + lumaUpLeft;

    // Compute an estimation of the gradient along the horizontal and vertical axis.
    float edgeHorizontal = abs(-2.0 * lumaLeft + lumaLeftCorners) + abs(-2.0 * lumaCenter + lumaDownUp) * 2.0 + abs(-2.0 * lumaRight + lumaRightCorners);
    float edgeVertical = abs(-2.0 * lumaUp + lumaUpCorners) + abs(-2.0 * lumaCenter + lumaLeftRight) * 2.0 + abs(-2.0 * lumaDown + lumaDownCorners);

    // Is the local edge horizontal or vertical ?
    bool isHorizontal = (edgeHorizontal >= edgeVertical);

    // Choose the step size (one pixel) accordingly.
    float stepLength = isHorizontal ? inverseScreenSize.y : inverseScreenSize.x;

    // Select the two neighboring texels lumas in the opposite direction to the local edge.
    float luma1 = isHorizontal ? lumaDown : lumaLeft;
    float luma2 = isHorizontal ? lumaUp : lumaRight;
    // Compute gradients in this direction.
    float gradient1 = luma1 - lumaCenter;
    float gradient2 = luma2 - lumaCenter;

    // Which direction is the steepest ?
    bool is1Steepest = abs(gradient1) >= abs(gradient2);

    // Gradient in the corresponding direction, normalized.
    float gradientScaled = 0.25 * max(abs(gradient1), abs(gradient2));

    // Average luma in the correct direction.
    float lumaLocalAverage = 0.0;
    if(is1Steepest){
        // Switch the direction
        stepLength = -stepLength;
        lumaLocalAverage = 0.5 * (luma1 + lumaCenter);
    } else {
        lumaLocalAverage = 0.5 * (luma2 + lumaCenter);
    }

    // Shift UV in the correct direction by half a pixel.
    vec2 currentUv = coords;
    if(isHorizontal){
        currentUv.y += stepLength * 0.5;
    } else {
        currentUv.x += stepLength * 0.5;
    }

    // Compute offset (for each iteration step) in the right direction.
    vec2 offset = isHorizontal ? vec2(inverseScreenSize.x, 0.0) : vec2(0.0, inverseScreenSize.y);
    // Compute UVs to explore on each side of the edge, orthogonally.
    // The QUALITY allows us to step faster.
    vec2 uv1 = currentUv - offset * QUALITY(0);
    vec2 uv2 = currentUv + offset * QUALITY(0);

    // Read the lumas at both current extremities of the exploration segment,
    // and compute the delta wrt to the local average luma.
    float lumaEnd1 = sampleLuma(uv1);
    float lumaEnd2 = sampleLuma(uv2);
    lumaEnd1 -= lumaLocalAverage;
    lumaEnd2 -= lumaLocalAverage;

    // If the luma deltas at the current extremities is larger than the local gradient,
    // we have reached the side of the edge.
    bool reached1 = abs(lumaEnd1) >= gradientScaled;
    bool reached2 = abs(lumaEnd2) >= gradientScaled;
    bool reachedBoth = reached1 && reached2;

    // If the side is not reached, we continue to explore in this direction.
    if(!reached1){
        uv1 -= offset * QUALITY(1);
    }
    if(!reached2){
        uv2 += offset * QUALITY(1);
    }

    // If both sides have not been reached, continue to explore.
    if(!reachedBoth){
        for(int i = 2; i < dIterations; i++){
            // If needed, read luma in 1st direction, compute delta.
            if(!reached1){
                lumaEnd1 = sampleLuma(uv1);
                lumaEnd1 = lumaEnd1 - lumaLocalAverage;
            }
            // If needed, read luma in opposite direction, compute delta.
            if(!reached2){
                lumaEnd2 = sampleLuma(uv2);
                lumaEnd2 = lumaEnd2 - lumaLocalAverage;
            }
            // If the luma deltas at the current extremities is larger than the local gradient,
            // we have reached the side of the edge.
            reached1 = abs(lumaEnd1) >= gradientScaled;
            reached2 = abs(lumaEnd2) >= gradientScaled;
            reachedBoth = reached1 && reached2;

            // If the side is not reached, we continue to explore in this direction,
            // with a variable quality.
            if(!reached1){
                uv1 -= offset * QUALITY(i);
            }
            if(!reached2){
                uv2 += offset * QUALITY(i);
            }

            // If both sides have been reached, stop the exploration.
            if(reachedBoth){
                break;
            }
        }
    }

    // Compute the distances to each side edge of the edge (!).
    float distance1 = isHorizontal ? (coords.x - uv1.x) : (coords.y - uv1.y);
    float distance2 = isHorizontal ? (uv2.x - coords.x) : (uv2.y - coords.y);

    // In which direction is the side of the edge closer ?
    bool isDirection1 = distance1 < distance2;
    float distanceFinal = min(distance1, distance2);

    // Thickness of the edge.
    float edgeThickness = (distance1 + distance2);

    // Is the luma at center smaller than the local average ?
    bool isLumaCenterSmaller = lumaCenter < lumaLocalAverage;

    // If the luma at center is smaller than at its neighbour,
    // the delta luma at each end should be positive (same variation).
    bool correctVariation1 = (lumaEnd1 < 0.0) != isLumaCenterSmaller;
    bool correctVariation2 = (lumaEnd2 < 0.0) != isLumaCenterSmaller;

    // Only keep the result in the direction of the closer side of the edge.
    bool correctVariation = isDirection1 ? correctVariation1 : correctVariation2;

    // UV offset: read in the direction of the closest side of the edge.
    float pixelOffset = - distanceFinal / edgeThickness + 0.5;

    // If the luma variation is incorrect, do not offset.
    float finalOffset = correctVariation ? pixelOffset : 0.0;

    // Sub-pixel shifting
    // Full weighted average of the luma over the 3x3 neighborhood.
    float lumaAverage = (1.0 / 12.0) * (2.0 * (lumaDownUp + lumaLeftRight) + lumaLeftCorners + lumaRightCorners);
    // Ratio of the delta between the global average and the center luma,
    // over the luma range in the 3x3 neighborhood.
    float subPixelOffset1 = clamp(abs(lumaAverage - lumaCenter) / lumaRange, 0.0, 1.0);
    float subPixelOffset2 = (-2.0 * subPixelOffset1 + 3.0) * subPixelOffset1 * subPixelOffset1;
    // Compute a sub-pixel offset based on this delta.
    float subPixelOffsetFinal = subPixelOffset2 * subPixelOffset2 * float(dSubpixelQuality);

    // Pick the biggest of the two offsets.
    finalOffset = max(finalOffset, subPixelOffsetFinal);

    // Compute the final UV coordinates.
    vec2 finalUv = coords;
    if(isHorizontal){
        finalUv.y += finalOffset * stepLength;
    } else {
        finalUv.x += finalOffset * stepLength;
    }

    // Read the color at the new UV coordinates, and use it.
    gl_FragColor = texture2D(tColor, finalUv);
}        

/* old fxaa implementation
uniform highp sampler2D colormap;
varying highp vec2 vTexCoords;


// Basic FXAA implementation based on the code on geeks3d.com 
#define FXAA_REDUCE_MIN (1.0/ 128.0)
#define FXAA_REDUCE_MUL (1.0 / 8.0)
#define FXAA_SPAN_MAX 8.0


vec4 applyFXAA(vec2 fragCoord, highp sampler2D tex)
{
    vec4 color;
    ivec2 dim = textureSize(tex,0);
    vec2 dimensions = vec2(float(dim.x),float(dim.y));
    vec2 inverseVP = vec2(1.0 / dimensions.x, 1.0 / dimensions.y);
    vec4 rgbNW = texture2D(tex, fragCoord + vec2(-1.0, -1.0) * inverseVP);
    vec4 rgbNE = texture2D(tex, fragCoord + vec2(1.0, -1.0) * inverseVP);
    vec4 rgbSW = texture2D(tex, fragCoord + vec2(-1.0, 1.0) * inverseVP);
    vec4 rgbSE = texture2D(tex, fragCoord + vec2(1.0, 1.0) * inverseVP);
    vec4 rgbM  = texture2D(tex, fragCoord );
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW.xyz, luma);
    float lumaNE = dot(rgbNE.xyz, luma);
    float lumaSW = dot(rgbSW.xyz, luma);
    float lumaSE = dot(rgbSE.xyz, luma);
    float lumaM  = dot(rgbM.xyz,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                        (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
            max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
            dir * rcpDirMin)) * inverseVP;

    vec4 rgbA = 0.5 * (
        texture2D(tex, fragCoord + dir * (1.0 / 3.0 - 0.5)) +
        texture2D(tex, fragCoord  + dir * (2.0 / 3.0 - 0.5)));
    vec4 rgbB = rgbA * 0.5 + 0.25 * (
        texture2D(tex, fragCoord  + dir * -0.5) +
        texture2D(tex, fragCoord  + dir * 0.5));

    float lumaB = dot(rgbB.xyz, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = rgbA;
    else
        color = rgbB;

    return color;
}


//DEFINEFRAGCOLOR
void main (void) {
    ivec2 dim = textureSize(colormap,0);

  gl_FragColor = applyFXAA(vTexCoords, colormap);
}
        
*/`},"./src/WebGL/shaders/lib/screenaa/screenaa.vert":(K,C,d)=>{d.r(C),d.d(C,{default:()=>A});const A=`attribute vec2 vertexPosition;
varying highp vec2 vTexCoords;
const vec2 scale = vec2(0.5, 0.5);

void main() {
   vTexCoords  = vertexPosition * scale + scale; // scale vertex attribute to [0,1] range
   gl_Position = vec4(vertexPosition, 0.0, 1.0);
}
        `},"./src/WebGL/shaders/lib/screenaa/uniforms.ts":(K,C,d)=>{d.r(C),d.d(C,{uniforms:()=>A});const A={}},"./src/WebGL/shaders/lib/sphereimposter/index.ts":(K,C,d)=>{d.r(C),d.d(C,{sphereimposter:()=>O});var A=d("./src/WebGL/shaders/lib/sphereimposter/uniforms.ts"),S=d("./src/WebGL/shaders/lib/sphereimposter/sphereimposter.frag"),w=d("./src/WebGL/shaders/lib/sphereimposter/sphereimposter.vert");const O={vertexShader:w.default.replace("#define GLSLIFY 1",""),fragmentShader:S.default.replace("#define GLSLIFY 1",""),uniforms:A.uniforms}},"./src/WebGL/shaders/lib/sphereimposter/sphereimposter.frag":(K,C,d)=>{d.r(C),d.d(C,{default:()=>A});const A=`
uniform mat4 viewMatrix;
uniform float opacity;
uniform mat4 projectionMatrix;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
uniform float uDepth;
uniform vec3 directionalLightColor[ 1 ];

varying vec3 vColor;
varying vec2 mapping;
varying float rval;
varying vec3 vLight;
varying vec3 center;

#ifdef SHADED
uniform highp sampler2D shading;
#endif

//DEFINEFRAGCOLOR

void main() {
    float lensqr = dot(mapping,mapping);
    float rsqr = rval*rval;
    if(lensqr > rsqr)
       discard;
    float z = sqrt(rsqr-lensqr);
    vec3 cameraPos = center+ vec3(mapping.x,mapping.y,z);
    vec4 clipPos = projectionMatrix * vec4(cameraPos, 1.0);
    float ndcDepth = clipPos.z / clipPos.w;
    gl_FragDepthEXT = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;
    vec3 norm = normalize(vec3(mapping.x,mapping.y,z));
    float dotProduct = dot( norm, vLight );
    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );
    vec3 vLight = directionalLightColor[ 0 ] * directionalLightWeighting;
    vec3 color = vLight*vColor;
#ifdef SHADED
    ivec2 dim = textureSize(shading,0);
    float shadowFactor = texture2D(shading,vec2(gl_FragCoord.x/float(dim.x),gl_FragCoord.y/float(dim.y))).r;
    color *= shadowFactor;
#endif    
    gl_FragColor = vec4(color, opacity*opacity );

    if(fogNear != fogFar) {
        float depth = -cameraPos.z;
        float fogFactor = smoothstep( fogNear, fogFar, depth );
        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
    }
     
}

`},"./src/WebGL/shaders/lib/sphereimposter/sphereimposter.vert":(K,C,d)=>{d.r(C),d.d(C,{default:()=>A});const A=`uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec2 mapping;
varying vec3 vColor;
varying float rval;
varying vec3 vLight;
varying vec3 center;

void main() {

    vColor = color;
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    center = mvPosition.xyz;
    vec4 projPosition = projectionMatrix * mvPosition;
    vec4 adjust = projectionMatrix* vec4(normal,0.0); adjust.z = 0.0; adjust.w = 0.0;
    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vLight = normalize( lDirection.xyz );
    mapping = normal.xy;
    rval = abs(normal.x);
    gl_Position = projPosition+adjust;

}
`},"./src/WebGL/shaders/lib/sphereimposter/uniforms.ts":(K,C,d)=>{d.r(C),d.d(C,{uniforms:()=>S});var A=d("./src/colors.ts");const S={opacity:{type:"f",value:1},fogColor:{type:"c",value:new A.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},"./src/WebGL/shaders/lib/sphereimposteroutline/index.ts":(K,C,d)=>{d.r(C),d.d(C,{sphereimposteroutline:()=>O});var A=d("./src/WebGL/shaders/lib/sphereimposteroutline/uniforms.ts"),S=d("./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.frag"),w=d("./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.vert");const O={fragmentShader:S.default.replace("#define GLSLIFY 1",""),vertexShader:w.default.replace("#define GLSLIFY 1",""),uniforms:A.uniforms}},"./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.frag":(K,C,d)=>{d.r(C),d.d(C,{default:()=>A});const A=`

uniform float opacity;
uniform vec3 outlineColor;
uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
uniform mat4 projectionMatrix;
varying vec2 mapping;
varying float rval;
varying vec3 center;

uniform float outlinePushback;

//DEFINEFRAGCOLOR

void main() {
    float lensqr = dot(mapping,mapping);
    float rsqr = rval*rval;
    if(lensqr > rsqr)
       discard;
    float z = sqrt(rsqr-lensqr);
    vec3 cameraPos = center+ vec3(mapping.x,mapping.y,z-outlinePushback);
    vec4 clipPos = projectionMatrix * vec4(cameraPos, 1.0);
    float ndcDepth = clipPos.z / clipPos.w;
    gl_FragDepthEXT = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;
    gl_FragColor = vec4(outlineColor, 1 );

    if(fogNear != fogFar) {
        float depth = -cameraPos.z;
        float fogFactor = smoothstep( fogNear, fogFar, depth );
        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
    }
}


`},"./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.vert":(K,C,d)=>{d.r(C),d.d(C,{default:()=>A});const A=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform float outlineWidth;
uniform float outlinePushback;
uniform float outlineMaxPixels;
uniform float vWidth;
uniform float vHeight;

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec2 mapping;
varying float rval;
varying vec3 center;

void main() {

    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    center = mvPosition.xyz;
    vec4 projPosition = projectionMatrix * mvPosition;
    vec2 norm = normal.xy + vec2(sign(normal.x)*outlineWidth,sign(normal.y)*outlineWidth);

    vec4 adjust = projectionMatrix* vec4(norm,normal.z,1.0); 
    mapping = norm.xy;
    rval = abs(norm.x);
    gl_Position = projPosition+vec4(adjust.xy,0.0,0.0);

    if(outlineMaxPixels > 0.0) {
        vec4 unadjusted = projectionMatrix*vec4(center.x+normal.x, center.y,center.z,1.0); 
        vec4 ccoord = projectionMatrix*vec4(center.xyz,1.0);
        adjust = projectionMatrix* vec4(center.x+norm.x,center.y,center.z,1.0); 
        //subtract center 
        unadjusted.xyz -= ccoord.xyz;
        adjust.xyz -= ccoord.xyz;
        unadjusted /= unadjusted.w;
        adjust /= adjust.w;
        float diff = abs(adjust.x-unadjusted.x);
        diff *= vWidth;
        if(diff > outlineMaxPixels) {
            
            float fixlen = abs(unadjusted.x) + outlineMaxPixels/vWidth;
            //adjsut reval by ratio of lengths
            rval *= fixlen/abs(adjust.x);
        }

    }
}

`},"./src/WebGL/shaders/lib/sphereimposteroutline/uniforms.ts":(K,C,d)=>{d.r(C),d.d(C,{uniforms:()=>S});var A=d("./src/colors.ts");const S={opacity:{type:"f",value:1},outlineColor:{type:"c",value:new A.Color(0,0,0)},fogColor:{type:"c",value:new A.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1},outlineMaxPixels:{type:"f",value:0}}},"./src/WebGL/shaders/lib/sprite/index.ts":(K,C,d)=>{d.r(C),d.d(C,{sprite:()=>O});var A=d("./src/WebGL/shaders/lib/sprite/uniforms.ts"),S=d("./src/WebGL/shaders/lib/sprite/sprite.frag"),w=d("./src/WebGL/shaders/lib/sprite/sprite.vert");const O={fragmentShader:S.default.replace("#define GLSLIFY 1",""),vertexShader:w.default.replace("#define GLSLIFY 1",""),uniforms:A.uniforms}},"./src/WebGL/shaders/lib/sprite/sprite.frag":(K,C,d)=>{d.r(C),d.d(C,{default:()=>A});const A=`

uniform vec3 color;
uniform sampler2D map;
uniform float opacity;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
uniform float alphaTest;

varying vec2 vUV;
//DEFINEFRAGCOLOR

void main() {

    vec4 texture = texture2D(map, vUV);

    if (texture.a <= alphaTest) discard;

    gl_FragColor = vec4(color * texture.xyz, texture.a * opacity);

    if (fogNear != fogFar) {

        float depth = gl_FragCoord.z / gl_FragCoord.w; //probably wrong
        float fogFactor = smoothstep(fogNear, fogFar, depth);        
        gl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w), fogFactor);
    }
}

`},"./src/WebGL/shaders/lib/sprite/sprite.vert":(K,C,d)=>{d.r(C),d.d(C,{default:()=>A});const A=`

uniform int useScreenCoordinates;
uniform vec3 screenPosition;
uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform float rotation;
uniform vec2 scale;
uniform vec2 alignment;
uniform vec2 uvOffset;
uniform vec2 uvScale;

attribute vec2 position;
attribute vec2 uv;

varying vec2 vUV;

void main() {

    vUV = uvOffset + uv * uvScale;

    vec2 alignedPosition = position + alignment;

    vec2 rotatedPosition;
    rotatedPosition.x = ( cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y ) * scale.x;
    rotatedPosition.y = ( sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y ) * scale.y;

    vec4 finalPosition;

    if(useScreenCoordinates != 0) {
        finalPosition = vec4(screenPosition.xy + rotatedPosition, screenPosition.z, 1.0);
    }

    else {
        finalPosition = projectionMatrix * modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0); finalPosition /= finalPosition.w;
        finalPosition.xy += rotatedPosition; 
    }

    gl_Position = finalPosition;

}

`},"./src/WebGL/shaders/lib/sprite/uniforms.ts":(K,C,d)=>{d.r(C),d.d(C,{uniforms:()=>A});const A={}},"./src/WebGL/shaders/lib/ssao/index.ts":(K,C,d)=>{d.r(C),d.d(C,{ssao:()=>O});var A=d("./src/WebGL/shaders/lib/ssao/uniforms.ts"),S=d("./src/WebGL/shaders/lib/ssao/ssao.frag"),w=d("./src/WebGL/shaders/lib/ssao/ssao.vert");const O={fragmentShader:S.default,vertexShader:w.default,uniforms:A.uniforms}},"./src/WebGL/shaders/lib/ssao/ssao.frag":(K,C,d)=>{d.r(C),d.d(C,{default:()=>A});const A=`uniform sampler2D depthmap;
varying highp vec2 vTexCoords;
uniform float vWidth;
uniform float vHeight;
uniform float total_strength;
uniform float radius;
uniform mat4 projinv;
uniform mat4 projectionMatrix;

//code for pseudorandom vector from chatgpt
float hash(vec3 p) {
    p = fract(p * vec3(0.1031, 0.1030, 0.0973));
    p += dot(p, p.yzx + 33.33);
    return fract((p.x + p.y) * p.z);
}

// Generate a pseudorandom vec3 from a seed vec3
vec3 pseudorandomVec3(vec3 seed) {
    vec3 randomVec;
    randomVec.x = hash(seed);
    randomVec.y = hash(seed + vec3(1.0, 0.0, 17.1));
    randomVec.z = hash(seed + vec3(0.0, 13.23, 0.0));
    return randomVec;
}

void main(void)
{   
   const float base = 0.2;
   const float area = 0.75;
   const int cycles = 1;

   const int samples = 64;
   vec3 sample_sphere[64] = vec3[](
      vec3(0.091258,-0.510164,0.000000),
      vec3(-0.204347,-0.872967,0.187199),
      vec3(0.009690,-0.263696,-0.110414),
      vec3(0.175208,-0.563987,0.228527),
      vec3(-0.001824,-0.003113,-0.000323),
      vec3(0.411134,-0.719869,-0.261530),
      vec3(-0.074272,-0.377368,0.276290),
      vec3(-0.147773,-0.381587,-0.284529),
      vec3(0.173317,-0.199635,0.063295),
      vec3(-0.186452,-0.199460,0.076965),
      vec3(0.143985,-0.308160,-0.307687),
      vec3(0.053194,-0.148286,0.169589),
      vec3(-0.547656,-0.486476,-0.317378),
      vec3(0.020804,-0.015092,-0.004574),
      vec3(-0.038006,-0.043165,0.054059),
      vec3(-0.094795,-0.443908,-0.731525),
      vec3(0.547552,-0.396466,0.461477),
      vec3(-0.176886,-0.089989,0.007315),
      vec3(0.074401,-0.048840,-0.074039),
      vec3(-0.008240,-0.075697,0.178197),
      vec3(-0.307880,-0.185053,-0.368943),
      vec3(0.309520,-0.108483,0.041646),
      vec3(-0.773478,-0.292946,0.538166),
      vec3(0.184487,-0.231594,-0.820065),
      vec3(0.207318,-0.100531,0.361797),
      vec3(-0.173306,-0.037737,-0.055289),
      vec3(0.548102,-0.105342,-0.253237),
      vec3(-0.119342,-0.043907,0.285162),
      vec3(-0.270247,-0.087861,-0.751357),
      vec3(0.449312,-0.039777,0.236146),
      vec3(-0.743773,-0.036095,0.196056),
      vec3(0.148819,-0.004300,-0.231448),
      vec3(0.008773,0.000809,0.051047),
      vec3(-0.461467,0.027390,-0.357386),
      vec3(0.169626,0.013338,-0.014053),
      vec3(-0.043786,0.007095,0.047331),
      vec3(0.004821,0.140371,-0.988260),
      vec3(0.092402,0.023994,0.101860),
      vec3(-0.295335,0.061530,-0.027372),
      vec3(0.024903,0.007537,-0.018901),
      vec3(-0.081463,0.125402,0.447794),
      vec3(-0.397119,0.231805,-0.631062),
      vec3(0.163853,0.059014,0.044905),
      vec3(-0.495220,0.214357,0.254139),
      vec3(0.306123,0.373687,-0.825715),
      vec3(0.021665,0.026737,0.053220),
      vec3(-0.208231,0.117129,-0.098685),
      vec3(0.139749,0.080968,-0.043086),
      vec3(-0.153599,0.182814,0.262090),
      vec3(-0.159673,0.496777,-0.743568),
      vec3(0.134797,0.117152,0.095753),
      vec3(-0.155626,0.120533,0.019395),
      vec3(0.042311,0.054462,-0.049709),
      vec3(0.001257,0.031288,0.034468),
      vec3(-0.002271,0.003199,-0.002304),
      vec3(0.662104,0.717307,0.033854),
      vec3(-0.373100,0.576021,0.308274),
      vec3(0.024233,0.231316,-0.173688),
      vec3(0.161311,0.420217,0.234273),
      vec3(-0.045248,0.078031,-0.010411),
      vec3(0.167453,0.376942,-0.094872),
      vec3(-0.056194,0.433247,0.173218),
      vec3(-0.016224,0.123149,-0.035569),
      vec3(0.067127,0.407641,0.028479)
   );

   float depth = texture2D(depthmap, vTexCoords).r;
   if(depth == 1.0) {
      discard;
   }

   vec4 screen_position = vec4(vTexCoords, depth,1.0);
   vec4 pos = projinv*screen_position;
   pos /= pos.w;
   vec3 position = pos.xyz;

   //approximate the normal from the depth map; I find this simpler
   //than trying to recompute the exact normal within every possible object shader

   //pixel offset positions in screen space
   ivec2 dim = textureSize(depthmap,0);
   vec2 offset1 = vec2(0.0,1.0/float(dim.y));
   vec2 offset2 = vec2(1.0/float(dim.x),0.0);
   float depth1 = texture2D(depthmap, vTexCoords + offset1).r;
   float depth2 = texture2D(depthmap, vTexCoords + offset2).r;
   
   vec3 p1 = vec3(screen_position.xy+offset1, depth1 - depth);
   vec3 p2 = vec3(screen_position.xy+offset2, depth2 - depth);

   //convert to model space
   vec4 pos1 = projinv*vec4(p1,1);
   pos1 /= pos1.w;
   vec4 pos2 = projinv*vec4(p2,1);
   pos2 /= pos2.w;

   vec3 normal = normalize(cross(pos1.xyz-position, pos2.xyz-position)); //model normal, important we normalize in model space

   //pseudo random number

   float occlusion = 0.0;
   for(int c = 0; c < cycles; c++) {
   vec3 random = normalize(pseudorandomVec3(position+float(c)));
   for(int i=0; i < samples; i++) {

      vec3 ray = radius * reflect(sample_sphere[i],random);
      vec3 hemi_ray = position + sign(dot(ray,normal)) * ray; //model space
      vec4 hemi_screen = projectionMatrix*vec4(hemi_ray,1.0);
      hemi_screen /= hemi_screen.w;
      
      float occ_depth = texture2D(depthmap, clamp(hemi_screen.xy,0.0,1.0)).r;
      float difference = hemi_screen.z - occ_depth;
      
      occlusion += step(0.0, difference) * (1.0-smoothstep(0.0, area, difference));
   }
   }
   float ao = 1.0 - total_strength * occlusion * (1.0 / float(cycles*samples));
   gl_FragDepthEXT = clamp(ao+base,0.0,1.0);

}`},"./src/WebGL/shaders/lib/ssao/ssao.vert":(K,C,d)=>{d.r(C),d.d(C,{default:()=>A});const A=`attribute vec2 vertexPosition;
varying highp vec2 vTexCoords;
const vec2 scale = vec2(0.5, 0.5);

void main() {
   vTexCoords  = vertexPosition * scale + scale; // scale vertex attribute to [0,1] range
   gl_Position = vec4(vertexPosition, 0.0, 1.0);
}
        `},"./src/WebGL/shaders/lib/ssao/uniforms.ts":(K,C,d)=>{d.r(C),d.d(C,{uniforms:()=>A});const A={total_strength:{type:"f",value:1},radius:{type:"f",value:5},projinv:{type:"mat4",value:[]}}},"./src/WebGL/shaders/lib/stickimposter/index.ts":(K,C,d)=>{d.r(C),d.d(C,{stickimposter:()=>x});var A=d("./src/WebGL/shaders/lib/stickimposter/uniforms.ts"),S=d("./src/WebGL/shaders/lib/stickimposter/stickimposterFragmentShader.partial.frag"),w=d("./src/WebGL/shaders/lib/stickimposter/stickimposter.partial.frag"),O=d("./src/WebGL/shaders/lib/stickimposter/stickimposter.vert");const x={fragmentShader:[S.default,w.default].join(`
`),vertexShader:O.default,uniforms:A.uniforms}},"./src/WebGL/shaders/lib/stickimposter/stickimposter.partial.frag":(K,C,d)=>{d.r(C),d.d(C,{default:()=>A});const A=`    float dotProduct = dot( norm, vLight );
    vec3 light = vec3( max( dotProduct, 0.0 ) );
    color *= light;
#ifdef SHADED
    ivec2 dim = textureSize(shading,0);
    float shadowFactor = texture2D(shading,vec2(gl_FragCoord.x/float(dim.x),gl_FragCoord.y/float(dim.y))).r;
    color *= shadowFactor;
#endif    
    gl_FragColor = vec4(color, opacity*opacity );
    if(fogNear != fogFar) {
        float depth = -qi.z;
        float fogFactor = smoothstep( fogNear, fogFar, depth );
        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
    }
}`},"./src/WebGL/shaders/lib/stickimposter/stickimposter.vert":(K,C,d)=>{d.r(C),d.d(C,{default:()=>A});const A=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;
attribute float radius;

varying vec3 vColor;
varying vec3 vLight;
varying vec3 cposition;
varying vec3 p1;
varying vec3 p2;
varying float r;

void main() {

    vColor = color; vColor.z = abs(vColor.z); //z indicates which vertex and so would vary
    r = abs(radius);
    vec4 to = modelViewMatrix*vec4(normal, 1.0); //normal is other point of cylinder
    vec4 pt = modelViewMatrix*vec4(position, 1.0);
    vec4 mvPosition = pt;
    p1 = pt.xyz; p2 = to.xyz;
    vec3 norm = to.xyz-pt.xyz;
    float mult = 1.1; //slop to account for perspective of sphere
    if(length(p1) > length(p2)) { //billboard at level of closest point
       mvPosition = to;
    }
    vec3 n = normalize(mvPosition.xyz);
    bool isperspective = (projectionMatrix[3][3] == 0.0);
//intersect with the plane defined by the camera looking at the billboard point
    if(color.z >= 0.0) { //p1
       if(isperspective) { //perspective
         vec3 pnorm = normalize(p1);
         float t = dot(mvPosition.xyz-p1,n)/dot(pnorm,n);
         mvPosition.xyz = p1+t*pnorm; 
       } else { //orthographic
         mvPosition.xyz = p1;
       }
    } else {
      if(isperspective) { //perspective
         vec3 pnorm = normalize(p2);
         float t = dot(mvPosition.xyz-p2,n)/dot(pnorm,n);
         mvPosition.xyz = p2+t*pnorm;
       } else { //orthographic
         mvPosition.xyz = p2;
       } 
       mult *= -1.0;
    }

    if(isperspective) { //perspective
      vec3 cr = normalize(cross(mvPosition.xyz,norm))*radius;
      vec3 doublecr = normalize(cross(mvPosition.xyz,cr))*radius;
      mvPosition.xyz +=  mult*(cr + doublecr).xyz;
    } else {
      vec3 cr = normalize(cross(vec3(0.0,0.0,-1.0),norm))*radius;
      vec3 doublecr = normalize(cross(vec3(0.0,0.0,-1.0),cr))*radius;
      mvPosition.xyz +=  mult*(cr + doublecr).xyz;     
    }

    cposition = mvPosition.xyz;
    gl_Position = projectionMatrix * mvPosition;
    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vLight = normalize( lDirection.xyz )*directionalLightColor[0]; //not really sure this is right, but color is always white so..
}

`},"./src/WebGL/shaders/lib/stickimposter/stickimposterFragmentShader.partial.frag":(K,C,d)=>{d.r(C),d.d(C,{default:()=>A});const A=`uniform float opacity;
uniform mat4 projectionMatrix;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;

varying vec3 vLight;
varying vec3 vColor;
varying vec3 cposition;
varying vec3 p1;
varying vec3 p2;
varying float r;

#ifdef SHADED
uniform highp sampler2D shading;
#endif

//DEFINEFRAGCOLOR

//cylinder-ray intersection testing taken from http://mrl.nyu.edu/~dzorin/cg05/lecture12.pdf
//also useful: http://stackoverflow.com/questions/9595300/cylinder-impostor-in-glsl
//with a bit more care (caps) this could be a general cylinder imposter (see also outline)
void main() {
    vec3 color = abs(vColor);
    vec3 pos = cposition;
    vec3 p = pos; //ray point
    vec3 v = vec3(0.0,0.0,-1.0); //ray normal - orthographic
    if(projectionMatrix[3][3] == 0.0) v = normalize(pos); //ray normal - perspective
    vec3 pa = p1; //cyl start
    vec3 va = normalize(p2-p1); //cyl norm
    vec3 tmp1 = v-(dot(v,va)*va);
    vec3 deltap = p-pa;
    float A = dot(tmp1,tmp1);
    if(A == 0.0) discard;
    vec3 tmp2 = deltap-(dot(deltap,va)*va);
    float B = 2.0*dot(tmp1, tmp2);
    float C = dot(tmp2,tmp2)-r*r;
//quadratic equation!
    float det = (B*B) - (4.0*A*C);
    if(det < 0.0) discard;
    float sqrtDet = sqrt(det);
    float posT = (-B+sqrtDet)/(2.0*A);
    float negT = (-B-sqrtDet)/(2.0*A);
    float intersectionT = min(posT,negT);
    vec3 qi = p+v*intersectionT;
    float dotp1 = dot(va,qi-p1);
    float dotp2 = dot(va,qi-p2);
    vec3 norm;
    if( dotp1 < 0.0 || dotp2 > 0.0) { //(p-c)^2 + 2(p-c)vt +v^2+t^2 - r^2 = 0
       vec3 cp;
       if( dotp1 < 0.0) {  
//        if(vColor.x < 0.0 ) discard; //color sign bit indicates if we should cap or not
        cp = p1;
       } else {
//          if(vColor.y < 0.0 ) discard;
          cp = p2;
       }
       vec3 diff = p-cp;
       A = dot(v,v);
       B = dot(diff,v)*2.0;
       C = dot(diff,diff)-r*r;
       det = (B*B) - (4.0*C);
       if(det < 0.0) discard;
       sqrtDet = sqrt(det);
       posT = (-B+sqrtDet)/(2.0);
       negT = (-B-sqrtDet)/(2.0);
       float t = min(posT,negT);
       qi = p+v*t; 
       norm = normalize(qi-cp); 
    } else {
       norm = normalize(qi-(dotp1*va + p1));
    }
    vec4 clipPos = projectionMatrix * vec4(qi, 1.0);
    float ndcDepth = clipPos.z / clipPos.w;
    float depth = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;
    gl_FragDepthEXT = depth;`},"./src/WebGL/shaders/lib/stickimposter/uniforms.ts":(K,C,d)=>{d.r(C),d.d(C,{uniforms:()=>S});var A=d("./src/colors.ts");const S={opacity:{type:"f",value:1},fogColor:{type:"c",value:new A.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},"./src/WebGL/shaders/lib/stickimposteroutline/index.ts":(K,C,d)=>{d.r(C),d.d(C,{stickimposteroutline:()=>x});var A=d("./src/WebGL/shaders/lib/stickimposteroutline/uniforms.ts"),S=d("./src/WebGL/shaders/lib/stickimposter/stickimposterFragmentShader.partial.frag"),w=d("./src/WebGL/shaders/lib/stickimposteroutline/stickimposteroutline.partial.frag"),O=d("./src/WebGL/shaders/lib/stickimposteroutline/stickimposteroutline.vert");const x={fragmentShader:S.default+w.default,vertexShader:O.default,uniforms:A.uniforms}},"./src/WebGL/shaders/lib/stickimposteroutline/stickimposteroutline.partial.frag":(K,C,d)=>{d.r(C),d.d(C,{default:()=>A});const A=`
    gl_FragColor = vec4(color, opacity*opacity );
    if(fogNear != fogFar) {
        float depth = -qi.z;
        float fogFactor = smoothstep( fogNear, fogFar, depth );
        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
    }
}`},"./src/WebGL/shaders/lib/stickimposteroutline/stickimposteroutline.vert":(K,C,d)=>{d.r(C),d.d(C,{default:()=>A});const A=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];
uniform vec3 outlineColor;
uniform float outlineWidth;
uniform float outlinePushback;
uniform float outlineMaxPixels;
uniform float vWidth;
uniform mat4 projinv;


attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;
attribute float radius;

varying vec3 vColor;
varying vec3 vLight;
varying vec3 cposition;
varying vec3 p1;
varying vec3 p2;
varying float r;

void main() {

    vColor = outlineColor;
    float rad = radius+sign(radius)*outlineWidth;
    r = abs(rad);

    vec4 to = modelViewMatrix*vec4(normal, 1.0); //normal is other point of cylinder
    vec4 pt = modelViewMatrix*vec4(position, 1.0);
//pushback
    float scale = 1.0;
    if(projectionMatrix[3][3] != 0.0) { //orthographic
        to.z -= outlinePushback;
        pt.z -= outlinePushback;
    } else { //perspective
        vec4 midbefore = pt;
        if(length(to.xyz) < length(pt)) {
            midbefore = to;
        }
        vec4 midafter = midbefore;
        midafter.xyz += normalize(midbefore.xyz)*outlinePushback;

        to.xyz += normalize(to.xyz)*outlinePushback;
        pt.xyz += normalize(pt.xyz)*outlinePushback;

        //figure out a scaling factor for radius to account for perspective setback
        vec4 midbeforer = vec4(midbefore.x+rad,midbefore.y, midbefore.z, midbefore.w);
        vec4 midafterr = vec4(midafter.x+rad,midafter.y, midafter.z, midafter.w);

        vec4 mb = projectionMatrix*midbefore;
        vec4 mbr = projectionMatrix*midbeforer;
        vec4 ma = projectionMatrix*midafter;
        vec4 mar = projectionMatrix*midafterr;
        mb /= mb.w;
        mbr /= mbr.w;
        ma /= ma.w;
        mar /= mar.w;
        scale = abs((mbr.x-mb.x)/(mar.x-ma.x));
        rad *= scale;
        r = abs(rad);
    }
    vec4 mvPosition = pt;
    p1 = pt.xyz; p2 = to.xyz;
    vec3 norm = to.xyz-pt.xyz;
    float mult = 1.1; //slop to account for perspective of sphere
    if(length(p1) > length(p2)) { //billboard at level of closest point
       mvPosition = to;
    }

    vec3 n = normalize(mvPosition.xyz);
//intersect with the plane defined by the camera looking at the billboard point
    if(color.z >= 0.0) { //p1
       vec3 pnorm = normalize(p1);
       float t = dot(mvPosition.xyz-p1,n)/dot(pnorm,n);
       mvPosition.xyz = p1+t*pnorm;
    } else {
       vec3 pnorm = normalize(p2);
       float t = dot(mvPosition.xyz-p2,n)/dot(pnorm,n);
       mvPosition.xyz = p2+t*pnorm;
       mult *= -1.0;
    }

    if(outlineMaxPixels > 0.0) {
        vec4 cpos = mvPosition;
        vec4 unadjusted = projectionMatrix*vec4(cpos.x+abs(scale*radius), cpos.y,cpos.z,cpos.w); 
        vec4 ccoord = projectionMatrix*cpos;
        vec4 adjust = projectionMatrix*vec4(cpos.x+r,cpos.y,cpos.z,cpos.w); 
        unadjusted /= unadjusted.w;
        adjust /= adjust.w;
        unadjusted.xyz -= ccoord.xyz/ccoord.w;
        adjust.xyz -= ccoord.xyz/ccoord.w;
        float diff = abs(adjust.x-unadjusted.x);
        diff *= vWidth; //this should now be in pixels
        if(diff > outlineMaxPixels) {
            float fixlen = abs(unadjusted.x) + outlineMaxPixels/vWidth; 
            vec4 pcoord = ccoord;
            pcoord.x += fixlen*pcoord.w;
            vec4 altc = projinv*pcoord;
            r= abs(altc.x-cpos.x);
        }
    }

    vec3 cr = normalize(cross(mvPosition.xyz,norm))*rad;
    vec3 doublecr = normalize(cross(mvPosition.xyz,cr))*rad;
    mvPosition.xy +=  mult*(cr + doublecr).xy;
    cposition = mvPosition.xyz;
    gl_Position = projectionMatrix * mvPosition;
    vLight = vec3(1.0,1.0,1.0);
}

`},"./src/WebGL/shaders/lib/stickimposteroutline/uniforms.ts":(K,C,d)=>{d.r(C),d.d(C,{uniforms:()=>S});var A=d("./src/colors.ts");const S={opacity:{type:"f",value:1},fogColor:{type:"c",value:new A.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineColor:{type:"c",value:new A.Color(0,0,0)},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1},outlineMaxPixels:{type:"f",value:0},projinv:{type:"mat4",value:[]}}},"./src/WebGL/shaders/lib/volumetric/index.ts":(K,C,d)=>{d.r(C),d.d(C,{volumetric:()=>O});var A=d("./src/WebGL/shaders/lib/volumetric/uniforms.ts"),S=d("./src/WebGL/shaders/lib/volumetric/volumetric.frag"),w=d("./src/WebGL/shaders/lib/volumetric/volumetric.vert");const O={fragmentShader:S.default.replace("#define GLSLIFY 1",""),vertexShader:w.default.replace("#define GLSLIFY 1",""),uniforms:A.uniforms}},"./src/WebGL/shaders/lib/volumetric/uniforms.ts":(K,C,d)=>{d.r(C),d.d(C,{uniforms:()=>S});var A=d("./src/colors.ts");const S={opacity:{type:"f",value:1},fogColor:{type:"c",value:new A.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},data:{type:"i",value:3},colormap:{type:"i",value:4},depthmap:{type:"i",value:5},step:{type:"f",value:1},maxdepth:{type:"f",value:100},subsamples:{type:"f",value:5},textmat:{type:"mat4",value:[]},projinv:{type:"mat4",value:[]},transfermin:{type:"f",value:-.2},transfermax:{type:"f",value:.2}}},"./src/WebGL/shaders/lib/volumetric/volumetric.frag":(K,C,d)=>{d.r(C),d.d(C,{default:()=>A});const A=`
uniform highp sampler3D data;
uniform highp sampler2D colormap;
uniform highp sampler2D depthmap;


uniform mat4 textmat;
uniform mat4 projinv;
uniform mat4 projectionMatrix;

uniform float step;
uniform float subsamples;
uniform float maxdepth;
uniform float transfermin;
uniform float transfermax;
in  vec4 mvPosition;
out vec4 color;
void main(void) {

   vec4 pos = mvPosition;
   bool seengood = false;
   float i = 0.0;
   color = vec4(1,1,1,0);
   float increment = 1.0/subsamples;
   float maxsteps = (maxdepth*subsamples/step);
//there's probably a better way to do this..
//calculate farthest possible point in model coordinates
   vec4 maxpos = vec4(pos.x,pos.y,pos.z-maxdepth,1.0);
// convert to projection
   maxpos = projectionMatrix*maxpos;
   vec4 startp = projectionMatrix*pos;
// homogonize
   maxpos /= maxpos.w;
   startp /= startp.w;
//take x,y from start and z from max
   maxpos = vec4(startp.x,startp.y,maxpos.z,1.0);
//convert back to model space
   maxpos = projinv*maxpos;
   maxpos /= maxpos.w;
   float incr = step/subsamples;
//get depth from depthmap
//startp is apparently [-1,1]
   vec2 tpos = startp.xy/2.0+0.5;
   float depth = texture(depthmap, tpos).r;
//compute vector between start and end
   vec4 direction = maxpos-pos;
   for( i = 0.0; i <= maxsteps; i++) {
      vec4 pt = (pos+(i/maxsteps)*direction);
      vec4 ppt = projectionMatrix*pt;
      float ptdepth = ppt.z/ppt.w;
      ptdepth = ((gl_DepthRange.diff * ptdepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;
      if(ptdepth > depth) break;
      pt = textmat*pt;
//       pt /= pt.w;
      if(pt.x >= -0.01 && pt.y >= -0.01 && pt.z >= -0.01 && pt.x <= 1.01 && pt.y <= 1.01 && pt.z <= 1.01) {
         seengood = true;
      } else if(seengood) {
         break;
      }
      if( pt.x < -0.01 || pt.x > 1.01 || pt.y < -0.01 || pt.y > 1.01 || pt.z < -0.01 || pt.z > 1.01  ){
          color.a = 0.0;
          continue;
      }
      else {
         float val = texture(data, pt.zyx).r;
         if(isinf(val)) continue; //masked out
         float cval = (val-transfermin)/(transfermax-transfermin); //scale to texture 0-1 range
         vec4 val_color = texture(colormap, vec2(cval,0.5));
         color.rgb = color.rgb*color.a + (1.0-color.a)*val_color.a*val_color.rgb;
         color.a += (1.0 - color.a) * val_color.a; 
         if(color.a > 0.0) color.rgb /= color.a;
//          color = vec4(pt.x, pt.y, pt.z, 1.0);
      }
//       color = vec4(pt.x, pt.y, pt.z, 0.0)
    }
}

        `},"./src/WebGL/shaders/lib/volumetric/volumetric.vert":(K,C,d)=>{d.r(C),d.d(C,{default:()=>A});const A=`uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;

in vec3 position;
out vec4 mvPosition;
void main() {

    mvPosition = modelViewMatrix * vec4( position, 1.0 );
    gl_Position = projectionMatrix*mvPosition;
}
`},"./src/WebGL/shaders/utils/clone.ts":(K,C,d)=>{d.r(C),d.d(C,{clone:()=>S});var A=d("./src/colors.ts");function S(w){let O={};for(const x in w){O[x]={},O[x].type=w[x].type;var p=w[x].value;p instanceof A.Color?O[x].value=p.clone():typeof p=="number"?O[x].value=p:p instanceof Array?O[x].value=[]:console.error("Error copying shader uniforms from ShaderLib: unknown type for uniform")}return O}},"./src/WebGL/shaders/utils/index.ts":(K,C,d)=>{d.r(C),d.d(C,{ShaderUtils:()=>S,clone:()=>A.clone});var A=d("./src/WebGL/shaders/utils/clone.ts");const S={clone:A.clone}},"./src/WebGL/shapes/Cylinder.ts":(K,C,d)=>{d.r(C),d.d(C,{Cylinder:()=>w});var A=d("./src/WebGL/math/index.ts");let S=new A.Vector3;class w{constructor(p=new A.Vector3,x=new A.Vector3,M=0){this.c1=p,this.c2=x,this.radius=M,this.direction=new A.Vector3().subVectors(this.c2,this.c1).normalize()}copy(p){return this.c1.copy(p.c1),this.c2.copy(p.c2),this.direction.copy(p.direction),this.radius=p.radius,this}lengthSq(){return S.subVectors(this.c2,this.c1).lengthSq()}applyMatrix4(p){return this.direction.add(this.c1).applyMatrix4(p),this.c1.applyMatrix4(p),this.c2.applyMatrix4(p),this.direction.sub(this.c1).normalize(),this.radius=this.radius*p.getMaxScaleOnAxis(),this}}},"./src/WebGL/shapes/Sphere.ts":(K,C,d)=>{d.r(C),d.d(C,{Sphere:()=>S});var A=d("./src/WebGL/math/index.ts");class S{constructor(O={x:0,y:0,z:0},p=0){this.center=new A.Vector3(O.x,O.y,O.z),this.radius=p}set(O,p){return this.center.copy(O),this.radius=p,this}copy(O){return this.center.copy(O.center),this.radius=O.radius,this}applyMatrix4(O){return this.center.applyMatrix4(O),this.radius=this.radius*O.getMaxScaleOnAxis(),this}translate(O){return this.center.add(O),this}equals(O){return O.center.equals(this.center)&&O.radius===this.radius}clone(){return new S().copy(this)}}},"./src/WebGL/shapes/Triangle.ts":(K,C,d)=>{d.r(C),d.d(C,{Triangle:()=>w});var A=d("./src/WebGL/math/index.ts");const S=new A.Vector3;class w{constructor(p=new A.Vector3,x=new A.Vector3,M=new A.Vector3){this.a=p,this.b=x,this.c=M}copy(p){return this.a.copy(p.a),this.b.copy(p.b),this.c.copy(p.c),this}applyMatrix4(p){return this.a.applyMatrix4(p),this.b.applyMatrix4(p),this.c.applyMatrix4(p),this}getNormal(){var p=this.a.clone();return p.sub(this.b),S.subVectors(this.c,this.b),p.cross(S),p.normalize(),p}}},"./src/WebGL/shapes/index.ts":(K,C,d)=>{d.r(C),d.d(C,{Cylinder:()=>S.Cylinder,Sphere:()=>A.Sphere,Triangle:()=>w.Triangle});var A=d("./src/WebGL/shapes/Sphere.ts"),S=d("./src/WebGL/shapes/Cylinder.ts"),w=d("./src/WebGL/shapes/Triangle.ts")},"./src/autoload.ts":(K,C,d)=>{d.r(C),d.d(C,{autoinit:()=>p,autoload:()=>v,processing_autoinit:()=>x,viewers:()=>M});var A=d("./src/GLViewer.ts"),S=d("./src/ProteinSurface4.ts"),w=d("./src/utilities.ts"),O=d("./src/colors.ts"),p=!1,x=!1,M={};function v(b,_){var g,m,r;if(document.querySelector(".viewer_3Dmoljs")!=null&&(p=!0),p){x=!0,b=b??null;var e=0;document.querySelectorAll(".viewer_3Dmoljs").forEach(t=>{var n=[],o=[],h="";t.style.position=="static"&&(t.style.position="relative");var f=null;if(r=null,t.dataset.pdb)n.push("https://files.rcsb.org/view/"+t.dataset.pdb+".pdb"),o.push("pdb");else if(t.dataset.cid)o.push("sdf"),n.push("https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+t.dataset.cid+"/SDF?record_type=3d");else if(t.dataset.href||t.dataset.url){if(t.dataset.href?h=t.dataset.href:h=t.dataset.url,n.push(h),r=h.substring(h.lastIndexOf(".")+1),r=="gz"){let _e=h.substring(0,h.lastIndexOf(".")).lastIndexOf(".");r=h.substring(_e+1)}o.push(r);var i=h.substring(h.lastIndexOf("/")+1,h.lastIndexOf("."));i=="/"&&(i=h.substring(h.lastIndexOf("/")+1)),t.dataset[o[o.length-1]]=i}let s=t.dataset;for(g in s)g.substring(0,3)==="pdb"&&g!=="pdb"?(n.push("https://files.rcsb.org/view/"+s[g]+".pdb"),o.push("pdb")):g.substring(0,4)==="href"&&g!=="href"?(h=s[g],n.push(h),o.push(h.substring(h.lastIndexOf(".")+1))):g.substring(0,3)==="cid"&&g!=="cid"&&(n.push("https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+s[g]+"/SDF?record_type=3d"),o.push("sdf"));var a={};t.dataset.options&&(a=(0,w.specStringToObject)(t.dataset.options));var c=O.CC.color(t.dataset.backgroundcolor),u=t.dataset.backgroundalpha;u=u==null?1:parseFloat(u);var E={line:{}};t.dataset.style&&(E=(0,w.specStringToObject)(t.dataset.style));var T={};t.dataset.select&&(T=(0,w.specStringToObject)(t.dataset.select));var L=[],P=[],I=[],z={},B=null,F=t.dataset,W=/style(.+)/,U=/surface(.*)/,R=/labelres(.*)/,V=[];for(m in F)Object.prototype.hasOwnProperty.call(F,m)&&V.push(m);for(V.sort(),g=0;g<V.length;g++){m=V[g];var q=W.exec(m),ee,se,ie;q&&(ee="select"+q[1],se=(0,w.specStringToObject)(F[ee]),ie=(0,w.specStringToObject)(F[m]),L.push([se,ie])),q=U.exec(m),q&&(ee="select"+q[1],se=(0,w.specStringToObject)(F[ee]),ie=(0,w.specStringToObject)(F[m]),P.push([se,ie])),q=R.exec(m),q&&(ee="select"+q[1],se=(0,w.specStringToObject)(F[ee]),ie=(0,w.specStringToObject)(F[m]),I.push([se,ie])),m=="zoomto"&&(z=(0,w.specStringToObject)(F[m])),m=="spin"&&(B=(0,w.specStringToObject)(F[m]))}var le=function(_e){for(_e.setStyle(T,E),f&&f.createSelectionAndStyle(T,E),g=0;g<L.length;g++){let Q=L[g][0]||{},me=L[g][1]||{line:{}};_e.setStyle(Q,me),f&&f.createSelectionAndStyle(T,E)}for(g=0;g<P.length;g++){let Q=P[g][0]||{},me=P[g][1]||{};f?_e.addSurface(S.SurfaceType.VDW,me,Q,Q).then(Pe=>{f.loadSurface("VDW",Q,me,Pe)}):_e.addSurface(S.SurfaceType.VDW,me,Q,Q)}for(g=0;g<I.length;g++){let Q=I[g][0]||{},me=I[g][1]||{};_e.addResLabels(Q,me)}_e.render(),_e.zoomTo(z),B&&_e.spin(B.axis,B.speed)};let re=b;try{var oe=(0,w.specStringToObject)(t.dataset.config)||{};oe.backgroundColor===void 0&&(oe.backgroundColor=c),oe.backgroundAlpha===void 0&&(oe.backgroundAlpha=u),re==null?re=M[t.id||e++]=(0,A.createViewer)(t,oe):(re.setBackgroundColor(c,u),re.setConfig(oe),f&&f.initiateUI()),t.dataset.ui&&$3Dmol.StateManager&&(f=new $3Dmol.StateManager(re))}catch(_e){console.log(_e),t.textContent="WebGL appears to be disabled."}if(n.length!=0){let _e=0,Q=((me,Ce)=>function(Pe){h=n[_e];var We=me.dataset.type||me.dataset.datatype||o[_e];if(Ce.addModel(Pe,We,a),f){var Ue=me.dataset[o[_e]];f.setModelTitle(Ue)}_e+=1,_e<n.length?(0,w.get)(n[_e]).then(Q):(le(Ce),me.dataset.callback&&(0,w.makeFunction)(me.dataset.callback)(Ce),x=!1,_&&_(Ce))})(t,re);r&&r.endsWith("gz")?(0,w.getbin)(n[0]).then(Q):(0,w.get)(n[0]).then(Q)}else{if(t.dataset.element){var Ae="#"+t.dataset.element,Me=document.querySelector(Ae),Oe=Me?Me.textContent:"";r=t.dataset.type||t.dataset.datatype,re.addModel(Oe,r,a)}le(re),t.dataset.callback&&(0,w.makeFunction)(t.dataset.callback)(re),x=!1,_&&_(re)}})}}document.onreadystatechange=()=>{document.readyState==="complete"&&v()}},"./src/colors.ts":(K,C,d)=>{d.r(C),d.d(C,{CC:()=>S,Color:()=>A,builtinColorSchemes:()=>b,chains:()=>v,elementColors:()=>x,htmlColors:()=>w,residues:()=>M,ssColors:()=>O});class A{constructor(g,m,r){return this.r=0,this.g=0,this.b=0,arguments.length>1&&typeof g=="number"?(this.r=g||0,this.g=m||0,this.b=r||0,this):this.set(g||0)}set(g){return g instanceof A?g.clone():(typeof g=="number"?this.setHex(g):typeof g=="object"&&(this.r=g?.r||0,this.g=g?.g||0,this.b=g?.b||0),this)}setHex(g){return g=Math.floor(g),this.r=(g>>16&255)/255,this.g=(g>>8&255)/255,this.b=(g&255)/255,this}getHex(){var g=Math.round(this.r*255),m=Math.round(this.g*255),r=Math.round(this.b*255);return g<<16|m<<8|r}clone(){return new A(this.r,this.g,this.b)}copy(g){return this.r=g.r,this.g=g.g,this.b=g.b,this}scaled(){var g={};return g.r=Math.round(this.r*255),g.g=Math.round(this.g*255),g.b=Math.round(this.b*255),g.a=1,g}}class S{static color(g){if(!g)return S.cache[0];if(g instanceof A)return g;if(typeof g=="number"&&typeof S.cache[g]<"u")return S.cache[g];if(g&&Array.isArray(g))return g.map(S.color);let m=S.getHex(g),r=new A(m);return S.cache[m]=r,r}static getHex(g){if(Array.isArray(g))return g.map(S.getHex);if(typeof g=="string"){let m=g;if(!isNaN(parseInt(m)))return parseInt(m);if(m=m.trim(),m.length==4&&m[0]=="#"&&(m="#"+m[1]+m[1]+m[2]+m[2]+m[3]+m[3]),m.length==7&&m[0]=="#")return parseInt(m.substring(1),16);let r=S.rgbRegEx.exec(m);if(r){r[1]!=""&&console.log("WARNING: Opacity value in rgba ignored.  Specify separately as opacity attribute.");let t=0;for(let n=2;n<5;n++){t*=256;let o=r[n].endsWith("%")?255*parseFloat(r[n])/100:parseFloat(r[n]);t+=Math.round(o)}return t}let e=w[m.toLowerCase()];return e!==void 0?e:(console.error("color not found",g.toLowerCase(),w),0)}return g}}S.rgbRegEx=/rgb(a?)\(\s*([^ ,\)\t]+)\s*,\s*([^ ,\)\t]+)\s*,\s*([^ ,\)\t]+)/i,S.cache={0:new A(0)};const w={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgrey:11119017,darkgreen:25600,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,grey:8421504,green:32768,greenyellow:11403055,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgrey:13882323,lightgreen:9498256,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074,b:255,g:32768,r:16711680,c:49087,m:12517567,y:12566272,k:0,w:16777215},O={pyMol:{h:16711680,s:16776960,c:65280},Jmol:{h:16711808,s:16762880,c:16777215}},p={H:16777215,He:16761035,HE:16761035,Li:11674146,LI:11674146,B:65280,C:13158600,N:9408511,O:15728640,F:14329120,Na:255,NA:255,Mg:2263842,MG:2263842,Al:8421520,AL:8421520,Si:14329120,SI:14329120,P:16753920,S:16762930,Cl:65280,CL:65280,Ca:8421520,CA:8421520,Ti:8421520,TI:8421520,Cr:8421520,CR:8421520,Mn:8421520,MN:8421520,Fe:16753920,FE:16753920,Ni:10824234,NI:10824234,Cu:10824234,CU:10824234,Zn:10824234,ZN:10824234,Br:10824234,BR:10824234,Ag:8421520,AG:8421520,I:10494192,Ba:16753920,BA:16753920,Au:14329120,AU:14329120},x={defaultColor:16716947,Jmol:{H:16777215,He:14286847,HE:14286847,Li:13402367,LI:13402367,Be:12779264,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,Ne:11789301,NE:11789301,Na:11230450,NA:11230450,Mg:9109248,MG:9109248,Al:12560038,AL:12560038,Si:1578e4,SI:1578e4,P:16744448,S:16777008,Cl:2093087,CL:2093087,Ar:8442339,AR:8442339,K:9388244,Ca:4062976,CA:4062976,Sc:15132390,SC:15132390,Ti:12567239,TI:12567239,V:10921643,Cr:9083335,CR:9083335,Mn:10255047,MN:10255047,Fe:14706227,FE:14706227,Co:15765664,CO:15765664,Ni:5296208,NI:5296208,Cu:13140019,CU:13140019,Zn:8224944,ZN:8224944,Ga:12750735,GA:12750735,Ge:6721423,GE:6721423,As:12419299,AS:12419299,Se:16752896,SE:16752896,Br:10889513,BR:10889513,Kr:6076625,KR:6076625,Rb:7351984,RB:7351984,Sr:65280,SR:65280,Y:9764863,Zr:9756896,ZR:9756896,Nb:7586505,NB:7586505,Mo:5551541,MO:5551541,Tc:3907230,TC:3907230,Ru:2396047,RU:2396047,Rh:687500,RH:687500,Pd:27013,PD:27013,Ag:12632256,AG:12632256,Cd:16767375,CD:16767375,In:10909043,IN:10909043,Sn:6717568,SN:6717568,Sb:10380213,SB:10380213,Te:13924864,TE:13924864,I:9699476,Xe:4366e3,XE:4366e3,Cs:5707663,CS:5707663,Ba:51456,BA:51456,La:7394559,LA:7394559,Ce:16777159,CE:16777159,Pr:14286791,PR:14286791,Nd:13107143,ND:13107143,Pm:10747847,PM:10747847,Sm:9437127,SM:9437127,Eu:6422471,EU:6422471,Gd:4587463,GD:4587463,Tb:3211207,TB:3211207,Dy:2097095,DY:2097095,Ho:65436,HO:65436,Er:58997,ER:58997,Tm:54354,TM:54354,Yb:48952,YB:48952,Lu:43812,LU:43812,Hf:5096191,HF:5096191,Ta:5089023,TA:5089023,W:2200790,Re:2522539,RE:2522539,Os:2516630,OS:2516630,Ir:1528967,IR:1528967,Pt:13684960,PT:13684960,Au:16765219,AU:16765219,Hg:12105936,HG:12105936,Tl:10900557,TL:10900557,Pb:5724513,PB:5724513,Bi:10375093,BI:10375093,Po:11230208,PO:11230208,At:7688005,AT:7688005,Rn:4358806,RN:4358806,Fr:4325478,FR:4325478,Ra:32e3,RA:32e3,Ac:7384058,AC:7384058,Th:47871,TH:47871,Pa:41471,PA:41471,U:36863,Np:33023,NP:33023,Pu:27647,PU:27647,Am:5528818,AM:5528818,Cm:7888099,CM:7888099,Bk:9064419,BK:9064419,Cf:10565332,CF:10565332,Es:11739092,ES:11739092,Fm:11739066,FM:11739066,Md:11734438,MD:11734438,No:12389767,NO:12389767,Lr:13041766,LR:13041766,Rf:13369433,RF:13369433,Db:13697103,DB:13697103,Sg:14221381,SG:14221381,Bh:14680120,BH:14680120,Hs:15073326,HS:15073326,Mt:15400998,MT:15400998},rasmol:p,defaultColors:Object.assign({},p),greenCarbon:Object.assign(Object.assign({},p),{C:65280}),cyanCarbon:Object.assign(Object.assign({},p),{C:65535}),magentaCarbon:Object.assign(Object.assign({},p),{C:16711935}),yellowCarbon:Object.assign(Object.assign({},p),{C:16776960}),whiteCarbon:Object.assign(Object.assign({},p),{C:16777215}),orangeCarbon:Object.assign(Object.assign({},p),{C:16753920}),purpleCarbon:Object.assign(Object.assign({},p),{C:8388736}),blueCarbon:Object.assign(Object.assign({},p),{C:255})},M={amino:{ALA:13158600,ARG:1334015,ASN:56540,ASP:15075850,CYS:15132160,GLN:56540,GLU:15075850,GLY:15461355,HIS:8553170,ILE:1016335,LEU:1016335,LYS:1334015,MET:15132160,PHE:3289770,PRO:14456450,SER:16422400,THR:16422400,TRP:11819700,TYR:3289770,VAL:1016335,ASX:16738740,GLX:16738740},shapely:{ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:16777215,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,ASX:16711935,GLX:16711935},nucleic:{A:10526975,G:16740464,I:8454143,C:16747595,T:10551200,U:16744576}},v={atom:{A:12636415,B:11599792,C:16761032,D:16777088,E:16761087,F:11596016,G:16765040,H:15761536,I:16113331,J:49151,K:13458524,L:6737322,M:10145074,N:15631086,O:52945,P:65407,Q:3978097,R:139,S:12433259,T:25600,U:8388608,V:8421376,W:8388736,X:32896,Y:12092939,Z:11674146},hetatm:{A:9478351,B:8441752,C:13602992,D:13619056,E:13603023,F:8437952,G:13607008,H:12603504,I:12955267,J:42959,K:11881548,L:5682578,M:9090346,N:12481214,O:46753,P:53103,Q:3447649,R:187,S:10854235,T:37888,U:11534336,V:11579392,W:11534512,X:45232,Y:15250963,Z:12726834}},b={ssPyMol:{prop:"ss",map:O.pyMol},ssJmol:{prop:"ss",map:O.Jmol},Jmol:{prop:"elem",map:x.Jmol},amino:{prop:"resn",map:M.amino},shapely:{prop:"resn",map:M.shapely},nucleic:{prop:"resn",map:M.nucleic},chain:{prop:"chain",map:v.atom},rasmol:{prop:"elem",map:x.rasmol},default:{prop:"elem",map:x.defaultColors},greenCarbon:{prop:"elem",map:x.greenCarbon},chainHetatm:{prop:"chain",map:v.hetatm},cyanCarbon:{prop:"elem",map:x.cyanCarbon},magentaCarbon:{prop:"elem",map:x.magentaCarbon},purpleCarbon:{prop:"elem",map:x.purpleCarbon},whiteCarbon:{prop:"elem",map:x.whiteCarbon},orangeCarbon:{prop:"elem",map:x.orangeCarbon},yellowCarbon:{prop:"elem",map:x.yellowCarbon},blueCarbon:{prop:"elem",map:x.blueCarbon}}},"./src/exporter.js":K=>{typeof K.exports=="object"&&(K.exports=window.$3Dmol)},"./src/glcartoon.ts":(K,C,d)=>{d.r(C),d.d(C,{drawCartoon:()=>T,subdivide_spline:()=>v});var A=d("./src/WebGL/math/index.ts"),S=d("./src/WebGL/shapes/index.ts"),w=d("./src/WebGL/index.ts"),O=d("./src/Gradient.ts"),p=d("./src/colors.ts"),x=d("./src/GLDraw.ts"),M=d("./src/utilities.ts");function v(L,P){var I=[],z=L;z=[],z.push(L[0]);var B,F,W,U,R,V,q,ee,se;for(B=1,F=L.length-1;B<F;B++)if(R=L[B],V=L[B+1],R.smoothen){var ie=new A.Vector3((R.x+V.x)/2,(R.y+V.y)/2,(R.z+V.z)/2);ie.atom=R.atom,z.push(ie)}else z.push(R);for(z.push(L[L.length-1]),B=-1,W=z.length;B<=W-3;B++)if(U=z[B===-1?0:B],R=z[B+1],V=z[B+2],q=z[B===W-3?W-1:B+3],ee=new A.Vector3().subVectors(V,U).multiplyScalar(.5),se=new A.Vector3().subVectors(q,R).multiplyScalar(.5),!V.skip)for(var le=0;le<P;le++){var re=1/P*le,oe=R.x+re*ee.x+re*re*(-3*R.x+3*V.x-2*ee.x-se.x)+re*re*re*(2*R.x-2*V.x+ee.x+se.x),Ae=R.y+re*ee.y+re*re*(-3*R.y+3*V.y-2*ee.y-se.y)+re*re*re*(2*R.y-2*V.y+ee.y+se.y),Me=R.z+re*ee.z+re*re*(-3*R.z+3*V.z-2*ee.z-se.z)+re*re*re*(2*R.z-2*V.z+ee.z+se.z),Oe=new A.Vector3(oe,Ae,Me);le<P/2?Oe.atom=R.atom:Oe.atom=V.atom,I.push(Oe)}return I.push(z[z.length-1]),I}const b=.5,_=1.3,g=.8,m=.4,r=.4;function e(L,P,I,z){for(var B,F,W,U,R=0,V=P.length;R<V;R++){U=Math.round(R*(z.length-1)/V),W=p.CC.color(z[U]);var q=L.updateGeoGroup(2),ee=q.vertexArray,se=q.colorArray,ie=q.faceArray;B=q.vertices,F=B*3,ee[F]=P[R].x,ee[F+1]=P[R].y,ee[F+2]=P[R].z,ee[F+3]=I[R].x,ee[F+4]=I[R].y,ee[F+5]=I[R].z;for(var le=0;le<6;++le)se[F+3*le]=W.r,se[F+1+3*le]=W.g,se[F+2+3*le]=W.b;if(R>0){var re=[B,B+1,B-1,B-2],oe=q.faceidx;ie[oe]=re[0],ie[oe+1]=re[1],ie[oe+2]=re[3],ie[oe+3]=re[1],ie[oe+4]=re[2],ie[oe+5]=re[3],q.faceidx+=6}q.vertices+=2}}function t(L,P,I,z,B,F,W){var U,R,V,q;if(V=P.length,V<2||P[0].length<2)return;for(U=0;U<V;U++)P[U]=v(P[U],z);if(q=P[0].length,!B)return e(L,P[0],P[V-1],I);var ee,se,ie,le,re,oe,Ae=[],Me=[],Oe=[];for(R=0;R<V;R++)Ae.push(.25+1.5*Math.sqrt((V-1)*R-Math.pow(R,2))/(V-1)),Me.push(.5),Oe.push(2*(Math.pow(R/V,2)-R/V)+.6);var _e=[];for(R=0;R<V*2-1;R++)_e[R]=[R,R+1,R+1-2*V,R-2*V];_e[V*2-1]=[R,R+1-2*V,R+1-4*V,R-2*V];var Q,me,Ce,Pe,We,Ue,ze,Be,Ie,Se;let Te=L.updateGeoGroup();for(U=0;U<q;U++){let Z=L.groups,Y=!1;Te=L.updateGeoGroup(2*V),Z!=L.groups&&U>0&&(U=U-1,Y=!0),Ue=Math.round(U*(I.length-1)/q),We=p.CC.color(I[Ue]),re=ie,oe=le,ie=[],le=[],ee=[],P[0][U].atom!==void 0&&(Pe=P[0][U].atom,W==="oval"?se=Ae:W==="rectangle"?se=Me:W==="parabola"&&(se=Oe)),se||(se=Me);var Ge,Ne;for(R=0;R<V;R++)U<q-1?Ge=P[R][U+1].clone().sub(P[R][U]):Ge=P[R][U-1].clone().sub(P[R][U]).negate(),R<V-1?Ne=P[R+1][U].clone().sub(P[R][U]):Ne=P[R-1][U].clone().sub(P[R][U]).negate(),ee[R]=Ne.cross(Ge).normalize().multiplyScalar(B*se[R]);for(R=0;R<V;R++)ie[R]=P[R][U].clone().add(ee[R].clone().negate());for(R=0;R<V;R++)le[R]=P[R][U].clone().add(ee[R]);for(ze=Te.vertexArray,Be=Te.colorArray,Ie=Te.faceArray,Q=Te.vertices,me=Q*3,R=0;R<V;R++)ze[me+3*R+0]=ie[R].x,ze[me+3*R+1]=ie[R].y,ze[me+3*R+2]=ie[R].z;for(R=0;R<V;R++)ze[me+3*R+0+3*V]=le[V-1-R].x,ze[me+3*R+1+3*V]=le[V-1-R].y,ze[me+3*R+2+3*V]=le[V-1-R].z;for(R=0;R<2*V;++R)Be[me+3*R+0]=We.r,Be[me+3*R+1]=We.g,Be[me+3*R+2]=We.b;if(U>0&&!Y){for(R=0;R<V*2;R++)Se=[Q+_e[R][0],Q+_e[R][1],Q+_e[R][2],Q+_e[R][3]],Ce=Te.faceidx,Ie[Ce]=Se[0],Ie[Ce+1]=Se[1],Ie[Ce+2]=Se[3],Ie[Ce+3]=Se[1],Ie[Ce+4]=Se[2],Ie[Ce+5]=Se[3],Te.faceidx+=6;if(Pe.clickable||Pe.hoverable){var k=[];k.push(new S.Triangle(re[0],ie[0],ie[V-1])),k.push(new S.Triangle(re[0],ie[V-1],re[V-1])),k.push(new S.Triangle(re[V-1],ie[V-1],le[V-1])),k.push(new S.Triangle(re[V-1],le[V-1],oe[V-1])),k.push(new S.Triangle(le[0],oe[0],oe[V-1])),k.push(new S.Triangle(le[V-1],le[0],oe[V-1])),k.push(new S.Triangle(ie[0],re[0],oe[0])),k.push(new S.Triangle(le[0],ie[0],oe[0]));for(R in k)Pe.intersectionShape.triangle.push(k[R])}}Te.vertices+=2*V}for(ze=Te.vertexArray,Be=Te.colorArray,Ie=Te.faceArray,Q=Te.vertices,me=Q*3,Ce=Te.faceidx,U=0;U<V-1;U++)Se=[U,U+1,2*V-2-U,2*V-1-U],Ce=Te.faceidx,Ie[Ce]=Se[0],Ie[Ce+1]=Se[1],Ie[Ce+2]=Se[3],Ie[Ce+3]=Se[1],Ie[Ce+4]=Se[2],Ie[Ce+5]=Se[3],Te.faceidx+=6;for(U=0;U<V-1;U++)Se=[Q-1-U,Q-2-U,Q-2*V+U+1,Q-2*V+U],Ce=Te.faceidx,Ie[Ce]=Se[0],Ie[Ce+1]=Se[1],Ie[Ce+2]=Se[3],Ie[Ce+3]=Se[1],Ie[Ce+4]=Se[2],Ie[Ce+5]=Se[3],Te.faceidx+=6}function n(L,P,I,z,B,F){if(!(P.length<2)){var W,U;if(W=P[0],U=P[P.length-1],W=v(W,z),U=v(U,z),!B)return e(L,W,U,I);var R=[],V,q,ee,se,ie,le=[[0,2,-6,-8],[-4,-2,6,4],[7,-1,-5,3],[-3,5,1,-7]],re,oe,Ae,Me,Oe,_e,Q,me,Ce,Pe,We,Ue,ze,Be,Ie,Se,Te;for(me=0,Ce=W.length;me<Ce;me++){if(Oe=Math.round(me*(I.length-1)/Ce),Me=p.CC.color(I[Oe]),R.push(q=W[me]),R.push(q),R.push(ee=U[me]),R.push(ee),me<Ce-1){var Ge=W[me+1].clone().sub(W[me]),Ne=U[me].clone().sub(W[me]);V=Ne.cross(Ge).normalize().multiplyScalar(B)}for(R.push(se=W[me].clone().add(V)),R.push(se),R.push(ie=U[me].clone().add(V)),R.push(ie),q.atom!==void 0&&(_e=q.atom),Be=L.updateGeoGroup(8),Ie=Be.vertexArray,Se=Be.colorArray,Te=Be.faceArray,re=Be.vertices,oe=re*3,Ie[oe]=q.x,Ie[oe+1]=q.y,Ie[oe+2]=q.z,Ie[oe+3]=q.x,Ie[oe+4]=q.y,Ie[oe+5]=q.z,Ie[oe+6]=ee.x,Ie[oe+7]=ee.y,Ie[oe+8]=ee.z,Ie[oe+9]=ee.x,Ie[oe+10]=ee.y,Ie[oe+11]=ee.z,Ie[oe+12]=se.x,Ie[oe+13]=se.y,Ie[oe+14]=se.z,Ie[oe+15]=se.x,Ie[oe+16]=se.y,Ie[oe+17]=se.z,Ie[oe+18]=ie.x,Ie[oe+19]=ie.y,Ie[oe+20]=ie.z,Ie[oe+21]=ie.x,Ie[oe+22]=ie.y,Ie[oe+23]=ie.z,Pe=0;Pe<8;++Pe)Se[oe+3*Pe]=Me.r,Se[oe+1+3*Pe]=Me.g,Se[oe+2+3*Pe]=Me.b;if(me>0){var k=Q!==void 0&&_e!==void 0&&Q.serial!==_e.serial;for(Pe=0;Pe<4;Pe++){var Z=[re+le[Pe][0],re+le[Pe][1],re+le[Pe][2],re+le[Pe][3]];if(Ae=Be.faceidx,Te[Ae]=Z[0],Te[Ae+1]=Z[1],Te[Ae+2]=Z[3],Te[Ae+3]=Z[1],Te[Ae+4]=Z[2],Te[Ae+5]=Z[3],Be.faceidx+=6,_e.clickable||Q.clickable||_e.hoverable||Q.hoverable){var Y=R[Z[3]].clone(),ue=R[Z[0]].clone(),fe=R[Z[2]].clone(),Ee=R[Z[1]].clone();if(Y.atom=R[Z[3]].atom||null,fe.atom=R[Z[2]].atom||null,ue.atom=R[Z[0]].atom||null,Ee.atom=R[Z[1]].atom||null,k){var we=Y.clone().add(ue).multiplyScalar(.5),N=fe.clone().add(Ee).multiplyScalar(.5),ae=Y.clone().add(Ee).multiplyScalar(.5);Pe%2===0?((Q.clickable||Q.hoverable)&&(We=new S.Triangle(we,ae,Y),Ue=new S.Triangle(N,fe,ae),ze=new S.Triangle(ae,fe,Y),Q.intersectionShape.triangle.push(We),Q.intersectionShape.triangle.push(Ue),Q.intersectionShape.triangle.push(ze)),(_e.clickable||_e.hoverable)&&(We=new S.Triangle(ue,Ee,ae),Ue=new S.Triangle(Ee,N,ae),ze=new S.Triangle(ue,ae,we),_e.intersectionShape.triangle.push(We),_e.intersectionShape.triangle.push(Ue),_e.intersectionShape.triangle.push(ze))):((_e.clickable||_e.hoverable)&&(We=new S.Triangle(we,ae,Y),Ue=new S.Triangle(N,fe,ae),ze=new S.Triangle(ae,fe,Y),_e.intersectionShape.triangle.push(We),_e.intersectionShape.triangle.push(Ue),_e.intersectionShape.triangle.push(ze)),(Q.clickable||Q.hoverable)&&(We=new S.Triangle(ue,Ee,ae),Ue=new S.Triangle(Ee,N,ae),ze=new S.Triangle(ue,ae,we),Q.intersectionShape.triangle.push(We),Q.intersectionShape.triangle.push(Ue),Q.intersectionShape.triangle.push(ze)))}else(_e.clickable||_e.hoverable)&&(We=new S.Triangle(ue,Ee,Y),Ue=new S.Triangle(Ee,fe,Y),_e.intersectionShape.triangle.push(We),_e.intersectionShape.triangle.push(Ue))}}}Be.vertices+=8,Q=_e}var ve=R.length-8;for(Be=L.updateGeoGroup(8),Ie=Be.vertexArray,Se=Be.colorArray,Te=Be.faceArray,re=Be.vertices,oe=re*3,Ae=Be.faceidx,me=0;me<4;me++){R.push(R[me*2]),R.push(R[ve+me*2]);var Le=R[me*2],ne=R[ve+me*2];Ie[oe+6*me]=Le.x,Ie[oe+1+6*me]=Le.y,Ie[oe+2+6*me]=Le.z,Ie[oe+3+6*me]=ne.x,Ie[oe+4+6*me]=ne.y,Ie[oe+5+6*me]=ne.z,Se[oe+6*me]=Me.r,Se[oe+1+6*me]=Me.g,Se[oe+2+6*me]=Me.b,Se[oe+3+6*me]=Me.r,Se[oe+4+6*me]=Me.g,Se[oe+5+6*me]=Me.b}ve+=8,We=[re,re+2,re+6,re+4],Ue=[re+1,re+5,re+7,re+3],Te[Ae]=We[0],Te[Ae+1]=We[1],Te[Ae+2]=We[3],Te[Ae+3]=We[1],Te[Ae+4]=We[2],Te[Ae+5]=We[3],Te[Ae+6]=Ue[0],Te[Ae+7]=Ue[1],Te[Ae+8]=Ue[3],Te[Ae+9]=Ue[1],Te[Ae+10]=Ue[2],Te[Ae+11]=Ue[3],Be.faceidx+=12,Be.vertices+=8}}function o(L,P,I,z,B,F,W){(!W||W==="default")&&(W="rectangle"),W==="edged"?n(L,P,I,z,B):(W==="rectangle"||W==="oval"||W==="parabola")&&t(L,P,I,z,B,F,W)}function h(L){return L&&L.elem==="C"&&L.atom==="CA"}function f(L,P){if(L&&P&&L.chain===P.chain){if(!L.hetflag&&!P.hetflag&&L.reschain===P.reschain&&(L.resi===P.resi||L.resi===P.resi-1))return!0;if(L.resi<P.resi){var I=L.x-P.x,z=L.y-P.y,B=L.z-P.z,F=I*I+z*z+B*B;if(L.atom=="CA"&&P.atom=="CA"&&F<16)return!0;if((L.atom=="P"||P.atom=="P")&&F<64)return!0}}return!1}function i(L,P,I,z,B){if(!(P==null||P.vertices==0)){B&&(P.initTypedArrays(),P.setUpNormals());var F=new w.MeshDoubleLambertMaterial;F.vertexColors=w.Coloring.FaceColors,typeof I=="number"&&I>=0&&I<1&&(F.transparent=!0,F.opacity=I),F.outline=z;var W=new w.Mesh(P,F);L.add(W)}}function s(L,P,I,z,B,F,W,U,R){var V,q,ee,se,ie,le;if(!(!z||!B||!W)){var re=B.sub(z);re.normalize();var oe=U[R];for(q=R+1;q<U.length&&(oe=U[q],oe.atom!=W.atom);q++);if(oe=oe?new A.Vector3(oe.x,oe.y,oe.z):new A.Vector3(0,0,0),oe.sub(z),W.ss==="arrow start"){var Ae=oe.clone().multiplyScalar(.3).cross(B);z.add(Ae);var Me=oe.clone().cross(re).normalize();re.rotateAboutVector(Me,.43)}for(W.style.cartoon.ribbon?V=W.style.cartoon.thickness||m:W.style.cartoon.width?V=W.style.cartoon.width:W.ss==="c"?W.atom==="P"?V=g:V=b:W.ss==="arrow start"?(V=_,ie=!0):W.ss==="arrow end"||W.ss==="h"&&W.style.cartoon.tubes||W.ss==="tube start"?V=b:V=_,F!=null&&re.dot(F)<0&&re.negate(),re.multiplyScalar(V),q=0;q<P;q++)ee=-1+q*2/(P-1),se=new A.Vector3(z.x+ee*re.x,z.y+ee*re.y,z.z+ee*re.z),se.atom=W,W.ss==="s"&&(se.smoothen=!0),L[q].push(se);if(ie)for(re.multiplyScalar(2),q=0;q<P;q++)ee=-1+q*2/(P-1),se=new A.Vector3(z.x+ee*re.x,z.y+ee*re.y,z.z+ee*re.z),se.atom=W,se.smoothen=!1,se.skip=!0,L[q].push(se);return le=W.style.cartoon.style||"default",L.style?L.style!=le&&(console.log("Warning: a cartoon chain's strand-style is ambiguous"),L.style="default"):L.style=le,(W.ss==="arrow start"||W.ss==="arrow end")&&(W.ss="s"),ie}}const a={C:!0,CA:!0,O:!0,P:!0,OP2:!0,O2P:!0,"O5'":!0,"O3'":!0,"C5'":!0,"C2'":!0,"O5*":!0,"O3*":!0,"C5*":!0,"C2*":!0,N1:!0,N3:!0},c={DA:!0,DG:!0,A:!0,G:!0},u={DT:!0,DC:!0,U:!0,C:!0,T:!0},E={DA:!0,DG:!0,A:!0,G:!0,DT:!0,DC:!0,U:!0,C:!0,T:!0};function T(L,P,I,z=10){let B=z,F=z;var W,U,R,V,q,ee,se,ie,le,re,oe,Ae,Me,Oe,_e,Q,me,Ce,Pe=new w.Geometry(!0),We=new w.Geometry(!0),Ue=[],ze=[],Be=1,Ie=!1,Se={};for(var Te in O.Gradient.builtinGradients)O.Gradient.builtinGradients.hasOwnProperty(Te)&&(Se[Te]=new O.Gradient.builtinGradients[Te](I[1],I[0]));var Ge=function(Re,D){return I&&D.color==="spectrum"?D.colorscheme in Se?Se[D.colorscheme].valueToHex(Re.resi):Se.sinebow.valueToHex(Re.resi):(0,M.getColorFromStyle)(Re,D).getHex()};for(ie=0;ie<B;ie++)ze[ie]=[];var Ne=!1,k=!1,Z=[];for(ie in P){if(V=P[ie],V.elem==="C"&&V.atom==="CA"){var Y=f(R,V);Y&&V.ss==="s"?Ne=!0:Ne&&(R&&U&&R.style.cartoon.arrows&&U.style.cartoon.arrows&&(R.ss="arrow end",U.ss="arrow start"),Ne=!1),Y&&(R.ss==="h"||R.ss=="tube start")&&R.style.cartoon.tubes?!k&&R.ss!="tube start"&&V.style.cartoon.tubes&&(V.ss="tube start",k=!0):k&&(R.ss==="tube start"?R.ss="tube end":U&&U.style.cartoon.tubes&&(U.ss="tube end"),k=!1),U=R,R=V}V&&V.atom in a&&Z.push(V)}k&&R.style.cartoon.tubes&&(R.ss="tube end",k=!1);var ue=function(Re){ze[0].length>0&&o(We,ze,Ue,F,se,Be,ze.style);var D=[],ce=null;if(Re){for(ie=0;ie<B;ie++)D[ie]=ze[ie][ze[ie].length-1];ce=Ue[Ue.length-1]}for(ze=[],ie=0;ie<B;ie++)ze[ie]=[];if(Ue=[],Re){for(ie=0;ie<B;ie++)ze[ie].push(D[ie]);Ue.push(ce)}i(L,We,Be,Ie,!0),i(L,Pe,Be,Ie,!1),We=new w.Geometry(!0),Pe=new w.Geometry(!0)};R=void 0;let fe=[];for(var Ee=0;Ee<Z.length;Ee++){V=Z[Ee];var we=V.resn.trim(),N=we in E;if(Be=1,W=V.style.cartoon,R&&R.style.cartoon&&(Be=R.style.cartoon.opacity),R&&R.style.cartoon&&R.style.cartoon.outline&&(Ie=R.style.cartoon.outline),R&&R.style.cartoon&&(!V.style.cartoon||R.style.cartoon.opacity!=V.style.cartoon.opacity)&&ue(R.chain==V.chain),R&&V&&!f(R,V)&&R.chain&&R.chain==V.chain&&!R.hetflag&&!V.hetflag&&R.reschain+1==V.reschain&&fe.push([R,V]),W.style==="trace"){if(!V.hetflag){if(V.elem==="C"&&V.atom==="CA"||N&&V.atom==="P"||V.atom==="BB"){if(ee=Ge(V,W),(0,M.isNumeric)(W.thickness)?se=W.thickness:se=m,f(R,V))if(ee==q){var ae=p.CC.color(ee);x.GLDraw.drawCylinder(Pe,R,V,se,ae,2,2)}else{var ve=new A.Vector3().addVectors(R,V).multiplyScalar(.5),Le=p.CC.color(q),ne=p.CC.color(ee);x.GLDraw.drawCylinder(Pe,R,ve,se,Le,2,0),x.GLDraw.drawCylinder(Pe,ve,V,se,ne,0,2)}if((V.clickable===!0||V.hoverable)&&V.intersectionShape!==void 0){var ye=new A.Vector3(V.x,V.y,V.z);V.intersectionShape.sphere.push(new S.Sphere(ye,se))}R=V,q=ee}}}else{if(h(V)||N&&(V.atom==="P"||V.atom.indexOf("O5")==0)){if(Ce)if(V.ss==="tube end")Ce=!1,me=new A.Vector3(V.x,V.y,V.z),x.GLDraw.drawCylinder(Pe,Q,me,2,p.CC.color(q),1,1),V.ss="h";else if(R.chain!=V.chain||R.ss==="tube end")Ce=!1,R.ss="h",me=new A.Vector3(R.x,R.y,R.z),x.GLDraw.drawCylinder(Pe,Q,me,2,p.CC.color(q),1,1);else continue;if(R&&(!f(R,V)||R.ss==="tube start")){for(R.ss==="tube start"&&(Ce=!0,Q=new A.Vector3(R.x,R.y,R.z),R.ss="h"),_e&&(Ae?Oe=new A.Vector3().addVectors(R,Ae).multiplyScalar(.5):Oe=new A.Vector3(R.x,R.y,R.z),x.GLDraw.drawCylinder(Pe,Oe,_e,r,p.CC.color(_e.color),0,2),s(ze,B,!0,Ae,Me,oe,R,Z,Ee),Ue.push(ee),Oe=null,_e=null),ze[0].length>0&&o(We,ze,Ue,F,se,Be,ze.style),ze=[],ie=0;ie<B;ie++)ze[ie]=[];Ue=[]}if(R===void 0||R.rescode!=V.rescode||R.resi!=V.resi){if(_e&&R!=null){Oe=new A.Vector3().addVectors(R,V).multiplyScalar(.5);var j=Oe.clone().sub(_e).multiplyScalar(.02);Oe.add(j),x.GLDraw.drawCylinder(Pe,Oe,_e,r,p.CC.color(_e.color),0,2),Oe=null,_e=null}ee=Ge(V,W),Ue.push(ee),(0,M.isNumeric)(W.thickness)?se=W.thickness:se=m,R=V,le=new A.Vector3(R.x,R.y,R.z),le.resi=R.resi,q=ee}(V.clickable===!0||V.hoverable===!0)&&(V.intersectionShape===void 0||V.intersectionShape.triangle===void 0)&&(V.intersectionShape={sphere:null,cylinder:[],line:[],triangle:[]})}else R!=null&&(h(R)&&V.atom==="O"||N&&R.atom==="P"&&(V.atom==="OP2"||V.atom==="O2P")||N&&R.atom.indexOf("O5")==0&&V.atom.indexOf("C5")==0)?(re=new A.Vector3(V.x,V.y,V.z),re.resi=V.resi,(V.atom==="OP2"||V.atom==="O2P")&&(Me=new A.Vector3(V.x,V.y,V.z))):N&&V.atom.indexOf("O3")==0?Ae=new A.Vector3(V.x,V.y,V.z):(V.atom==="N1"&&we in c||V.atom==="N3"&&we in u)&&(_e=new A.Vector3(V.x,V.y,V.z),_e.color=(0,M.getColorFromStyle)(V,W).getHex());re&&le&&re.resi===le.resi&&(s(ze,B,!0,le,re,oe,R,Z,Ee),oe=re,le=null,re=null,Ue.push(ee))}}_e&&(Ae?Oe=new A.Vector3().addVectors(R,Ae).multiplyScalar(.5):Oe=new A.Vector3(R.x,R.y,R.z),x.GLDraw.drawCylinder(Pe,Oe,_e,r,p.CC.color(_e.color),0,2),s(ze,B,!0,Ae,Me,oe,R,Z,Ee),Ue.push(ee)),ue(!1);var De=function(Re,D){if(Re.style.cartoon.gapcutoff&&Re.style.cartoon.gapcutoff==D.style.cartoon.gapcutoff){let de=Re.style.cartoon.gapcutoff,H=D.resi-Re.resi;if(H>0&&H<de){let te=.25,pe=D.x-Re.x,ke=D.y-Re.y,je=D.z-Re.z,Ve=Math.sqrt(pe*pe+ke*ke+je*je),Qe=Ve/(2*H),_t=new A.Vector3(Re.x,Re.y,Re.z),et=Ve/Qe,$e=new A.Vector3((D.x-Re.x)/et,(D.y-Re.y)/et,(D.z-Re.z)/et);_t.add({x:$e.x/2,y:$e.y/2,z:$e.z/2});let Je=_t.clone().add($e);$e.multiplyScalar(2);let gt=(0,M.extend)({},Re);for(var ce=0;ce<H;ce++){gt.resi+=1;let ft=Ge(gt,gt.style.cartoon);x.GLDraw.drawCylinder(Pe,_t,Je,te,p.CC.color(ft),x.CAP.FLAT,x.CAP.FLAT),_t.add($e),Je.add($e)}ue(!1)}}};for(let Re of fe)De(Re[0],Re[1])}},"./src/index.ts":(K,C,d)=>{d.r(C),d.d(C,{CAP:()=>A.CAP,CC:()=>A.CC,CONTEXTS_PER_VIEWPORT:()=>A.CONTEXTS_PER_VIEWPORT,Color:()=>A.Color,CustomLinear:()=>A.CustomLinear,Cylinder:()=>A.Cylinder,GLDraw:()=>A.GLDraw,GLModel:()=>A.GLModel,GLShape:()=>A.GLShape,GLViewer:()=>A.GLViewer,GLVolumetricRender:()=>A.GLVolumetricRender,Gradient:()=>A.Gradient,GradientType:()=>A.GradientType,Label:()=>A.Label,LabelCount:()=>A.LabelCount,MarchingCube:()=>A.MarchingCube,MarchingCubeInitializer:()=>A.MarchingCubeInitializer,Matrix3:()=>A.Matrix3,Matrix4:()=>A.Matrix4,Parsers:()=>A.Parsers,PausableTimer:()=>A.PausableTimer,PointGrid:()=>A.PointGrid,ProteinSurface:()=>A.ProteinSurface,Quaternion:()=>A.Quaternion,ROYGB:()=>A.ROYGB,RWB:()=>A.RWB,Ray:()=>A.Ray,Sinebow:()=>A.Sinebow,Sphere:()=>A.Sphere,SurfaceType:()=>A.SurfaceType,Triangle:()=>A.Triangle,Vector2:()=>A.Vector2,Vector3:()=>A.Vector3,VolumeData:()=>A.VolumeData,adjustVolumeStyle:()=>A.adjustVolumeStyle,applyPartialCharges:()=>A.applyPartialCharges,autoinit:()=>A.autoinit,autoload:()=>A.autoload,base64ToArray:()=>A.base64ToArray,bondLength:()=>A.bondLength,builtinColorSchemes:()=>A.builtinColorSchemes,builtinGradients:()=>A.builtinGradients,chains:()=>A.chains,clamp:()=>A.clamp,conversionMatrix3:()=>A.conversionMatrix3,createStereoViewer:()=>A.createStereoViewer,createViewer:()=>A.createViewer,createViewerGrid:()=>A.createViewerGrid,deepCopy:()=>A.deepCopy,degToRad:()=>A.degToRad,download:()=>A.download,drawCartoon:()=>A.drawCartoon,elementColors:()=>A.elementColors,extend:()=>A.extend,get:()=>A.get,getAtomProperty:()=>A.getAtomProperty,getColorFromStyle:()=>A.getColorFromStyle,getElement:()=>A.getElement,getExtent:()=>A.getExtent,getGradient:()=>A.getGradient,getPropertyRange:()=>A.getPropertyRange,getbin:()=>A.getbin,htmlColors:()=>A.htmlColors,inflateString:()=>A.inflateString,isEmptyObject:()=>A.isEmptyObject,isNumeric:()=>A.isNumeric,makeFunction:()=>A.makeFunction,mergeGeos:()=>A.mergeGeos,normalizeValue:()=>A.normalizeValue,partialCharges:()=>A.partialCharges,processing_autoinit:()=>A.processing_autoinit,residues:()=>A.residues,setBondLength:()=>A.setBondLength,setSyncSurface:()=>A.setSyncSurface,specStringToObject:()=>A.specStringToObject,splitMesh:()=>A.splitMesh,ssColors:()=>A.ssColors,subdivide_spline:()=>A.subdivide_spline,syncSurface:()=>A.syncSurface,viewers:()=>A.viewers});var A=d("./src/3Dmol.ts");window&&(window.$3Dmol=C)},"./src/parsers/BCIF.ts":(K,C,d)=>{d.r(C),d.d(C,{BCIF:()=>m});var A=d("./src/utilities.ts"),S=d("./src/parsers/utils/computeSecondaryStructure.ts"),w=d("./src/parsers/utils/processSymmetries.ts"),O=d("./src/parsers/cifutils/category.ts"),p=d("./src/parsers/utils/assignPDBBonds.ts"),x=d("./src/WebGL/index.ts"),M=d("./src/parsers/utils/isEmpty.ts"),v=d("./src/vendor/mmtf.js");class b{constructor(e){if(this.C={},e){let t=e.getField("comp_id"),n=e.getField("atom_id_1"),o=e.getField("atom_id_2"),h=e.getField("value_order");for(let f=0;f<t.length;f++){let i=t[f],s=n[f],a=o[f],c=h[f],u=1;c=="doub"?u=2:c=="trip"&&(u=3),this.C[i]==null&&(this.C[i]={}),this.C[i][s]==null&&(this.C[i][s]={}),this.C[i][a]==null&&(this.C[i][a]={}),this.C[i][s][a]=u,this.C[i][a][s]=u}}}order(e,t,n){return this.C[e]!==void 0&&this.C[e][t]!==void 0&&this.C[e][t][n]!==void 0?this.C[e][t][n]:0}}class _{constructor(e){if(this.C=[],e){let t=e.getField("conn_type_id"),n=e.getField("ptnr1_label_asym_id"),o=e.getField("ptnr1_label_seq_id"),h=e.getField("ptnr1_label_comp_id"),f=e.getField("ptnr1_label_atom_id"),i=e.getField("ptnr2_label_asym_id"),s=e.getField("ptnr2_label_seq_id"),a=e.getField("ptnr2_label_comp_id"),c=e.getField("ptnr2_label_atom_id"),u=e.getField("pdbx_value_order");for(let E=0;E<t.length;E++)if(t[E]=="disulf"||t[E]=="covale"){let T=u?u[E]==""?1:parseInt(u[E]):1;this.C.push([[n[E],o[E],h[E],f[E]],[i[E],s[E],a[E],c[E]],T])}}}}class g{constructor(){this.R={}}add(e){this.R[e.lchain]==null&&(this.R[e.lchain]={}),this.R[e.lchain][e.lresi]==null&&(this.R[e.lchain][e.lresi]={}),this.R[e.lchain][e.lresi][e.lresn]==null&&(this.R[e.lchain][e.lresi][e.lresn]=[]),this.R[e.lchain][e.lresi][e.lresn].push(e),this.R[e.lchain][e.lresi][e.lresn][e.atom]=e}geta([e,t,n,o]){if(this.R[e]!==void 0&&this.R[e][t]!==void 0&&this.R[e][t][n]!==void 0)return this.R[e][t][n][o]}setBonds(e,t){for(let n in this.R)for(let o in this.R[n])for(let h in this.R[n][o]){let f=this.R[n][o][h];for(let i=0;i<f.length;i++)for(let s=i+1;s<f.length;s++){let a=f[i],c=f[s],u=e.order(h,a.atom,c.atom);a.altLoc!=c.altLoc&&a.altLoc!=""&&c.altLoc!=""&&(u=0),u>0&&(a.bonds.push(c.index),c.bonds.push(a.index),a.bondOrder.push(u),c.bondOrder.push(u))}}for(let n of t.C){let o=n[0],h=n[1],f=n[2],i=this.geta(o),s=this.geta(h);i!=null&&s!=null&&(i.bonds.push(s.index),s.bonds.push(i.index),i.bondOrder.push(f),s.bondOrder.push(f))}}}function m(r,e){var t=!e.keepH,n=e.altLoc?e.altLoc:"A",o=!e.noComputeSecondaryStructure;const h=!e.doAssembly,f=e.assignBonds===void 0?!0:e.assignBonds;if(typeof r=="string")try{r=(0,A.base64ToArray)(r)}catch{r=new TextEncoder().encode(r)}else r=new Uint8Array(r);var i=v.decodeMsgpack(r);i==31&&(r=(0,A.inflateString)(r,!1),i=v.decodeMsgpack(r));var s=[],a=s.modelData=[],c=i.dataBlocks.length;if(c==0)return s;e.multimodel||(c=1);for(let u=0;u<c;u++){let E=s.length;const T=[];a.push({symmetries:[]}),s.push([]);const L=i.dataBlocks[u],P=Object.create(null);for(const Se of L.categories)P[Se.name.substr(1)]=(0,O.Category)(Se);let I={},z=P.struct_conf;if(z){let Se=z.getField("conf_type_id"),Te=z.getField("beg_label_asym_id"),Ge=z.getField("beg_label_seq_id"),Ne=z.getField("end_label_seq_id");for(let k=0;k<Se.length;k++)if(Se[k].startsWith("H")){let Z=Te[k],Y=Ge[k],ue=Ne[k];Z in I||(I[Z]={}),I[Z][Y]="h1";for(let fe=Y+1;fe<ue;fe++)I[Z][fe]="h";I[Z][ue]="h2"}}let B=P.struct_sheet_range;if(B){let Se=B.getField("id"),Te=B.getField("beg_label_asym_id"),Ge=B.getField("beg_label_seq_id"),Ne=B.getField("end_label_seq_id");for(let k=0;k<Se.length;k++){let Z=Te[k],Y=Ge[k],ue=Ne[k];Z in I||(I[Z]={}),I[Z][Y]="s1";for(let fe=Y+1;fe<ue;fe++)I[Z][fe]="s";I[Z][ue]="s2"}}let F=P.pdbx_struct_oper_list,W=F.getField("id");if(W&&!h){let Se=F.getField("matrix[1][1]"),Te=F.getField("matrix[1][2]"),Ge=F.getField("matrix[1][3]"),Ne=F.getField("matrix[2][1]"),k=F.getField("matrix[2][2]"),Z=F.getField("matrix[2][3]"),Y=F.getField("matrix[3][1]"),ue=F.getField("matrix[3][2]"),fe=F.getField("matrix[3][3]"),Ee=F.getField("vector[1]"),we=F.getField("vector[2]"),N=F.getField("vector[3]");for(let ae=0;ae<W.length;ae++){const ve=new x.Matrix4(Se[ae],Te[ae],Ge[ae],Ee[ae],Ne[ae],k[ae],Z[ae],we[ae],Y[ae],ue[ae],fe[ae],N[ae]);a[a.length-1].symmetries.push(ve)}}let U=new b(P.chem_comp_bond),R=new g,V=new _(P.struct_conn),q=P.atom_site,ee=q.rowCount,se=q.getField("group_PDB"),ie=q.getField("Cartn_x"),le=q.getField("Cartn_y"),re=q.getField("Cartn_z"),oe=q.getField("auth_asym_id"),Ae=q.getField("label_asym_id"),Me=q.getField("auth_seq_id"),Oe=q.getField("label_seq_id"),_e=q.getField("auth_comp_id"),Q=q.getField("label_comp_id"),me=q.getField("auth_atom_id"),Ce=q.getField("label_atom_id"),Pe=q.getField("type_symbol"),We=q.getField("B_iso_or_equiv"),Ue=q.getField("id"),ze=q.getField("label_alt_id"),Be=q.getField("pdbx_PDB_model_num"),Ie=Be?Be[0]:0;for(let Se=0;Se<ee;Se++){if(se!==void 0&&se[Se]==="TER")continue;if(Be&&Be[Se]!=Ie)if(Ie=Be[Se],e.multimodel)e.onemol||(s.push([]),a.push(a[a.length-1]),Ie=Be[Se],R.setBonds(U,V),R=new g);else break;const Te={};Te.x=ie[Se],Te.y=le[Se],Te.z=re[Se],Te.chain=oe?oe[Se]:Ae?Ae[Se]:void 0,Te.lchain=Ae?Ae[Se]:void 0,Te.resi=Me?Me[Se]:Oe?Oe[Se]:void 0,Te.lresi=Oe?Oe[Se]:void 0,Te.resn=_e?_e[Se].trim():Q?Q[Se].trim():void 0,Te.lresn=Q?Q[Se].trim():void 0,Te.atom=me?me[Se].replace(/"/gm,""):Ce?Ce[Se].replace(/"/gm,""):void 0,Te.icode=ze?ze[Se]:void 0,Te.altLoc=Te.icode,Te.hetflag=!se||se[Se]==="HETA"||se[Se]==="HETATM";let Ge="X";Pe&&(Ge=Pe[Se].replace(/\(?\+?\d+.*/,"")),Te.elem=Ge[0].toUpperCase()+Ge.substring(1,2).toLowerCase(),We&&(Te.b=We[Se]),!(t&&Te.elem=="H")&&(Te.altLoc!=""&&Te.altLoc!=n&&n!="*"||(Te.bonds=[],Te.ss="c",Te.serial=Ue[Se],Te.model=Ie,Te.bondOrder=[],Te.properties={},Te.index=s[s.length-1].length,T[Te.serial]=[s.length,Te.index],s[s.length-1].push(Te),R.add(Te)))}if(R.setBonds(U,V),!(0,M.isEmpty)(I))for(let Se=E;Se<s.length;Se++){let Te=s[Se];for(let Ge=0;Ge<Te.length;Ge++){const Ne=Te[Ge];if(Ne!==void 0&&Ne.lchain in I&&Ne.lresi in I[Ne.lchain]){const k=I[Ne.lchain][Ne.lresi];Ne.ss=k[0],k.length>1&&(k[1]=="1"?Ne.ssbegin=!0:k[1]=="2"&&(Ne.ssend=!0))}}}e.multimodel&&u<c-1&&(e.onemol||(s.push([]),a.push({symmetries:[]})))}for(let u=0;u<s.length;u++)f&&!(e.duplicateAssemblyAtoms&&!e.dontConnectDuplicatedAtoms)&&(0,p.assignPDBBonds)(s[u],e),o&&(0,S.computeSecondaryStructure)(s[u],e.hbondCutoff),(0,w.processSymmetries)(a[u].symmetries,s[u],e,a[u].cryst),e.duplicateAssemblyAtoms&&!e.dontConnectDuplicatedAtoms&&f&&(0,p.assignPDBBonds)(s[u],e);return s}},"./src/parsers/CDJSON.ts":(K,C,d)=>{d.r(C),d.d(C,{CDJSON:()=>A});function A(S,w){var O=[[]];typeof S=="string"&&(S=JSON.parse(S));for(var p=S.m,x=p[0].a,M=p[0].b,v=p[0].s,b=w!==void 0&&w.parseStyle!==void 0?w.parseStyle:v!==void 0,_=O[O.length-1].length,g=0;g<x.length;g++){var m=x[g],r={};r.id=m.i,r.x=m.x,r.y=m.y,r.z=m.z||0,r.bonds=[],r.bondOrder=[];var e=m.l||"C";r.elem=e[0].toUpperCase()+e.substring(1).toLowerCase(),r.serial=O[O.length-1].length,b&&(r.style=v[m.s||0]),O[O.length-1].push(r)}for(let t=0;t<M.length;t++){let n=M[t],o=n.b+_,h=n.e+_,f=n.o||1,i=O[O.length-1][o],s=O[O.length-1][h];i.bonds.push(h),i.bondOrder.push(f),s.bonds.push(o),s.bondOrder.push(f)}return O}},"./src/parsers/CIF.ts":(K,C,d)=>{d.r(C),d.d(C,{CIF:()=>x});var A=d("./src/parsers/utils/computeSecondaryStructure.ts"),S=d("./src/parsers/utils/processSymmetries.ts"),w=d("./src/WebGL/index.ts"),O=d("./src/parsers/utils/assignPDBBonds.ts");const p=function(M,v,b,_){return new w.Vector3(v,b,_).applyMatrix3(M)};function x(M,v={}){const b=[],_=!v.doAssembly,g=b.modelData=[],m=v.assignBonds===void 0?!0:v.assignBonds;function r(f,i){const s=[];let a=0,c=0;for(;c<f.length;){for(;f.substring(c,c+i.length)!==i&&c<f.length;)if(f[c]==="'"){for(c++;c<f.length&&f[c]!=="'";)c++;for(;f.substring(c,c+i.length)!==i&&c<f.length;)c++}else if(f[c]==='"'){for(c++;c<f.length&&f[c]!=='"';)c++;c++}else c++;s.push(f.substring(a,c)),a=c=c+i.length}return s}const e=M.split(/\r?\n|\r/),t=[];let n=!1;for(let f=0;f<e.length;f++){var o=e[f].split("#")[0];if(n?o[0]===";"&&(n=!1):o[0]===";"&&(n=!0),n||o!==""){if(!n&&(o=o.trim(),o[0]==="_")){const i=o.split(/\s/)[0].indexOf(".");if(i>-1){let s=o.split("");s[i]="_",o=s.join(""),o=o.substring(0,i)+"_"+o.substring(i+1)}}t.push(o)}}let h=0;for(;h<t.length;){for(;!t[h].startsWith("data_")||t[h]==="data_global";)h++;h++;const f={};for(;h<t.length&&!t[h].startsWith("data_");)if(t[h][0]===void 0)h++;else if(t[h][0]==="_"){const c=t[h].split(/\s/)[0].toLowerCase(),u=f[c]=f[c]||[],E=t[h].substring(t[h].indexOf(c)+c.length);if(E==="")if(h++,t[h][0]===";"){let T=t[h].substring(1);for(h++;t[h]!==";";)T=T+`
`+t[h],h++;u.push(T)}else u.push(t[h]);else u.push(E.trim());h++}else if(t[h].substring(0,5)==="loop_"){h++;const c=[];for(;t[h]===""||t[h][0]==="_";){if(t[h]!==""){let E=t[h].split(/\s/)[0].toLowerCase(),T=f[E]=f[E]||[];c.push(T)}h++}let u=0;for(;h<t.length&&t[h][0]!=="_"&&!t[h].startsWith("loop_")&&!t[h].startsWith("data_");){let E=r(t[h]," ");for(let T=0;T<E.length;T++)E[T]!==""&&(c[u].push(E[T]),u=(u+1)%c.length);h++}}else h++;g.push({symmetries:[]}),b.push([]);const i=f._atom_site_id!==void 0?f._atom_site_id.length:f._atom_site_label.length;let s;if(f._cell_length_a!==void 0){const c=parseFloat(f._cell_length_a),u=parseFloat(f._cell_length_b),E=parseFloat(f._cell_length_c),T=parseFloat(f._cell_angle_alpha)||90,L=parseFloat(f._cell_angle_beta)||90,P=parseFloat(f._cell_angle_gamma)||90;s=(0,w.conversionMatrix3)(c,u,E,T,L,P),g[g.length-1].cryst={a:c,b:u,c:E,alpha:T,beta:L,gamma:P}}for(let c=0;c<i;c++){if(f._atom_site_group_pdb!==void 0&&f._atom_site_group_pdb[c]==="TER")continue;const u={};if(f._atom_site_cartn_x!==void 0)u.x=parseFloat(f._atom_site_cartn_x[c]),u.y=parseFloat(f._atom_site_cartn_y[c]),u.z=parseFloat(f._atom_site_cartn_z[c]);else{const T=p(s,parseFloat(f._atom_site_fract_x[c]),parseFloat(f._atom_site_fract_y[c]),parseFloat(f._atom_site_fract_z[c]));u.x=T.x,u.y=T.y,u.z=T.z}u.chain=f._atom_site_auth_asym_id?f._atom_site_auth_asym_id[c]:f._atom_site_label_asym_id?f._atom_site_label_asym_id[c]:void 0,u.lchain=f._atom_site_label_asym_id?f._atom_site_label_asym_id[c]:void 0,u.resi=f._atom_site_auth_seq_id?parseInt(f._atom_site_auth_seq_id[c]):f._atom_site_label_seq_id?f._atom_site_label_seq_id[c]:void 0,u.resn=f._atom_site_auth_comp_id?f._atom_site_auth_comp_id[c].trim():f._atom_site_label_comp_id?f._atom_site_label_comp_id[c].trim():void 0,u.atom=f._atom_site_auth_atom_id?f._atom_site_auth_atom_id[c].replace(/"/gm,""):f._atom_site_label_atom_id?f._atom_site_label_atom_id[c].replace(/"/gm,""):void 0,u.hetflag=!f._atom_site_group_pdb||f._atom_site_group_pdb[c]==="HETA"||f._atom_site_group_pdb[c]==="HETATM",f._atom_site_b_iso_or_equiv&&(u.b=parseFloat(f._atom_site_b_iso_or_equiv[c]));let E="X";f._atom_site_type_symbol?E=f._atom_site_type_symbol[c].replace(/\(?\+?\d+.*/,""):f._atom_site_label&&(E=f._atom_site_label[c].split("_")[0].replace(/\(?\d+.*/,"")),u.elem=E[0].toUpperCase()+E.substring(1,2).toLowerCase(),u.bonds=[],u.ss="c",u.serial=c,u.bondOrder=[],u.properties={},b[b.length-1].push(u)}if(f._pdbx_struct_oper_list_id!==void 0&&!_)for(let c=0;c<f._pdbx_struct_oper_list_id.length;c++){const u=parseFloat(f["_pdbx_struct_oper_list_matrix[1][1]"][c]),E=parseFloat(f["_pdbx_struct_oper_list_matrix[1][2]"][c]),T=parseFloat(f["_pdbx_struct_oper_list_matrix[1][3]"][c]),L=parseFloat(f["_pdbx_struct_oper_list_vector[1]"][c]),P=parseFloat(f["_pdbx_struct_oper_list_matrix[2][1]"][c]),I=parseFloat(f["_pdbx_struct_oper_list_matrix[2][2]"][c]),z=parseFloat(f["_pdbx_struct_oper_list_matrix[2][3]"][c]),B=parseFloat(f["_pdbx_struct_oper_list_vector[2]"][c]),F=parseFloat(f["_pdbx_struct_oper_list_matrix[3][1]"][c]),W=parseFloat(f["_pdbx_struct_oper_list_matrix[3][2]"][c]),U=parseFloat(f["_pdbx_struct_oper_list_matrix[3][3]"][c]),R=parseFloat(f["_pdbx_struct_oper_list_vector[3]"][c]),V=new w.Matrix4(u,E,T,L,P,I,z,B,F,W,U,R);g[g.length-1].symmetries.push(V)}const a=function(c){const u=c.match("-");c=c.replace(/[-xyz]/g,"");const E=c.split("/");let T,L;return E[1]===void 0?L=1:L=parseInt(E[1]),E[0]===""?T=1:T=parseInt(E[0]),T/L*(u?-1:1)};if(f._symmetry_equiv_pos_as_xyz!==void 0&&!_)for(let c=0;c<f._symmetry_equiv_pos_as_xyz.length;c++){const E=f._symmetry_equiv_pos_as_xyz[c].replace(/["' ]/g,"").split(",").map(function(I){return I.replace(/-/g,"+-")});let T=new w.Matrix4(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1);for(let I=0;I<3;I++){const z=E[I].split("+");for(let B=0;B<z.length;B++){const F=z[B];if(F==="")continue;const W=a(F);F.match("x")?T.elements[I+0]=W:F.match("y")?T.elements[I+4]=W:F.match("z")?T.elements[I+8]=W:T.elements[I+12]=W}}const L=s.getMatrix4(),P=new w.Matrix4().getInverse(L,!0);T=new w.Matrix4().multiplyMatrices(T,P),T=new w.Matrix4().multiplyMatrices(L,T),g[g.length-1].symmetries.push(T)}}for(let f=0;f<b.length;f++)m&&!(v.duplicateAssemblyAtoms&&!v.dontConnectDuplicatedAtoms)&&(0,O.assignPDBBonds)(b[f],v),(0,A.computeSecondaryStructure)(b[f],v.hbondCutoff),(0,S.processSymmetries)(g[f].symmetries,b[f],v,g[f].cryst),v.duplicateAssemblyAtoms&&!v.dontConnectDuplicatedAtoms&&m&&(0,O.assignPDBBonds)(b[f],v);return b}},"./src/parsers/CUBE.ts":(K,C,d)=>{d.r(C),d.d(C,{CUBE:()=>O});var A=d("./src/WebGL/index.ts"),S=d("./src/parsers/utils/assignBonds.ts"),w=d("./src/parsers/utils/anumToSymbol.ts");function O(p,x){x=x||{};const M=[[]];let v=p.split(/\r?\n/);const b=x.assignBonds===void 0?!0:x.assignBonds;if(v.length<6)return M;let _=v[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");const g=Math.abs(parseFloat(_[0]));let m={origin:void 0,size:void 0,unit:void 0,matrix4:void 0,matrix:void 0};const r=m.origin=new A.Vector3(parseFloat(_[1]),parseFloat(_[2]),parseFloat(_[3]));_=v[3].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),_=v[3].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");const e=_[0]>0?.529177:1;r.multiplyScalar(e);const t=Math.abs(_[0]),n=new A.Vector3(parseFloat(_[1]),parseFloat(_[2]),parseFloat(_[3])).multiplyScalar(e);_=v[4].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");const o=Math.abs(_[0]),h=new A.Vector3(parseFloat(_[1]),parseFloat(_[2]),parseFloat(_[3])).multiplyScalar(e);_=v[5].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");const f=Math.abs(_[0]),i=new A.Vector3(parseFloat(_[1]),parseFloat(_[2]),parseFloat(_[3])).multiplyScalar(e);if(m.size={x:t,y:o,z:f},m.unit=new A.Vector3(n.x,h.y,i.z),n.y!=0||n.z!=0||h.x!=0||h.z!=0||i.x!=0||i.y!=0){m.matrix4=new A.Matrix4(n.x,h.x,i.x,0,n.y,h.y,i.y,0,n.z,h.z,i.z,0,0,0,0,1);let L=new A.Matrix4().makeTranslation(r.x,r.y,r.z);m.matrix4=m.matrix4.multiplyMatrices(L,m.matrix4),m.matrix=m.matrix4.matrix3FromTopLeft(),m.origin=new A.Vector3(0,0,0),m.unit=new A.Vector3(1,1,1)}M.modelData=[{cryst:m}],v=v.splice(6,g);for(var s=M[M.length-1].length,a=s+v.length,c=s;c<a;++c){var u={};u.serial=c;var E=v[c-s],T=E.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");u.elem=w.anumToSymbol[T[0]],u.x=parseFloat(T[2])*e,u.y=parseFloat(T[3])*e,u.z=parseFloat(T[4])*e,u.hetflag=!0,u.bonds=[],u.bondOrder=[],u.properties={},M[M.length-1].push(u)}if(b)for(let L=0;L<M.length;L++)(0,S.assignBonds)(M[L],x);return M}},"./src/parsers/GRO.ts":(K,C,d)=>{d.r(C),d.d(C,{GRO:()=>w});var A=d("./src/parsers/utils/assignPDBBonds.ts"),S=d("./src/parsers/utils/atomNameToElem.ts");function w(O,p){const x=[],M=O.split(/\r?\n|\r/);for(;M.length>0;){const v=parseInt(M[1]);if(M.length<3||isNaN(v)||v<=0||M.length<v+3)break;const _=[];x.push(_);let g=2;const m=_.length,r=m+v;for(let e=m;e<r;e++){const t=M[g++],n={};n.serial=e,n.atom=t.slice(10,15).trim(),n.elem=(0,S.atomNameToElem)(n.atom,!0),n.x=10*parseFloat(t.slice(20,28)),n.y=10*parseFloat(t.slice(28,36)),n.z=10*parseFloat(t.slice(36,44)),n.resi=parseInt(t.slice(0,5)),n.resn=t.slice(5,10).trim(),n.bonds=[],n.bondOrder=[],n.properties={},t.length>44&&(n.dx=10*parseFloat(t.slice(44,52)),n.dy=10*parseFloat(t.slice(52,60)),n.dz=10*parseFloat(t.slice(60,68))),_[e]=n}if(M.length<=g+3){const t=M[g++].trim().split(/\s+/);if(t.length===3){for(let n=0;n<3;n++)t[n]=(parseFloat(t[n])*10).toString();x.box=t}}M.splice(0,++g)}for(let v=0;v<x.length;v++)(0,A.assignPDBBonds)(x[v],p);return x}},"./src/parsers/LAMMPSTRJ.ts":(K,C,d)=>{d.r(C),d.d(C,{LAMMPSTRJ:()=>w});var A=d("./src/parsers/utils/assignBonds.ts");const S={id:"serial",type:"atom",element:"elem",q:"charge",radius:"radius",x:"x",xu:"x",xs:"x",xsu:"x",y:"y",yu:"y",ys:"y",ysu:"y",z:"z",zu:"z",zs:"z",zsu:"z"};function w(O,p){const x=[],M=O.split(/\r?\n|\r/);let v=0,b=0,_=0;for(;_<M.length-9;){for(var g=_;g<M.length;g++)if(M[g].match(/ITEM: NUMBER OF ATOMS/)&&(b=parseInt(M[g+1])),M[g].match(/ITEM: ATOMS/)){v=g+1;break}const m=M[v-1].replace("ITEM: ATOMS ","").split(" ");x.push([]);for(let r=v;r<v+b;r++){const e={},t={},n=M[r].split(" ");for(let o=0;o<n.length;o++){const h=S[m[o]];h!==void 0&&(h==="serial"?e[h]=parseInt(n[o]):h==="x"||h==="y"||h==="z"?e[h]=parseFloat(n[o]):h==="charge"||h==="radius"?t[h]=parseFloat(n[o]):e[h]=n[o]),e.properties=t,e.bonds=[],e.bondOrder=[]}x[x.length-1][r-v]=e}_=v+b-1}if(p.assignBonds)for(let m=0;m<x.length;m++)(0,A.assignBonds)(x[m],p);return x}},"./src/parsers/MMTF.ts":(K,C,d)=>{d.r(C),d.d(C,{MMTFparser:()=>b});var A=d("./src/utilities.ts"),S=d("./src/WebGL/index.ts"),w=d("./src/parsers/utils/computeSecondaryStructure.ts"),O=d("./src/parsers/utils/processSymmetries.ts"),p=d("./src/vendor/mmtf.js"),x=function(_){return String.fromCharCode.apply(null,_).replace(/\0/g,"")},M=function(_){return _==0||_==2||_==4?"h":_==3?"s":"c"};let v=new Set(["D-SACCHARIDE","D-SACCHARIDE 1,4 AND 1,4 LINKING","D-SACCHARIDE 1,4 AND 1,6 LINKING","L-SACCHARIDE","L-SACCHARIDE 1,4 AND 1,4 LINKING","L-SACCHARIDE 1,4 AND 1,6 LINKING","NON-POLYMER","OTHER","PEPTIDE-LIKE","SACCHARIDE"]);function b(_,g){var m=!g.keepH,r=g.altLoc?g.altLoc:"A",e=!!g.noSecondaryStructure,t=!g.noComputeSecondaryStructure,n=!g.doAssembly,o=g.assemblyIndex?g.assemblyIndex:0;typeof _=="string"?_=(0,A.base64ToArray)(_):_=new Uint8Array(_);var h=p.decode(_),f=[[]],i=f.modelData=[],s=0,a=0,c=0,u=h.secStructList,E=h.bFactorList,T=h.altLocList,L=h.occupancyList,P=h.bondAtomList,I=h.bondOrderList,z=h.numModels;if(z==0)return f;g.multimodel||(z=1);var B,F,W,U,R,V,q=[];if(!n&&h.bioAssemblyList&&h.bioAssemblyList.length>0){var ee=h.bioAssemblyList[o].transformList;for(B=0,V=ee.length;B<V;B++){var se=new S.Matrix4(ee[B].matrix);se.transpose(),q.push(se)}}var ie=null;if(h.unitCell){var le=h.unitCell;ie={a:le[0],b:le[1],c:le[2],alpha:le[3],beta:le[4],gamma:le[5]}}let re=[];h.entityList.forEach(de=>{de.chainIndexList.forEach(H=>{re[H]=de.type=="polymer"})});var oe=0;for(R=0;R<z;R++){var Ae=h.chainsPerModel[R],Me=f[f.length-1],Oe=[];for(i.push({symmetries:q,cryst:ie}),B=0;B<Ae;++B){var _e=h.groupsPerChain[s],Q=x(h.chainIdList.subarray(s*4,s*4+4));h.chainNameList&&(Q=x(h.chainNameList.subarray(s*4,s*4+4)));var me=a,Ce="";for(F=0;F<_e;++F){var Pe=h.groupList[h.groupTypeList[a]],We=Pe.atomNameList.length,Ue=0,ze=!1,Be=!1;if(u){Ue=u[a];var Ie=M(Ue);(a==0||Ie!=Ce)&&(ze=!0),Ce=Ie;var Se=a+1;(Se>=u.length||M(u[Se]!=Ie))&&(Be=!0)}var Te=h.groupIdList[a],Ge=Pe.groupName;let de=Pe.chemCompType;var Ne=c;let H=v.has(de)||!re[s];for(W=0;W<We;++W){var k=Pe.elementList[W];if(m&&k=="H"){c+=1;continue}var Z="";E&&(Z=E[c]);var Y="";T&&T[c]&&(Y=String.fromCharCode(T[c]));var ue="";if(L&&(ue=L[c]),Y!=""&&Y!=r&&r!="*"){c+=1;continue}var fe=h.atomIdList[c],Ee=Pe.atomNameList[W],we=0;Pe.atomChargeList&&(we=Pe.atomChargeList[W]);var N=h.xCoordList[c],ae=h.yCoordList[c],ve=h.zCoordList[c];Oe[c]=Me.length,Me.push({resn:Ge,x:N,y:ae,z:ve,elem:k,hetflag:H,chain:Q,resi:Te,icode:Y,rescode:Te+(Y!=" "?"^"+Y:""),serial:fe,altLoc:Y,index:c,atom:Ee,bonds:[],ss:M(Ue),ssbegin:ze,ssend:Be,bondOrder:[],properties:{charge:we,occupancy:ue},b:Z}),c+=1}var Le=Pe.bondAtomList;for(W=0,U=Pe.bondOrderList.length;W<U;++W){var ne=Ne+Le[W*2],ye=Ne+Le[W*2+1],j=Pe.bondOrderList[W],De=Oe[ne],Re=Oe[ye],D=Me[De],ce=Me[Re];D&&ce&&(D.bonds.push(Re),D.bondOrder.push(j),ce.bonds.push(De),ce.bondOrder.push(j))}a+=1}for(a=me,F=0;F<_e;++F)a+=1;s+=1}if(P)for(let de=oe,H=P.length;de<H;de+=2){let te=P[de],pe=P[de+1],ke=I?I[de/2]:1;if(te>=c){oe=de;break}let je=Oe[te],Ve=Oe[pe],Qe=Me[je],_t=Me[Ve];Qe&&_t&&(Qe.bonds.push(Ve),Qe.bondOrder.push(ke),_t.bonds.push(je),_t.bondOrder.push(ke))}g.multimodel&&(g.onemol||f.push([]))}if(!n)for(let de=0;de<f.length;de++)(0,O.processSymmetries)(i[de].symmetries,f[de],g,i[de].cryst);return t&&!e&&(0,w.computeSecondaryStructure)(f,g.hbondCutoff),f}},"./src/parsers/MOL2.ts":(K,C,d)=>{d.r(C),d.d(C,{MOL2:()=>S});let A={"C.1":"C",C1:"C","C.2":"C",C2:"C","C.3":"C",C3:"C","C.ar":"C",Car:"C","C.cat":"C",Ccat:"C","H.spc":"H",Hspc:"H","H.t3p":"H",Ht3p:"H","N.1":"N",N1:"N","N.2":"N",N2:"N","N.3":"N",N3:"N","N.4":"N",N4:"N","N.am":"N",Nam:"N","N.ar":"N",Nar:"N","N.p13":"N",Np13:"N","O.2":"O",O2:"O","O.3":"O",O3:"O","O.co2":"O",Oco2:"O","O.spc":"O",Ospc:"O","O.t3p":"O",Ot3p:"O","P.3":"P",P3:"P","S.2":"S",S2:"S","S.3":"S",S3:"S","S.o":"S",So:"S","S.o2":"S",So2:"S"};function S(w,O){var p=[[]],x=!1;typeof O.keepH<"u"&&(x=!O.keepH);var M=w.search(/@<TRIPOS>MOLECULE/),v=w.search(/@<TRIPOS>ATOM/);if(M==-1||v==-1)return p;for(var b=w.substring(M).split(/\r?\n|\r/);b.length>0;){var _=[],g=b[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),m=parseInt(g[0]),r=0;g.length>1&&(r=parseInt(g[1]));var e=4,t;for(t=3;t<b.length;t++)if(b[t]=="@<TRIPOS>ATOM"){e=t+1;break}var n=p[p.length-1].length,o=n+m,h;for(t=n;t<o;t++){h=b[e++],g=h.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var f={},i=g[5];if(A[i]!==void 0?i=A[i]:(i=i.split(".")[0],i=i[0].toUpperCase()+i.substring(1).toLowerCase()),f.atom=g[1],f.elem=i,!(f.elem=="H"&&x)){var s=p[p.length-1].length,a=parseInt(g[0]);f.serial=a,f.x=parseFloat(g[2]),f.y=parseFloat(g[3]),f.z=parseFloat(g[4]),f.atom=g[5];var c=parseFloat(g[8]);f.index=s,f.bonds=[],f.bondOrder=[],f.properties={charge:c,partialCharge:c},_[a]=s,p[p.length-1].push(f)}}for(var u=!1;e<b.length;)if(b[e++]=="@<TRIPOS>BOND"){u=!0;break}if(u&&r)for(t=0;t<r;t++){h=b[e++],g=h.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var E=parseInt(g[1]),T=p[p.length-1][_[E]],L=parseInt(g[2]),P=p[p.length-1][_[L]],I=parseInt(g[3]);isNaN(I)&&(I=1),T!==void 0&&P!==void 0&&(T.bonds.push(_[L]),T.bondOrder.push(I),P.bonds.push(_[E]),P.bondOrder.push(I))}if(O.multimodel){O.onemol||p.push([]),b.splice(0,e),w=b.join(`
`);continue}else break}return p}},"./src/parsers/PDB.ts":(K,C,d)=>{d.r(C),d.d(C,{PDB:()=>S});var A=d("./src/parsers/utils/getSinglePDB.ts");function S(w,O){O=O||{};var p=[],x={};p.modelData=[];for(var M=w.split(/\r?\n|\r/);M.length>0;){var v=(0,A.getSinglePDB)(M,O,x),b=v[0],_=v[1];if(M=v[2],b.length!=0){if(O.multimodel&&O.onemol&&p.length>0)for(var g=p[0].length,m=0;m<b.length;m++){var r=b[m];r.index=m;for(var e=0;e<r.bonds.length;e++)r.bonds[e]+=g;p[0].push(r)}else p.modelData.push(_),p.push(b);if(!O.multimodel)break}}return p}},"./src/parsers/PQR.ts":(K,C,d)=>{d.r(C),d.d(C,{PQR:()=>w});var A=d("./src/parsers/utils/assignPDBBonds.ts"),S=d("./src/parsers/utils/computeSecondaryStructure.ts");function w(O,p){var x=[[]],M=!p.noSecondaryStructure;x.modelData=[{symmetries:[]}];var v=[],b=O.split(/\r?\n|\r/),_;for(let u=0;u<b.length;u++){_=b[u].replace(/^\s*/,"");var g=_.substring(0,6);if(g.indexOf("END")==0)if(p.multimodel){p.onemol||x.push([]);continue}else break;else if(g=="ATOM  "||g=="HETATM"){var m;let E=parseInt(_.substring(6,11)),T=_.substring(12,16).replace(/ /g,""),L=_.substring(17,20).trim(),P=_.substring(21,22),I=parseInt(_.substring(22,26));var r=_.substring(30).trim().split(/\s+/),e=parseFloat(r[0]),t=parseFloat(r[1]),n=parseFloat(r[2]),o=parseFloat(r[3]),h=parseFloat(r[4]),f=T[0];T.length>1&&T[1].toUpperCase()!=T[1]&&(f=T.substring(0,2)),_[0]=="H"?m=!0:m=!1,v[E]=x[x.length-1].length,x[x.length-1].push({resn:L,x:e,y:t,z:n,elem:f,hetflag:m,chain:P,resi:I,serial:E,atom:T,bonds:[],ss:"c",bondOrder:[],properties:{charge:o,partialCharge:o,radius:h},pdbline:_})}else if(g=="CONECT"){var i=parseInt(_.substring(6,11)),s=x[x.length-1][v[i]];for(let E=0;E<4;E++){var a=parseInt(_.substring([11,16,21,26][E],[11,16,21,26][E]+5)),c=x[x.length-1][v[a]];s!==void 0&&c!==void 0&&(s.bonds.push(v[a]),s.bondOrder.push(1))}}}for(let u=0;u<x.length;u++)(0,A.assignPDBBonds)(x[u],p),M&&(0,S.computeSecondaryStructure)(x[u],p.hbondCutoff);return x}},"./src/parsers/PRMTOP.ts":(K,C,d)=>{d.r(C),d.d(C,{PRMTOP:()=>A});function A(S){var w=[],O,p=0,x=S.split(/\r?\n|\r/);if(x.length>0&&x[0].includes("VERSION")){var M=x.filter(function(n){return n.includes("POINTERS")||n.includes("ATOM_NAME")||n.includes("CHARGE")||n.includes("RADII")||n.includes("BONDS_INC_HYDROGEN")||n.includes("BONDS_WITHOUT_HYDROGEN")||n.includes("RESIDUE_LABEL")||n.includes("RESIDUE_POINTER")}),v=r("POINTERS");if(v==-1)return[];var b=e(v),_=parseInt(x[v+1].slice(0,b[1]));let t=parseInt(x[v+2].slice(b[1],b[0]+b[1]));if(isNaN(_)||_<=0)return[];if(v=r("ATOM_NAME"),v==-1)return[];b=e(v);var g=b[0];for(let n=0;n<_/b[0];n++){n==parseInt(_/b[0])&&(g=_%b[0]);for(let o=0;o<g;o++){let h={},f={charge:"",radii:""};h.serial=p,h.x=0,h.y=0,h.z=0,h.atom=x[v+1].slice(b[1]*o,b[1]*(o+1)).trim(),h.elem=x[v+1].slice(b[1]*o,b[1]*o+1).trim(),h.properties=f,h.bonds=[],h.bondOrder=[],h.index=w.length,w.push(h),p++}v++}if(v=r("CHARGE"),v!=-1){b=e(v),p=0,g=b[0];for(let n=0;n<_/b[0];n++){n==parseInt(_/b[0])&&(g=_%b[0]);for(let o=0;o<g;o++)w[p].properties.charge=parseFloat(x[v+1].slice(b[1]*o,b[1]*(o+1))),p++;v++}}v=r("RESIDUE_POINTER");var m=[];if(v!=-1){b=e(v),g=b[0],v+=1;for(let n=0;n<t/b[0];n++){n==parseInt(t/b[0])&&(g=t%b[0]);for(let o=0;o<g;o++)m.push(parseInt(x[v].slice(b[1]*o,b[1]*(o+1))));v++}if(v=r("RESIDUE_LABEL"),v!=-1){let n=[];b=e(v),g=b[0],v+=1;for(let i=0;i<t/b[0];i++){i==parseInt(t/b[0])&&(g=t%b[0]);for(let s=0;s<g;s++)n.push(x[v].slice(b[1]*s,b[1]*(s+1)).trim());v++}let o=0,h=0,f="";m.push(w.length+1);for(let i=0;i<w.length;i++)i+1>=m[o]&&(f=n[o],o+=1,h+=1),w[i].resi=h,w[i].resn=f}}if(v=r("RADII"),v!=-1){b=e(v),p=0,g=b[0];for(let n=0;n<_/b[0];n++){n==parseInt(_/b[0])&&(g=_%b[0]);for(let o=0;o<g;o++)w[p].properties.radii=parseFloat(x[v+1].slice(b[1]*o,b[1]*(o+1))),p++;v++}}if(v=r("BONDS_WITHOUT_HYDROGEN"),v!=-1)for(b=e(v),p=0,g=b[0],v=v+1;!x[v].match(/^%FLAG/);){x[v+1].match(/^%FLAG/)&&(g=_%b[0]);for(let n=0;n<g;n++)p%3==0?O=parseInt(x[v].slice(b[1]*n,b[1]*(n+1))/3):p%3==1&&(w[O].bonds.push(parseInt(x[v].slice(b[1]*n,b[1]*(n+1))/3)),w[O].bondOrder.push(1)),p++;v++}if(v=r("BONDS_INC_HYDROGEN"),v!=-1)for(b=e(v),p=0,g=b[0],v=v+1;!x[v].match(/^%FLAG/);){x[v+1].match(/^%FLAG/)&&(g=_%b[0]);for(let n=0;n<g;n++)p%3==0?O=parseInt(x[v].slice(b[1]*n,b[1]*(n+1))/3):p%3==1&&(w[O].bonds.push(parseInt(x[v].slice(b[1]*n,b[1]*(n+1))/3)),w[O].bonds.push(1)),p++;v++}}else return[];function r(t){var n=x.indexOf(M.filter(function(o){return o.includes(t)})[0]);if(Number.isInteger(n)&&n>0){for(;!x[n].includes("FORMAT");)n++;return n}else return-1}function e(t){var n=x[t].match(/\((\d*)\S*/),o=x[t].match(/[a-zA-Z](\d*)\)\s*/);return o==null&&(o=x[t].match(/[a-zA-Z](\d*)\.\d*\)\s*/)),[parseInt(n[1]),parseInt(o[1])]}return[w]}},"./src/parsers/SDF.ts":(K,C,d)=>{d.r(C),d.d(C,{SDF:()=>w});var A=function(O,p){var x=[[]],M=!1;for(typeof p.keepH<"u"&&(M=!p.keepH);O.length>0&&!(O.length<4);){var v=parseInt(O[3].substring(0,3));if(isNaN(v)||v<=0)break;var b=parseInt(O[3].substring(3,6)),_=4;if(O.length<4+v+b)break;var g=[],m=x[x.length-1].length,r=m+v,e,t;for(e=m;e<r;e++,_++){t=O[_];var n={},o=t.substring(31,34).replace(/ /g,"");n.atom=n.elem=o[0].toUpperCase()+o.substring(1).toLowerCase(),(n.elem!=="H"||!M)&&(n.serial=e,g[e]=x[x.length-1].length,n.x=parseFloat(t.substring(0,10)),n.y=parseFloat(t.substring(10,20)),n.z=parseFloat(t.substring(20,30)),n.hetflag=!0,n.bonds=[],n.bondOrder=[],n.properties={},n.index=x[x.length-1].length,x[x.length-1].push(n))}for(e=0;e<b;e++,_++){t=O[_];var h=g[parseInt(t.substring(0,3))-1+m],f=g[parseInt(t.substring(3,6))-1+m],i=parseFloat(t.substring(6));typeof h<"u"&&typeof f<"u"&&(x[x.length-1][h].bonds.push(f),x[x.length-1][h].bondOrder.push(i),x[x.length-1][f].bonds.push(h),x[x.length-1][f].bondOrder.push(i))}if(p.multimodel){for(p.onemol||x.push([]);O[_]!=="$$$$"&&_<O.length;)_++;O.splice(0,++_)}else break}return x},S=function(O,p){var x=[[]],M=!1;for(typeof p.keepH<"u"&&(M=!p.keepH);O.length>0&&!(O.length<8||!O[4].startsWith("M  V30 BEGIN CTAB")||!O[5].startsWith("M  V30 COUNTS")||O[5].length<14);){var v=O[5].substring(13).match(/\S+/g);if(v.length<2)break;var b=parseInt(v[0]);if(isNaN(b)||b<=0)break;var _=parseInt(v[1]),g=7;if(O.length<8+b+_)break;var m=[],r=x[x.length-1].length,e=r+b,t,n;for(t=r;t<e;t++,g++){n=O[g];var o=n.substring(6).match(/\S+/g);if(o.length>4){var h={},f=o[1].replace(/ /g,"");h.atom=h.elem=f[0].toUpperCase()+f.substring(1).toLowerCase(),(h.elem!=="H"||!M)&&(h.serial=t,m[t]=x[x.length-1].length,h.x=parseFloat(o[2]),h.y=parseFloat(o[3]),h.z=parseFloat(o[4]),h.hetflag=!0,h.bonds=[],h.bondOrder=[],h.properties={},h.index=x[x.length-1].length,x[x.length-1].push(h))}}if(O[g]==="M  V30 END ATOM")g++;else break;if(_!==0&&O[g]==="M  V30 BEGIN BOND")g++;else break;for(t=0;t<_;t++,g++){n=O[g];var i=n.substring(6).match(/\S+/g);if(i.length>3){var s=m[parseInt(i[2])-1+r],a=m[parseInt(i[3])-1+r],c=parseFloat(i[1]);typeof s<"u"&&typeof a<"u"&&(x[x.length-1][s].bonds.push(a),x[x.length-1][s].bondOrder.push(c),x[x.length-1][a].bonds.push(s),x[x.length-1][a].bondOrder.push(c))}}if(p.multimodel){for(p.onemol||x.push([]);O[g]!=="$$$$"&&g<O.length;)g++;O.splice(0,++g)}else break}return x};function w(O,p){var x="V2000",M=O.split(/\r?\n|\r/);return M.length>3&&M[3].length>38&&(x=M[3].substring(34,39)),x==="V2000"?A(M,p):x==="V3000"?S(M,p):[[""]]}},"./src/parsers/VASP.ts":(K,C,d)=>{d.r(C),d.d(C,{VASP:()=>w});var A=d("./src/WebGL/index.ts"),S=d("./src/parsers/utils/assignBonds.ts");function w(O,p={}){var x=[[]],M={};const v=p.assignBonds===void 0?!0:p.assignBonds;var b=O.replace(/^\s+/,"").split(/\r?\n/);if(b.length<3)return x;if(b[1].match(/\d+/))M.length=parseFloat(b[1]);else return console.log("Warning: second line of the vasp structure file must be a number"),x;if(M.length<0)return console.log("Warning: Vasp implementation for negative lattice lengths is not yet available"),x;M.xVec=new Float32Array(b[2].replace(/^\s+/,"").split(/\s+/)),M.yVec=new Float32Array(b[3].replace(/^\s+/,"").split(/\s+/)),M.zVec=new Float32Array(b[4].replace(/^\s+/,"").split(/\s+/));var _=new A.Matrix3(M.xVec[0],M.xVec[1],M.xVec[2],M.yVec[0],M.yVec[1],M.yVec[2],M.zVec[0],M.zVec[1],M.zVec[2]);_.multiplyScalar(M.length),x.modelData=[{symmetries:[],cryst:{matrix:_}}];var g=b[5].trim().split(/\s+/),m=new Int16Array(b[6].trim().split(/\s+/)),r=b[7].trim(),e=!1;if(r.match(/S/)&&(e=!0,r=b[8].trim()),r.toLowerCase()[0]=="c")r="cartesian";else if(r.toLowerCase()[0]=="d")r="direct";else return console.log("Warning: Unknown vasp mode in POSCAR file: mode must be either C(artesian) or D(irect)"),x;if(g.length!=m.length)return console.log("Warning: declaration of atomary species wrong:"),console.log(g),console.log(m),x;e?b.splice(0,9):b.splice(0,8);for(var t=0,n=0,o=g.length;n<o;n++){for(var h=g[n],f=0,i=m[n];f<i;f++){var s=new Float32Array(b[t+f].trim().split(/\s+/)),a={};a.elem=h,r=="cartesian"?(a.x=M.length*s[0],a.y=M.length*s[1],a.z=M.length*s[2]):(a.x=M.length*(s[0]*M.xVec[0]+s[1]*M.yVec[0]+s[2]*M.zVec[0]),a.y=M.length*(s[0]*M.xVec[1]+s[1]*M.yVec[1]+s[2]*M.zVec[1]),a.z=M.length*(s[0]*M.xVec[2]+s[1]*M.yVec[2]+s[2]*M.zVec[2])),a.bonds=[],a.bondOrder=[],x[0].push(a)}t+=m[n]}if(v)for(let c=0;c<x.length;c++)(0,S.assignBonds)(x[c],p);return x}},"./src/parsers/XYZ.ts":(K,C,d)=>{d.r(C),d.d(C,{XYZ:()=>w});var A=d("./src/WebGL/index.ts"),S=d("./src/parsers/utils/assignBonds.ts");function w(O,p){p=p||{};for(var x=[[]],M=p.assignBonds===void 0?!0:p.assignBonds,v=O.trimStart().split(/\r?\n|\r/);v.length>0&&!(v.length<3);){var b=parseInt(v[0]);if(isNaN(b)||b<=0||v.length<b+2)break;var _=/Lattice\s*=\s*["\{\}]([^"\{\}]+)["\{\}]\s*/gi,g=_.exec(v[1]);if(g!=null&&g.length>1){var m=new Float32Array(g[1].split(/\s+/)),r=new A.Matrix3(m[0],m[3],m[6],m[1],m[4],m[7],m[2],m[5],m[8]);x.modelData=[{cryst:{matrix:r}}]}for(var e=2,t=x[x.length-1].length,n=t+b,o=t;o<n;o++){var h=v[e++],f=h.trim().split(/\s+/),i={};i.serial=o;var s=f[0];i.atom=i.elem=s[0].toUpperCase()+s.substring(1,2).toLowerCase(),i.x=parseFloat(f[1]),i.y=parseFloat(f[2]),i.z=parseFloat(f[3]),i.hetflag=!0,i.bonds=[],i.bondOrder=[],i.properties={},x[x.length-1][o]=i,f.length>=7&&(i.dx=parseFloat(f[4]),i.dy=parseFloat(f[5]),i.dz=parseFloat(f[6]))}if(p.multimodel)x.push([]),v.splice(0,e);else break}if(M)for(let c=0;c<x.length;c++)(0,S.assignBonds)(x[c],p);if(p.onemol){var a=x;x=[],x.push(a[0]);for(let c=1;c<a.length;c++){let u=x[0].length;for(let E=0;E<a[c].length;E++){let T=a[c][E];for(let L=0;L<T.bonds.length;L++)T.bonds[L]=T.bonds[L]+u;T.index=x[0].length,T.serial=x[0].length,x[0].push(T)}}}return x}},"./src/parsers/cifutils/category.ts":(K,C,d)=>{d.r(C),d.d(C,{Category:()=>S});var A=d("./src/parsers/cifutils/decoder.ts");function S(w){const O=Object.create(null),p=Object.create(null);for(const x of w.columns)O[x.name]=x;return{rowCount:w.rowCount,name:w.name.substring(1),fieldNames:w.columns.map(x=>x.name),getField(x){const M=O[x];if(M)return p[x]||(p[x]=(0,A.decode)(M.data)),p[x]}}}},"./src/parsers/cifutils/decoder.ts":(K,C,d)=>{d.r(C),d.d(C,{decode:()=>O});var A=d("./src/parsers/cifutils/encoding.ts");const S=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function w(u,E){const T=new ArrayBuffer(u.length),L=new Uint8Array(T);for(let P=0,I=u.length;P<I;P+=E)for(let z=0;z<E;z++)L[P+E-z-1]=u[P+z];return T}function O(u){let E=u.data;for(let T=u.encoding.length-1;T>=0;T--)E=p(E,u.encoding[T]);return E}function p(u,E){switch(E.kind){case"ByteArray":switch(E.type){case A.Encoding.IntDataType.Uint8:return u;case A.Encoding.IntDataType.Int8:return v(u);case A.Encoding.IntDataType.Int16:return _(u);case A.Encoding.IntDataType.Uint16:return g(u);case A.Encoding.IntDataType.Int32:return m(u);case A.Encoding.IntDataType.Uint32:return r(u);case A.Encoding.FloatDataType.Float32:return e(u);case A.Encoding.FloatDataType.Float64:return t(u);default:throw new Error("unreachable")}case"FixedPoint":return n(u,E);case"IntervalQuantization":return o(u,E);case"RunLength":return h(u,E);case"Delta":return f(u,E);case"IntegerPacking":return a(u,E);case"StringArray":return c(u,E)}}function x(u,E){switch(u){case A.Encoding.IntDataType.Int8:return new Int8Array(E);case A.Encoding.IntDataType.Int16:return new Int16Array(E);case A.Encoding.IntDataType.Int32:return new Int32Array(E);case A.Encoding.IntDataType.Uint8:return new Uint8Array(E);case A.Encoding.IntDataType.Uint16:return new Uint16Array(E);case A.Encoding.IntDataType.Uint32:return new Uint32Array(E);default:return new Int32Array(E)}}function M(u,E){switch(u){case A.Encoding.FloatDataType.Float32:return new Float32Array(E);case A.Encoding.FloatDataType.Float64:return new Float64Array(E);default:return new Float64Array(E)}}function v(u){return new Int8Array(u.buffer,u.byteOffset)}function b(u,E,T){return(u.byteOffset!=0||u.byteLength!=u.buffer.byteLength)&&(u=new Uint8Array(u)),S?new T(u.buffer):new T(w(u,E))}function _(u){return b(u,2,Int16Array)}function g(u){return b(u,2,Uint16Array)}function m(u){return b(u,4,Int32Array)}function r(u){return b(u,4,Uint32Array)}function e(u){return b(u,4,Float32Array)}function t(u){return b(u,8,Float64Array)}function n(u,E){const T=u.length,L=M(E.srcType,T),P=1/E.factor;for(let I=0;I<T;I++)L[I]=P*u[I];return L}function o(u,E){const T=u.length,L=M(E.srcType,T),P=(E.max-E.min)/(E.numSteps-1),I=E.min;for(let z=0;z<T;z++)L[z]=I+P*u[z];return L}function h(u,E){const T=x(E.srcType,E.srcSize);let L=0;for(let P=0,I=u.length;P<I;P+=2){const z=u[P],B=u[P+1];for(let F=0;F<B;++F)T[L++]=z}return T}function f(u,E){const T=u.length,L=x(E.srcType,T);if(!T)return u;L[0]=u[0]+(E.origin|0);for(let P=1;P<T;++P)L[P]=u[P]+L[P-1];return L}function i(u,E){const T=E.byteCount===1?127:32767,L=-T-1,P=u.length,I=new Int32Array(E.srcSize);let z=0,B=0;for(;z<P;){let F=0,W=u[z];for(;W===T||W===L;)F+=W,z++,W=u[z];F+=W,I[B]=F,z++,B++}return I}function s(u,E){const T=E.byteCount===1?255:65535,L=u.length,P=new Int32Array(E.srcSize);let I=0,z=0;for(;I<L;){let B=0,F=u[I];for(;F===T;)B+=F,I++,F=u[I];B+=F,P[z]=B,I++,z++}return P}function a(u,E){return u.length===E.srcSize?u:E.isUnsigned?s(u,E):i(u,E)}function c(u,E){const T=O({encoding:E.offsetEncoding,data:E.offsets}),L=O({encoding:E.dataEncoding,data:u}),P=E.stringData,I=new Array(T.length);I[0]="";for(let F=1,W=T.length;F<W;F++)I[F]=P.substring(T[F-1],T[F]);let z=0;const B=new Array(L.length);for(let F=0,W=L.length;F<W;F++)B[z++]=I[L[F]+1];return B}},"./src/parsers/cifutils/encoding.ts":(K,C,d)=>{d.r(C),d.d(C,{Encoding:()=>S,VERSION:()=>A});const A="0.3.0";var S;(function(w){(function(x){x[x.Int8=1]="Int8",x[x.Int16=2]="Int16",x[x.Int32=3]="Int32",x[x.Uint8=4]="Uint8",x[x.Uint16=5]="Uint16",x[x.Uint32=6]="Uint32"})(w.IntDataType||(w.IntDataType={})),function(x){x[x.Float32=32]="Float32",x[x.Float64=33]="Float64"}(w.FloatDataType||(w.FloatDataType={}));function O(x){let M;return x instanceof Int8Array?M=w.IntDataType.Int8:x instanceof Int16Array?M=w.IntDataType.Int16:x instanceof Int32Array?M=w.IntDataType.Int32:x instanceof Uint8Array?M=w.IntDataType.Uint8:x instanceof Uint16Array?M=w.IntDataType.Uint16:x instanceof Uint32Array?M=w.IntDataType.Uint32:x instanceof Float32Array?M=w.FloatDataType.Float32:x instanceof Float64Array?M=w.FloatDataType.Float64:M=w.IntDataType.Int32,M}w.getDataType=O;function p(x){if(x instanceof Int8Array||x instanceof Int16Array||x instanceof Int32Array)return!0;for(let M=0,v=x.length;M<v;M++)if(M<0)return!1;return!0}w.isSignedIntegerDataType=p})(S||(S={}))},"./src/parsers/index.ts":(K,C,d)=>{d.r(C),d.d(C,{Parsers:()=>n,bondLength:()=>t.bondLength,setBondLength:()=>t.setBondLength});var A=d("./src/parsers/VASP.ts"),S=d("./src/parsers/CUBE.ts"),w=d("./src/parsers/XYZ.ts"),O=d("./src/parsers/SDF.ts"),p=d("./src/parsers/CDJSON.ts"),x=d("./src/parsers/CIF.ts"),M=d("./src/parsers/MOL2.ts"),v=d("./src/parsers/PDB.ts"),b=d("./src/parsers/PQR.ts"),_=d("./src/parsers/MMTF.ts"),g=d("./src/parsers/PRMTOP.ts"),m=d("./src/parsers/GRO.ts"),r=d("./src/parsers/LAMMPSTRJ.ts"),e=d("./src/parsers/BCIF.ts"),t=d("./src/parsers/utils/bondLength.ts");const n={vasp:A.VASP,VASP:A.VASP,cube:S.CUBE,CUBE:S.CUBE,xyz:w.XYZ,XYZ:w.XYZ,sdf:O.SDF,SDF:O.SDF,json:p.CDJSON,cdjson:p.CDJSON,CDJSON:p.CDJSON,mcif:x.CIF,cif:x.CIF,CIF:x.CIF,mol2:M.MOL2,MOL2:M.MOL2,pdb:v.PDB,PDB:v.PDB,pdbqt:v.PDB,PDBQT:v.PDB,pqr:b.PQR,PQR:b.PQR,mmtf:_.MMTFparser,MMTF:_.MMTFparser,prmtop:g.PRMTOP,PRMTOP:g.PRMTOP,gro:m.GRO,GRO:m.GRO,lammpstrj:r.LAMMPSTRJ,LAMMPSTRJ:r.LAMMPSTRJ,bcif:e.BCIF,BCIF:e.BCIF}},"./src/parsers/utils/anumToSymbol.ts":(K,C,d)=>{d.r(C),d.d(C,{anumToSymbol:()=>A});const A={1:"H",2:"He",3:"Li",4:"Be",5:"B",6:"C",7:"N",8:"O",9:"F",10:"Ne",11:"Na",12:"Mg",13:"Al",14:"Si",15:"P",16:"S",17:"Cl",18:"Ar",19:"K",20:"Ca",21:"Sc",22:"Ti",23:"V",24:"Cr",25:"Mn",26:"Fe",27:"Co",28:"Ni",29:"Cu",30:"Zn",31:"Ga",32:"Ge",33:"As",34:"Se",35:"Br",36:"Kr",37:"Rb",38:"Sr",39:"Y",40:"Zr",41:"Nb",42:"Mo",43:"Tc",44:"Ru",45:"Rh",46:"Pd",47:"Ag",48:"Cd",49:"In",50:"Sn",51:"Sb",52:"Te",53:"I",54:"Xe",55:"Cs",56:"Ba",71:"Lu",72:"Hf",73:"Ta",74:"W",75:"Re",76:"Os",77:"Ir",78:"Pt",79:"Au",80:"Hg",81:"Tl",82:"Pb",83:"Bi",84:"Po",85:"At",86:"Rn",87:"Fr",88:"Ra",104:"Rf",105:"Db",106:"Sg",107:"Bh",108:"Hs",109:"Mt",110:"Ds",111:"Rg",112:"Cn",113:"Nh",114:"Fl",115:"Mc",116:"Lv",117:"Ts",118:"Og",57:"La",58:"Ce",59:"Pr",60:"Nd",61:"Pm",62:"Sm",63:"Eu",64:"Gd",65:"Tb",66:"Dy",67:"Ho",68:"Er",69:"Tm",70:"Yb",89:"Ac",90:"Th",91:"Pa",92:"U",93:"Np",94:"Pu",95:"Am",96:"Cm",97:"Bk",98:"Cf",99:"Es",100:"Fm",101:"Md",102:"No"}},"./src/parsers/utils/areConnected.ts":(K,C,d)=>{d.r(C),d.d(C,{areConnected:()=>w});var A=d("./src/parsers/utils/bondLength.ts");const S=new Set(["Na","K","Ca","Mg","Mn","Sr"]);function w(O,p,x){if(x&&x.unboundCations&&(S.has(O.elem)||S.has(p.elem)))return!1;let M=(0,A.bondLength)(O.elem)+(0,A.bondLength)(p.elem);M+=.25,M*=M;let v=O.x-p.x;if(v*=v,v>M)return!1;let b=O.y-p.y;if(b*=b,b>M)return!1;let _=O.z-p.z;if(_*=_,_>M)return!1;const g=v+b+_;return!(isNaN(g)||g<.5||g>M||O.altLoc!==p.altLoc&&O.altLoc.trim()!==""&&p.altLoc.trim()!=="")}},"./src/parsers/utils/assignBackboneHBonds.ts":(K,C,d)=>{d.r(C),d.d(C,{assignBackboneHBonds:()=>A});function A(S,w){const O=w||3.2,p=O*O,x=[];for(let M=0,v=S.length;M<v;M++){S[M].index=M;const b=S[M];!b.hetflag&&(b.atom==="N"||b.atom==="O")&&(x.push(b),b.hbondOther=null,b.hbondDistanceSq=Number.POSITIVE_INFINITY)}x.sort(function(M,v){return M.z-v.z});for(let M=0,v=x.length;M<v;M++){const b=x[M];for(let _=M+1;_<v;_++){const g=x[_],m=g.z-b.z;if(m>O)break;if(g.atom==b.atom)continue;const r=Math.abs(g.y-b.y);if(r>O)continue;const e=Math.abs(g.x-b.x);if(e>O)continue;const t=e*e+r*r+m*m;t>p||g.chain==b.chain&&Math.abs(g.resi-b.resi)<4||(t<b.hbondDistanceSq&&(b.hbondOther=g,b.hbondDistanceSq=t),t<g.hbondDistanceSq&&(g.hbondOther=b,g.hbondDistanceSq=t))}}}},"./src/parsers/utils/assignBonds.ts":(K,C,d)=>{d.r(C),d.d(C,{assignBonds:()=>O});var A=d("./src/parsers/utils/areConnected.ts");const S=[{x:0,y:0,z:1},{x:0,y:1,z:-1},{x:0,y:1,z:0},{x:0,y:1,z:1},{x:1,y:-1,z:-1},{x:1,y:-1,z:0},{x:1,y:-1,z:1},{x:1,y:0,z:-1},{x:1,y:0,z:0},{x:1,y:0,z:1},{x:1,y:1,z:-1},{x:1,y:1,z:0},{x:1,y:1,z:1}],w=4.95;function O(p,x){for(let b=0,_=p.length;b<_;b++)p[b].index||(p[b].index=b);const M={x:{y:{z:[]}}};for(let b=0;b<p.length;b++){const _=p[b],g=Math.floor(_.x/w),m=Math.floor(_.y/w),r=Math.floor(_.z/w);M[g]||(M[g]={}),M[g][m]||(M[g][m]={}),M[g][m][r]||(M[g][m][r]=[]),M[g][m][r].push(_)}function v(b,_){for(let g=0;g<b.length;g++){const m=b[g];for(let r=0;r<_.length;r++){const e=_[r];if((0,A.areConnected)(m,e,x)){const t=m.bonds.indexOf(e.index),n=e.bonds.indexOf(m.index);t===-1&&n===-1?(m.bonds.push(e.index),m.bondOrder.push(1),e.bonds.push(m.index),e.bondOrder.push(1)):t===-1?(m.bonds.push(e.index),m.bondOrder.push(e.bondOrder[n])):n===-1&&(e.bonds.push(m.index),e.bondOrder.push(m.bondOrder[t]))}}}}for(let b in M){const _=parseInt(b);for(let g in M[_]){const m=parseInt(g);for(let r in M[_][m]){const e=parseInt(r),t=M[_][m][e];for(let n=0;n<t.length;n++){const o=t[n];for(let h=n+1;h<t.length;h++){const f=t[h];(0,A.areConnected)(o,f,x)&&o.bonds.indexOf(f.index)==-1&&(o.bonds.push(f.index),o.bondOrder.push(1),f.bonds.push(o.index),f.bondOrder.push(1))}}for(let n=0;n<S.length;n++){const o=S[n];if(!M[_+o.x]||!M[_+o.x][m+o.y]||!M[_+o.x][m+o.y][e+o.z])continue;const h=M[_+o.x][m+o.y][e+o.z];v(t,h)}}}}}},"./src/parsers/utils/assignPDBBonds.ts":(K,C,d)=>{d.r(C),d.d(C,{assignPDBBonds:()=>O});var A=d("./src/parsers/utils/areConnected.ts"),S=d("./src/parsers/utils/assignBonds.ts"),w=d("./src/parsers/utils/standardResidues.ts");function O(p,x){const M=[],v=[];for(let m=0,r=p.length;m<r;m++){const e=p[m];e.index=m,e.hetflag||!w.standardResidues.has(e.resn)?v.push(e):M.push(e)}(0,S.assignBonds)(v,x),M.sort(function(m,r){return m.chain!==r.chain?m.chain<r.chain?-1:1:m.resi-r.resi});let b=-1,_=-1,g;for(let m=0,r=M.length;m<r;m++){const e=M[m];e.resi!==b&&(b=e.resi,g||_++,g=!1),e.reschain=_;for(let t=m+1;t<M.length;t++){const n=M[t];if(n.chain!==e.chain||n.resi-e.resi>1)break;(0,A.areConnected)(e,n,x)&&(e.bonds.indexOf(n.index)===-1&&(e.bonds.push(n.index),e.bondOrder.push(1),n.bonds.push(e.index),n.bondOrder.push(1)),e.resi!==n.resi&&(g=!0))}}}},"./src/parsers/utils/atomNameToElem.ts":(K,C,d)=>{d.r(C),d.d(C,{atomNameToElem:()=>S});var A=d("./src/parsers/utils/bondLength.ts");function S(w,O){let p=w.replace(/ /g,"");return p.length>0&&p[0]==="H"&&p!=="Hg"&&p!=="He"&&p!=="Hf"&&p!=="Hs"&&p!=="Ho"&&(p="H"),p.length>1&&(p=p[0].toUpperCase()+p.substring(1).toLowerCase(),A.bondTable[p]===void 0?p=p[0]:O&&(p==="Ca"||p==="Cd")&&(p="C")),p}},"./src/parsers/utils/bondLength.ts":(K,C,d)=>{d.r(C),d.d(C,{bondLength:()=>S,bondTable:()=>A,setBondLength:()=>w});let A={H:.37,He:.32,Li:1.34,Be:.9,B:.82,C:.77,N:.75,O:.73,F:.71,Ne:.69,Na:1.54,Mg:1.3,Al:1.18,Si:1.11,P:1.06,S:1.02,Cl:.99,Ar:.97,K:1.96,Ca:1.74,Sc:1.44,Ti:1.56,V:1.25,Mn:1.39,Fe:1.25,Co:1.26,Ni:1.21,Cu:1.38,Zn:1.31,Ga:1.26,Ge:1.22,Se:1.16,Br:1.14,Kr:1.1,Rb:2.11,Sr:1.92,Y:1.62,Zr:1.48,Nb:1.37,Mo:1.45,Tc:1.56,Ru:1.26,Rh:1.35,Pd:1.31,Ag:1.53,Cd:1.48,In:1.44,Sn:1.41,Sb:1.38,Te:1.35,I:1.33,Xe:1.3,Cs:2.25,Ba:1.98,Lu:1.6,Hf:1.5,Ta:1.38,W:1.46,Re:1.59,Os:1.44,Ir:1.37,Pt:1.28,Au:1.44,Hg:1.49,Tl:1.48,Pb:1.47,Bi:1.46,Rn:1.45};function S(O){return A[O]||1.6}function w(O,p){p<0&&(p=0),A[O]=p}},"./src/parsers/utils/computeSecondaryStructure.ts":(K,C,d)=>{d.r(C),d.d(C,{computeSecondaryStructure:()=>S});var A=d("./src/parsers/utils/assignBackboneHBonds.ts");function S(w,O){(0,A.assignBackboneHBonds)(w,O);const p={};let x,M,v,b,_,g;for(x=0,M=w.length;x<M;x++)if(_=w[x],p[_.chain]===void 0&&(p[_.chain]=[]),isFinite(_.hbondDistanceSq)){const m=_.hbondOther;p[m.chain]===void 0&&(p[m.chain]=[]),Math.abs(m.resi-_.resi)===4&&(p[_.chain][_.resi]="h")}for(v in p)for(b=1;b<p[v].length-1;b++){const m=p[v][b-1],r=p[v][b+1];g=p[v][b],m=="h"&&m==r&&g!=m&&(p[v][b]=m)}for(x=0,M=w.length;x<M;x++)_=w[x],isFinite(_.hbondDistanceSq)&&p[_.chain][_.resi]!="h"&&_.ss!=="h"&&(p[_.chain][_.resi]="maybesheet");for(let m=0,r=w.length;m<r;m++)if(_=w[m],isFinite(_.hbondDistanceSq)&&p[_.chain][_.resi]=="maybesheet"){let e=_.hbondOther,t=p[e.chain][e.resi];(t=="maybesheet"||t=="s")&&(p[_.chain][_.resi]="s",p[e.chain][e.resi]="s")}for(let m in p){for(let r=1;r<p[m].length-1;r++){const e=p[m][r-1],t=p[m][r+1];g=p[m][r],e=="s"&&e==t&&g!=e&&(p[m][r]=e)}for(let r=0;r<p[m].length;r++){const e=p[m][r];(e=="h"||e=="s")&&p[m][r-1]!=e&&p[m][r+1]!=e&&delete p[m][r]}}for(x=0,M=w.length;x<M;x++)_=w[x],g=p[_.chain][_.resi],delete _.hbondOther,delete _.hbondDistanceSq,!(g===void 0||g==="maybesheet")&&(_.ss=g,p[_.chain][_.resi-1]!=g&&(_.ssbegin=!0),p[_.chain][_.resi+1]!=g&&(_.ssend=!0))}},"./src/parsers/utils/getSinglePDB.ts":(K,C,d)=>{d.r(C),d.d(C,{getSinglePDB:()=>b});var A=d("./src/WebGL/index.ts"),S=d("./src/parsers/utils/atomNameToElem.ts"),w=d("./src/parsers/utils/bondLength.ts"),O=d("./src/parsers/utils/computeSecondaryStructure.ts"),p=d("./src/parsers/utils/isEmpty.ts"),x=d("./src/parsers/utils/processSymmetries.ts"),M=d("./src/parsers/utils/assignPDBBonds.ts"),v=d("./src/parsers/utils/validateBonds.ts");function b(_,g,m){const r=[],e=g.assignBonds===void 0?!0:g.assignBonds,t=!g.keepH,n=!!g.noSecondaryStructure,o=!g.noComputeSecondaryStructure,h=!g.doAssembly,f=g.altLoc?g.altLoc:"A",i={symmetries:[],cryst:void 0};let s,a=[];const c=[];let u;const E={};for(let T=0;T<_.length;T++){u=_[T].replace(/^\s*/,"");const L=u.substring(0,6);let P,I,z;if(L.indexOf("END")===0){if(a=_.slice(T+1),L==="END")for(const B in m)m.hasOwnProperty(B)&&delete m[B];break}else if(L==="ATOM  "||L==="HETATM"){let B,F,W,U,R,V,q,ee,se,ie,le,re;if(le=u.substring(16,17),le!==" "&&le!==f&&f!=="*"||(ie=parseInt(u.substring(6,11)),s=u.substring(12,16).replace(/ /g,""),B=u.substring(17,20).replace(/ /g,""),F=u.substring(21,22),W=parseInt(u.substring(22,26)),U=u.substring(26,27),R=parseFloat(u.substring(30,38)),V=parseFloat(u.substring(38,46)),q=parseFloat(u.substring(46,54)),re=parseFloat(u.substring(60,68)),se=u.substring(76,78).replace(/ /g,""),se===""||w.bondTable[se]===void 0?se=(0,S.atomNameToElem)(u.substring(12,14),u[0]=="A"):se=se[0].toUpperCase()+se.substring(1).toLowerCase(),se==="H"&&t))continue;L[0]=="H"?ee=!0:ee=!1,c[ie]=r.length,r.push({resn:B,x:R,y:V,z:q,elem:se,hetflag:ee,altLoc:le,chain:F,resi:W,icode:U,rescode:W+(U!==" "?"^"+U:""),serial:ie,atom:s,bonds:[],ss:"c",bondOrder:[],properties:{},b:re,pdbline:u})}else if(L==="SHEET "){P=u.substring(21,22),I=parseInt(u.substring(22,26)),z=parseInt(u.substring(33,37)),P in m||(m[P]={}),m[P][I]="s1";for(let B=I+1;B<z;B++)m[P][B]="s";m[P][z]="s2"}else if(L==="CONECT"){const B=parseInt(u.substring(6,11)),F=c[B],W=r[F],U=[11,16,21,26];for(let R=0;R<4;R++){const V=parseInt(u.substring(U[R],U[R]+5)),q=c[V];let ee=F+":"+q;const se=r[q];if(W!==void 0&&se!==void 0)if(!E[ee])E[ee]=1,(W.bonds.length==0||W.bonds[W.bonds.length-1]!==q)&&(W.bonds.push(q),W.bondOrder.push(1));else{E[ee]+=1;for(let ie=0;ie<W.bonds.length;ie++)if(W.bonds[ie]==q){const le=E[ee];le>=4?W.bondOrder[ie]=1:W.bondOrder[ie]=le}}}}else if(L==="HELIX "){P=u.substring(19,20),I=parseInt(u.substring(21,25)),z=parseInt(u.substring(33,37)),P in m||(m[P]={}),m[P][I]="h1";for(let B=I+1;B<z;B++)m[P][B]="h";m[P][z]="h2"}else if(!h&&L==="REMARK"&&u.substring(13,18)==="BIOMT"){let B,F=new A.Matrix4;for(B=1;B<=3;B++)if(u=_[T].replace(/^\s*/,""),parseInt(u.substring(18,19))==B)F.elements[B-1]=parseFloat(u.substring(23,33)),F.elements[B-1+4]=parseFloat(u.substring(33,43)),F.elements[B-1+8]=parseFloat(u.substring(43,53)),F.elements[B-1+12]=parseFloat(u.substring(53)),T++;else for(;u.substring(13,18)==="BIOMT";)T++,u=_[T].replace(/^\s*/,"");F.elements[3]=0,F.elements[7]=0,F.elements[11]=0,F.elements[15]=1,i.symmetries.push(F),T--}else if(L==="CRYST1"){let B,F,W,U,R,V;B=parseFloat(u.substring(7,15)),F=parseFloat(u.substring(16,24)),W=parseFloat(u.substring(25,33)),U=parseFloat(u.substring(34,40)),R=parseFloat(u.substring(41,47)),V=parseFloat(u.substring(48,54)),i.cryst={a:B,b:F,c:W,alpha:U,beta:R,gamma:V}}else if(L==="ANISOU"){const B=parseInt(u.substring(6,11)),F=c[B],W=r[F];if(W){const U=u.substring(30).trim().split(/\s+/),R={u11:parseInt(U[0]),u22:parseInt(U[1]),u33:parseInt(U[2]),u12:parseInt(U[3]),u13:parseInt(U[4]),u23:parseInt(U[5])};W.uMat=R}}}if((0,v.validateBonds)(r,c),e&&(0,M.assignPDBBonds)(r,g),h||(0,x.processSymmetries)(i.symmetries,r,g,i.cryst),o&&!n&&(0,O.computeSecondaryStructure)(r,g.hbondCutoff),!(0,p.isEmpty)(m))for(let T=0;T<r.length;T++){const L=r[T];if(L!==void 0&&L.chain in m&&L.resi in m[L.chain]){const P=m[L.chain][L.resi];L.ss=P[0],P.length>1&&(P[1]=="1"?L.ssbegin=!0:P[1]=="2"&&(L.ssend=!0))}}return[r,i,a]}},"./src/parsers/utils/isEmpty.ts":(K,C,d)=>{d.r(C),d.d(C,{isEmpty:()=>A});function A(S){for(const w in S)return!1;return!0}},"./src/parsers/utils/processSymmetries.ts":(K,C,d)=>{d.r(C),d.d(C,{processSymmetries:()=>S});var A=d("./src/WebGL/index.ts");function S(w,O,p,x){const M=!p.duplicateAssemblyAtoms,v=O.length;let b=v,_=-1,g=null,m=null;(p.normalizeAssembly||p.wrapAtoms)&&x&&(g=(0,A.conversionMatrix3)(x.a,x.b,x.c,x.alpha,x.beta,x.gamma),m=new A.Matrix3,m.getInverse3(g));let r=function(n){let o=n.clone().applyMatrix3(m);const h=[o.x,o.y,o.z],f=[0,0,0];for(let s=0;s<3;s++){for(;h[s]<-.001;)h[s]+=1,f[s]+=1;for(;h[s]>1.001;)h[s]-=1,f[s]-=1}const i=new A.Vector3(f[0],f[1],f[2]);return i.applyMatrix3(g),i};if(p.normalizeAssembly&&x)for(let n=0;n<w.length;n++){const o=new A.Vector3(0,0,0);for(let f=0;f<v;f++){const i=new A.Vector3(O[f].x,O[f].y,O[f].z);i.applyMatrix4(w[n]),o.add(i)}o.divideScalar(v);const h=r(o);w[n].isNearlyIdentity()&&h.lengthSq()>.001&&(_=n),w[n].translate(h)}if(M){if(w.length>1)for(let n=0;n<O.length;n++){var e=[];for(let o=0;o<w.length;o++)if(!w[o].isNearlyIdentity()){var t=new A.Vector3;t.set(O[n].x,O[n].y,O[n].z),t.applyMatrix4(w[o]),e.push(t)}O[n].symmetries=e}}else{for(let n=0;n<v;n++)O[n].sym=-1;for(let n=0;n<w.length;n++)if(!w[n].isNearlyIdentity()&&_!=n){let o=new A.Vector3;for(let h=0;h<v;h++){const f=[];for(let s=0;s<O[h].bonds.length;s++)f.push(O[h].bonds[s]+b);if(o.set(O[h].x,O[h].y,O[h].z),o.applyMatrix4(w[n]),p.wrapAtoms&&x){let s=r(o);o.add(s)}const i={};for(const s in O[h])i[s]=O[h][s];i.x=o.x,i.y=o.y,i.z=o.z,i.bonds=f,i.sym=n,i.index=O.length,O.push(i)}b=O.length}else for(let o=0;o<v;o++)O[o].sym=n;if(p.wrapAtoms&&x){let n=new A.Vector3;for(let o=0;o<v;o++){n.set(O[o].x,O[o].y,O[o].z);let h=r(n);n.add(h),O[o].x=n.x,O[o].y=n.y,O[o].z=n.z}}if(_>=0){const n=new A.Vector3;for(let o=0;o<v;o++)n.set(O[o].x,O[o].y,O[o].z),n.applyMatrix4(w[_]),O[o].x=n.x,O[o].y=n.y,O[o].z=n.z}w.length=0}}},"./src/parsers/utils/standardResidues.ts":(K,C,d)=>{d.r(C),d.d(C,{standardResidues:()=>A});const A=new Set(["ABU","ACD","ALA","ALB","ALI","ARG","AR0","ASN","ASP","ASX","BAS","CYS","CYH","CYX","CSS","CSH","GLN","GLU","GLX","GLY","HIS","HIE","HID","HIP","HYP","ILE","ILU","LEU","LYS","MET","PCA","PGA","PHE","PR0","PRO","PRZ","SER","THR","TRP","TYR","VAL","A","1MA","C","5MC","OMC","G","1MG","2MG","M2G","7MG","OMG","YG","I","T","U","+U","H2U","5MU","PSU","ACE","F0R","H2O","HOH","WAT"])},"./src/parsers/utils/validateBonds.ts":(K,C,d)=>{d.r(C),d.d(C,{validateBonds:()=>A});function A(S,w){for(let O=0,p=S.length;O<p;O++){const x=S[O];for(let M=0;M<x.bonds.length;M++){const v=x.bonds[M],b=S[v],_=w[x.serial];b&&_&&b.bonds.indexOf(_)<0&&(b.bonds.push(_),b.bondOrder.push(x.bondOrder[M]))}}}},"./src/partialCharges.ts":(K,C,d)=>{d.r(C),d.d(C,{applyPartialCharges:()=>S,partialCharges:()=>A});const A={"ALA:N":-.15,"ALA:CA":.1,"ALA:CB":0,"ALA:C":.6,"ALA:O":-.55,"ARG:N":-.15,"ARG:CA":.1,"ARG:CB":0,"ARG:CG":0,"ARG:CD":.1,"ARG:NE":-.1,"ARG:CZ":.5,"ARG:NH1":.25,"ARG:NH2":.25,"ARG:C":.6,"ARG:O":-.55,"ASN:N":-.15,"ASN:CA":.1,"ASN:CB":0,"ASN:CG":.55,"ASN:OD1":-.55,"ASN:ND2":0,"ASN:C":.6,"ASN:O":-.55,"ASP:N":-.15,"ASP:CA":.1,"ASP:CB":0,"ASP:CG":.14,"ASP:OD1":-.57,"ASP:OD2":-.57,"ASP:C":.6,"ASP:O":-.55,"CYS:N":-.15,"CYS:CA":.1,"CYS:CB":.19,"CYS:SG":-.19,"CYS:C":.6,"CYS:O":-.55,"GLN:N":-.15,"GLN:CA":.1,"GLN:CB":0,"GLN:CG":0,"GLN:CD":.55,"GLN:OE1":-.55,"GLN:NE2":0,"GLN:C":.6,"GLN:O":-.55,"GLU:N":-.15,"GLU:CA":.1,"GLU:CB":0,"GLU:CG":0,"GLU:CD":.14,"GLU:OE1":-.57,"GLU:OE2":-.57,"GLU:C":.6,"GLU:O":-.55,"GLY:N":-.15,"GLY:CA":.1,"GLY:C":.6,"GLY:O":-.55,"HIS:N":-.15,"HIS:CA":.1,"HIS:CB":0,"HIS:CG":.1,"HIS:ND1":-.1,"HIS:CD2":.1,"HIS:NE2":-.4,"HIS:CE1":.3,"HIS:C":.6,"HIS:O":-.55,"ILE:N":-.15,"ILE:CA":.1,"ILE:CB":0,"ILE:CG2":0,"ILE:CG1":0,"ILE:CD":0,"ILE:C":.6,"ILE:O":-.55,"LEU:N":-.15,"LEU:CA":.1,"LEU:CB":0,"LEU:CG":0,"LEU:CD1":0,"LEU:CD2":0,"LEU:C":.6,"LEU:O":-.55,"LYS:N":-.15,"LYS:CA":.1,"LYS:CB":0,"LYS:CG":0,"LYS:CD":0,"LYS:CE":.25,"LYS:NZ":.75,"LYS:C":.6,"LYS:O":-.55,"MET:N":-.15,"MET:CA":.1,"MET:CB":0,"MET:CG":.06,"MET:SD":-.12,"MET:CE":.06,"MET:C":.6,"MET:O":-.55,"PHE:N":-.15,"PHE:CA":.1,"PHE:CB":0,"PHE:CG":0,"PHE:CD1":0,"PHE:CD2":0,"PHE:CE1":0,"PHE:CE2":0,"PHE:CZ":0,"PHE:C":.6,"PHE:O":-.55,"PRO:N":-.25,"PRO:CD":.1,"PRO:CA":.1,"PRO:CB":0,"PRO:CG":0,"PRO:C":.6,"PRO:O":-.55,"SER:N":-.15,"SER:CA":.1,"SER:CB":.25,"SER:OG":-.25,"SER:C":.6,"SER:O":-.55,"THR:N":-.15,"THR:CA":.1,"THR:CB":.25,"THR:OG1":-.25,"THR:CG2":0,"THR:C":.6,"THR:O":-.55,"TRP:N":-.15,"TRP:CA":.1,"TRP:CB":0,"TRP:CG":-.03,"TRP:CD2":.1,"TRP:CE2":-.04,"TRP:CE3":-.03,"TRP:CD1":.06,"TRP:NE1":-.06,"TRP:CZ2":0,"TRP:CZ3":0,"TRP:CH2":0,"TRP:C":.6,"TRP:O":-.55,"TYR:N":-.15,"TYR:CA":.1,"TYR:CB":0,"TYR:CG":0,"TYR:CD1":0,"TYR:CE1":0,"TYR:CD2":0,"TYR:CE2":0,"TYR:CZ":.25,"TYR:OH":-.25,"TYR:C":.6,"TYR:O":-.55,"VAL:N":-.15,"VAL:CA":.1,"VAL:CB":0,"VAL:CG1":0,"VAL:CG2":0,"VAL:C":.6,"VAL:O":-.55};function S(w,O){if((!O||typeof w.partialCharge>"u")&&w.resn&&w.atom){var p=w.resn+":"+w.atom;w.properties.partialCharge=A[p]}}},"./src/specs.ts":(K,C,d)=>{d.r(C)},"./src/utilities.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{PausableTimer:()=>PausableTimer,adjustVolumeStyle:()=>adjustVolumeStyle,base64ToArray:()=>base64ToArray,deepCopy:()=>deepCopy,download:()=>download,extend:()=>extend,get:()=>get,getAtomProperty:()=>getAtomProperty,getColorFromStyle:()=>getColorFromStyle,getElement:()=>getElement,getExtent:()=>getExtent,getPropertyRange:()=>getPropertyRange,getbin:()=>getbin,inflateString:()=>inflateString,isEmptyObject:()=>isEmptyObject,isNumeric:()=>isNumeric,makeFunction:()=>makeFunction,mergeGeos:()=>mergeGeos,specStringToObject:()=>specStringToObject});var _Gradient__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/Gradient.ts"),_VolumeData__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/VolumeData.ts"),_colors__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/colors.ts"),pako__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/pako/dist/pako.esm.mjs");function extend(K,C){for(var d in C)C.hasOwnProperty(d)&&C[d]!==void 0&&(K[d]=C[d]);return K}function deepCopy(K){let C,d,A;if(K==null)return{};if(typeof K!="object"||K===null)return K;C=Array.isArray(K)?[]:{};for(A in K)d=K[A],C[A]=deepCopy(d);return C}function isNumeric(K){var C=typeof K;return(C==="number"||C==="string")&&!isNaN(K-parseFloat(K))}function isEmptyObject(K){return Object.keys(K).length===0}function makeFunction(callback){return callback&&typeof callback=="string"&&(callback=eval("("+callback+")")),callback&&typeof callback!="function"?(console.warn("Invalid callback provided."),()=>{}):callback}function adjustVolumeStyle(K){K&&(K.volformat&&!(K.voldata instanceof _VolumeData__WEBPACK_IMPORTED_MODULE_1__.VolumeData)&&(K.voldata=new _VolumeData__WEBPACK_IMPORTED_MODULE_1__.VolumeData(K.voldata,K.volformat)),K.volscheme&&(K.volscheme=_Gradient__WEBPACK_IMPORTED_MODULE_0__.Gradient.getGradient(K.volscheme)))}function getExtent(K,C){var d,A,S,w,O,p,x,M,v,b,_=!C;if(d=A=S=9999,w=O=p=-9999,x=M=v=b=0,K.length===0)return[[0,0,0],[0,0,0],[0,0,0]];for(var g=0;g<K.length;g++){var m=K[g];if(!(typeof m>"u"||!isFinite(m.x)||!isFinite(m.y)||!isFinite(m.z))&&(b++,x+=m.x,M+=m.y,v+=m.z,d=d<m.x?d:m.x,A=A<m.y?A:m.y,S=S<m.z?S:m.z,w=w>m.x?w:m.x,O=O>m.y?O:m.y,p=p>m.z?p:m.z,m.symmetries&&_))for(var r=0;r<m.symmetries.length;r++)b++,x+=m.symmetries[r].x,M+=m.symmetries[r].y,v+=m.symmetries[r].z,d=d<m.symmetries[r].x?d:m.symmetries[r].x,A=A<m.symmetries[r].y?A:m.symmetries[r].y,S=S<m.symmetries[r].z?S:m.symmetries[r].z,w=w>m.symmetries[r].x?w:m.symmetries[r].x,O=O>m.symmetries[r].y?O:m.symmetries[r].y,p=p>m.symmetries[r].z?p:m.symmetries[r].z}return[[d,A,S],[w,O,p],[x/b,M/b,v/b]]}function getPropertyRange(K,C){for(var d=Number.POSITIVE_INFINITY,A=Number.NEGATIVE_INFINITY,S=0,w=K.length;S<w;S++){var O=K[S],p=getAtomProperty(O,C);p!=null&&(p<d&&(d=p),p>A&&(A=p))}return!isFinite(d)&&!isFinite(A)?d=A=0:isFinite(d)?isFinite(A)||(A=d):d=A,[d,A]}class PausableTimer{constructor(C,d,A){this.total_time_run=0,this.fn=C,this.arg=A,this.countdown=d,this.start_time=new Date().getTime(),this.ident=setTimeout(C,d,A)}cancel(){clearTimeout(this.ident)}pause(){clearTimeout(this.ident),this.total_time_run=new Date().getTime()-this.start_time}resume(){this.ident=setTimeout(this.fn,Math.max(0,this.countdown-this.total_time_run),this.arg)}}function base64ToArray(K){for(var C=window.atob(K),d=C.length,A=new Uint8Array(d),S=0;S<d;S++)A[S]=C.charCodeAt(S);return A}function getAtomProperty(K,C){var d=null;return K.properties&&typeof K.properties[C]<"u"?d=K.properties[C]:typeof K[C]<"u"&&(d=K[C]),d}function mergeGeos(K,C){var d=C.geometry;d!==void 0&&K.geometryGroups.push(d.geometryGroups[0])}function specStringToObject(K){if(typeof K=="object")return K;if(typeof K>"u"||K==null)return K;try{return JSON.parse(K)}catch{}K=K.replace(/%7E/g,"~");var C=function(_){return isNumeric(_)?Math.floor(parseFloat(_))==parseInt(_)||_.indexOf(".")>=0?parseFloat(_):parseInt(_):_==="true"?!0:_==="false"?!1:_},d={};if(K==="all")return d;for(var A=K.split(";"),S=0;S<A.length;S++){var w=A[S].split(":"),O=w[0],p={},x=w[1];if(x)if(x=x.replace(/~/g,"="),x.indexOf("=")!==-1)for(var M=x.split(","),v=0;v<M.length;v++){var b=M[v].split("=",2);p[b[0]]=C(b[1])}else x.indexOf(",")!==-1?p=x.split(","):p=C(x);d[O]=p}return d}function checkStatus(K){if(!K.ok)throw new Error(`HTTP ${K.status} - ${K.statusText}`);return K}function get(K,C){var d=fetch(K).then(checkStatus).then(A=>A.text());return C?d.then(C):d}function getbin(K,C,d,A){var S;return d=="POST"?S=fetch(K,{method:"POST",body:A}).then(w=>checkStatus(w)).then(w=>w.arrayBuffer()):S=fetch(K).then(w=>checkStatus(w)).then(w=>w.arrayBuffer()),C?S.then(C):S}function download(K,C,d,A){var S="",w="",O="",p=null,x=C.addModel();if(K.indexOf(":")<0&&(K.length==4?K="pdb:"+K:isNaN(K)?K="url:"+K:K="cid:"+K),K.substring(0,5)=="mmtf:"&&(console.warn("WARNING: MMTF now deprecated.  Reverting to bcif."),K="bcif:"+K.slice(5)),K.substring(0,5)==="bcif:")K=K.substring(5).toUpperCase(),O="https://models.rcsb.org/"+K+".bcif.gz",d&&typeof d.noComputeSecondaryStructure>"u"&&(d.noComputeSecondaryStructure=!0),p=new Promise(function(v){getbin(O).then(function(b){x.addMolData(b,"bcif.gz",d),C.zoomTo(),C.render(),v(x)},function(){console.error("fetch of "+O+" failed.")})});else{if(K.substring(0,4)==="pdb:"){if(S="bcif",d&&d.format&&(S=d.format),d&&typeof d.noComputeSecondaryStructure>"u"&&(d.noComputeSecondaryStructure=!0),K=K.substring(4).toUpperCase(),!K.match(/^[1-9][A-Za-z0-9]{3}$/)){alert("Wrong PDB ID");return}S=="bcif"?O="https://models.rcsb.org/"+K.toUpperCase()+".bcif.gz":(w=d&&d.pdbUri?d.pdbUri:"https://files.rcsb.org/view/",O=w+K+"."+S)}else if(K.substring(0,4)=="cid:"){if(S="sdf",K=K.substring(4),!K.match(/^[0-9]+$/)){alert("Wrong Compound ID");return}O="https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+K+"/SDF?record_type=3d"}else K.substring(0,4)=="url:"&&(O=K.substring(4),S=O);var M=function(v){x.addMolData(v,S,d),C.zoomTo(),C.render()};p=new Promise(function(v){S=="bcif"?getbin(O).then(function(b){M(b),v(x)}).catch(function(){w=d&&d.pdbUri?d.pdbUri:"https://files.rcsb.org/view/",O=w+K+".pdb",S="pdb",console.warn("falling back to pdb format"),get(O).then(function(b){M(b),v(x)}).catch(function(b){M(""),v(x),console.error("fetch of "+O+" failed: "+b.statusText)})}):get(O).then(function(b){M(b),v(x)}).catch(function(b){M(""),v(x),console.error("fetch of "+O+" failed: "+b.statusText)})})}return A?(p.then(function(v){A(v)}),x):p}function getColorFromStyle(K,C){let d=C.colorscheme;if(typeof _colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[d]<"u")d=_colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[d];else if(typeof d=="string"&&d.endsWith("Carbon")){let O=d.substring(0,d.lastIndexOf("Carbon")).toLowerCase();if(typeof _colors__WEBPACK_IMPORTED_MODULE_2__.htmlColors[O]<"u"){let p=Object.assign({},_colors__WEBPACK_IMPORTED_MODULE_2__.elementColors.defaultColors);p.C=_colors__WEBPACK_IMPORTED_MODULE_2__.htmlColors[O],_colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[d]={prop:"elem",map:p},d=_colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[d]}}let A=K.color;if(typeof C.color<"u"&&C.color!="spectrum"&&(A=C.color),typeof d<"u"){let O,p;if(typeof _colors__WEBPACK_IMPORTED_MODULE_2__.elementColors[d]<"u")d=_colors__WEBPACK_IMPORTED_MODULE_2__.elementColors[d],typeof d[K[d.prop]]<"u"&&(A=d.map[K[d.prop]]);else if(typeof d[K[d.prop]]<"u")A=d.map[K[d.prop]];else if(typeof d.prop<"u"&&typeof d.gradient<"u"){O=d.prop;var S=d.gradient;S instanceof _Gradient__WEBPACK_IMPORTED_MODULE_0__.GradientType||(S=(0,_Gradient__WEBPACK_IMPORTED_MODULE_0__.getGradient)(d));let x=S.range()||[-1,1];p=getAtomProperty(K,O),p!=null&&(A=S.valueToHex(p,x))}else typeof d.prop<"u"&&typeof d.map<"u"?(O=d.prop,p=getAtomProperty(K,O),typeof d.map[p]<"u"&&(A=d.map[p])):typeof C.colorscheme[K.elem]<"u"?A=C.colorscheme[K.elem]:console.warn("Could not interpret colorscheme "+d)}else typeof C.colorfunc<"u"&&(A=C.colorfunc(K));return _colors__WEBPACK_IMPORTED_MODULE_2__.CC.color(A)}function getElement(K){let C=K;return typeof K=="string"?C=document.querySelector("#"+K):typeof K=="object"&&K.get&&(C=K.get(0)),C}function inflateString(K,C=!0){let d;return typeof K=="string"?d=new TextEncoder().encode(K):d=new Uint8Array(K),(0,pako__WEBPACK_IMPORTED_MODULE_3__.inflate)(d,{to:C?"string":null})}},"./src/vendor/mmtf.js":function(K,C){(function(d,A){A(C)})(this,function(d){function A(k,Z,Y){for(var ue=(k.byteLength,0),fe=Y.length;fe>ue;ue++){var Ee=Y.charCodeAt(ue);if(128>Ee)k.setUint8(Z++,Ee>>>0&127|0);else if(2048>Ee)k.setUint8(Z++,Ee>>>6&31|192),k.setUint8(Z++,Ee>>>0&63|128);else if(65536>Ee)k.setUint8(Z++,Ee>>>12&15|224),k.setUint8(Z++,Ee>>>6&63|128),k.setUint8(Z++,Ee>>>0&63|128);else{if(!(1114112>Ee))throw new Error("bad codepoint "+Ee);k.setUint8(Z++,Ee>>>18&7|240),k.setUint8(Z++,Ee>>>12&63|128),k.setUint8(Z++,Ee>>>6&63|128),k.setUint8(Z++,Ee>>>0&63|128)}}}function S(k){for(var Z=0,Y=0,ue=k.length;ue>Y;Y++){var fe=k.charCodeAt(Y);if(128>fe)Z+=1;else if(2048>fe)Z+=2;else if(65536>fe)Z+=3;else{if(!(1114112>fe))throw new Error("bad codepoint "+fe);Z+=4}}return Z}function w(k,Z,Y){var ue=typeof k;if(ue==="string"){var fe=S(k);if(32>fe)return Z.setUint8(Y,160|fe),A(Z,Y+1,k),1+fe;if(256>fe)return Z.setUint8(Y,217),Z.setUint8(Y+1,fe),A(Z,Y+2,k),2+fe;if(65536>fe)return Z.setUint8(Y,218),Z.setUint16(Y+1,fe),A(Z,Y+3,k),3+fe;if(4294967296>fe)return Z.setUint8(Y,219),Z.setUint32(Y+1,fe),A(Z,Y+5,k),5+fe}if(k instanceof Uint8Array){var fe=k.byteLength,Ee=new Uint8Array(Z.buffer);if(256>fe)return Z.setUint8(Y,196),Z.setUint8(Y+1,fe),Ee.set(k,Y+2),2+fe;if(65536>fe)return Z.setUint8(Y,197),Z.setUint16(Y+1,fe),Ee.set(k,Y+3),3+fe;if(4294967296>fe)return Z.setUint8(Y,198),Z.setUint32(Y+1,fe),Ee.set(k,Y+5),5+fe}if(ue==="number"){if(!isFinite(k))throw new Error("Number not finite: "+k);if(Math.floor(k)!==k)return Z.setUint8(Y,203),Z.setFloat64(Y+1,k),9;if(k>=0){if(128>k)return Z.setUint8(Y,k),1;if(256>k)return Z.setUint8(Y,204),Z.setUint8(Y+1,k),2;if(65536>k)return Z.setUint8(Y,205),Z.setUint16(Y+1,k),3;if(4294967296>k)return Z.setUint8(Y,206),Z.setUint32(Y+1,k),5;throw new Error("Number too big 0x"+k.toString(16))}if(k>=-32)return Z.setInt8(Y,k),1;if(k>=-128)return Z.setUint8(Y,208),Z.setInt8(Y+1,k),2;if(k>=-32768)return Z.setUint8(Y,209),Z.setInt16(Y+1,k),3;if(k>=-2147483648)return Z.setUint8(Y,210),Z.setInt32(Y+1,k),5;throw new Error("Number too small -0x"+(-k).toString(16).substr(1))}if(k===null)return Z.setUint8(Y,192),1;if(ue==="boolean")return Z.setUint8(Y,k?195:194),1;if(ue==="object"){var fe,ae=0,we=Array.isArray(k);if(we)fe=k.length;else{var N=Object.keys(k);fe=N.length}var ae;if(16>fe?(Z.setUint8(Y,fe|(we?144:128)),ae=1):65536>fe?(Z.setUint8(Y,we?220:222),Z.setUint16(Y+1,fe),ae=3):4294967296>fe&&(Z.setUint8(Y,we?221:223),Z.setUint32(Y+1,fe),ae=5),we)for(var ve=0;fe>ve;ve++)ae+=w(k[ve],Z,Y+ae);else for(var ve=0;fe>ve;ve++){var Le=N[ve];ae+=w(Le,Z,Y+ae),ae+=w(k[Le],Z,Y+ae)}return ae}throw new Error("Unknown type "+ue)}function O(k){var Z=typeof k;if(Z==="string"){var Y=S(k);if(32>Y)return 1+Y;if(256>Y)return 2+Y;if(65536>Y)return 3+Y;if(4294967296>Y)return 5+Y}if(k instanceof Uint8Array){var Y=k.byteLength;if(256>Y)return 2+Y;if(65536>Y)return 3+Y;if(4294967296>Y)return 5+Y}if(Z==="number"){if(Math.floor(k)!==k)return 9;if(k>=0){if(128>k)return 1;if(256>k)return 2;if(65536>k)return 3;if(4294967296>k)return 5;throw new Error("Number too big 0x"+k.toString(16))}if(k>=-32)return 1;if(k>=-128)return 2;if(k>=-32768)return 3;if(k>=-2147483648)return 5;throw new Error("Number too small -0x"+k.toString(16).substr(1))}if(Z==="boolean"||k===null)return 1;if(Z==="object"){var Y,ue=0;if(Array.isArray(k)){Y=k.length;for(var fe=0;Y>fe;fe++)ue+=O(k[fe])}else{var Ee=Object.keys(k);Y=Ee.length;for(var fe=0;Y>fe;fe++){var we=Ee[fe];ue+=O(we)+O(k[we])}}if(16>Y)return 1+ue;if(65536>Y)return 3+ue;if(4294967296>Y)return 5+ue;throw new Error("Array or object too long 0x"+Y.toString(16))}throw new Error("Unknown type "+Z)}function p(k){var Z=new ArrayBuffer(O(k)),Y=new DataView(Z);return w(k,Y,0),new Uint8Array(Z)}function x(k,Z,Y){return Z?new k(Z.buffer,Z.byteOffset,Z.byteLength/(Y||1)):void 0}function M(k){return x(DataView,k)}function v(k){return x(Uint8Array,k)}function b(k){return x(Int8Array,k)}function _(k){return x(Int32Array,k,4)}function g(k){return x(Float32Array,k,4)}function m(k,Z){var Y=k.length/2;Z||(Z=new Int16Array(Y));for(var ue=0,fe=0;Y>ue;++ue,fe+=2)Z[ue]=k[fe]<<8^k[fe+1]<<0;return Z}function r(k,Z){var Y=k.length;Z||(Z=new Uint8Array(2*Y));for(var ue=M(Z),fe=0;Y>fe;++fe)ue.setInt16(2*fe,k[fe]);return v(Z)}function e(k,Z){var Y=k.length/4;Z||(Z=new Int32Array(Y));for(var ue=0,fe=0;Y>ue;++ue,fe+=4)Z[ue]=k[fe]<<24^k[fe+1]<<16^k[fe+2]<<8^k[fe+3]<<0;return Z}function t(k,Z){var Y=k.length;Z||(Z=new Uint8Array(4*Y));for(var ue=M(Z),fe=0;Y>fe;++fe)ue.setInt32(4*fe,k[fe]);return v(Z)}function n(k,Z){var Y=k.length;Z||(Z=new Float32Array(Y/4));for(var ue=M(Z),fe=M(k),Ee=0,we=0,N=Y/4;N>Ee;++Ee,we+=4)ue.setFloat32(we,fe.getFloat32(we),!0);return Z}function o(k,Z,Y){var ue=k.length,fe=1/Z;Y||(Y=new Float32Array(ue));for(var Ee=0;ue>Ee;++Ee)Y[Ee]=k[Ee]*fe;return Y}function h(k,Z,Y){var ue=k.length;Y||(Y=new Int32Array(ue));for(var fe=0;ue>fe;++fe)Y[fe]=Math.round(k[fe]*Z);return Y}function f(k,Z){var Y,ue;if(!Z){var fe=0;for(Y=0,ue=k.length;ue>Y;Y+=2)fe+=k[Y+1];Z=new k.constructor(fe)}var Ee=0;for(Y=0,ue=k.length;ue>Y;Y+=2)for(var we=k[Y],N=k[Y+1],ae=0;N>ae;++ae)Z[Ee]=we,++Ee;return Z}function i(k){if(k.length===0)return new Int32Array;var Z,Y,ue=2;for(Z=1,Y=k.length;Y>Z;++Z)k[Z-1]!==k[Z]&&(ue+=2);var fe=new Int32Array(ue),Ee=0,we=1;for(Z=1,Y=k.length;Y>Z;++Z)k[Z-1]!==k[Z]?(fe[Ee]=k[Z-1],fe[Ee+1]=we,we=1,Ee+=2):++we;return fe[Ee]=k[k.length-1],fe[Ee+1]=we,fe}function s(k,Z){var Y=k.length;Z||(Z=new k.constructor(Y)),Y&&(Z[0]=k[0]);for(var ue=1;Y>ue;++ue)Z[ue]=k[ue]+Z[ue-1];return Z}function a(k,Z){var Y=k.length;Z||(Z=new k.constructor(Y)),Z[0]=k[0];for(var ue=1;Y>ue;++ue)Z[ue]=k[ue]-k[ue-1];return Z}function c(k,Z){var Y,ue,fe=k instanceof Int8Array?127:32767,Ee=-fe-1,we=k.length;if(!Z){var N=0;for(Y=0;we>Y;++Y)k[Y]<fe&&k[Y]>Ee&&++N;Z=new Int32Array(N)}for(Y=0,ue=0;we>Y;){for(var ae=0;k[Y]===fe||k[Y]===Ee;)ae+=k[Y],++Y;ae+=k[Y],++Y,Z[ue]=ae,++ue}return Z}function u(k,Z){var Y,ue=32767,fe=-ue-1,Ee=k.length,we=0;for(Y=0;Ee>Y;++Y){var N=k[Y];N===0?++we:N>0?(we+=Math.ceil(N/ue),N%ue===0&&(we+=1)):(we+=Math.ceil(N/fe),N%fe===0&&(we+=1))}var ae=Z?new Int8Array(we):new Int16Array(we),ve=0;for(Y=0;Ee>Y;++Y){var N=k[Y];if(N>=0)for(;N>=ue;)ae[ve]=ue,++ve,N-=ue;else for(;fe>=N;)ae[ve]=fe,++ve,N-=fe;ae[ve]=N,++ve}return ae}function E(k,Z){return s(f(k),Z)}function T(k){return i(a(k))}function L(k,Z,Y){return o(f(k,_(Y)),Z,Y)}function P(k,Z){return i(h(k,Z))}function I(k,Z,Y){return o(s(k,_(Y)),Z,Y)}function z(k,Z,Y){return a(h(k,Z),Y)}function B(k,Z,Y){return o(c(k,_(Y)),Z,Y)}function F(k,Z,Y){var ue=c(k,_(Y));return I(ue,Z,g(ue))}function W(k,Z,Y){return u(z(k,Z),Y)}function U(Ee){var Z=M(Ee),Y=Z.getInt32(0),ue=Z.getInt32(4),fe=Ee.subarray(8,12),Ee=Ee.subarray(12);return[Y,Ee,ue,fe]}function R(k,Z,Y,ue){var fe=new ArrayBuffer(12+ue.byteLength),Ee=new Uint8Array(fe),we=new DataView(fe);return we.setInt32(0,k),we.setInt32(4,Z),Y&&Ee.set(Y,8),Ee.set(ue,12),Ee}function V(k){var Z=k.length,Y=v(k);return R(2,Z,void 0,Y)}function q(k){var Z=k.length,Y=t(k);return R(4,Z,void 0,Y)}function ee(k,Z){var Y=k.length/Z,ue=t([Z]),fe=v(k);return R(5,Y,ue,fe)}function se(k){var Z=k.length,Y=t(i(k));return R(6,Z,void 0,Y)}function ie(k){var Z=k.length,Y=t(T(k));return R(8,Z,void 0,Y)}function le(k,Z){var Y=k.length,ue=t([Z]),fe=t(P(k,Z));return R(9,Y,ue,fe)}function re(k,Z){var Y=k.length,ue=t([Z]),fe=r(W(k,Z));return R(10,Y,ue,fe)}function oe(k){var Z={};return ze.forEach(function(Y){k[Y]!==void 0&&(Z[Y]=k[Y])}),k.bondAtomList&&(Z.bondAtomList=q(k.bondAtomList)),k.bondOrderList&&(Z.bondOrderList=V(k.bondOrderList)),Z.xCoordList=re(k.xCoordList,1e3),Z.yCoordList=re(k.yCoordList,1e3),Z.zCoordList=re(k.zCoordList,1e3),k.bFactorList&&(Z.bFactorList=re(k.bFactorList,100)),k.atomIdList&&(Z.atomIdList=ie(k.atomIdList)),k.altLocList&&(Z.altLocList=se(k.altLocList)),k.occupancyList&&(Z.occupancyList=le(k.occupancyList,100)),Z.groupIdList=ie(k.groupIdList),Z.groupTypeList=q(k.groupTypeList),k.secStructList&&(Z.secStructList=V(k.secStructList)),k.insCodeList&&(Z.insCodeList=se(k.insCodeList)),k.sequenceIndexList&&(Z.sequenceIndexList=ie(k.sequenceIndexList)),Z.chainIdList=ee(k.chainIdList,4),k.chainNameList&&(Z.chainNameList=ee(k.chainNameList,4)),Z}function Ae(k){function Z(ae){for(var ve={},Le=0;ae>Le;Le++){var ne=Ee();ve[ne]=Ee()}return ve}function Y(ae){var ve=k.subarray(we,we+ae);return we+=ae,ve}function ue(ae){var ve=k.subarray(we,we+ae);we+=ae;var Le=65535;if(ae>Le){for(var ne=[],ye=0;ye<ve.length;ye+=Le)ne.push(String.fromCharCode.apply(null,ve.subarray(ye,ye+Le)));return ne.join("")}return String.fromCharCode.apply(null,ve)}function fe(ae){for(var ve=new Array(ae),Le=0;ae>Le;Le++)ve[Le]=Ee();return ve}function Ee(){var ae,ve,Le=k[we];if((128&Le)===0)return we++,Le;if((240&Le)===128)return ve=15&Le,we++,Z(ve);if((240&Le)===144)return ve=15&Le,we++,fe(ve);if((224&Le)===160)return ve=31&Le,we++,ue(ve);if((224&Le)===224)return ae=N.getInt8(we),we++,ae;switch(Le){case 192:return we++,null;case 194:return we++,!1;case 195:return we++,!0;case 196:return ve=N.getUint8(we+1),we+=2,Y(ve);case 197:return ve=N.getUint16(we+1),we+=3,Y(ve);case 198:return ve=N.getUint32(we+1),we+=5,Y(ve);case 202:return ae=N.getFloat32(we+1),we+=5,ae;case 203:return ae=N.getFloat64(we+1),we+=9,ae;case 204:return ae=k[we+1],we+=2,ae;case 205:return ae=N.getUint16(we+1),we+=3,ae;case 206:return ae=N.getUint32(we+1),we+=5,ae;case 208:return ae=N.getInt8(we+1),we+=2,ae;case 209:return ae=N.getInt16(we+1),we+=3,ae;case 210:return ae=N.getInt32(we+1),we+=5,ae;case 217:return ve=N.getUint8(we+1),we+=2,ue(ve);case 218:return ve=N.getUint16(we+1),we+=3,ue(ve);case 219:return ve=N.getUint32(we+1),we+=5,ue(ve);case 220:return ve=N.getUint16(we+1),we+=3,fe(ve);case 221:return ve=N.getUint32(we+1),we+=5,fe(ve);case 222:return ve=N.getUint16(we+1),we+=3,Z(ve);case 223:return ve=N.getUint32(we+1),we+=5,Z(ve)}throw new Error("Unknown type 0x"+Le.toString(16))}var we=0,N=new DataView(k.buffer);return Ee()}function Me(k,Z,Y,ue){switch(k){case 1:return n(Z);case 2:return b(Z);case 3:return m(Z);case 4:return e(Z);case 5:return v(Z);case 6:return f(e(Z),new Uint8Array(Y));case 7:return f(e(Z));case 8:return E(e(Z));case 9:return L(e(Z),e(ue)[0]);case 10:return F(m(Z),e(ue)[0]);case 11:return o(m(Z),e(ue)[0]);case 12:return B(m(Z),e(ue)[0]);case 13:return B(b(Z),e(ue)[0]);case 14:return c(m(Z));case 15:return c(b(Z))}}function Oe(k,Z){Z=Z||{};var Y=Z.ignoreFields,ue={};return Ie.forEach(function(fe){var Ee=Y?Y.indexOf(fe)!==-1:!1,we=k[fe];Ee||we===void 0||(we instanceof Uint8Array?ue[fe]=Me.apply(null,U(we)):ue[fe]=we)}),ue}function _e(k){return String.fromCharCode.apply(null,k).replace(/\0/g,"")}function Q(k,Z,Y){Y=Y||{};var ue,fe,Ee,we,N,ae,ve=Y.firstModelOnly,Le=Z.onModel,ne=Z.onChain,ye=Z.onGroup,j=Z.onAtom,De=Z.onBond,Re=0,D=0,ce=0,de=0,H=0,te=-1,pe=k.chainNameList,ke=k.secStructList,je=k.insCodeList,Ve=k.sequenceIndexList,Qe=k.atomIdList,_t=k.bFactorList,et=k.altLocList,$e=k.occupancyList,Je=k.bondAtomList,gt=k.bondOrderList;for(ue=0,fe=k.chainsPerModel.length;fe>ue&&!(ve&&Re>0);++ue){var ft=k.chainsPerModel[Re];for(Le&&Le({chainCount:ft,modelIndex:Re}),Ee=0;ft>Ee;++Ee){var Ot=k.groupsPerChain[D];if(ne){var Dt=_e(k.chainIdList.subarray(4*D,4*D+4)),vt=null;pe&&(vt=_e(pe.subarray(4*D,4*D+4))),ne({groupCount:Ot,chainIndex:D,modelIndex:Re,chainId:Dt,chainName:vt})}for(we=0;Ot>we;++we){var mt=k.groupList[k.groupTypeList[ce]],ct=mt.atomNameList.length;if(ye){var At=null;ke&&(At=ke[ce]);var yt=null;k.insCodeList&&(yt=String.fromCharCode(je[ce]));var Bt=null;Ve&&(Bt=Ve[ce]),ye({atomCount:ct,groupIndex:ce,chainIndex:D,modelIndex:Re,groupId:k.groupIdList[ce],groupType:k.groupTypeList[ce],groupName:mt.groupName,singleLetterCode:mt.singleLetterCode,chemCompType:mt.chemCompType,secStruct:At,insCode:yt,sequenceIndex:Bt})}for(N=0;ct>N;++N){if(j){var oi=null;Qe&&(oi=Qe[de]);var Ft=null;_t&&(Ft=_t[de]);var li=null;et&&(li=String.fromCharCode(et[de]));var hi=null;$e&&(hi=$e[de]),j({atomIndex:de,groupIndex:ce,chainIndex:D,modelIndex:Re,atomId:oi,element:mt.elementList[N],atomName:mt.atomNameList[N],formalCharge:mt.formalChargeList[N],xCoord:k.xCoordList[de],yCoord:k.yCoordList[de],zCoord:k.zCoordList[de],bFactor:Ft,altLoc:li,occupancy:hi})}de+=1}if(De){var fi=mt.bondAtomList;for(N=0,ae=mt.bondOrderList.length;ae>N;++N)De({atomIndex1:de-ct+fi[2*N],atomIndex2:de-ct+fi[2*N+1],bondOrder:mt.bondOrderList[N]})}ce+=1}D+=1}if(H=te+1,te=de-1,De&&Je)for(N=0,ae=Je.length;ae>N;N+=2){var di=Je[N],ci=Je[N+1];(di>=H&&te>=di||ci>=H&&te>=ci)&&De({atomIndex1:di,atomIndex2:ci,bondOrder:gt?gt[N/2]:null})}Re+=1}}function me(k){return p(oe(k))}function Ce(k,Z){k instanceof ArrayBuffer&&(k=new Uint8Array(k));var Y;return Y=k instanceof Uint8Array?Ae(k):k,Oe(Y,Z)}function Pe(k,Z,Y,ue){function fe(){try{var we=Ce(Ee.response);Y(we)}catch(N){ue(N)}}var Ee=new XMLHttpRequest;Ee.addEventListener("load",fe,!0),Ee.addEventListener("error",ue,!0),Ee.responseType="arraybuffer",Ee.open("GET",Z+k.toUpperCase()),Ee.send()}function We(k,Z,Y){Pe(k,Ge,Z,Y)}function Ue(k,Z,Y){Pe(k,Ne,Z,Y)}var ze=["mmtfVersion","mmtfProducer","unitCell","spaceGroup","structureId","title","depositionDate","releaseDate","experimentalMethods","resolution","rFree","rWork","bioAssemblyList","ncsOperatorList","entityList","groupList","numBonds","numAtoms","numGroups","numChains","numModels","groupsPerChain","chainsPerModel"],Be=["xCoordList","yCoordList","zCoordList","groupIdList","groupTypeList","chainIdList","bFactorList","atomIdList","altLocList","occupancyList","secStructList","insCodeList","sequenceIndexList","chainNameList","bondAtomList","bondOrderList"],Ie=ze.concat(Be),Se="v1.0.1",Te="//mmtf.rcsb.org/v1.0/",Ge=Te+"full/",Ne=Te+"reduced/";d.encode=me,d.decode=Ce,d.traverse=Q,d.fetch=We,d.fetchReduced=Ue,d.version=Se,d.fetchUrl=Ge,d.fetchReducedUrl=Ne,d.encodeMsgpack=p,d.encodeMmtf=oe,d.decodeMsgpack=Ae,d.decodeMmtf=Oe})}},__webpack_module_cache__={};function __webpack_require__(K){var C=__webpack_module_cache__[K];if(C!==void 0)return C.exports;var d=__webpack_module_cache__[K]={exports:{}};return __webpack_modules__[K].call(d.exports,d,d.exports,__webpack_require__),d.exports}__webpack_require__.n=K=>{var C=K&&K.__esModule?()=>K.default:()=>K;return __webpack_require__.d(C,{a:C}),C},__webpack_require__.d=(K,C)=>{for(var d in C)__webpack_require__.o(C,d)&&!__webpack_require__.o(K,d)&&Object.defineProperty(K,d,{enumerable:!0,get:C[d]})},__webpack_require__.o=(K,C)=>Object.prototype.hasOwnProperty.call(K,C),__webpack_require__.r=K=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(K,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(K,"__esModule",{value:!0})},__webpack_require__("./src/index.ts"),__webpack_require__("./src/SurfaceWorker.js");var __webpack_exports__=__webpack_require__("./src/exporter.js");return __webpack_exports__})())}(_3Dmol$3)),_3Dmol$3.exports}var _3DmolExports=require_3Dmol();const _3Dmol=getDefaultExportFromCjs(_3DmolExports),_3Dmol$1=_mergeNamespaces({__proto__:null,default:_3Dmol},[_3DmolExports]);export{_3Dmol$1 as _};
